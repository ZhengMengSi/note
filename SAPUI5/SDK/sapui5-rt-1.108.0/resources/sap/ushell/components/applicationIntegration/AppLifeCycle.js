// Copyright (c) 2009-2022 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/components/applicationIntegration/elements/model","sap/ushell/components/applicationIntegration/Storage","sap/ushell/components/applicationIntegration/application/BlueBoxHandler","sap/ushell/ui5service/ShellUIService","sap/ushell/components/applicationIntegration/application/Application","sap/ushell/components/applicationIntegration/relatedServices/RelatedServices","sap/ushell/components/applicationIntegration/relatedShellElements/RelatedShellElements","sap/ushell/components/applicationIntegration/configuration/AppMeta","sap/ushell/services/AppConfiguration","sap/ushell/utils","sap/ui/Device","sap/ushell/Config","sap/ushell/ApplicationType","sap/base/util/UriParameters","sap/ui/thirdparty/jquery","sap/base/Log","sap/ushell/EventHub","sap/ushell/utils/UrlParsing"],function(e,t,i,n,a,s,r,o,p,l,u,f,c,h,jQuery,d,g,C){"use strict";function m(){var m,v=["URL"],A,y,S,I={},b=false,T={},E={home:{embedded:"embedded-home",headerless:"headerless-home",merged:"blank-home",blank:"blank-home"},app:{minimal:"minimal",app:"app",standalone:"standalone",embedded:"embedded",headerless:"headerless",merged:"merged",home:"home",blank:"blank",lean:"lean"}},R,U=[],w={},F=false,P={FULL:"true",RESTRICTED:"restricted"};this.shellElements=function(){return r};this.service=function(){return s};this.isCurrentApp=function(e){return T.appId===e};this.isAppWithSimilarShellHashInCache=function(e,i){var n=t.get(e);if(n){if(n.shellHash===i){return true}return false}return false};this.isAppInCache=function(e){return!!t.get(e)};this.normalizeAppId=function(e){var t="-component",i=e.endsWith(t);if(i){return e.substring(0,e.length-t.length)}return e};this.onComponentCreated=function(e,i,n){var a=n.component,s=this.normalizeAppId(a.getId());if(this.isAppInCache(s)){t.get(s).app=a;this.active(s)}else{T.app=a;if(a.active){a.active()}}};this.onGetMe=function(e,t,i){i.AppLifeCycle=this};this.store=function(e){var i=t.get(e);if(i){a.store(i);o.store(i.meta);i.stateStored=true}};this.destroy=function(e,n,s){var p=t.get(e),l,u;function f(){if(n&&n.getUrl){i.deleteStateFul(n.getUrl())}a.destroy(n);r.destroy(n);o.destroy(n)}this.removeControl(e);if(p){l=i.getStateFul(n.getUrl());if(l&&i.isStatefulContainerSupported(l)){var c=i.getHandler();u=c.destroy(l,e)}else{p.container.destroy();i.deleteStateFul(n.getUrl());u=Promise.resolve()}t.remove(e);if(s){u.then(s.resolve)}}else{var h=n&&n.sendBeforeAppCloseEvent&&n.sendBeforeAppCloseEvent();if(h===undefined){f();if(s){s.resolve()}}else{h.then(function(){f();if(s){s.resolve()}},function(e){f();if(s){s.resolve()}d.error("FLP got a failed response from the iframe for the 'sap.ushell.services.CrossApplicationNavigation.beforeAppCloseEvent' message sent",e,"sap.ushell.components.applicationIntegration.AppLifeCycle.js")})}}};this.restore=function(e){var i=t.get(e);if(i&&i.stateStored===true){a.restore(i);s.restore(i.service);o.restore(i.meta)}};this.active=function(e){var i=t.get(e);if(i){a.active(i.app)}};this.handleExitStateful=function(e,n,a){var r,o=i.getHandler();if(t.get(e)){r=i.getStorageKey(n);if(s.isBackNavigation()===true&&!a){sap.ui.getCore().getEventBus().publish("sap.ushell","appClosed",n);t.remove(r);return o.destroy(n)}else{sap.ui.getCore().getEventBus().publish("sap.ushell","appClosed",n);return o.store(n,r)}}return o.destroy(n)};this.handleExitApplication=function(e,n,r,o,p){var l=this,u,f,c;if(r&&o&&o.getIframeReusedForApp&&o.getIframeReusedForApp()===true){o.setProperty("iframeReusedForApp",false,true);a.postMessageToIframeApp(o,"sap.ushell.sessionHandler","afterApplicationShow",{},false)}if(e&&n){if(n.getUrl()&&i.isStatefulContainerSupported(i.getStateFul(n.getUrl()))){f=this.handleExitStateful(e,n,p)}else if(t.get(e)){if(s.isBackNavigation()===true&&!p){c=new jQuery.Deferred;this.destroy(e,n,c);f=c.promise()}else{this.store(e)}sap.ui.getCore().getEventBus().publish("sap.ushell","appClosed",n)}else if(n.getIsStateful&&n.getIsStateful()){if(p){f=n.postMessageRequest("sap.gui.triggerCloseSessionImmediately")}}else{u=v.indexOf(n.getApplicationType)>=0;if(this.isAppOfTypeCached(e,u)===false){c=new jQuery.Deferred;this.destroy(e,n,c);f=c.promise()}}if(p===true){if(f===undefined){this.closeKeepAliveApps(O)}else{f.then(function(){l.closeKeepAliveApps(O)})}}if(e.indexOf("Shell-appfinder-component")>0){sap.ui.getCore().getEventBus().publish("sap.ushell","appFinderAfterNavigate")}}sap.ui.getCore().getEventBus().publish("relatedServices","resetBackNavigation");if(f===undefined){f=(new jQuery.Deferred).resolve().promise()}return f};function O(e){return e.value.keepAliveMode===P.RESTRICTED}this.closeKeepAliveApps=function(e,i){try{var n=this,a=[];t.forEach(function(t){if(e.apply(this,[t])===true){a.push(t.value)}});a.forEach(function(e){var t;if(i){t=new jQuery.Deferred;i.push(t.promise())}n.destroy(e.appId,e.container,t)})}catch(e){d.error("Error: sap.ushell.services.appLifeCycle.closeOtherKeepAliveRestrictedApps:"+e)}};this.onBeforeNavigate=function(e,n,s,r){if(e&&n){if(n.getUrl()&&(i.isStatefulContainerSupported(i.getStateFul(n.getUrl()))||t.get(e)||n.getIsStateful&&n.getIsStateful())){a.postMessageToIframeApp(n,"sap.ushell.sessionHandler","beforeApplicationHide",{},false)}}};this.onAfterNavigate=function(e,i,n,s){var r=n.indexOf("Shell-appfinder-component")>0||n.indexOf("Shell-home-component")>0||n.indexOf("pages-component-container")>0||n.indexOf("homeApp-component-container")>0||n.indexOf("workPageRuntime-component-container")>0||n.indexOf("runtimeSwitcher-component-container")>0;this.handleExitApplication(e,i,n,s,r);if(r===true){a.setActiveAppContainer(undefined)}if(n){if(t.get(n)){this.restore(n)}else{}}};this.storeApp=function(e,n,a,s,o){if(!this.isAppInCache(e)){if(n.setProperty){n.setProperty("isKeepAlive",true,true)}t.set(e,{service:{},shellHash:s,appId:e,stt:"loading",appRelatedElements:r.getAppRelatedElement(),container:n,meta:p.getMetadata(a),app:undefined,keepAliveMode:o&&(o.globalValue||o.paramValue),appTarget:a,ui5ComponentName:a&&a.ui5ComponentName,enableRouterRetrigger:true,stateStored:false});I[s]=e;i.setStorageKey(n,e);return true}return false};this.restoreApp=function(e){if(this.isAppInCache(e)){T=t.get(e);if(i.getStorageKey(T.container)){i.setStorageKey(T.container,e)}}};this.isAppOfTypeCached=function(e,t,i){var n;if(!b&&e.indexOf(A)!==-1){return true}if(!b&&e.indexOf("Shell-appfinder")!==-1){return true}n=new h(window.location.href).get("sap-keep-alive");if(n===P.FULL||n===P.RESTRICTED){if(i){i.globalValue=n}return true}return false};this.isCachedEnabledAsAppParameter=function(e,t,i){var n;n=e&&e.params&&e.params["sap-keep-alive"];if(n===P.FULL||n===P.RESTRICTED){if(i){i.paramValue=n}return true}if(t&&t.url){n=new h(t.url).get("sap-keep-alive");if(n===P.FULL||n===P.RESTRICTED){if(i){i.paramValue=n}return true}}return false};this.calculateAppType=function(e){if(e.applicationType==="URL"&&e.additionalInformation&&e.additionalInformation.startsWith("SAPUI5.Component=")){return"SAPUI5"}return e.applicationType};this.getStatefulCapabilities=function(e){if(e.appCapabilities&&e.appCapabilities&&e.appCapabilities.statefulContainer){return e.appCapabilities.statefulContainer}return undefined};this.isNotifyInnerAppRouteChangeEnabled=function(e){if(e.appCapabilities&&e.appCapabilities.notifyInnerAppRouteChange){return true}return false};this.isStatefulCapabilityEnabled=function(e){var t=this.getStatefulCapabilities(e);if(t&&(t.enabled===true||t===true)){return true}return false};this.isGUICapabilityEnabled=function(e){var t=this.getStatefulCapabilities(e);if(t&&t.protocol==="GUI"){return true}return false};this.isFLPCapabilityEnabled=function(e){return!this.isGUICapabilityEnabled(e)&&this.isStatefulCapabilityEnabled(e)};this.isGUIStatefulCapabilityEnabled=function(e){return this.isGUICapabilityEnabled(e)&&this.isStatefulCapabilityEnabled(e)};this.openApp=function(e,t,n,a){var s,r,o=v.indexOf(t.applicationType)>=0,l,u,f={globalValue:undefined,paramValue:undefined};var c="application"+e;s=i.getStateFul(t.url);if(s&&i.isStatefulContainerSupported(s)){if(this.isAppOfTypeCached(c,o,f)||this.isCachedEnabledAsAppParameter(n,t,f)){if(!this.isAppInCache(c)){this.storeApp(c,s,t,a,f)}this.restoreApp(c)}else{T={appId:c,stt:"loading",container:s,meta:p.getMetadata(t),app:undefined}}}else if(this.isAppOfTypeCached(c,o,f)||this.isCachedEnabledAsAppParameter(n,t,f)){if(!this.isAppInCache(c)){r=n.semanticObject+"-"+n.action;l=i.getById("application-"+r)||this.getControl(r);if(l){u=l.getUrl();i.removeCapabilities(l);this.destroy("application-"+r,l);i.deleteStateFul(u)}s=this.createApplicationContainer(e,t);this.storeApp(c,s,t,a,f);i.set(t.url,s)}this.restoreApp(c)}else if(t.applicationType==="TR"||t.appCapabilities&&t.appCapabilities.appFrameworkId==="GUI"){if(n){r=n.semanticObject+"-"+n.action;l=i.getById("application-"+r)||this.getControl(r);if(l){u=l.getUrl();i.removeCapabilities(l);this.destroy("application-"+r,l);i.deleteStateFul(u)}}s=this.getWebGuiV1StatefulContainer(t.url);if(!s){s=this.createApplicationContainer(e,t);i.set(t.url,s)}T={appId:c,stt:"loading",container:s,meta:p.getMetadata(t),app:undefined}}else{if(s){r=n.semanticObject+"-"+n.action;this.removeApplication(r)}else if(t.applicationType==="URL"||t.applicationType==="TR"||t.applicationType==="NWBC"){r=n.semanticObject+"-"+n.action;l=i.getById("application-"+r)||this.getControl(r);if(l){u=l.getUrl();i.removeCapabilities(l);this.destroy("application-"+r,l);i.deleteStateFul(u)}}s=this.createApplicationContainer(e,t);i.set(t.url,s);if(i.isCapUT(s,"isFLP")){i.setCapabilities(s,[{service:"sap.ushell.services.appLifeCycle",action:"create"},{service:"sap.ushell.services.appLifeCycle",action:"destroy"}])}T={appId:c,stt:"loading",container:s,meta:p.getMetadata(t),app:undefined}}};this.getAppMeta=function(){return o};this.evict=function(e){var t,n=e.value,a=e.key;this.removeControl(a);if(n.container.getUrl&&n.container.getUrl()){t=i.getStateFul(n.container.getUrl())}if(t){var s=i.getHandler();s.destroy(t,a)}else{n.container.destroy()}};this.addEvents=function(){var e=false;return function(){if(!e){e=true;var i=this;g.on("disableKeepAliveRestoreRouterRetrigger").do(function(e){var i=e.intent.semanticObject+"-"+e.intent.action;var n="application-"+i;if(t.get(n)){t.get(n).enableRouterRetrigger=e.disable}});g.on("setApplicationFullWidth").do(function(e){i.setApplicationFullWidth(e.bValue)})}}}();this.init=function(e,a,s,p,l,f,c){var h=this,g;if(u.system.phone){g=10;if(c&&c.limit&&c.limit.phone){g=c.limit.phone}}else if(u.system.tablet){g=10;if(c&&c.limit&&c.limit.tablet){g=c.limit.tablet}}else if(u.system.desktop){g=15;if(c&&c.limit&&c.limit.desktop){g=c.limit.desktop}}else{g=10}y=new n({scopeObject:l.ownerComponent,scopeType:"component"});S=e;m=a;A=s;o.init(A);b=p;i.init({oShellUIService:y},c,this);t.init(g,function(e){this.evict(e)}.bind(this));this.registerShellCommunicationHandler({"sap.ushell.services.appLifeCycle":{oRequestCalls:{create:{isActiveOnly:true,distributionType:["URL"],fnResponseHandler:function(e){e.then(function(e){d.info("sap.ushell.services.appLifeCycle.create:"+e)}).catch(function(e){d.error("Error: sap.ushell.services.appLifeCycle.create:"+e)})}},destroy:{isActiveOnly:true,distributionType:["URL"],fnResponseHandler:function(e){e.then(function(e){d.info("sap.ushell.services.appLifeCycle.destroy:"+e)}).catch(function(e){d.error("Error: sap.ushell.services.appLifeCycle.destroy:"+e)})}},store:{isActiveOnly:true,distributionType:["URL"],fnResponseHandler:function(e){e.then(function(e){d.info("sap.ushell.services.appLifeCycle.store:"+e)}).catch(function(e){d.error("Error: sap.ushell.services.appLifeCycle.store:"+e)})}},restore:{isActiveOnly:true,distributionType:["URL"],fnResponseHandler:function(e){e.then(function(e){d.info("sap.ushell.services.appLifeCycle.restore:"+e)}).catch(function(e){d.error("Error: sap.ushell.services.appLifeCycle.restore:"+e)})}}},oServiceCalls:{subscribe:{executeServiceCallFn:function(e){i.mapCapabilities(e.oContainer,e.oMessageData.body);return(new jQuery.Deferred).resolve({}).promise()}},setup:{executeServiceCallFn:function(e){var t=e.oMessageData&&e.oMessageData.body,n=[],a=e.oContainer.getApplicationType(),s=e.oContainer.getFrameworkId(),r=false;if(t){if(e.oContainer.getIsKeepAlive()===true&&(a==="GUI"||a==="TR"||a==="NWBC"||a==="WDA"||a==="WCF"||s==="GUI"||s==="WDA"||s==="NWBC"||s==="WCF")){r=true}if(t.isStateful===true&&!r){n.push({action:"create",service:"sap.ushell.services.appLifeCycle"});n.push({action:"destroy",service:"sap.ushell.services.appLifeCycle"})}if(t.isIframeValid===true){n.push({action:"iframeIsValid",service:"sap.ushell.appRuntime"})}if(t.isIframeBusy===true){n.push({action:"iframeIsBusy",service:"sap.ushell.appRuntime"})}if(t.session&&t.session.bLogoutSupport===true){n.push({action:"logout",service:"sap.ushell.sessionHandler"})}if(n.length>0){i.mapCapabilities(e.oContainer,n)}}return(new jQuery.Deferred).resolve().promise()}}}},"sap.gui":{oServiceCalls:{loadFinished:{executeServiceCallFn:function(e){var t=e.oContainer.getApplicationType(),i=e.oContainer.getFrameworkId();if((t==="GUI"||t==="TR"||t==="NWBC"||i==="GUI"||i==="NWBC")&&e.oContainer.getIsKeepAlive()===false){h.setWebGuiV1StatefulContainer(e.oContainer);e.oContainer.setIsStateful(true);T={appId:e.oContainer.getId(),stt:"loading",container:e.oContainer,meta:undefined,app:undefined}}return(new jQuery.Deferred).resolve({}).promise()}}}}});sap.ui.getCore().getEventBus().subscribe("sap.ushell","appComponentLoaded",this.onComponentCreated,this);sap.ui.getCore().getEventBus().subscribe("sap.ushell","getAppLifeCycle",this.onGetMe,this);r.init(this.getElementsModel(),f);this.addEvents()};this.addControl=function(e){m.addCenterViewPort(e)};this.removeControl=function(e){var t=i.getById(e),n=i.isStatefulContainerSupported(t);if(!n){m.removeCenterViewPort(e,true)}};this.removeApplication=function(e){var t=this.getControl(e);if(t){this.removeControl(t.getId());t.destroy()}};this.getControl=function(e){return m&&(m.getViewPortControl("centerViewPort","application-"+e)||m.getViewPortControl("centerViewPort","applicationShellPage-"+e))};this.getViewPortContainer=function(){return m};this.navTo=function(e){m.navTo("centerViewPort",e,"show")};this.getCurrentApplication=function(){return T};this.setApplicationFullWidth=function(e){var t=this.getCurrentApplication();if(t.container){t.container.toggleStyleClass("sapUShellApplicationContainerLimitedWidth",!e)}};this.createComponent=function(e,t){function i(t){return t.value.ui5ComponentName===e.ui5ComponentName}var n=[],s=new jQuery.Deferred;this.shellElements().setDangling(true);this.closeKeepAliveApps(i,n);Promise.all(n).then(function(){a.createComponent(e,t).done(s.resolve).fail(s.reject)});return s.promise()};this.getAppContainer=function(e,t,i,n,a){t.shellUIService=y.getInterface();t.targetNavigationMode=i?"explace":"inplace";this.openApp(e,t,n,a);if(U.length>0){T.container.registerShellCommunicationHandler(U)}if(w.UI5APP){T.container.setIframeHandlers(w.UI5APP)}return T.container};this.getShellUIService=function(){return y};this.initShellUIService=function(e){y._attachHierarchyChanged(o.onHierarchyChange.bind(this));y._attachTitleChanged(o.onTitleChange.bind(this));y._attachRelatedAppsChanged(o.onRelatedAppsChange.bind(this));y._attachBackNavigationChanged(e.fnOnBackNavigationChange.bind(this))};this.getElementsModel=function(){return e};this.activeContainer=function(e){var t=this.getWebGuiV1AllApplicationContainers();t.forEach(function(e){d.info("Deactivating container "+e.getId());e.setActive(false)});i.forEach(function(t){if(t&&t!==e){try{d.info("Deactivating container "+t.getId());t.setActive(false)}catch(e){}}});if(e){d.info("Activating container "+e.getId());e.setActive(true)}};this.showApplicationContainer=function(e){this.navTo(e.getId());if(e.hasStyleClass("sapUShellApplicationContainerShiftedIframe")){e.toggleStyleClass("sapUShellApplicationContainerIframeHidden",false)}else{e.toggleStyleClass("hidden",false)}a.setActiveAppContainer(e);d.info("New application context opened successfully in an existing transaction UI session.")};this.reuseStateFulContainerAndRestore=function(e,t,n,a,s){var r=this,o=I[a];if(i.getStorageKey(e)){i.setStorageKey(e,o)}return n.restore(e,o,s).then(function(){r.showApplicationContainer(e)},function(e){d.error(e&&e.message||e)})};this.reuseStateFulContainer=function(e,t,n,a,s,r){var o=this;I[s]=n;if(i.getStorageKey(e)){i.setStorageKey(e,n)}this.initAppMetaParams();return a.create(e,t,n,r).then(function(){o.showApplicationContainer(e)},function(e){d.error(e&&e.message||e)})};this.initAppMetaParams=function(){if(!this.getAppMeta().getIsHierarchyChanged()){y.setHierarchy()}if(!this.getAppMeta().getIsTitleChanged()){y.setTitle()}if(!this.getAppMeta().getIsRelatedAppsChanged()){y.setRelatedApps()}if(!F){y.setBackNavigation()}};this.reuseApplicationContainer=function(e,t,i){var n=this;e.setProperty("iframeReusedForApp",true,true);return e.setNewApplicationContext(t,i).then(function(){n.navTo(e.getId());if(e.hasStyleClass("sapUShellApplicationContainerShiftedIframe")){e.toggleStyleClass("sapUShellApplicationContainerIframeHidden",false)}else{e.toggleStyleClass("hidden",false)}d.info("New application context opened successfully in an existing transaction UI session.")},function(e){d.error(e&&e.message||e)})};this.createApplicationContainer=function(e,t){return a.createApplicationContainer(e,t)};this.publishNavigationStateEvents=function(e,t,i){var n,a=e.getId?e.getId():"",s=this;var r=p.getMetadata(),o=r.icon,l=r.title;e.addEventDelegate({onAfterRendering:i});n=e.exit;e.exit=function(){if(n){n.apply(this,arguments)}s.getAppMeta()._applyContentDensityByPriority();setTimeout(function(){var e=jQuery.extend(true,{},t);delete e.componentHandle;e.appId=a;e.usageIcon=o;e.usageTitle=l;sap.ui.getCore().getEventBus().publish("sap.ushell","appClosed",e);d.info("app was closed")},0);var e=s._publicEventDataFromResolutionResult(t);sap.ushell.renderers.fiori2.utils.publishExternalEvent("appClosed",e)}};this._publicEventDataFromResolutionResult=function(e){var t={};if(!e){return e}["applicationType","ui5ComponentName","url","additionalInformation","text"].forEach(function(i){t[i]=e[i]});Object.freeze(t);return t};this.getInMemoryInstance=function(e,i,n,a){var s="application-"+e,r=t.get(s),o="",p=false,l;if(r){if(a!==null&&a!==undefined&&a!==""){o=a.toLowerCase();p=o.indexOf("shell-home")>=0||o.indexOf("launchpad-openflppage")>=0||o.indexOf("launchpad-openworkpage")>=0||o.indexOf("shell-appfinder")>=0}l=p&&(typeof n==="string"&&n.length>0);if(r.shellHash===i&&!l){return{isInstanceSupported:true,appId:r.appId,container:r.container}}return{isInstanceSupported:false,appId:r.appId,container:r.container}}return{isInstanceSupported:false,appId:undefined,container:undefined}};this.handleOpenStateful=function(e,n,a,s,r,o,p){var l=i.getHandler();s.setProperty("iframeReusedForApp",true,true);if(t.get(a)&&e===false){this.reuseStateFulContainerAndRestore(s,a,l,o,r)}else{this.reuseStateFulContainer(s,r.url,a,l,o,r);if(n){if(!this.isAppInCache(a)){this.storeApp(a,s,r,o,p)}}}};this.handleControl=function(e,n,a,r,o,u,f){var h=this,g,A=this.getWebGuiV1StatefulContainer(r.url)!==undefined,y,S=v.indexOf(r.applicationType)>=0,I="application-"+e,b,E,R,U=false,w,F,P,O=new jQuery.Deferred,B,L,x,M,D,H=(new jQuery.Deferred).resolve().promise(),W={globalValue:undefined,paramValue:undefined},N,V,k,G;D=i.getStateFul(r.url);if(D&&i.isStatefulContainerSupported(D)){N=(new Date).getTime()-D.getIsIframeValidTime().time;if(i.isIframeBusySupported(D)&&D.getIsIframeBusy()===true||i.isIframeIsValidSupported(D)&&N>=3500){d.warning("Destroying statefull container iframe due to unresponsiveness ("+D.getId()+")","reason: "+(D.getIsIframeBusy()===true?"iframe is still creating a different app":"no ping from the iframe in the last '"+N+"' ms"),"sap.ushell.components.applicationIntegration.AppLifeCycle");i.removeCapabilities(D);this.destroy(I,D);i.deleteStateFul(r.url);D=undefined;f=undefined}}if(typeof f==="string"){V=C.parseShellHash(f);if(V){k="application-"+V.semanticObject+"-"+V.action;M=t.get(k)}if(M){x=M.container}else{G=m.getCurrentCenterPage?m.getCurrentCenterPage():undefined;if(G){x=sap.ui.getCore().byId(G)}}}y=x?i.isStatefulContainerSupported(x):false;if(x&&x===D&&y){if(M){s.store(M.service)}H=this.handleExitApplication(k,x,undefined,undefined,false)}H.then(function(){E=h.isAppOfTypeCached(I,S,W)||h.isCachedEnabledAsAppParameter(a,r,W);R=h.calculateAppType(r);w=c.getDefaultFullWidthSetting(R);g=i.getStateFul(r.url);y=i.isStatefulContainerSupported(g);if(!y){if(T&&I!==T.appId){g=undefined}b=t.get("application"+n);if(b){g=b.container;if(!y&&E&&g!==undefined){F=true}}}var s,f;s=r.appCapabilities&&r.appCapabilities.fullWidth;L=p.getMetadata(r);if(w===true){if(r.fullWidth===false||r.fullWidth==="false"||L.fullWidth===false||L.fullWidth==="false"||s===false){f=false}}else if(r.fullWidth===true||r.fullWidth==="true"||L.fullWidth===true||L.fullWidth==="true"){f=true}if(f===undefined){f=w}if(y){if(!g){g=o(e,L,a,r,n,f,u);h.restoreApp(g.getId());h.navTo(g.getId());U=true}}else if(!A&&g&&!E){P=new jQuery.Deferred;h.destroy(g.getId(),g,P);P.then(function(){g=o(e,L,a,r,n,f,u)})}else if(!g){g=o(e,L,a,r,n,f,u)}if(P===undefined){P=(new jQuery.Deferred).resolve()}if(g&&g.getDeffedControlCreation){B=g.getDeffedControlCreation()}else{B=Promise.resolve()}P.then(function(){B.then(function(){if(!A&&!y){if(F===true){sap.ui.getCore().getEventBus().publish("launchpad","appOpening",r)}h.restoreApp(g.getId());h.navTo(g.getId());if(F===true){h.initAppMetaParams();sap.ui.getCore().getEventBus().publish("sap.ushell","appOpened",r)}}m.switchState("Center");l.setPerformanceMark("FLP -- centerViewPort");h.activeContainer(g);if(y){h.handleOpenStateful(U,E,"application"+n,g,r,u,W)}else if(A){h.reuseApplicationContainer(g,"TR",r.url)}O.resolve()})})});return O.promise()};this.switchViewState=function(i,n,a){var s=i,o;if(E[i]&&E[i][S]){s=E[i][S]}var p=f.last("/core/shell/model/currentState/stateName")==="home";if(!p&&(!T.appId||!t.get(T.appId))){e.destroyManageQueue()}o=t.get("application"+a);if(o){r.restore(o)}else{r.assignNew(i)}e.switchState(s,n,a);this.shellElements().setDangling(false);this.shellElements().processDangling();if(i==="searchResults"){this.getElementsModel().setProperty("/lastSearchScreen","");if(!window.hasher.getHash().indexOf("Action-search")===0){var l=sap.ui.getCore().getModel("searchModel");window.hasher.setHash("Action-search&/searchTerm="+l.getProperty("/uiFilter/searchTerms")+"&dataSource="+JSON.stringify(l.getProperty("/uiFilter/dataSource").getJson()))}}};this.registerShellCommunicationHandler=function(e){a.registerShellCommunicationHandler(e)};this.registerIframeCommunicationHandler=function(e,t){w[t]=e};this.postMessageToIframeApp=function(e,t,n,s){function r(i){if(e==="sap.ushell.sessionHandler"&&t==="logout"){if(i&&i.getApplicationType&&",WCF,GUI,TR,WDA,".indexOf(i.getApplicationType())>0){return false}}return true}var o,p=a.getActiveAppContainer(),l=false,u=[];if(i.hasIFrame(p)&&(i.isCapabilitySupported(p,e,t)||a.isAppTypeSupported(p,e,t))&&r(p)===true){u.push(a.postMessageToIframeApp(p,e,t,n,s));l=true}if(!a.isActiveOnly(e,t)){i.forEach(function(o){if(l===true&&o===p){return}if(i.hasIFrame(o)){if((i.isCapabilitySupported(o,e,t)||a.isAppTypeSupported(o,e,t))&&r(o)===true){u.push(a.postMessageToIframeApp(o,e,t,n,s))}}})}o=a.getResponseHandler(e,t);var f=Promise.all(u);if(o){o(f)}return f};this.postMessageToIframeAppAccordingToPolicy=function(e,t,n,s,r){var o,p=a.getActiveAppContainer(),l=[];if(i.hasIFrame(p)&&a.isAppTypeSupportedByPolicy(p,r)){l.push(a.postMessageToIframeApp(p,e,t,n,s))}if(!r.isActiveOnly){i.forEach(function(r){if(i.hasIFrame(r)){if(i.isCapabilitySupported(r,e,t)||a.isAppTypeSupported(r,e,t)){l.push(a.postMessageToIframeApp(r,e,t,n,s))}}})}o=a.getResponseHandler(e,t);var u=Promise.all(l);if(o){o(u)}return u};this.setBackNavigationChanged=function(e){F=e};this.getBackNavigationChanged=function(){return F};this.parseStatefulContainerConfiguration=function(){R={}};this.getWebGuiV1StatefulContainer=function(e){var t;if(e){t=i._getBlueBoxCacheKey(e);return R[t]}else{return undefined}};this.setWebGuiV1StatefulContainer=function(e){var t=e.getUrl(),n;if(t){n=i._getBlueBoxCacheKey(t);R[n]=e}};this.getWebGuiV1AllApplicationContainers=function(){return Object.keys(R).map(function(e){return R[e]}).filter(function(e){return!!e})}}return new m},true);
//# sourceMappingURL=AppLifeCycle.js.map