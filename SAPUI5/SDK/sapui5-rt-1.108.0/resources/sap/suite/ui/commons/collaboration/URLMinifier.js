/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/base/Log","sap/ui/core/routing/HashChanger","sap/ui/base/Object"],function(e,t,n){"use strict";var r="sap-url-hash";var i="transient";var a=e.getLogger("sap.suite.ui.commons.collaboration.URLMinifier");var s=n.extend("sap.suite.ui.commons.collaboration.URLMinifier");s.compactHash=function(e){var t=sap.ushell&&sap.ushell.Container;if(!t){return{url:e}}return t.getServiceAsync("AppState").then(function(t){var n=t.createEmptyAppState(undefined,false);var i=this._getNextKey(n);if(!this._isEligibleForBackendPersistency(t)){a.warning("Transient flag is true. URL will not be shortened");return{url:e}}var s=this._extractURLBeforeHash(e);var o=this._extractSemanticObjectAndAction();if(!o){return{url:e}}return this._storeUrl(e,n).then(function(){return{url:s+"#"+o+"&/"+r+"="+i}}).catch(function(t){a.warning("URL is not shortened due to an error."+t.toString());return{url:e}})}.bind(this))};s.expandHash=function(){var e=document.URL;if(e.indexOf(r)>-1){var n=t.getInstance().getHash().split("=")[1];return this._retrieveURL(n).then(function(e){return Promise.resolve(e)})}return Promise.resolve()};s.redirect=function(e){window.location.replace(e)};s._retrieveURL=function(e){if(sap.ushell&&sap.ushell.Container){return sap.ushell.Container.getServiceAsync("AppState").then(function(t){return t.getAppState(e)})}};s._isEligibleForBackendPersistency=function(e){return e!=null&&e._oConfig!=null&&i in e._oConfig&&!e._oConfig[i]};s._getNextKey=function(e){return e.getKey()};s._extractSemanticObjectAndAction=function(){var e=sap.ushell&&sap.ushell.services&&new sap.ushell.services.URLParsing;if(e){var t=e.parseShellHash(document.location.hash);if(t){return t.contextRaw?t.semanticObject+"-"+t.action+"~"+t.contextRaw:t.semanticObject+"-"+t.action}}return undefined};s._extractURLBeforeHash=function(e){var t=e.split("#")[0];return t};s._storeUrl=function(e,t){t.setData(e);return t.save()};return s});
//# sourceMappingURL=URLMinifier.js.map