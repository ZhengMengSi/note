sap.ui.define(["sap/base/util/ObjectPath","sap/ui/integration/widgets/Card","sap/m/p13n/Popup","sap/m/p13n/SelectionPanel"],function(e,a,t,r){"use strict";var n={};n.showColumnsForCardGeneration=function(e,a){return new Promise(function(t,r){var n=e["entityType"];var i=e["currentControlHandler"].getModel().getMetaModel();var o=[];e["currentControlHandler"].getVisibleProperties().filter(function(e){var a=e.data("p13nData")&&e.data("p13nData").columnKey;var t=i.getODataProperty(n,e.data("p13nData").leadingProperty);if(t&&t["sap:label"]){if(e.getVisible()&&(a.indexOf("DataFieldForAnnotation")<0&&!e.data("p13nData").actionButton&&!!e.data("p13nData").leadingProperty)){var r={visible:false,name:t.name,label:t["sap:label"]};o.push(r)}}});C(o,a,e,t)})};n.createAnalyticalCardForPreview=function(e){return i(e)};var i=function(e,t){var r=new a({height:"533px",width:"314px"});var n=o(e,t);r.setManifest(n);return r};var o=function(e,a){var t=e["component"];var r=t.getAppComponent().getMetadata();var n=r.getManifestEntry("sap.ui");var i=r.getManifestEntry("sap.app");var o={};var l="user."+i.id+"."+Date.now();i.type="card";i.id=l;o["sap.app"]=i;o["sap.ui"]=n;o["sap.card"]=s(e,a);o["sap.insights"]=u(e);return o};var s=function(e,a){var t={};var r=e["component"].getMetadata().getName();t["type"]=l(r);t["configuration"]=c(e);t["header"]=v(e,t);t["data"]=p(e,t);if(t.type==="Analytical"){t["content"]=g(e,t)}else{t["content"]=d(e,t,a)}return t};var u=function(e){var a=e["component"],t=a.getAppComponent().getMetadata(),r=t.getManifestEntry("sap.app"),n=r.id,i="RT";return{parentAppId:n,cardType:i,versions:{ui5:sap.ui.version+"-"+sap.ui.getVersionInfo().buildTimestamp}}};var l=function(e){switch(e){case"sap.suite.ui.generic.template.ListReport.Component":return"Table";case"sap.suite.ui.generic.template.AnalyticalListPage.Component":return"Analytical";default:return"List"}};var c=function(e){var a={};var t=e["component"];var r=t.getModel().sServiceUrl;a["destinations"]={service:{name:"(default)",defaultUrl:"/"}};a["csrfTokens"]={token1:{data:{request:{url:"{{destinations.service}}"+r,method:"HEAD",headers:{"X-CSRF-Token":"Fetch"}}}}};return a};var p=function(e,a){var t={};var r=e["component"];var n=r.getModel().sServiceUrl;var i=n;var o=e["currentControlHandler"];var s="";if(o.getBinding()){s=o.getBinding().getDownloadUrl()}var u={};u.content={method:"GET",url:s,headers:{Accept:"application/json"}};t["request"]={url:"{{destinations.service}}"+i+"/$batch",method:"POST",headers:{"X-CSRF-Token":"{{csrfTokens.token1}}"},batch:u};return t};var v=function(e,a){var t=e["currentControlHandler"].getToolbar();var r=e["component"].getMetadata().getName(),n=t.getTitleControl()&&t.getTitleControl().getText(),i="";if(n&&r==="sap.suite.ui.generic.template.ListReport.Component"){var o=n.split("(");n=o[0].trim();i=o[1].split(")")[0].trim()}var s={title:n,subTitle:"",actions:P(e["oSmartFilterbar"]),status:{text:i}};return s};var d=function(e,a,t){var r=T(e,t);var n={data:{path:"/content/d/results"},maxItems:5,row:{columns:r,actions:P(e["oSmartFilterbar"])}};return n};var g=function(e,a){var t={},r=e["currentControlHandler"],n=r.getInnerChart(),i=r.getBinding().getMeasureDetails(),o=r.getBinding().getDimensionDetails();t["data"]={path:"/content/d/results"};t["chartType"]=h(n);t["measures"]=y(i);t["dimensions"]=b(o);t["feeds"]=f(t);t["chartProperties"]=m(n);t["actionableArea"]="Chart";t["actions"]=P(e["oSmartFilterbar"]);return t};var m=function(e){var a=e.mProperties.vizProperties;a["categoryAxis"]["title"]["visible"]=true;a["valueAxis"]["title"]["visible"]=true;return a};var f=function(e){var a=[],t=[];for(var r in e["measures"]){a.push(e["measures"][r].name)}for(var r in e["dimensions"]){t.push(e["dimensions"][r].name)}return[{type:"Dimension",uid:e.chartType==="Donut"?"color":"categoryAxis",values:t},{type:"Measure",uid:e.chartType==="Donut"?"size":"valueAxis",values:a}]};var h=function(e){var a;switch(e.getChartType()){case"line":a="Line";break;case"donut":a="Donut";break;case"stacked_column":a="stacked_column";break;default:a="Line";break}return a};var y=function(e){var a=[];for(var t in e){var r=e[t];a.push({name:r.analyticalInfo.name,value:"{"+r.analyticalInfo.measurePropertyName+"}"})}return a};var b=function(e){var a=[];for(var t in e){var r=e[t];a.push({name:r.name,value:"{"+r.analyticalInfo.name+"}"})}return a};var D=function(e,a){var t=[];for(var r in e){t.push(e[r][a])}return t.length>1?t:t[0]};var P=function(e){var a=window.hasher.getHash(),t=a.split("&/")[0].split("-"),r=e.getFilterData(),n={};for(var i in r){if(!r[i].hasOwnProperty("conditionTypeInfo")){if(r[i].items&&r[i].items.length){n[i]=D(r[i].items,"key")}if(r[i].ranges&&r[i].ranges.length){n[i]=D(r[i].ranges,"value1")}}}var o=[{type:"Navigation",parameters:{ibnTarget:{semanticObject:t[0],action:t[1]},ibnParams:n}}];return o};var T=function(e,a){var t=e["entityType"];var r=e["currentControlHandler"].getModel().getMetaModel();var n=[];e["currentControlHandler"].getVisibleProperties().filter(function(e){var i=e.data("p13nData")&&e.data("p13nData").columnKey;var o=r.getODataProperty(t,e.data("p13nData").leadingProperty);if(o&&a.indexOf(o.name)>-1){if(e.getVisible()&&(i.indexOf("DataFieldForAnnotation")<0&&!e.data("p13nData").actionButton&&!!e.data("p13nData").leadingProperty)){var s={};var u="{"+o.name+"}";var l="";if(o["Org.OData.Measures.V1.ISOCurrency"]&&o["Org.OData.Measures.V1.ISOCurrency"].Path){u=u.concat(" "+"{"+l+o["Org.OData.Measures.V1.ISOCurrency"].Path+"}")}if(o["Org.OData.Measures.V1.Unit"]&&o["Org.OData.Measures.V1.Unit"].Path){u=u.concat(" "+"{"+l+o["Org.OData.Measures.V1.Unit"].Path+"}")}if(o["com.sap.vocabularies.UI.v1.IsImageURL"]&&o["com.sap.vocabularies.UI.v1.IsImageURL"].Bool==="true"){s["title"]=o["com.sap.vocabularies.Common.v1.Label"].String||o["sap:label"];s["icon"]={src:"{"+o.name+"}"}}else{s["title"]=o["com.sap.vocabularies.Common.v1.Label"].String||o["sap:label"];s["value"]=u}n.push(s)}}});return n};function C(e,a,n,o){var s=n["component"].getModel("i18n").getResourceBundle();var u=new r({title:s.getText("ST_CARDS_SELECTIONPANEL_TITLE"),showHeader:true,messageStrip:new sap.m.MessageStrip({text:s.getText("ST_CARDS_SELECTIONPANEL_MESSAGESTRIP")}),change:function(e){var a=u.getP13nData();var t=u.getP13nData(true).length;if(t>3){var r=a.find(function(a){return a.name===e.getParameter("item").name});r.visible=false}u.setP13nData(a)}});u.setP13nData(e);var l=new t({title:s.getText("ST_CARDS_SELECTIONPOPUP_TITLE"),panels:[u],close:function(e){if(e.getParameter("reason")==="Ok"){var a=e.getSource().getPanels()[0].getSelectedFields();o(i(n,a))}}});l.open(a)}return n});
//# sourceMappingURL=AddCardsHelper.js.map