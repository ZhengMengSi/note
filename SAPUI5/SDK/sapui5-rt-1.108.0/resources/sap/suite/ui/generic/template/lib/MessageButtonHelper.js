sap.ui.define(["sap/ui/base/Object","sap/m/MessagePopover","sap/m/MessagePopoverItem","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/json/JSONModel","sap/suite/ui/generic/template/lib/MessageUtils","sap/suite/ui/generic/template/genericUtilities/testableHelper","sap/ui/core/Element","sap/base/util/extend","sap/suite/ui/generic/template/genericUtilities/oDataModelHelper"],function(e,t,r,n,a,s,i,o,u,l,g){"use strict";n=o.observableConstructor(n,true);var c=new n({path:"persistent",operator:a.EQ,value1:false});var p=new n({path:"technical",operator:a.EQ,value1:false});var f=new n({path:"validation",operator:a.EQ,value1:true});var v=new n({filters:[f,new n({path:"validation",operator:a.EQ,value1:false})],and:true});function m(e,t,r){var o=t.controller;var u=o.getOwnerComponent();var l=u.getModel("ui");var m=new s({heartBeat:0});var d=o.byId("showMessages");var h=e.oComponentUtils.isDraftEnabled();var P=false;var M;var T;var y;var S=[];function C(t){return!!(t&&e.oCommonUtils.getPositionableControlId(t))}function b(e,r){return B&&e&&t.getGroupTitle?t.getGroupTitle(e,r):""}function w(e,r,n){return B&&e&&r&&t.getSubtitle?t.getSubtitle(e,r,n,function(){var e=m.getProperty("/heartBeat");e++;m.setProperty("/heartBeat",e)}):n}var E=r&&!h?l.getProperty.bind(l,"/createMode"):function(){return false};var O=v;var B;var U=new n({path:"target",operator:a.EQ,value1:"/"+o.getOwnerComponent()});var I;e.oCommonUtils.getDialogFragment("sap.suite.ui.generic.template.fragments.MessagePopover",{afterClose:function(){B.sort([])},beforeOpen:function(){I.navigateBack()},isPositionable:C,getGroupTitle:b,getSubtitle:w,titlePressed:function(t){i.navigateFromMessageTitleEvent(e,t,u,h,M)}}).then(function(t){I=t;I.setModel(sap.ui.getCore().getMessageManager().getMessageModel(),"msg");I.setModel(m,"helper");B=I.getBinding("items");B.filter(O);(function(t,r){var n=o.getOwnerComponent();var a=n.getModel("_templPriv");a.setProperty("/generic/messageCount",0);var s=e.oCommonUtils.getText("MESSAGE_BUTTON_TOOLTIP_P",0);a.setProperty("/generic/messageButtonTooltip",s);r.attachChange(function(){var n=r.getLength();if(n>0){var i=t.getItems();var o=0;var u,l,g;var c={};for(var p=0;p<i.length;p++){if(i[p].getType()==="Error"){o=o+1}else if(i[p].getType()==="Warning"){u=true}else if(i[p].getType()==="Success"){l=true}else{g=true}}if(o>0){c={messageSeverity:"Negative",icon:"sap-icon://message-error"}}else if(u){c={messageSeverity:"Critical",icon:"sap-icon://message-warning"}}else if(g){c={messageSeverity:"Neutral",icon:"sap-icon://message-information"}}else if(l){c={messageSeverity:"Success",icon:"sap-icon://message-success"}}a.setProperty("/generic/messageBtnIcon",c.icon);a.setProperty("/generic/messageSeverity",c.messageSeverity)}a.setProperty("/generic/messageCount",n);a.setProperty("/generic/errorMessageCount",o||"");s=e.oCommonUtils.getText(n===1?"MESSAGE_BUTTON_TOOLTIP_S":"MESSAGE_BUTTON_TOOLTIP_P",n);a.setProperty("/generic/messageButtonTooltip",s);S.forEach(function(e){e()})})})(I,B)});var _=new n({filters:[f,new n({path:"controlIds",test:function(t){return!!e.oCommonUtils.getPositionableControlId(t)},caseSensitive:true})],and:true});var x=[];var A=0;var F;var G;function L(e){if(Array.isArray(e)){var t=false;for(var r=0;r<e.length;r++){t=L(e[r])||t}return t}if(e instanceof Promise){e.then(F);return false}G.push(e);return true}function N(e){O=e;if(B){B.filter(O)}}function D(){if(P){T=new n({filters:G,and:false});var t=[T,c];if(e.oServices.oApplication.needsToSuppressTechnicalStateMessages()){t.push(p)}y=new n({filters:t,and:true});N(new n({filters:[y,_],and:false}))}}function H(e,t){if(e===A&&L(t)){D()}}function Q(e){var t=e();return L(t)}function j(){x.forEach(Q)}function W(e){M=e;A++;F=H.bind(null,A);var t=E();G=r?[new n({path:t?"target":"fullTarget",operator:a.StartsWith,value1:M}),U]:[];j();D()}function k(e){x.push(e);if(M!==undefined&&Q(e)){D()}}var J;function q(){J=J||function(){if(B.getLength()>0){I.openBy(d)}};var e=Y();setTimeout(function(){e.then(J)},0)}function z(e){P=e;if(e){if(G){D()}}else{G=null;N(v)}}function K(e){return e?_:O}function R(e){return e?y:T}function V(e){var t=E(),r=!t&&g.analyseContextPath(M,e),n=t?M:r.canonicalPath,a=M;return{target:n,fullTarget:a}}function X(){var e=Y();e.then(function(){I.toggle(d)})}function Y(){var r=e.oServices.oApplication.getBusyHelper();var n=B.getCurrentContexts().map(function(e){return e.getObject()});var a=(t.getPrepareMessageDisplayPromise?t.getPrepareMessageDisplayPromise(n):Promise.resolve()).then(function(e){if(e){B.sort(e)}});r.setBusy(a);return a}function Z(e){S.push(e)}return{adaptToContext:W,toggleMessagePopover:X,showMessagePopover:q,registerMessageFilterProvider:k,setEnabled:z,getMessageFilters:K,getContextFilter:R,getTargetInfo:V,registerExternalListener:Z}}return e.extend("sap.suite.ui.generic.template.lib.MessageButtonHelper",{constructor:function(e,t,r){l(this,o.testableStatic(m,"MessageButtonHelper")(e,t,r))}})});
//# sourceMappingURL=MessageButtonHelper.js.map