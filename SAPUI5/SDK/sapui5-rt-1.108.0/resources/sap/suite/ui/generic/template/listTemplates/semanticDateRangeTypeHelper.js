sap.ui.define(["sap/suite/ui/generic/template/genericUtilities/FeError","sap/base/util/deepExtend","sap/base/util/extend","sap/base/util/isEmptyObject","sap/m/DynamicDateUtil","sap/suite/ui/generic/template/genericUtilities/metadataAnalyser"],function(e,t,i,a,n,r){"use strict";var s="listTemplates.semanticDateRangeTypeHelper";function l(){var e={useDateRange:{type:"boolean",defaultValue:false},selectedValues:{type:"string",defaultValue:""},exclude:{type:"boolean",defaultValue:true},customDateRangeImplementation:{type:"string",defaultValue:""},defaultValue:{type:"object",properties:{operation:{type:"string"}}},filter:{type:"array",arrayEntries:{type:"object",properties:{path:{type:"string"},equals:{type:"string"},contains:{type:"string"},exclude:{type:"boolean",defaultValue:false}}}}};var t=i({fields:{type:"object",mapEntryProperties:e}},e);return{type:"object",properties:t}}function o(e,t,i){var a=e.type==="Edm.DateTime"&&e["sap:display-format"]==="Date"||e.type==="Edm.DateTimeOffset";var n=e.type==="Edm.String"&&e["com.sap.vocabularies.Common.v1.IsCalendarDate"]&&e["com.sap.vocabularies.Common.v1.IsCalendarDate"].Bool==="true";if(a||n){if(e.isParam){return true}if(e["sap:filter-restriction"]==="interval"||i.includes(e.name)||e["sap:filter-restriction"]==="single-value"&&!(e.type==="Edm.DateTimeOffset")){return true}}return false}function f(t){var i;if(t.customDateRangeImplementation){i=t.customDateRangeImplementation}else if(t.filter){i=JSON.stringify({module:"sap.ui.comp.config.condition.DateRangeType",operations:{filter:t.filter}})}else if(t.selectedValues){var a={path:"key",contains:t.selectedValues,exclude:t.exclude===undefined||t.exclude};i=JSON.stringify({module:"sap.ui.comp.config.condition.DateRangeType",operations:{filter:[a]}})}else if(t.defaultValue){i=JSON.stringify({module:"sap.ui.comp.config.condition.DateRangeType"})}else{throw new e(s,"Wrong Date Range configuration set in manifest")}return i}function u(e,t,n){var r=i({},e.fields&&e.fields[n.name]||e);delete r.fields;delete r.useDateRange;return o(n,e,t)&&!a(r)}function p(e,t){var i=r.getParametersByEntitySet(e,t.name);var a;if(i.entitySetName){a=r.getPropertyOfEntitySet(e,i.entitySetName);if(!a){return[]}}else{return[]}var n=[];a.forEach(function(e){e.isParam=true;if(o(e)){n.push(e)}});return n}function d(e,t,i,a){if(!e.filterSettings||!e.filterSettings.dateSettings){return[]}var r=[];if(a&&i){r=p(a,i)}if(e.filterSettings.dateSettings.useDateRange&&e.filterSettings.dateSettings.fields){e.filterSettings.dateSettings.useDateRange=false;var s=t.property.filter(o,e.filterSettings.dateSettings,[]);var l=e.filterSettings.dateSettings.fields;s.forEach(function(e){if(!l.hasOwnProperty(e["name"])||!l[e["name"]]){var t=e["name"];l[t]={selectedValues:n.getAllOptionKeys().toString(),exclude:false}}})}var d=i["Org.OData.Capabilities.V1.FilterRestrictions"]&&i["Org.OData.Capabilities.V1.FilterRestrictions"].FilterExpressionRestrictions?i["Org.OData.Capabilities.V1.FilterRestrictions"].FilterExpressionRestrictions.filter(function(e){return e.AllowedExpressions&&e.AllowedExpressions.String==="SingleRange"}).map(function(e){return e.Property&&e.Property.PropertyPath}):[];var g=t.property.concat(r);return g.filter(u.bind(null,e.filterSettings.dateSettings,d)).map(function(t){return{key:t.name,conditionType:f(e.filterSettings.dateSettings.fields&&e.filterSettings.dateSettings.fields[t.name]||e.filterSettings.dateSettings,t)}})}function g(e,t,i,a){var n={};var r=[],s;if(e.filterSettings&&e.filterSettings.dateSettings&&e.filterSettings.dateSettings.fields){s=e.filterSettings.dateSettings.fields;Object.entries(s).forEach(function(e){var s=-1;if(i&&i.Dates){s=i.Dates.findIndex(function(t){return t.PropertyName===e[0]})}if(s===-1&&Object.keys(a).indexOf(e[0])===-1&&e[1].defaultValue){t.getConditionTypeByKey(e[0])&&t.getConditionTypeByKey(e[0]).setOperation(e[1].defaultValue.operation);n=t.getConditionTypeByKey(e[0])&&t.getConditionTypeByKey(e[0]).getCondition();n&&r.push({PropertyName:n.key,Data:n})}})}if(!s){if(i&&i.Dates){var l=i.Dates.findIndex(function(e){return Object.keys(a).includes(e.PropertyName)});if(l===-1){r=i.Dates}}}return{Dates:r}}return{getDateSettingsMetadata:l,getDateRangeFieldSettings:d,addSemanticDateRangeDefaultValue:g}});
//# sourceMappingURL=semanticDateRangeTypeHelper.js.map