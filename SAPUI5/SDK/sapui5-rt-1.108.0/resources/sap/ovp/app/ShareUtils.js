sap.ui.define(["sap/ui/base/Object","sap/m/library","sap/m/MenuItem","sap/ui/core/Core","sap/ui/core/Fragment","sap/ui/core/CustomData","sap/base/util/ObjectPath","sap/ui/thirdparty/hasher","sap/ushell/ui/footerbar/AddBookmarkButton","sap/suite/ui/commons/collaboration/ServiceContainer"],function(e,t,r,o,a,i,n,s,l,c){"use strict";return e.extend("sap.ovp.app.ShareUtils",{constructor:function(e){if(!e){throw new Error("controller is undefined!")}this.oController=e},init:function(){this._createModelForTile();this._checkJamAuth()},onShareButtonAvailableAndPressed:function(e){var n=this.oController._getLibraryResourceBundle();var s=this.oController.getUIModel();var u=s&&s.getProperty("/title");var h=this;var p;var d={shareEmailPressed:function(){t.URLHelper.triggerEmail(null,n.getText("Email_Subject",[u]),document.URL)},shareMSTeamsPressed:function(){var e="";var t=s.getProperty("/subtitle");if(t&&t.length>0){e=s.getProperty("/appTitle")||"";t=u+" - "+t}else{t="";e=u}var r={url:document.URL,appTitle:e,subTitle:t};h.oSuiteCollaborationService.share(this.getCustomData()[0].getValue(),r)},shareJamPressed:function(){var e=o.createComponent({name:"sap.collaboration.components.fiori.sharing.dialog",settings:{object:{id:document.URL,share:u}}});e.open()},shareTilePressed:function(){p.firePress()}};if(this.oShareActionSheet){this.oShareActionSheet.destroy()}this.oSharePageFragment=a.load({name:"sap.ovp.app.SharePage",controller:d}).then(function(e){h.oController.getView().addDependent(e);return e});this.oSharePageFragment.then(function(t){h.oShareActionSheet=t;p=new l("",{customUrl:s.getProperty("/tileInfo").tileCustomURL(),title:u,tileIcon:s.getProperty("/icon")||"sap-icon://bookmark"});s.setProperty("/tileVisible",p.getEnabled());s.setProperty("/tileIcon",p.getIcon());s.setProperty("/tileText",p.getText());var o=2;if(!s.getProperty("/jamVisible")){o=1}var a={isShareAsLinkEnabled:true,isShareAsTabEnabled:false};c.getServiceAsync().then(function(e){h.oSuiteCollaborationService=e;var t=h.oSuiteCollaborationService.getOptions(a);if(Array.isArray(t)&&t.length>0){t.forEach(function(e){if(Array.isArray(e.subOptions)&&e.subOptions.length>1){var t=[];e.subOptions.forEach(function(e){var o=new r({text:e.text,icon:e.icon,press:d.shareMSTeamsPressed});o.addCustomData(new i({key:"data",value:e}));t.push(o)});h.oShareActionSheet.insertItem(new r({text:e.text,icon:e.icon,items:t}),o)}else{var a=new r({text:e.text,icon:e.icon,press:d.shareMSTeamsPressed});a.addCustomData(new i({key:"data",value:e}));h.oShareActionSheet.insertItem(a,o)}o++})}});h.oShareActionSheet.openBy(e)})},_checkJamAuth:function(){var e=n.get("sap.ushell.Container.getUser");var t=this.oController.getUIModel();if(t){t.setProperty("/jamVisible",!!e&&e().isJamActive())}},_createModelForTile:function(){var e=this.oController.getUIModel();var t,r=e&&e.getProperty("/title");var o={tileTitle:r,tileCustomURL:function(){t=s.getHash();return t?"#"+t:window.location.href}};if(e){e.setProperty("/tileInfo",o)}}})});
//# sourceMappingURL=ShareUtils.js.map