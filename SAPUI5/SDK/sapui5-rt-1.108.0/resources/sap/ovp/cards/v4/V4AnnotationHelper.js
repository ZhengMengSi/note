sap.ui.define(["sap/ui/core/format/NumberFormat","sap/ui/core/format/DateFormat","sap/ovp/cards/CommonUtils","sap/ui/model/odata/v4/AnnotationHelper","sap/ui/model/FilterOperator","sap/ui/Device","sap/ui/model/analytics/odata4analytics","sap/fe/navigation/SelectionVariant","sap/ovp/app/resources","sap/base/strings/formatMessage","sap/base/util/isPlainObject","sap/base/util/each","sap/ovp/cards/MetadataAnalyser","sap/base/security/encodeURL","sap/base/util/merge","sap/ovp/cards/ovpLogger","sap/base/util/isEmptyObject","sap/ovp/app/OVPUtils"],function(e,t,r,a,i,n,o,u,l,s,f,c,p,g,v,m,h,y){"use strict";var d={StateValues:{None:"None",Negative:"Error",Critical:"Warning",Positive:"Success"},ColorValues:{None:"Neutral",Negative:"Error",Critical:"Critical",Positive:"Good"}};var P={TEXT:"com.sap.vocabularies.Common.v1.Text",TEXT_ARRANGEMENT:"com.sap.vocabularies.UI.v1.TextArrangement",UOM:"Org.OData.Measures.V1.Unit",ISO_CURRENCY:"Org.OData.Measures.V1.ISOCurrency"};var C={TEXT_LAST:"com.sap.vocabularies.UI.v1.TextArrangementType/TextLast",TEXT_FIRST:"com.sap.vocabularies.UI.v1.TextArrangementType/TextFirst",TEXT_ONLY:"com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly",TEXT_SEPARATE:"com.sap.vocabularies.UI.v1.TextArrangementType/TextSeparate"};var T={List_condensed:{phone:5,tablet:5,desktop:5},List_extended:{phone:3,tablet:3,desktop:3},List_condensed_bar:{phone:5,tablet:5,desktop:5},List_extended_bar:{phone:3,tablet:3,desktop:3},Table:{phone:5,tablet:5,desktop:5},Stack_simple:{phone:20,tablet:20,desktop:20},Stack_complex:{phone:5,tablet:5,desktop:5}};var b=new m("OVP.cards.V4AnnotationHelper");function I(e,t){var r=e.getSetting("ovpCardProperties");var a=r.getProperty("/showLabelText");if(a==="true"){var i=t.Address[0];if(typeof i.country!=="undefined"){return"{path:'"+i.country.Path+"'}"}else if(typeof i.locality!=="undefined"){return"{path:'"+i.locality.Path+"'}"}else if(typeof i.street!=="undefined"){return"{path:'"+i.street.Path+"'}"}else if(typeof i.code!=="undefined"){return"{path:'"+i.code.Path+"'}"}}else{return null}}I.requiresIContext=true;function $(e,t){if(!t){return""}if(t.Label){return t.Label}var r=e.getSetting&&e.getSetting("ovpCardProperties");var a=r&&r.getProperty("/metaModel");var i=r&&r.getProperty("/entityType");if(!a||!i){return""}var n;if(t.Value){n=t.Value.$Path}if(t.Target){var o="/"+q(i.$Type,t);var u=o&&a.getProperty(o);n=u&&u.Value.$Path}if(!n||!n.length>0||n===" "){return""}var l=a.getData()["$Annotations"][i.$Type+"/"+n];if(!l){return""}var s=l["sap:label"]||l["@com.sap.vocabularies.Common.v1.Label"]||""||"";return s}$.requiresIContext=true;function D(e){if(e.EdmType==="Edm.DateTime"||e.EdmType==="Edm.DateTimeOffset"){return"Right"}return"Left"}D.requiresContext=true;function V(e,t){if(e.getSetting){var r=e.getSetting("_ovpCache");if(r){return r[t]}}return undefined}function O(e,t,r){if(e.getSetting){var a=e.getSetting("_ovpCache");if(a){a[t]=r}}}function F(e,t){var r;if(t){r=t.None;if(e&&e.$EnumMember){var a=e.$EnumMember;if(x(a,"Negative")){r=t.Negative}else if(x(a,"Critical")){r=t.Critical}else if(x(a,"Positive")){r=t.Positive}}}return r}function S(e){if(e=="Error"){e=1}else if(e=="Warning"){e=2}else if(e=="Success"){e=3}else{e=0}return e}function x(e,t){return e&&e.indexOf(t,e.length-t.length)!==-1}function N(t,r,a,i,n,o,u){if(typeof t=="string"){t=e.getIntegerInstance().parse(t)}var l={};l.$EnumMember="None";var s=Number.NEGATIVE_INFINITY;var f=Number.POSITIVE_INFINITY;if(!n&&n!==0&&(a||a===0)){n=a}if(!o&&o!==0&&(i||i===0)){o=i}if(!a&&a!==0){a=s}if(!i&&i!==0){i=f}if(t!==undefined){t=Number(t);if(x(r,"Minimize")||x(r,"Minimizing")){if((o||o===0)&&(i||i===0)){if(t<=parseFloat(o)){l.$EnumMember="Positive"}else if(t>parseFloat(i)){l.$EnumMember="Negative"}else{l.$EnumMember="Critical"}}}else if(x(r,"Maximize")||x(r,"Maximizing")){if((n||n===0)&&(a||a===0)){if(t>=parseFloat(n)){l.$EnumMember="Positive"}else if(t<parseFloat(a)){l.$EnumMember="Negative"}else{l.$EnumMember="Critical"}}}else if(x(r,"Target")){if((o||o===0)&&(i||i===0)&&(n||n===0)&&(a||a===0)){if(t>=parseFloat(n)&&t<=parseFloat(o)){l.$EnumMember="Positive"}else if(t<parseFloat(a)||t>parseFloat(i)){l.$EnumMember="Negative"}else{l.$EnumMember="Critical"}}}}return F(l,u)}function E(t,r,a,i){if(typeof t=="string"){t=e.getIntegerInstance().parse(t)}if(!t||!r){return}t=Number(t);if(!i&&t-r>=0){return"Up"}if(!a&&t-r<=0){return"Down"}if(r&&i&&t-r>=i){return"Up"}if(r&&a&&t-r<=a){return"Down"}}function A(e,t){var r=e.getPath(0)+"-DataFields-Sorted";var a=V(e,r);if(!a){var i=M(e,t);var n=i.map(function(e){return e.Value.$Path});n=n.filter(function(e){return!!e});a=t.filter(function(e){if(e.$Type==="com.sap.vocabularies.UI.v1.DataField"&&n.indexOf(e.Value.$Path)===-1){return true}return false});a=_(a);O(e,r,a)}return a}A.requiresIContext=true;function M(e,t,r){var a=e.getPath(0)+"-DataPoints-Sorted";var i=V(e,a);if(!i){if(r){i=t.filter(U)}else{i=t.filter(R)}i=_(i);var n;for(var o=0;o<i.length;o++){n=e.getPath(0).substr(0,e.getPath(0).lastIndexOf("/")+1);i[o]=e.getModel(0).getProperty(q(n,i[o]));n=""}O(e,a,i)}return i}M.requiresIContext=true;function R(e){if(e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&e.Target.$AnnotationPath.match(/@com.sap.vocabularies.UI.v1.DataPoint.*/)){return true}return false}function U(e){if(e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&e.Target.$AnnotationPath.match(/@com.sap.vocabularies.UI.v1.DataPoint.*/)||e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&e.Target.$AnnotationPath.match(/@com.sap.vocabularies.Communication.v1.Contact.*/)){return true}return false}function w(e){if(!e||!e.Criticality||!e.Criticality.Path){return}return"{path:'"+e.Criticality.Path+"'}"}function q(e,t){return e+t.Target.$AnnotationPath}function L(e){var t,r;if(e["@com.sap.vocabularies.UI.v1.Importance"]){t=e["@com.sap.vocabularies.UI.v1.Importance"].$EnumMember;switch(t){case"com.sap.vocabularies.UI.v1.ImportanceType/High":r=1;break;case"com.sap.vocabularies.UI.v1.ImportanceType/Medium":r=2;break;case"com.sap.vocabularies.UI.v1.ImportanceType/Low":r=3;break}}else{r=4}return r}function _(e){if(e.length<2){return e}var t=parseInt(e.length/2,10);var r=e.slice(0,t);var a=e.slice(t,e.length);return B(_(r),_(a))}function B(e,t){var r=[];while(e.length&&t.length){var a=L(e[0]),i=L(t[0]);if(a<=i){r.push(e.shift())}else{r.push(t.shift())}}while(e.length){r.push(e.shift())}while(t.length){r.push(t.shift())}return r}function j(e,t,r){var a=A(e,t)[r];if(a){return Q(e,a)}return""}function k(e,t,r){var a=A(e,t)[r];return $(e,a)}function H(e,t,r){var a=M(e,t)[r];if(a&&a.Title){return a.Title.String}return""}function G(e,t,r){var a=t.filter(R);a=_(a);if(!a||!a.length||!a.length>0){return""}return $(e,a[0])}function X(e,t,r,a){var i=M(e,t)[r];if(!i){return""}var n=e.getSetting("ovpCardProperties");var o=n.getProperty("/entityType");var u=n.getProperty("/metaModel");return J(e,i,o,u,a)}function Y(e,t,r){var a=M(e,t)[r];if(a&&a.Criticality){return true}}function z(e,t,r){var a=M(e,t)[r];var i=a.Criticality.Path;return"{path:'"+i+"'}"}function J(e,t,r,a,i){if(!t||!t.Value){return""}var n=e.getSetting("ovpCardProperties");var o=false;if(n){var u=n.getProperty("/ignoreSapText");o=u==undefined?o:u}var l=a.getData()["$Annotations"][r.$Type+"/"+t.Value.$Path];var s=false;if(o==true){if(l&&(l["@com.sap.vocabularies.Analytics.v1.Measure"]||l["sap:aggregation-role"]=="measure")){s=true}}if(!s&&l){var f;if(l[P.TEXT]){f=l[P.TEXT]?l[P.TEXT]:l[P.TEXT].$Path}else if(l["sap:text"]){f=l["sap:text"]}if(f){t={Value:{$Path:f}}}}return Q(e,t,i)}function Q(e,t,r,i){if(t.Value.Apply){return a.format(e,t.Value)}var n=e.getSetting("ovpCardProperties");var o=n.getProperty("/entityType");var u=n.getProperty("/metaModel");return K(e,t,o,u,r,i)}Q.requiresIContext=true;function W(e,t,r,i){var e=!e.getPath()?e.getInterface(0):e;if(!r||typeof i!=="string"){return i}var n=r["@"+P.TEXT];if(!n){return i}var o,u;o=r["@"+P.TEXT+"@"+P.TEXT_ARRANGEMENT];u=o&&o.$EnumMember;if(!u){o=n&&n["@"+P.TEXT_ARRANGEMENT];u=o&&o.$EnumMember}if(!u){o=t&&t[P.TEXT_ARRANGEMENT];u=o&&o.$EnumMember}var l=a.format(n,{context:e});if(!l||l===" "){return i}if(!u){return i+" ("+l+")"}var s;switch(u){case C.TEXT_FIRST:s=l+" ("+i+")";break;case C.TEXT_LAST:s=i+" ("+l+")";break;case C.TEXT_ONLY:s=l;break;case C.TEXT_SEPARATE:s=i+" ("+l+")";break;default:s=i;break}return s}function K(e,t,r,i,n,o,u){if(t.Value.Apply){return a.format(e,t.Value)}var l=t.Value.$Path?t.Value.$Path:t.Value.String;var s=ee(i,r,t.Value.$Path),f="",c,p;var g=e.getSetting("ovpCardProperties");var v=g&&g.getProperty("/contentFragment");if(!o){if(t.Value.$Path&&t.Value.$Path.split("/").length>1){s=ne(i,r,t.Value.$Path)}if(!s){return""}if(s&&(s.$Type==="Edm.DateTime"||s.$Type==="Edm.DateTimeOffset")){var m={relative:true,relativeScale:"auto"},h=g&&g.getProperty("/showDateInRelativeFormat");if(h!==undefined&&!h){m={style:"medium"}}p={dateFormat:m,bUTC:s.$Type==="Edm.DateTime"?true:false};c="sap.ovp.cards.AnnotationHelper.formatDate";f=te([t.Value.$Path?t.Value.$Path:l.split("/")[l.split("/").length-1]],c,p)}else if(t.ValueFormat&&t.ValueFormat.NumberOfFractionalDigits>=0||s["scale"]){var y=t.ValueFormat&&t.ValueFormat.NumberOfFractionalDigits?t.ValueFormat.NumberOfFractionalDigits:0,d;var C=t.ValueFormat&&t.ValueFormat.ScaleFactor&&t.ValueFormat.ScaleFactor.$Decimal;if(s["@"+P.ISO_CURRENCY]){d=s["@"+P.ISO_CURRENCY].$Path?s["@"+P.ISO_CURRENCY].$Path:s["@"+P.ISO_CURRENCY]}else if(s["@"+P.UOM]){d=s["@"+P.UOM].$Path?s["@"+P.UOM].$Path:s["@"+P.UOM]}else if(s["@sap:unit"]){d=s["@sap:unit"]}var T=d?i.getProperty("/"+r.$Type)[d]:null,b=[t.Value.$Path?t.Value.$Path:l.split("/")[l.split("/").length-1]];if(y>2){y=2}p={numberOfFractionalDigits:y,scaleFactor:C};if(s["@"+P.ISO_CURRENCY]){var I=s["@"+P.ISO_CURRENCY];if(I.$Path){c="sap.ovp.cards.v4.V4AnnotationHelper.formatCurrency";b.push(I.$Path)}else if(I.String){p.currencyString=I.String;c="sap.ovp.cards.v4.V4AnnotationHelper.formatCurrency"}}else if(T&&(T[P.ISO_CURRENCY]||T["sap:semantics"]==="currency-code")){c="sap.ovp.cards.v4.V4AnnotationHelper.formatCurrency";b.push(d)}else{c="sap.ovp.cards.v4.V4AnnotationHelper.formatNumberCalculation"}f=te(b,c,p)}else{if(u){f=a.format(t.Value,{context:e})}else{var $=a.format(t.Value,e.getModel()?{context:e}:{context:e.getInterface(0)});var D=$.split(",");var V=[];if(D.length>1){for(var O=0;O<D.length;O++){if(D[O].indexOf("path:")>=0||D[O].indexOf("type:")>=0){V.push(D[O])}}if(V.length>0){f=f+V.join(",");if(f.substring(f.length-1)!=="}"){f=f+"}"}}}else{f=$}}}if(v){f=W(e,r,s,f)}if(s&&s["@"+P.UOM]){var F=s["@"+P.UOM];if(F.$Path){f+=" "+te([F.$Path]);f+=" "+Z(F.$Path,i,r)}else if(F.String){if(F.String!=="%"){f+=" "}f+=F.String}}}if(!n){if(s["@"+P.ISO_CURRENCY]){var I=s["@"+P.ISO_CURRENCY];if(I){if(I.$Path){f+=" "+te([I.$Path])}else{f+=" "+I}f+=" "+Z(I.$Path,i,r)}}}if(f[0]===" "){f=f.substring(1)}f=f.replace("\\","");f=f.replace("\\","");f=f.replace("Unsupported: ","");f=f.replace("$P","p");return f}function Z(e,t,r){if(e){var a,i,n;if(e.split("/").length>1){a=ne(t,r,e);i=he(t,r,e)}else{a=ee(t,r,e)}if(a){n=a["@"+P.TEXT]&&a["@"+P.TEXT].$Path}if(n&&i){n=i+"/"+n}if(n){return" ({"+n+"})"}return""}}function ee(e,t,r){var a=e.getData().$Annotations[t.$Type+"/"+r];var i=e.getObject("/"+t.$Type.split(".")[1]+"/"+r);var n=y.merge(true,{},a,i);return n}function te(e,t,r,a){var i="",n=e.length;if(n>1||r){i="{parts:[";for(var o=0;o<n;o++){if(a){i+="{path: '"+e[o]+"',type:'sap.ui.model.odata.type.Decimal'}"+(o===n-1&&!r?"]":", ")}else{i+="{path: '"+e[o]+"'}"+(o===n-1&&!r?"]":", ")}}if(r){var u="{value:"+JSON.stringify(r)+", model: 'ovpCardProperties'}";i+=u+"]"}}else{i="{path: '"+e[0]+"'"}i+=(t?", formatter: '"+t+"'":"")+"}";return i}function re(){var t=arguments[arguments.length-1],r=arguments[0];var a=e.getFloatInstance({style:"short",showMeasure:false,shortRefNumber:t.scaleFactor,minFractionDigits:t.numberOfFractionalDigits,maxFractionDigits:t.numberOfFractionalDigits});if(typeof r=="string"){r=e.getIntegerInstance().parse(r)}return a.format(Number(r))}function ae(){var e=arguments[arguments.length-1],r=arguments[0];var a=t.getInstance(e.dateFormat);if(!r){r="";return r}return a.format(new Date(r),e.bUTC)}function ie(){var t=arguments[arguments.length-1],r=Number(arguments[0]),a=arguments[1];var i="";var n=e.getCurrencyInstance({style:"short",showMeasure:false,shortRefNumber:t.scaleFactor,minFractionDigits:t.numberOfFractionalDigits,maxFractionDigits:t.numberOfFractionalDigits});if(typeof r=="string"){r=e.getIntegerInstance().parse(r)}if(a){i=n.format(r,a)}else{i=t.currencyString?n.format(r,t.currencyString):n.format(r)}return i}function ne(e,t,r){var a=r.split("/");if(a.length>1){for(var i=0;i<a.length-1;i++){t=e.getProperty("/"+t.$Type)[a[i]]}return ee(e,t,a[a.length-1])}}function oe(e,t,r){var a=M(e,t);var i=d.StateValues;var n=a[r];if(!n){return i.None}if(n.Criticality){return fe(e,n,i)}return pe(e,n,i)}function ue(e,t,r){var a=M(e,t);if(a&&a.length){var i=a[0];if(i&&(i.Criticality||i.CriticalityCalculation)){return true}}return false}function le(e,t,r){if(ue(e,t,r)){return""}return"sapUiChartPaletteQualitativeHue1"}le.requiresIContext=true;function se(e,t,r){var a=M(e,t),i=d.ColorValues;var n=i.None;if(a.length>r){var o=a[r];if(o&&o.Criticality){n=fe(e,o,i)}else{n=pe(e,o,i)}}return n}function fe(e,t,r){var i=r.None;var n;var o=t.Criticality;if(o){n="'{'= ({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Negative'') || ({0} === ''1'') || ({0} === 1) ? ''"+r.Negative+"'' : "+"({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Critical'') || ({0} === ''2'') || ({0} === 2) ? ''"+r.Critical+"'' : "+"({0} === ''com.sap.vocabularies.UI.v1.CriticalityType/Positive'') || ({0} === ''3'') || ({0} === 3) ? ''"+r.Positive+"'' : "+"''"+r.None+"'' '}'";if(o.$Path){var u="$"+a.format(o,{context:e});i=s(n,u)}else if(o.$EnumMember){var l="'"+o.$EnumMember+"'";i=s(n,l)}else{b.warning("Case not supported, returning the default Neutral state")}}else{b.warning("Case not supported, returning the default Neutral state")}return i}function ce(e,t,r){var a=M(e,t);var i="None";if(a.length>r){var n=a[r];if(n&&n.Criticality&&n.Criticality.Path){i=z(e,t,r)}else{i=pe(e,n,d.StateValues);i=S(i)}}return i}function pe(e,t,r,a){var i=r.None;if(t.Criticality){i=F(t.Criticality,r)}else if(t.CriticalityCalculation&&t.Value&&t.Value&&t.Value.$Path){i=ge(e,t,r,a)}return i}function ge(e,t,r,a){var i=Ne(t.Value,a);var n=t.CriticalityCalculation.ImprovementDirection.$EnumMember;var o=Ne(t.CriticalityCalculation.DeviationRangeLowValue,a);var u=Ne(t.CriticalityCalculation.DeviationRangeHighValue,a);var l=Ne(t.CriticalityCalculation.ToleranceRangeLowValue,a);var s=Ne(t.CriticalityCalculation.ToleranceRangeHighValue,a);var f=me(o);var c=me(u);var p=me(l);var g=me(s);var v={deviationLow:o,deviationHigh:u,toleranceLow:l,toleranceHigh:s,bIsDeviationLowBinding:f,bIsDeviationHighBinding:c,bIsToleranceLowBinding:p,bIsToleranceHighBinding:g,sImprovementDirection:n,oCriticalityConfigValues:r};var m="{value:"+JSON.stringify(v)+", model: 'ovpCardProperties'}";var h="parts: ["+i;h+=f?","+o:"";h+=c?","+u:"";h+=p?","+l:"";h+=g?","+s:"";h+=","+m;h+="]";var y="sap.ovp.cards.v4.V4AnnotationHelper.formatColor";return"{"+h+", formatter: '"+y+"'}"}function ve(){var e=arguments[arguments.length-1];var t=1;return N(arguments[0],e.sImprovementDirection,e.bIsDeviationLowBinding?parseFloat(arguments[t++].split(",").join("")):e.deviationLow,e.bIsDeviationHighBinding?parseFloat(arguments[t++].split(",").join("")):e.deviationHigh,e.bIsToleranceLowBinding?parseFloat(arguments[t++].split(",").join("")):e.toleranceLow,e.bIsToleranceHighBinding?parseFloat(arguments[t++].split(",").join("")):e.toleranceHigh,e.oCriticalityConfigValues)}function me(e){return typeof e==="string"&&e.charAt(0)==="{"}function he(e,t,r){var a="";var i=r.split("/");if(i.length>1){i.pop();a=i.join("/")}return a}function ye(e){var t;if(e&&typeof e.getData==="function"){var r=e.getData();if(r.tabs){var a=0;var i=r.selectedKey;if(i&&r.tabs.length>=i){a=i-1}t=r.tabs[a].mFilterPreference}else{t=r.mFilterPreference}}return!!t}function de(e,t){var r=e.getSetting("ovpCardProperties");var a=r.getProperty("/addODataSelect");var i=r.getProperty("/metaModel");var n=i.getData();var o=t;var u,l,s,f;if(r.getProperty("/selectionAnnotationPath")){u="@"+r.getProperty("/selectionAnnotationPath");l=n["$Annotations"][o.$Type][u]}if(r.getProperty("/presentationAnnotationPath")){s=r.getProperty("/presentationAnnotationPath");s="@"+s;f=n["$Annotations"][o.$Type][s]}var c="/"+r.getProperty("/entitySet");var p=Array.prototype.slice.call(arguments,2);var g=e.getSetting("ovpCardProperties"),v=g.getProperty("/parameters");if(l||!!v){if(l&&l.Parameters&&l.Parameters.length>0||!!v){c=Ft(e.getSetting("dataModel"),t,l,v)}}if(r.getProperty("/cardLayout")&&r.getProperty("/cardLayout/noOfItems")){var m="{path: '"+c+"', length: "+ +r.getProperty("/cardLayout/noOfItems")}else{var m="{path: '"+c+"', length: "+Ee(r)}var h=[];if(a){h=Ce(e,i,o,p);var y=r.getProperty("/template");if(y!="sap.ovp.cards.charts.analytical"&&y!="sap.ovp.cards.charts.smart.chart"){var d=Ie(f);for(var P=0;P<d.length;P++){if(h.indexOf(d[P])===-1){h.push(d[P])}}}}var C=Pe(i,o.$Type,p);var T=ye(r);if(T||h.length>0||C.length>0){m=m+", parameters: {"}if(h.length>0||C.length>0){if(h.length>0){m=m+"select: '"+h.join(",")+"'"}if(C.length>0){if(h.length>0){m=m+", "}m=m+"$expand: '"+C.join(",")+"'"}if(T){m=m+", "}}if(T){m=m+"custom: {cardId: '"+r.getProperty("/cardId")+"'}"}if(T||h.length>0||C.length>0){m=m+", $count: true}"}else{m=m+", parameters: {$count:true}"}var b=be(r,f);if(b.length>0){m=m+", sorter:"+JSON.stringify(b)}var I=Oe(r,l);if(I.length>0){m=m+", filters:"+JSON.stringify(I)}m=m+"}";return m}de.requiresIContext=true;function Pe(e,t,r){var a=[];var i,n;for(var o=0;o<r.length;o++){if(!r[o]){continue}i=e.getData()["$Annotations"][t]["@"+r[o]];i=i?i:[];for(var u=0;u<i.length;u++){if(i[u].Value&&i[u].Value.$Path){n=he(e,t,i[u].Value.$Path);if(n&&a.indexOf(n)===-1){a.push(n)}}}}return a}function Ce(e,t,r,i){var n=[];var o,u,l;for(var s=0;s<i.length;s++){if(!i[s]){continue}o=r.$Type.split(".")[1]+"/@"+i[s];u=e.getModel(0);var c={};if(e&&e.bDummyContext){v(c,e,u,true)}else{c=e}l=u.getObject("/"+o);if(!l){l=[]}else if(f(l)){if(l.Data){l=l.Data}else{l=[]}}var p;var g;var m;var h;for(var y=0;y<l.length;y++){g=[];p=l[y];m="";h=p.$Type;if(h==="com.sap.vocabularies.UI.v1.DataField"){m=K(c.getInterface(0),p,r,t,undefined,undefined,true)}else if(h==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"){var d=q(r.$path,p);m=J(c,t.getProperty(d),r,t);var P=w(t.getProperty(d));if(P&&P.length>0){m+=P}}else if(h==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"&&p.Url){var C;if(!p.Url.UrlRef){C=a.format(c,p.Url)}if(C&&C.substring(0,2)==="{="){m=C}}if(m){var T=a.format(p.Value,{context:c.getInterface(0)});if(m.indexOf("(")<0&&m!==T){m=[].concat(T,m).join(" ")}g=Te(m)}if(g&&g.length>0){var b;for(var I=0;I<g.length;I++){b=g[I];if(!n[b]){n[b]=true;var $={};$[b]=ee(t,r,b);var D=wt(b,$);if(D&&D!==b){n[D]=true}var V=ir(t,r,b);if(V&&V!==b){n[V]=true}}}}}}return Object.keys(n)}function Te(e){var t,r=0,a=e.length,i="",n;for(t=0;t<a;t++){n=e.charAt(t);if(!n){return}switch(n){case"{":r++;break;case"}":r--;break;default:if(r<=0){continue}break}i+=n}e=i;var o=/\${([a-zA-Z0-9\_|\/]*)/g;var u=/[^[{]*[a-zA-Z0-9\_]/g;var l=/path *\: *\'([a-zA-Z0-9\_]+)*\'/g;var s,f,c=[];if(e.indexOf("{parts:[")!==-1){e=e.replace("{parts:[","");e=e.replace("]","");e=e.replace(e.lastIndexOf("}",""))}if(e.substring(0,2)==="{="){s=o;f=1}else if(e.indexOf("path")!==-1){if(e.indexOf("{value")>0){var p=0;var t=e.indexOf("{value")+5;var g;while(t<a){if(e[t]==="}"&&p===0){g=t;break}if(e[t]==="{"){p+=1}if(e[t]==="}"){p-=1}t++}e=e.slice(0,e.indexOf("{value"))+e.slice(g)}var v=u.exec(e);while(v){if(v[0].indexOf("path")===-1&&v[0].indexOf("@i18n")!==0&&v[0].indexOf("model: 'ovpCardProperties'")<=-1){c.push(v[0])}v=u.exec(e)}s=l;f=1}else{s=u;f=0}var m=s.exec(e);while(m){if(m[f]&&m[f].indexOf("@i18n")!==0){c.push(m[f])}m=s.exec(e)}return c}function be(e,t){var r=[];var a,i;var n=e.getProperty("/sortBy");if(n){var o=e.getProperty("/sortOrder");if(o&&o.toLowerCase()!=="descending"){i=false}else{i=true}a={path:n,descending:i};r.push(a)}var u=t&&t.SortOrder||undefined;var l,n;if(u){for(var s=0;s<u.length;s++){l=u[s];n=l.Property.$PropertyPath;i=Fe(l.Descending,true);a={path:n,descending:i};r.push(a)}}return r}function Ie(e){var t=[];var r=e&&e.RequestAtLeast||undefined;if(r){for(var a=0;a<r.length;a++){if(r[a].PropertyPath){t.push(r[a].PropertyPath)}}}return t}function $e(e){var t=e.getProperty("/entityType");var r=t[e.getProperty("/selectionAnnotationPath")];return{filters:Oe(e,r),parameters:Ve(r)}}function De(e){if(!e){return}var t=e.getProperty("/entityType");var r=t[e.getProperty("/presentationAnnotationPath")];var a=be(e,r);var i=[];var n,o=a.length;for(n=0;n<o;n++){if(!a[n].path){continue}i.push({Property:a[n].path,Descending:a[n].descending})}if(i.length>0){return{SortOrder:i}}}function Ve(e){var t,r=[];if(!e||!e.Parameters){return r}var a=e.Parameters.length;for(var i=0;i<a;i++){t=e.Parameters[i];if(!t.PropertyName||!t.PropertyName.PropertyPath){continue}if(!t.PropertyValue){b.error("Missing value for parameter "+t.PropertyName.PropertyPath);continue}r[r.length]={path:t.PropertyName.PropertyPath,value:xe(t.PropertyValue)}}return r}function Oe(e,t){var r=[];var a;var n=e.getProperty("/filters");if(n){r=r.concat(n)}if(t&&t.SelectOptions){a=t.SelectOptions}else{a=t}var o,u,l;if(a){for(var s=0;s<a.length;s++){o=a[s];u=o.PropertyName.$PropertyPath;for(var f=0;f<o.Ranges.length;f++){l=o.Ranges[f];if(l.Sign.$EnumMember){var c={path:u,operator:l.Option.$EnumMember.split("/")[1],value1:xe(l.Low),value2:xe(l.High),sign:l.Sign.$EnumMember==="com.sap.vocabularies.UI.v1.SelectionRangeSignType/I"?"I":"E"};if(c.sign==="E"&&c.operator!==i.EQ){b.error("Exclude sign is supported only with EQ operator");continue}if(c.sign==="E"&&c.operator===i.EQ){c.operator=i.NE;c.sign="I"}if(c.operator==="CP"&&c.sign==="I"){var p=i.Contains;var g=c.value1;if(g){var v=g.indexOf("*");var m=g.lastIndexOf("*");if(v>-1){if(v===0&&m!==g.length-1){p=i.EndsWith;g=g.substring(1,g.length)}else if(v!==0&&m===g.length-1){p=i.StartsWith;g=g.substring(0,g.length-1)}else{g=g.substring(1,g.length-1)}}}c.operator=p;c.value1=g}r.push(c)}}}}return r}function Fe(e,t){if(e&&e.Boolean){if(e.Boolean.toLowerCase()==="true"){return true}else if(e.Boolean.toLowerCase()==="false"){return false}}else if(e&&e.Bool){if(e.Bool.toLowerCase()==="true"){return true}else if(e.Bool.toLowerCase()==="false"){return false}}return t}function Se(e){var t;if(e){if(e.String){t=Number(e.String)}else if(e.Int){t=Number(e.Int)}else if(e.$Decimal){t=Number(e.$Decimal)}else if(e.Double){t=Number(e.Double)}else if(e.Single){t=Number(e.Single)}else if(typeof e==="number"){return e}}return t}function xe(e){var t;if(e){if(e.String||e.String===""){t=e.String}else if(typeof e=="string"){t=e}else if(e.Boolean||e.Bool){t=Fe(e)}else if(e.DateTime){t=e.DateTime}else if(e.DateTimeOffset){t=e.DateTimeOffset}else{t=Se(e)}}return t}function Ne(e,t){if(e){if(e.$Path){return t?"{path:'"+e.$Path+"Agg"+"', type:'sap.ui.model.odata.type.Decimal'}":"{path:'"+e.$Path+"'}"}else{return xe(e)}}else{return""}}function Ee(e){var t=e.getProperty("/contentFragment");var r=e.getProperty("/listType");var a=e.getProperty("/listFlavor");var i;var o="desktop";if(n.system.phone){o="phone"}else if(n.system.tablet){o="tablet"}if(t=="sap.ovp.cards.list.List"){if(r=="extended"){if(a=="bar"){i=T["List_extended_bar"]}else{i=T["List_extended"]}}else if(a=="bar"){i=T["List_condensed_bar"]}else{i=T["List_condensed"]}}else if(t=="sap.ovp.cards.table.Table"){i=T["Table"]}else if(t=="sap.ovp.cards.stack.Stack"){if(e.getProperty("/objectStreamCardsNavigationProperty")){i=T["Stack_complex"]}else{i=T["Stack_simple"]}}if(i){return i[o]}return 5}function Ae(e){var t=e.getObject();var r=M(e,t,true);var a=r.map(function(e){if(e&&e.Value&&e.Value.$Path){return e.Value.$Path}else if(e&&e.fn&&e.fn.$Path){return e.fn.$Path}});t.filter(function(e,r){if(e.$Type==="com.sap.vocabularies.UI.v1.DataField"&&a.indexOf(e.Value.$Path)>-1){t.splice(r,1)}});return e.sPath}Ae.requiresIContext=true;function Me(e,t){if(t.charAt(0)==="/"||t.indexOf("http")===0){return t}var r=e.getModel(0).getProperty("/baseUrl");if(r){return r+"/"+t}return t}Me.requiresIContext=true;function Re(e,t){var r=M(e,t);return r.length}Re.requiresIContext=true;function Ue(e,t){return qe(e,t,0)}Ue.requiresIContext=true;function we(e,t){return qe(e,t,1)}we.requiresIContext=true;function qe(e,t,r){var a=M(e,t),i=a[r];if(i&&i.Value&&i.Value.$Path){return i.Value.$Path}return""}function Le(e,t){return k(e,t,0)}Le.requiresIContext=true;function _e(e,t){return k(e,t,1)}_e.requiresIContext=true;function Be(e,t){return k(e,t,2)}Be.requiresIContext=true;function je(e,t){return k(e,t,3)}je.requiresIContext=true;function ke(e,t){return k(e,t,4)}ke.requiresIContext=true;function He(e,t,r){return j(e,t,r)}He.requiresIContext=true;function Ge(e,t,r){return X(e,t,r)}Ge.requiresIContext=true;function Xe(e,t,r,a){var i=Re(e,t);if(i>0){return Ge(e,t,r)}else{return He(e,t,a)}}Xe.requiresIContext=true;function Ye(e,t,r){return vt(e,t,r)}Ye.requiresIContext=true;function ze(e,t){return H(e,t,0)}ze.requiresIContext=true;function Je(e,t){return H(e,t,1)}Je.requiresIContext=true;function Qe(e,t){return H(e,t,2)}Qe.requiresIContext=true;function We(e,t){return G(e,t,0)}We.requiresIContext=true;function Ke(e,t){for(var r=0;r<t.length;r++){var i=t[r];if(i.$Type==="com.sap.vocabularies.UI.v1.DataField"){if(i.IconUrl&&i.IconUrl.String){return i.IconUrl.String}if(i.IconUrl&&i.IconUrl.$Path){return a.format(i.IconUrl,{context:e})}}}}Ke.requiresIContext=true;function Ze(e,t,r){var a="";var i;if(Array.isArray(t)){i=M(e,t)[r]}else{var n=Object.assign({},t);var o=Object.assign({},e);i=pt(o,n)}if(!i||!i.Value){return a}var u=e.getSetting("ovpCardProperties");var l=u&&u.getProperty("/entityType");var s=u&&u.getProperty("/metaModel");var f=s&&s.getData()["$Annotations"][l.$Type+"/"+i.Value.$Path];var c=f&&f["@"+P.ISO_CURRENCY];if(c){if(c.$Path){a+=" "+te([c.$Path])}else{a+=" "+c}a+=" "+Z(c.$Path,s,l)}return a}Ze.requiresIContext=true;function et(e,t,r,a){return X(e,t,r,a)}et.requiresIContext=true;function tt(e,t){return oe(e,t,0)}tt.requiresIContext=true;function rt(e,t){return se(e,t,0)}rt.requiresIContext=true;function at(e,t){return oe(e,t,1)}at.requiresIContext=true;function it(e,t){return oe(e,t,2)}it.requiresIContext=true;function nt(e,t){return ce(e,t,0)}nt.requiresIContext=true;function ot(e){var t={};t.$EnumMember="None";if(Number(e)===1){t.$EnumMember="Negative"}else if(Number(e)===2){t.$EnumMember="Critical"}else if(Number(e)===3){t.$EnumMember="Positive"}return F(t,d.ColorValues)}function ut(e,t){if(t&&t.Criticality&&t.Criticality.$Path){return"{parts: [{path:'"+t.Criticality.$Path+"Agg', type:'sap.ui.model.odata.type.Decimal'}], formatter: 'sap.ovp.cards.v4.V4AnnotationHelper.kpiValueCriticality'}"}else{return pe(e,t,d.ColorValues,true)}}ut.requiresIContext=true;function lt(e,t){return Y(e,t,0)}lt.requiresIContext=true;function st(e,t){var r=M(e,t)[0];if(r&&(r.Criticality||r.CriticalityCalculation)){return true}return false}st.requiresIContext=true;function ft(e,t){return Y(e,t,1)}ft.requiresIContext=true;function ct(e,t){return Y(e,t,2)}ct.requiresIContext=true;function pt(e,t){var r=e.getPath(0);var a=r.slice(0,r.lastIndexOf("/"));a=a.slice(0,a.lastIndexOf("/"));var i=q(a,t);t=e.getModel(0).getProperty(i);return t}function gt(e,t){if(!t){return""}return Q(e,t)}gt.requiresIContext=true;function vt(e,t,r,i){var n;var o=i==undefined?r:A(e,r)[i];var u=e.getSetting("ovpCardProperties");var l=u.getProperty("/metaModel");var s=t.$Type;var f=l.getData()["$Annotations"][s+"/"+o.Value.$Path];if(f){n=f["@com.sap.vocabularies.Common.v1.SemanticObject"];if(n){return a.format(n,e.getModel()?{context:e}:{context:e.getInterface(0)})}else{return""}}}function mt(e,t,r){var a=r===undefined?t.Value.$Path:t[r].Value.$Path;var i=a.indexOf("/")!=-1?a.split("/")[0]:"";return i}mt.requiresIContext=true;function ht(e,t){var r=e.getSetting("ovpCardProperties");var a=r.getProperty("/metaModel");var i=a.getData()["$Annotations"][t.$Type];if(i["@com.sap.vocabularies.Communication.v1.Contact"]){return true}return false}ht.requiresIContext=true;function yt(e,t,r){if(!t){return""}var a=e.getSetting("ovpCardProperties");var i=a.getProperty("/entityType");var n=a.getProperty("/metaModel");var o=Object.assign({},t);var u=Object.assign({},e);t=pt(u,o);return J(e,t,i,n,r)}yt.requiresIContext=true;function dt(e,t){var r=Object.assign({},t);var a=Object.assign({},e);var i="None",n=d.StateValues;t=pt(a,r);if(t&&t.Criticality){i=fe(e,t,n)}else{i=pe(e,t,n)}return i}dt.requiresIContext=true;function Pt(e,t){var r=Object.assign({},t);var a=Object.assign({},e);t=pt(a,r);if(t&&t.Criticality){return true}}Pt.requiresIContext=true;function Ct(e,t){var r=Object.assign({},t);var a=Object.assign({},e);var i=e.getSetting("ovpCardProperties");var n=i.getProperty("/entityType");var o=i.getProperty("/metaModel");t=pt(a,r);if(!t){return}var u=o.getProperty("/"+n.$Type)[t.Value.$Path];if(t&&u&&u.$Type=="Edm.String"&&(t.Criticality||t.CriticalityCalculation)){return"Center"}if(u&&(u.$Type=="Edm.DateTime"||u.$Type=="Edm.DateTimeOffset")){return"Right"}}Ct.requiresIContext=true;function Tt(e,t){var r=Object.assign({},t);var a=Object.assign({},e);t=pt(a,r);var i="None";if(t&&t.Criticality&&t.Criticality.Path){i="{path:'"+t.Criticality.Path+"'}"}else{i=pe(e,t,d.StateValues);i=S(i)}return i}Tt.requiresIContext=true;function bt(e,t){var r;for(var a=0;a<t.length;a++){r=t[a];if(r.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"||r.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForAction"||r.RecordType==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){return 1}}return 0}bt.requiresIContext=true;function It(e,t){var r=M(e,t)[0];if(r&&r.Value&&r.Value.$Path){var a=e.getPath(0).substr(0,e.getPath(0).lastIndexOf("/")+1);var i=e.getModel(0);var n=i.getData(r.Value.$Path);var o=a.substr(1,a.length-2);if(n&&n[o][r.Value.$Path][P.UOM]){return n[P.UOM].String==="%"}}return false}It.requiresIContext=true;function $t(e){var t=e.getObject();var r=e.getModel();var a=r.getProperty("/metaModel");var i="/"+r.getProperty("/entitySet");var n=a.getObject(i);t="/"+n.$Type+"/@"+t;return a.createBindingContext(t)}function Dt(e,t){if(e==="Edm.String"){var r=t.PropertyValue.String;return r}return t.PropertyValue.String}function Vt(e,t,r,a){var i="";var n=[];if(a&&a.Parameters){e.parameters.forEach(function(r){a.Parameters.forEach(function(a){var i=a.PropertyName.PropertyPath.split("/");i=i[i.length-1];if(i===r){var o=Dt(e["parameterType"][r],a);o=g(t.formatValue(o,e["parameterType"][r]));n.push(i+"="+o)}})})}else{i="/"+r.name;b.error("SelectionParameters","There are no parameters to resolve");return i}try{i="/"+e.entitySetName+"("+n.join(",")+")/"+e.navPropertyName}catch(e){i="/"+r.name;b.error("getEntitySetPathWithParameters","binding path with parameters failed - "+e||e.message)}return i}function Ot(e,t,r,a,i){var n="";var l=new o.Model(o.Model.ReferenceByModel(e));var s=l.findQueryResultByName(t.name);var f=new o.QueryResultRequest(s);var p=s.getParameterization();if(!p){n="/"+t.name;return n}if(i){var g=i.getAnalyticalParameters()}if(p){var v;f.setParameterizationRequest(new o.ParameterizationRequest(p));if(r&&r.Parameters){c(r.Parameters,function(){if(this.RecordType==="com.sap.vocabularies.UI.v1.IntervalParameter"){v=this.PropertyNameFrom.PropertyPath.split("/");f.getParameterizationRequest().setParameterValue(v[v.length-1],this.PropertyValueFrom.String,this.PropertyValueTo.String)}else{v=this.PropertyName.PropertyPath.split("/");f.getParameterizationRequest().setParameterValue(v[v.length-1],this.PropertyValue.String)}})}else if(a){c(a,function(){f.getParameterizationRequest().setParameterValue(this.path,this.value)})}else if(g&&g.length>0){var m=i&&i.getUiState({allFilters:false});var h=m?JSON.stringify(m.getSelectionVariant()):"{}";var r=new u(h);for(var y in p.getAllParameters()){for(var d=0;d<g.length;d++){if(g[d]&&g[d].name==y){var P=g[d].name;var C=r.getParameter(P);if(!C){var T=r.getSelectOption(P);C=T&&T[0]&&T[0].Low}f.getParameterizationRequest().setParameterValue(y,C)}}}}else{n="/"+t.name;b.error("SelectionParameters","There are no parameters to resolve");return n}}try{n=f.getURIToQueryResultEntitySet()}catch(e){s=f.getQueryResult();n="/"+s.getEntitySet().getQName();b.error("getEntitySetPathWithParameters","binding path with parameters failed - "+e||e.message)}return n}function Ft(e,t,r,a,i){var n="";if(p.checkAnalyticalParameterisedEntitySet(e,t.name)){n=Ot(e,t,r,a,i)}else{var o=p.getParametersByEntitySet(e,t.name);var u=p.getPropertyOfEntitySet(e,t.name);var l={};if(o){o["parameters"].forEach(function(e){u.forEach(function(t){if(t["name"]==e){l[e]=t["type"]}})});o["parameterType"]=l;n=Vt(o,e,t,r)}else{n="/"+t.name}}return n}function St(e,t,r){var a=e.getServiceMetadata().dataServices.schema[0].association;for(var i=0;i<a.length;i++){if(r+"."+a[i].name===t){return a[i]}}}function xt(e,t){var r=e.filter(function(e){if(e.$Type==="com.sap.vocabularies.UI.v1.DataField"){return true}return false});var a=_(r);if(a){return a[t]}return}function Nt(e,t,r){if(!r||!r.length||r.length===0){return false}r=xt(r,0);return vt(e,t,r)}Nt.requiresIContext=true;function Et(e,t,r){if(!r||!r.length||r.length===0){return false}r=xt(r,1);return vt(e,t,r)}Et.requiresIContext=true;function At(e,t){var r=e.filter(function(e){if(e.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"&&e.Target.$AnnotationPath.indexOf("@com.sap.vocabularies.Communication.v1.Contact")!==-1){return true}return false});var a=_(r);if(a){return a[t]}return}function Mt(e){if(!e||!e.length||e.length===0){return false}var t=At(e,0);if(t){return true}return false}function Rt(e,t,r,a){var i;if(r&&r.Value&&r.Value.$Path){i=r.Value.$Path}else if(r&&r.Description&&r.Description.Value&&r.Description.Value.$Path){i=r.Description.Value.$Path}var n="";var o=a&&a.Parameters;var u="";var l=e.getSetting("ovpCardProperties"),s=l.getProperty("/parameters");o=o||!!s;var f=e.getSetting("dataModel");if(o){var c=Ft(f,t,a,s);n+="{path: '"+c+"'"}else{n+="{path: '/"+t.$Type.split(".")[1]+"'"}n+=", length: 1";var p=e.getSetting("ovpCardProperties");var g=p.getProperty("/entityType");var v=e.getModel(0);var m=v.getObject("/"+t.$Type.split(".")[1]+"/");var h,y;for(h in m){if(h.startsWith("$")){continue}y=g.$Type.concat("/",h);m[h].annotations=v.getData(h).$Annotations[y]}var d=Oe(p,a);if(d.length>0){u+=", filters: "+JSON.stringify(d)}var P=[];var C=f.oMetaModel.getData().$Annotations;var T=Ut(i,C,t.$Type);P.push("'"+i+"Agg' : { 'name' : '"+i+"', 'with' : '"+T+"'}");if(r&&r.Criticality&&r.Criticality.$Path){T=Ut(r.Criticality.$Path,C,t.$Type);P.push("'"+r.Criticality.$Path+"Agg' : { 'name' : '"+r.Criticality.$Path+"', 'with' : '"+T+"'}")}if(r&&r.CriticalityCalculation&&r.CriticalityCalculation.DeviationRangeLowValue&&r.CriticalityCalculation.DeviationRangeLowValue.$Path){T=Ut(r.CriticalityCalculation.DeviationRangeLowValue.$Path,C,t.$Type);P.push("'"+r.CriticalityCalculation.DeviationRangeLowValue.$Path+"Agg' : { 'name' : '"+r.CriticalityCalculation.DeviationRangeLowValue.$Path+"', 'with' : '"+T+"'}")}if(r&&r.CriticalityCalculation&&r.CriticalityCalculation.ToleranceRangeLowValue&&r.CriticalityCalculation.ToleranceRangeLowValue.$Path){var T=Ut(r.CriticalityCalculation.ToleranceRangeLowValue.$Path,C,t.$Type);P.push("'"+r.CriticalityCalculation.ToleranceRangeLowValue.$Path+"Agg' : { 'name' : '"+r.CriticalityCalculation.ToleranceRangeLowValue.$Path+"', 'with' : '"+T+"'}")}if(r&&r.CriticalityCalculation&&r.CriticalityCalculation.DeviationRangeHighValue&&r.CriticalityCalculation.DeviationRangeHighValue.$Path){var T=Ut(r.CriticalityCalculation.DeviationRangeHighValue.$Path,C,t.$Type);P.push("'"+r.CriticalityCalculation.DeviationRangeHighValue.$Path+"Agg' : { 'name' : '"+r.CriticalityCalculation.DeviationRangeHighValue.$Path+"', 'with' : '"+T+"'}")}if(r&&r.CriticalityCalculation&&r.CriticalityCalculation.ToleranceRangeHighValue&&r.CriticalityCalculation.ToleranceRangeHighValue.$Path){var T=Ut(r.CriticalityCalculation.ToleranceRangeHighValue.$Path,C,t.$Type);P.push("'"+r.CriticalityCalculation.ToleranceRangeHighValue.$Path+"Agg' : { 'name' : '"+r.CriticalityCalculation.ToleranceRangeHighValue.$Path+"', 'with' : '"+T+"'}")}if(r&&r.TrendCalculation&&r.TrendCalculation.ReferenceValue&&r.TrendCalculation.ReferenceValue.$Path){var T=Ut(r.TrendCalculation.ReferenceValue.$Path,C,t.$Type);P.push("'"+r.TrendCalculation.ReferenceValue.$Path+"Agg' : { 'name' : '"+r.TrendCalculation.ReferenceValue.$Path+"', 'with' : '"+T+"'}")}var b=ye(l);var I=b?", custom: {cardId: '"+l.getProperty("/cardId")+"'}":"";var $="parameters:{'$$aggregation' : {'aggregate' : {"+P.join(",")+"}}"+I+"}";return n+", "+$+u+"}"}Rt.requiresIContext=true;function Ut(e,t,r){var a=t[r+"/"+e];if(a["@Org.OData.Aggregation.V1.default"]){return a["@Org.OData.Aggregation.V1.default"].$EnumMember.split("/")[1].toLowerCase()}return"sum"}function wt(e,t,r){var a;var i,n,o;for(o in t){if(o!==e){continue}if(t[o].annotations&&t[o].annotations.hasOwnProperty("@"+P.ISO_CURRENCY)){i=t[o].annotations["@"+P.ISO_CURRENCY].$Path;n=t[o].annotations["@"+P.ISO_CURRENCY].$String;if(i){return i}else{return r?n:""}}if(t[o].annotations&&t[o].annotations.hasOwnProperty("@"+P.UOM)){i=t[o].annotations.hasOwnProperty("@"+P.UOM).$Path;n=t[o].annotations["@"+P.UOM].$String;if(i){a=i}else{a=r?n:""}if(a&&a!="%"){return a}else{return null}}if(t[o].annotations&&t[o].annotations.hasOwnProperty("sap:unit")){return t[o].annotations["sap:unit"]}break}return null}function qt(e){if(!e||!e.Value||!e.Value.$Path){return""}var t=this.getModel("ovpCardProperties");var r=t.getProperty("/entityType");var a=t.getProperty("/metaModel");var i=ee(a,r,e.Value.$Path);if(i[P.UOM]){var n=i[P.UOM];if(n.String=="%"){this.getModel("ovpCardProperties").oData.percentageAvailable=true}}if(e&&e.ValueFormat&&e.ValueFormat.NumberOfFractionalDigits){this.getModel("ovpCardProperties").oData.NumberOfFractionalDigits=e.ValueFormat.NumberOfFractionalDigits}var o={NumberOfFractionalDigits:this.getModel("ovpCardProperties").oData.NumberOfFractionalDigits?this.getModel("ovpCardProperties").oData.NumberOfFractionalDigits:0,percentageAvailable:this.getModel("ovpCardProperties").oData.percentageAvailable?this.getModel("ovpCardProperties").oData.percentageAvailable:false};var u="sap.ovp.cards.v4.V4AnnotationHelper.KpiValueFormatter";var l=[e.Value.$Path+"Agg"];return te(l,u,o,true)}function Lt(){var t=arguments[arguments.length-1],r=arguments[0];r=r?parseInt(r.split(",").join(""),10):null;var a=e.getFloatInstance({minFractionDigits:t.NumberOfFractionalDigits,maxFractionDigits:t.NumberOfFractionalDigits,style:"short",showScale:true,shortRefNumber:r});if(t.percentageAvailable){return a.format(Number(r))+" %"}else{return a.format(Number(r))}}function _t(e,t){if(!t||!t.Value||!t.Value.$Path||!t.TrendCalculation){return""}var r=Ne(t.Value,true);var a=Ne(t.TrendCalculation.ReferenceValue,true);var i=Ne(t.TrendCalculation.DownDifference,true);var n=Ne(t.TrendCalculation.UpDifference,true);var o=me(a);var u=me(i);var l=me(n);var s={referenceValue:a,downDifference:i,upDifference:n,bIsRefValBinding:o,bIsDownDiffBinding:u,bIsUpDiffBinding:l};var f="{value:"+JSON.stringify(s)+", model: 'ovpCardProperties'}";var c="parts: ["+r;c+=o?","+a:"";c+=u?","+i:"";c+=l?","+n:"";c+=","+f;c+="]";var p="sap.ovp.cards.v4.V4AnnotationHelper.formatTrendIcon";return"{"+c+", formatter: '"+p+"'}"}_t.requiresIContext=true;function Bt(){var e=arguments[arguments.length-1];var t=1;return E(arguments[0],e.bIsRefValBinding?arguments[t++]:e.referenceValue,e.bIsDownDiffBinding?arguments[t++]:e.downDifference,e.bIsUpDiffBinding?arguments[t++]:e.upDifference)}function jt(e){if(!e||!e.TrendCalculation||!e.TrendCalculation.ReferenceValue){return""}if(e&&e.ValueFormat&&e.ValueFormat.NumberOfFractionalDigits){this.getModel("ovpCardProperties").oData.NumberOfFractionalDigits=e.ValueFormat.NumberOfFractionalDigits}if(e.TrendCalculation.ReferenceValue.$Path){return"{parts: [{path:'"+e.Value.$Path+"Agg', type:'sap.ui.model.odata.type.Decimal'}, {path:'"+e.TrendCalculation.ReferenceValue.$Path+"'}], formatter: 'sap.ovp.cards.v4.V4AnnotationHelper.returnPercentageChange'}"}else{return"{parts: [{path:'"+e.Value.$Path+"Agg', type:'sap.ui.model.odata.type.Decimal'}], formatter: 'sap.ovp.cards.v4.V4AnnotationHelper.returnPercentageChange'}"}}function kt(t,r){var a,i,n,o,u=false;if(typeof t=="string"){t=e.getIntegerInstance().parse(t)}if(isNaN(+t)){return""}if(t==0){o=r}else{o=t}i=this.getModel("ovpCardProperties");if(i.getProperty("/iNumberOfFractionalDigits")){n=+i.getProperty("/iNumberOfFractionalDigits")}if(i.getProperty("/bPercentageAvailableForTarget")){u=true}if(r){a=r}else{if(i.getProperty("/sManifestTargetValue")){a=i.getProperty("/sManifestTargetValue")}}if(!n||n<0){n=0}else if(n>2){n=2}if(a){var l=e.getFloatInstance({minFractionDigits:n,maxFractionDigits:n,style:"short",showScale:true,shortRefNumber:o});if(u){return l.format(+a)+" %"}else{return l.format(+a)}}}function Ht(e){if(!e||!e.TrendCalculation||!e.TrendCalculation.ReferenceValue){return""}if(!e||!e.Value||!e.Value.$Path){return""}var t=this.getModel("ovpCardProperties");var r=t.getProperty("/entityType");var a=t.getProperty("/metaModel");if(e&&e.ValueFormat&&e.ValueFormat.NumberOfFractionalDigits){t.setProperty("/iNumberOfFractionalDigits",e.ValueFormat.NumberOfFractionalDigits)}if(e.TrendCalculation.ReferenceValue){if(e.TrendCalculation.ReferenceValue.$Path){var i=ee(a,r,e.TrendCalculation.ReferenceValue.$Path);if(i[P.UOM]){var n=i[P.UOM];if(n.String=="%"){t.setProperty("/bPercentageAvailableForTarget",true)}}return"{parts: [{path:'"+e.Value.$Path+"Agg', type:'sap.ui.model.odata.type.Decimal'},{path:'"+e.TrendCalculation.ReferenceValue.$Path+"Agg', type:'sap.ui.model.odata.type.Decimal'}], formatter: 'sap.ovp.cards.v4.V4AnnotationHelper.TargetValueFormatter'}"}if(e.TrendCalculation.ReferenceValue){t.setProperty("/sManifestTargetValue",e.TrendCalculation.ReferenceValue);return"{parts: [{path:'"+e.Value.$Path+"Agg', type:'sap.ui.model.odata.type.Decimal'}], formatter: 'sap.ovp.cards.v4.V4AnnotationHelper.TargetValueFormatter'}"}}}function Gt(t,r){var a,i,n;if(typeof t=="string"){t=e.getIntegerInstance().parse(t)}if(isNaN(+t)){return""}t=+t;n=this.getModel("ovpCardProperties");if(n.getProperty("/iNumberOfFractionalDigits")){a=+n.getProperty("/iNumberOfFractionalDigits")}if(r){i=+r}else{if(n.getProperty("/sManifestTargetValue")){i=+n.getProperty("/sManifestTargetValue")}}if(!a||a<0){a=0}else if(a>2){a=2}if(i){var o=(t-i)/i;var u=e.getPercentInstance({style:"short",minFractionDigits:a,maxFractionDigits:a,showScale:true});return u.format(o)}}function Xt(e){if(e&&e.GroupBy&&!h(e.GroupBy)&&e.GroupBy[0].hasOwnProperty("$PropertyPath")){return true}else{return false}}function Yt(e,t){var r;for(var a=0;e&&a<e.length;a++){if(e[a].value==t){r=e[a];break}}return r?r.name:null}function zt(e,t){return Yt(e,t)}function Jt(e,t){var r=Yt(e,t);return r?r:l.getText("OVP_KEYUSER_LABEL_NO_NAVIGATION")}function Qt(e){var t="";var r=e&&e.GroupBy;if(!r){return t}var a=this.getModel("ovpCardProperties").getProperty("/metaModel");var i=this.getModel("ovpCardProperties").getProperty("/entityType");var n;if(e.GroupBy.constructor===Array){n=e.GroupBy}else if(!e.GroupBy.Collection){return t}else{n=e.GroupBy.Collection}var o;c(n,function(){o=ar(a,i,this.$PropertyPath);if(!o){return}t+=o;t+=", "});if(t[t.length-1]===" "&&t[t.length-2]===","){t=t.substring(0,t.length-2)}return t==""?"":l.getText("By",[t])}function Wt(e,t,r){var a=true;var i=r["SelectOptions"].length-1;if(t.PropertyName.PropertyPath===r["SelectOptions"][i].PropertyName.PropertyPath){a=false}t=[t];var n=e.getSetting("ovpCardProperties");var o=n.getProperty("/entityType");var u=n.getProperty("/metaModel");var l=Oe(n,t);if(l.length==0){return""}var s;var f;s=l[0].path;f=ir(u,o,s);if(f!==s){return""}var c=u.getODataProperty(o,t[0].PropertyName.PropertyPath)["type"];var p=tr(l,c);if(a===true){return p+", "}return p}Wt.requiresIContext=true;function Kt(e,t,r){var a=!(t.index===r.length-1);var i=e.getSetting("ovpCardProperties");var n=i.getProperty("/metaModel");var o=i.getProperty("/entityType");var u=n.getODataProperty(o,r[t.index].path)["type"];var l=tr([r[t.index]],u);if(a===true){return l+", "}return l}Kt.requiresIContext=true;function Zt(e){return e.id}function er(e){return e.id}function tr(e,t){var r=[];for(var a=0;a<e.length;a++){r.push(rr(e[a],t))}return r.join(", ")}function rr(e,r){var a=false;var i,n=t.getInstance({style:"medium"});if(r==="Edm.DateTime"){i=n.format(new Date(e.value1))}else if(r==="Edm.DateTimeOffset"){i=n.format(new Date(e.value1),true)}else{i=e.value1}if(e.operator[0]==="N"){a=true}if(e.value2){if(r==="Edm.DateTime"){i+=" - "+n.format(new Date(e.value1))}else if(r==="Edm.DateTimeOffset"){i+=" - "+n.format(new Date(e.value1),true)}else{i+=" - "+e.value1}}if(a){i=l.getText("kpiHeader_Filter_NotOperator",[i])}return i}function ar(e,t,r){return nr(e,t,r,"com.sap.vocabularies.Common.v1.Label")}function ir(e,t,r){return nr(e,t,r,"sap:text")}function nr(e,t,r,a){var i={};i[r]=ee(e,t,r);if(!i){b.error("No Property Found for with Name '"+r+" For Entity-Type '"+t.name+"'");return}if(i[r].annotations){var n=i[r].annotations["@"+a]}if(n){return n}return Object.keys(i)[0]}function or(e){if(!e||!e.Value||!e.Value.$Path){return""}var t={NumberOfFractionalDigits:this.getModel("ovpCardProperties").oData.NumberOfFractionalDigits?this.getModel("ovpCardProperties").oData.NumberOfFractionalDigits:0,percentageAvailable:this.getModel("ovpCardProperties").oData.percentageAvailable?this.getModel("ovpCardProperties").oData.percentageAvailable:false};var r="sap.ovp.cards.v4.V4AnnotationHelper.KpiValueFormatter";var a=[e.Value.$Path];return te(a,r,t)}function ur(e,t){if(t.hasOwnProperty(e)){return true}return false}function lr(e,t){var r;if(t[e].customDateRangeImplementation){return t[e].customDateRangeImplementation}else if(t[e].filter){r={module:"sap.ui.comp.config.condition.DateRangeType",operations:{filter:t[e].filter}};return JSON.stringify(r)}else if(t[e].selectedValues){r={module:"sap.ui.comp.config.condition.DateRangeType",operations:{filter:[{path:"key",contains:t[e].selectedValues,exclude:t[e].exclude}]}};return JSON.stringify(r)}else if(t[e].defaultValue){r={module:"sap.ui.comp.config.condition.DateRangeType"};return JSON.stringify(r)}}function sr(e){if(e){return undefined}return"_BASIC"}function fr(e,t){for(var r=0;r<t.length;r++){if(t[r].type.$EnumMember.indexOf("ContactInformationType/work")>=0){var i=a.format(t[r].address,{context:e});return i}}return""}fr.requiresIContext=true;function cr(e,t){for(var r=0;r<t.length;r++){if(t[r].type.$EnumMember.indexOf("PhoneType/work")>=0){var i=a.format(t[r].uri,{context:e});return i}}return""}cr.requiresIContext=true;function pr(e,t){for(var r=0;r<t.length;r++){if(t[r].type.$EnumMember.indexOf("PhoneType/cell")>=0){var i=a.format(t[r].uri,{context:e});return i}}return""}pr.requiresIContext=true;function gr(e,t){for(var r=0;r<t.length;r++){if(t[r].type.$EnumMember.indexOf("PhoneType/fax")>=0){var i=a.format(t[r].uri,{context:e});return i}}return""}gr.requiresIContext=true;return{getGroupID:sr,getConditionTypeForDateProperties:lr,isDateRangeType:ur,criticalityConstants:d,TextArrangementType:C,getLabelForDataItem:$,colorPaletteForComparisonMicroChart:le,formatField:Q,checkFilterPreference:ye,formatItems:de,getCardSelections:$e,getCardSorters:De,getFilters:Oe,getPrimitiveValue:xe,getAnnotationLabel:zt,getApplicationName:Jt,removeDuplicateDataField:Ae,formatUrl:Me,getDataPointsCount:Re,getFirstDataPointValue:Ue,getFirstDataFieldName:Le,getSecondDataFieldName:_e,getRequestFields:Ie,getThirdDataFieldName:Be,formatDataFieldValueOnIndex:He,formatDataPointValueOnIndex:Ge,formatDataPointOrField:Xe,formatsemanticObjectOfDataFieldGeneric:Ye,getLabelForFirstDataPoint:We,formatImageUrl:Ke,formatUnit:Ze,formatObjectNumber:et,formatFirstDataPointState:tt,formatFirstDataPointColor:rt,formatSecondDataPointState:at,formatThirdDataPointState:it,formatFirstDataPointStateForSmartField:nt,formatKPIHeaderState:ut,isFirstDataPointCriticality:lt,isFirstDataPointCriticalityForTableStatus:st,getSortedDataFields:A,getSortedDataPoints:M,formatDataFieldValueGeneric:gt,formatDataPointValue:yt,formatDataPointStateGeneric:dt,checkCriticalityGeneric:Pt,checkCriticalityGenericForTableStatus:Ct,formatDataPointStateForSmartFieldGeneric:Tt,hasActions:bt,isFirstDataPointPercentageUnit:It,resolveEntityTypePath:$t,resolveParameterizedEntitySet:Ft,getAssociationObject:St,semanticObjectOfFirstDataField:Nt,semanticObjectOfSecondDataField:Et,isFirstContactAnnotation:Mt,getAggregateNumber:Rt,KpiValueFormatter:Lt,kpiValueCriticality:ot,formThePathForAggregateNumber:qt,formThePathForTrendIcon:_t,formPathForPercentageChange:jt,TargetValueFormatter:kt,formPathForTargetValue:Ht,returnPercentageChange:Gt,isPresentationVarientPresent:Xt,listGroupBy:Qt,formTheFilterByString:Wt,formTheFilterByStringNotFromSelVar:Kt,formTheIdForFilter:Zt,formTheIdForFilterNotFromSelVar:er,_criticality2state:F,_calculateCriticalityState:N,_calculateTrendDirection:E,_getPropertiesFromBindingString:Te,sortCollectionByImportance:_,checkNavTargetForContactAnno:mt,checkForContactAnnotation:ht,getKPIHeaderAggregateNumber:or,formatColor:ve,formatTrendIcon:Bt,formatNumberCalculation:re,formatCurrency:ie,formatDate:ae,getSapTextPathForUOM:Z,getEmail:fr,getPhone:cr,getDevice:pr,getPhoneType:gr}},true);
//# sourceMappingURL=V4AnnotationHelper.js.map