/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/CommonUtils", "sap/fe/navigation/SelectionVariant"], function (CommonUtils, SelectionVariant) {
  "use strict";

  var IntentBasedNavigationOverride = {
    adaptNavigationContext: function (oSelectionVariant, oTargetInfo) {
      var oView = this.getView(),
          oController = oView.getController(),
          oInternalModelContext = this.getView().getBindingContext("internal"),
          oExternalNavigationContext = oInternalModelContext.getProperty("externalNavigationContext");
      var oAppComponent = CommonUtils.getAppComponent(oView);
      var oMetaModel = oAppComponent.getModel().getMetaModel();

      if (oExternalNavigationContext.page) {
        var oPageContext = oView.getBindingContext(),
            sMetaPath = oMetaModel.getMetaPath(oPageContext.getPath());

        var oPageContextData = oController._intentBasedNavigation.removeSensitiveData(oPageContext.getObject(), sMetaPath),
            oPageData = oController._intentBasedNavigation.prepareContextForExternalNavigation(oPageContextData, oPageContext),
            oPagePropertiesWithoutConflict = oPageData.propertiesWithoutConflict,
            // TODO: move this also into the intent based navigation controller extension
        oPageSV = CommonUtils.addPageContextToSelectionVariant(new SelectionVariant(), oPageData.semanticAttributes, oView),
            oPropertiesWithoutConflict = oTargetInfo.propertiesWithoutConflict;

        var aSelectOptionPropertyNames = oPageSV.getSelectOptionsPropertyNames();
        aSelectOptionPropertyNames.forEach(function (sPropertyName) {
          if (!oSelectionVariant.getSelectOption(sPropertyName)) {
            oSelectionVariant.massAddSelectOption(sPropertyName, oPageSV.getSelectOption(sPropertyName));
          } else {
            // Only when there is no conflict do we need to add something
            // in all other case the conflicted paths are already added in prepareContextForExternalNavigation
            // if property was without conflict in incoming context then add path from incoming context to SV
            // TO-DO. Remove the check for oPropertiesWithoutConflict once semantic links functionality is covered
            if (oPropertiesWithoutConflict && sPropertyName in oPropertiesWithoutConflict) {
              oSelectionVariant.massAddSelectOption(oPropertiesWithoutConflict[sPropertyName], oSelectionVariant.getSelectOption(sPropertyName));
            } // if property was without conflict in page context then add path from page context to SV


            if (sPropertyName in oPagePropertiesWithoutConflict) {
              oSelectionVariant.massAddSelectOption(oPagePropertiesWithoutConflict[sPropertyName], oPageSV.getSelectOption(sPropertyName));
            }
          }
        }); // remove non public properties from targetInfo

        delete oTargetInfo.propertiesWithoutConflict;
      }

      oInternalModelContext.setProperty("externalNavigationContext", {
        "page": true
      });
    }
  };
  return IntentBasedNavigationOverride;
}, false);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJJbnRlbnRCYXNlZE5hdmlnYXRpb25PdmVycmlkZSIsImFkYXB0TmF2aWdhdGlvbkNvbnRleHQiLCJvU2VsZWN0aW9uVmFyaWFudCIsIm9UYXJnZXRJbmZvIiwib1ZpZXciLCJnZXRWaWV3Iiwib0NvbnRyb2xsZXIiLCJnZXRDb250cm9sbGVyIiwib0ludGVybmFsTW9kZWxDb250ZXh0IiwiZ2V0QmluZGluZ0NvbnRleHQiLCJvRXh0ZXJuYWxOYXZpZ2F0aW9uQ29udGV4dCIsImdldFByb3BlcnR5Iiwib0FwcENvbXBvbmVudCIsIkNvbW1vblV0aWxzIiwiZ2V0QXBwQ29tcG9uZW50Iiwib01ldGFNb2RlbCIsImdldE1vZGVsIiwiZ2V0TWV0YU1vZGVsIiwicGFnZSIsIm9QYWdlQ29udGV4dCIsInNNZXRhUGF0aCIsImdldE1ldGFQYXRoIiwiZ2V0UGF0aCIsIm9QYWdlQ29udGV4dERhdGEiLCJfaW50ZW50QmFzZWROYXZpZ2F0aW9uIiwicmVtb3ZlU2Vuc2l0aXZlRGF0YSIsImdldE9iamVjdCIsIm9QYWdlRGF0YSIsInByZXBhcmVDb250ZXh0Rm9yRXh0ZXJuYWxOYXZpZ2F0aW9uIiwib1BhZ2VQcm9wZXJ0aWVzV2l0aG91dENvbmZsaWN0IiwicHJvcGVydGllc1dpdGhvdXRDb25mbGljdCIsIm9QYWdlU1YiLCJhZGRQYWdlQ29udGV4dFRvU2VsZWN0aW9uVmFyaWFudCIsIlNlbGVjdGlvblZhcmlhbnQiLCJzZW1hbnRpY0F0dHJpYnV0ZXMiLCJvUHJvcGVydGllc1dpdGhvdXRDb25mbGljdCIsImFTZWxlY3RPcHRpb25Qcm9wZXJ0eU5hbWVzIiwiZ2V0U2VsZWN0T3B0aW9uc1Byb3BlcnR5TmFtZXMiLCJmb3JFYWNoIiwic1Byb3BlcnR5TmFtZSIsImdldFNlbGVjdE9wdGlvbiIsIm1hc3NBZGRTZWxlY3RPcHRpb24iLCJzZXRQcm9wZXJ0eSJdLCJzb3VyY2VSb290IjoiLiIsInNvdXJjZXMiOlsiSW50ZW50QmFzZWROYXZpZ2F0aW9uLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBDb21tb25VdGlscyBmcm9tIFwic2FwL2ZlL2NvcmUvQ29tbW9uVXRpbHNcIjtcbmltcG9ydCB0eXBlIEludGVudEJhc2VkTmF2aWdhdGlvbiBmcm9tIFwic2FwL2ZlL2NvcmUvY29udHJvbGxlcmV4dGVuc2lvbnMvSW50ZW50QmFzZWROYXZpZ2F0aW9uXCI7XG5pbXBvcnQgdHlwZSB7IEludGVybmFsTW9kZWxDb250ZXh0IH0gZnJvbSBcInNhcC9mZS9jb3JlL2hlbHBlcnMvTW9kZWxIZWxwZXJcIjtcbmltcG9ydCB0eXBlIFBhZ2VDb250cm9sbGVyIGZyb20gXCJzYXAvZmUvY29yZS9QYWdlQ29udHJvbGxlclwiO1xuaW1wb3J0IFNlbGVjdGlvblZhcmlhbnQgZnJvbSBcInNhcC9mZS9uYXZpZ2F0aW9uL1NlbGVjdGlvblZhcmlhbnRcIjtcbmltcG9ydCB0eXBlIENvbnRleHQgZnJvbSBcInNhcC91aS9tb2RlbC9Db250ZXh0XCI7XG5pbXBvcnQgdHlwZSBPRGF0YU1ldGFNb2RlbCBmcm9tIFwic2FwL3VpL21vZGVsL29kYXRhL3Y0L09EYXRhTWV0YU1vZGVsXCI7XG5cbmNvbnN0IEludGVudEJhc2VkTmF2aWdhdGlvbk92ZXJyaWRlID0ge1xuXHRhZGFwdE5hdmlnYXRpb25Db250ZXh0OiBmdW5jdGlvbiAodGhpczogSW50ZW50QmFzZWROYXZpZ2F0aW9uLCBvU2VsZWN0aW9uVmFyaWFudDogYW55LCBvVGFyZ2V0SW5mbzogYW55KSB7XG5cdFx0Y29uc3Qgb1ZpZXcgPSB0aGlzLmdldFZpZXcoKSxcblx0XHRcdG9Db250cm9sbGVyID0gb1ZpZXcuZ2V0Q29udHJvbGxlcigpIGFzIFBhZ2VDb250cm9sbGVyLFxuXHRcdFx0b0ludGVybmFsTW9kZWxDb250ZXh0ID0gdGhpcy5nZXRWaWV3KCkuZ2V0QmluZGluZ0NvbnRleHQoXCJpbnRlcm5hbFwiKSBhcyBJbnRlcm5hbE1vZGVsQ29udGV4dCxcblx0XHRcdG9FeHRlcm5hbE5hdmlnYXRpb25Db250ZXh0ID0gb0ludGVybmFsTW9kZWxDb250ZXh0LmdldFByb3BlcnR5KFwiZXh0ZXJuYWxOYXZpZ2F0aW9uQ29udGV4dFwiKTtcblx0XHRjb25zdCBvQXBwQ29tcG9uZW50ID0gQ29tbW9uVXRpbHMuZ2V0QXBwQ29tcG9uZW50KG9WaWV3KTtcblx0XHRjb25zdCBvTWV0YU1vZGVsID0gb0FwcENvbXBvbmVudC5nZXRNb2RlbCgpLmdldE1ldGFNb2RlbCgpIGFzIE9EYXRhTWV0YU1vZGVsO1xuXHRcdGlmIChvRXh0ZXJuYWxOYXZpZ2F0aW9uQ29udGV4dC5wYWdlKSB7XG5cdFx0XHRjb25zdCBvUGFnZUNvbnRleHQgPSBvVmlldy5nZXRCaW5kaW5nQ29udGV4dCgpIGFzIENvbnRleHQsXG5cdFx0XHRcdHNNZXRhUGF0aCA9IG9NZXRhTW9kZWwuZ2V0TWV0YVBhdGgob1BhZ2VDb250ZXh0LmdldFBhdGgoKSk7XG5cdFx0XHRjb25zdCBvUGFnZUNvbnRleHREYXRhID0gb0NvbnRyb2xsZXIuX2ludGVudEJhc2VkTmF2aWdhdGlvbi5yZW1vdmVTZW5zaXRpdmVEYXRhKG9QYWdlQ29udGV4dC5nZXRPYmplY3QoKSwgc01ldGFQYXRoKSxcblx0XHRcdFx0b1BhZ2VEYXRhID0gb0NvbnRyb2xsZXIuX2ludGVudEJhc2VkTmF2aWdhdGlvbi5wcmVwYXJlQ29udGV4dEZvckV4dGVybmFsTmF2aWdhdGlvbihvUGFnZUNvbnRleHREYXRhLCBvUGFnZUNvbnRleHQpLFxuXHRcdFx0XHRvUGFnZVByb3BlcnRpZXNXaXRob3V0Q29uZmxpY3QgPSBvUGFnZURhdGEucHJvcGVydGllc1dpdGhvdXRDb25mbGljdCxcblx0XHRcdFx0Ly8gVE9ETzogbW92ZSB0aGlzIGFsc28gaW50byB0aGUgaW50ZW50IGJhc2VkIG5hdmlnYXRpb24gY29udHJvbGxlciBleHRlbnNpb25cblx0XHRcdFx0b1BhZ2VTVjogYW55ID0gQ29tbW9uVXRpbHMuYWRkUGFnZUNvbnRleHRUb1NlbGVjdGlvblZhcmlhbnQobmV3IFNlbGVjdGlvblZhcmlhbnQoKSwgb1BhZ2VEYXRhLnNlbWFudGljQXR0cmlidXRlcywgb1ZpZXcpLFxuXHRcdFx0XHRvUHJvcGVydGllc1dpdGhvdXRDb25mbGljdCA9IG9UYXJnZXRJbmZvLnByb3BlcnRpZXNXaXRob3V0Q29uZmxpY3Q7XG5cdFx0XHRjb25zdCBhU2VsZWN0T3B0aW9uUHJvcGVydHlOYW1lcyA9IG9QYWdlU1YuZ2V0U2VsZWN0T3B0aW9uc1Byb3BlcnR5TmFtZXMoKTtcblx0XHRcdGFTZWxlY3RPcHRpb25Qcm9wZXJ0eU5hbWVzLmZvckVhY2goZnVuY3Rpb24gKHNQcm9wZXJ0eU5hbWU6IGFueSkge1xuXHRcdFx0XHRpZiAoIW9TZWxlY3Rpb25WYXJpYW50LmdldFNlbGVjdE9wdGlvbihzUHJvcGVydHlOYW1lKSkge1xuXHRcdFx0XHRcdG9TZWxlY3Rpb25WYXJpYW50Lm1hc3NBZGRTZWxlY3RPcHRpb24oc1Byb3BlcnR5TmFtZSwgb1BhZ2VTVi5nZXRTZWxlY3RPcHRpb24oc1Byb3BlcnR5TmFtZSkpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdC8vIE9ubHkgd2hlbiB0aGVyZSBpcyBubyBjb25mbGljdCBkbyB3ZSBuZWVkIHRvIGFkZCBzb21ldGhpbmdcblx0XHRcdFx0XHQvLyBpbiBhbGwgb3RoZXIgY2FzZSB0aGUgY29uZmxpY3RlZCBwYXRocyBhcmUgYWxyZWFkeSBhZGRlZCBpbiBwcmVwYXJlQ29udGV4dEZvckV4dGVybmFsTmF2aWdhdGlvblxuXHRcdFx0XHRcdC8vIGlmIHByb3BlcnR5IHdhcyB3aXRob3V0IGNvbmZsaWN0IGluIGluY29taW5nIGNvbnRleHQgdGhlbiBhZGQgcGF0aCBmcm9tIGluY29taW5nIGNvbnRleHQgdG8gU1Zcblx0XHRcdFx0XHQvLyBUTy1ETy4gUmVtb3ZlIHRoZSBjaGVjayBmb3Igb1Byb3BlcnRpZXNXaXRob3V0Q29uZmxpY3Qgb25jZSBzZW1hbnRpYyBsaW5rcyBmdW5jdGlvbmFsaXR5IGlzIGNvdmVyZWRcblx0XHRcdFx0XHRpZiAob1Byb3BlcnRpZXNXaXRob3V0Q29uZmxpY3QgJiYgc1Byb3BlcnR5TmFtZSBpbiBvUHJvcGVydGllc1dpdGhvdXRDb25mbGljdCkge1xuXHRcdFx0XHRcdFx0b1NlbGVjdGlvblZhcmlhbnQubWFzc0FkZFNlbGVjdE9wdGlvbihcblx0XHRcdFx0XHRcdFx0b1Byb3BlcnRpZXNXaXRob3V0Q29uZmxpY3Rbc1Byb3BlcnR5TmFtZV0sXG5cdFx0XHRcdFx0XHRcdG9TZWxlY3Rpb25WYXJpYW50LmdldFNlbGVjdE9wdGlvbihzUHJvcGVydHlOYW1lKVxuXHRcdFx0XHRcdFx0KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0Ly8gaWYgcHJvcGVydHkgd2FzIHdpdGhvdXQgY29uZmxpY3QgaW4gcGFnZSBjb250ZXh0IHRoZW4gYWRkIHBhdGggZnJvbSBwYWdlIGNvbnRleHQgdG8gU1Zcblx0XHRcdFx0XHRpZiAoc1Byb3BlcnR5TmFtZSBpbiBvUGFnZVByb3BlcnRpZXNXaXRob3V0Q29uZmxpY3QpIHtcblx0XHRcdFx0XHRcdG9TZWxlY3Rpb25WYXJpYW50Lm1hc3NBZGRTZWxlY3RPcHRpb24oXG5cdFx0XHRcdFx0XHRcdG9QYWdlUHJvcGVydGllc1dpdGhvdXRDb25mbGljdFtzUHJvcGVydHlOYW1lXSxcblx0XHRcdFx0XHRcdFx0b1BhZ2VTVi5nZXRTZWxlY3RPcHRpb24oc1Byb3BlcnR5TmFtZSlcblx0XHRcdFx0XHRcdCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHRcdC8vIHJlbW92ZSBub24gcHVibGljIHByb3BlcnRpZXMgZnJvbSB0YXJnZXRJbmZvXG5cdFx0XHRkZWxldGUgb1RhcmdldEluZm8ucHJvcGVydGllc1dpdGhvdXRDb25mbGljdDtcblx0XHR9XG5cdFx0b0ludGVybmFsTW9kZWxDb250ZXh0LnNldFByb3BlcnR5KFwiZXh0ZXJuYWxOYXZpZ2F0aW9uQ29udGV4dFwiLCB7IFwicGFnZVwiOiB0cnVlIH0pO1xuXHR9XG59O1xuXG5leHBvcnQgZGVmYXVsdCBJbnRlbnRCYXNlZE5hdmlnYXRpb25P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