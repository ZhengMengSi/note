/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/base/util/ObjectPath","sap/fe/core/ActionRuntime","sap/fe/core/CommonUtils","sap/fe/core/controllerextensions/EditFlow","sap/fe/core/controllerextensions/IntentBasedNavigation","sap/fe/core/controllerextensions/InternalIntentBasedNavigation","sap/fe/core/controllerextensions/InternalRouting","sap/fe/core/controllerextensions/KPIManagement","sap/fe/core/controllerextensions/MassEdit","sap/fe/core/controllerextensions/Placeholder","sap/fe/core/controllerextensions/Share","sap/fe/core/controllerextensions/SideEffects","sap/fe/core/controllerextensions/ViewState","sap/fe/core/helpers/ClassSupport","sap/fe/core/helpers/EditState","sap/fe/core/helpers/MessageStrip","sap/fe/core/helpers/StableIdHelper","sap/fe/core/library","sap/fe/core/PageController","sap/fe/macros/chart/ChartRuntime","sap/fe/macros/chart/ChartUtils","sap/fe/macros/CommonHelper","sap/fe/macros/DelegateUtil","sap/fe/macros/filter/FilterUtils","sap/fe/macros/table/TableHelper","sap/fe/templates/ListReport/ExtensionAPI","sap/fe/templates/RootContainer/overrides/EditFlow","sap/fe/templates/TableScroller","sap/ui/core/Component","sap/ui/core/mvc/OverrideExecution","sap/ui/Device","sap/ui/mdc/p13n/StateUtil","sap/ui/thirdparty/hasher","./ListReportTemplating","./overrides/IntentBasedNavigation","./overrides/Share","./overrides/ViewState"],function(e,t,r,i,n,a,o,s,l,u,g,d,c,p,f,h,v,b,C,y,_,m,P,w,S,A,B,I,V,F,T,E,x,M,R,D,O,L){"use strict";var N,z,k,H,U,j,K,J,q,W,X,$,G,Q,Y,Z,ee,te,re,ie,ne,ae,oe,se,le,ue,ge,de,ce,pe,fe;var he=E.system;var ve=f.usingExtension;var be=f.publicExtension;var Ce=f.privateExtension;var ye=f.finalExtension;var _e=f.extensible;var me=f.defineUI5Class;function Pe(e,t,r,i){if(!r)return;Object.defineProperty(e,t,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(i):void 0})}function we(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e}function Se(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e;Ae(e,t)}function Ae(e,t){Ae=Object.setPrototypeOf?Object.setPrototypeOf.bind():function e(t,r){t.__proto__=r;return t};return Ae(e,t)}function Be(e,t,r,i,n){var a={};Object.keys(i).forEach(function(e){a[e]=i[e]});a.enumerable=!!a.enumerable;a.configurable=!!a.configurable;if("value"in a||a.initializer){a.writable=true}a=r.slice().reverse().reduce(function(r,i){return i(e,t,r)||r},a);if(n&&a.initializer!==void 0){a.value=a.initializer?a.initializer.call(n):void 0;a.initializer=undefined}if(a.initializer===void 0){Object.defineProperty(e,t,a);a=null}return a}function Ie(e,t){throw new Error("Decorating class property failed. Please ensure that "+"proposal-class-properties is enabled and runs after the decorators transform.")}var Ve=C.TemplateContentView,Fe=C.InitialLoadMode;var Te=(N=me("sap.fe.templates.ListReport.ListReportController"),z=ve(s.override({onAfterBinding:function(){this.getView().getController()._onAfterBinding()}})),k=ve(o.override({getEntitySet:function(){return this.base.getCurrentEntitySet()}})),H=ve(c),U=ve(a.override(D)),j=ve(d.override(O)),K=ve(n.override(I)),J=ve(p.override(L)),q=ve(l),W=ve(g),X=ve(u),$=be(),G=ye(),Q=Ce(),Y=_e(T.After),Z=be(),ee=_e(T.After),te=be(),re=_e(T.After),N(ie=(ne=function(n){Se(a,n);function a(){var t;for(var r=arguments.length,i=new Array(r),a=0;a<r;a++){i[a]=arguments[a]}t=n.call.apply(n,[this].concat(i))||this;Pe(t,"_routing",ae,we(t));Pe(t,"_intentBasedNavigation",oe,we(t));Pe(t,"sideEffects",se,we(t));Pe(t,"intentBasedNavigation",le,we(t));Pe(t,"share",ue,we(t));Pe(t,"editFlow",ge,we(t));Pe(t,"viewState",de,we(t));Pe(t,"kpiManagement",ce,we(t));Pe(t,"placeholder",pe,we(t));Pe(t,"massEdit",fe,we(t));t.handlers={handleShareShortcut:function(){var e=this.getView().byId("fe::Share");e.openMenu()},onFilterSearch:function(){this._getFilterBarControl().triggerSearch()},onFiltersChanged:function(e){var t=this._getFilterBarControl();if(t){var r=this.getView().getBindingContext("internal");this.onPendingFilters();r.setProperty("appliedFilters",t.getAssignedFiltersText().filtersText);if(e.getParameter("conditionsBased")){r.setProperty("hasPendingFilters",true)}}},onVariantSelected:function(e){var t=this;var r=e.getSource();var i=e.getParameter("key");var n=this._getMultiModeControl();n===null||n===void 0?void 0:n.invalidateContent();n===null||n===void 0?void 0:n.setFreezeContent(true);setTimeout(function(){if(t._shouldAutoTriggerSearch(r)){return t._getFilterBarControl().triggerSearch()}else if(!t._getApplyAutomaticallyOnVariant(r,i)){t.getExtensionAPI().updateAppState()}},0)},onVariantSaved:function(){var e=this;setTimeout(function(){e.getExtensionAPI().updateAppState()},1e3)},onSearch:function(){var t=this;var r=this._getFilterBarControl();var i=this.getView().getBindingContext("internal");var n=this.getChartControl();var a=S.getEditStateIsHideDraft(r.getConditions());i.setProperty("hasPendingFilters",false);i.setProperty("hideDraftInfo",a);if(!this._getMultiModeControl()){this._updateALPNotApplicableFields(i,r)}if(n){n.getBindingContext("internal").setProperty("",{});var o=n.getBindingContext("pageInternal");var s=o.getProperty("".concat(o.getPath(),"/alpContentView"));if(s===Ve.Chart){this.hasPendingChartChanges=true}if(s===Ve.Table){this.hasPendingTableChanges=true}}x.retrieveExternalState(r).then(function(e){t.filterBarConditions=e.filter}).catch(function(t){e.error("Error while retrieving the external state",t)});if(this.getView().getViewData().liveMode===false){this.getExtensionAPI().updateAppState()}if(he.phone){var l=this._getDynamicListReportControl();l.setHeaderExpanded(false)}},onChevronPressNavigateOutBound:function(e,t,r,i){return e._intentBasedNavigation.onChevronPressNavigateOutBound(e,t,r,i)},onChartSelectionChanged:function(e){var t=e.getSource().getContent(),r=this._getTable(),i=e.getParameter("data"),n=this.getView().getBindingContext("internal");if(i){_.fnUpdateChart(e);m.setChartFilters(t)}var a=n.getProperty("".concat(n.getPath(),"/alpContentView"));if(a===Ve.Chart){this.hasPendingChartChanges=true}else if(r){r.rebind();this.hasPendingChartChanges=false}},onSegmentedButtonPressed:function(e){var t=e.mParameters.key?e.mParameters.key:null;var r=this.getView().getBindingContext("internal");r.setProperty("alpContentView",t);var i=this.getChartControl();var n=this._getTable();var a={onAfterRendering:function(){var e=o.getItems();e.forEach(function(e){if(e.getKey()===t){e.focus()}});o.removeEventDelegate(a)}};var o=t===Ve.Table?this._getSegmentedButton("Table"):this._getSegmentedButton("Chart");if(o!==e.getSource()){o.addEventDelegate(a)}switch(t){case Ve.Table:this._updateTable(n);break;case Ve.Chart:this._updateChart(i);break;case Ve.Hybrid:this._updateTable(n);this._updateChart(i);break;default:break}this.getExtensionAPI().updateAppState()},onFiltersSegmentedButtonPressed:function(e){var t=e.getParameter("key")==="Compact";this._getFilterBarControl().setVisible(t);this._getVisualFilterBarControl().setVisible(!t)},onStateChange:function(){this.getExtensionAPI().updateAppState()},onDynamicPageTitleStateChanged:function(e){var t=this._getFilterBarControl();if(t&&t.getSegmentedButton()){if(e.getParameter("isExpanded")){t.getSegmentedButton().setVisible(true)}else{t.getSegmentedButton().setVisible(false)}}}};t.formatters={setALPControlMessageStrip:function(e,t,r){var i="";t=t==="true"||t===true;var n=this._getFilterBarControl();if(n&&Array.isArray(e)&&e.length>0&&t){var a=v.getLabels(e,n.data("entityType"),n,this.oResourceBundle);var o=!r.enableSearch;i=t?v.getALPText(a,n,o):v.getText(a,n,"",w.getLocalizedText);return i}}};return t}var o=a.prototype;o.getExtensionAPI=function e(){if(!this.extensionAPI){this.extensionAPI=new B(this)}return this.extensionAPI};o.onInit=function e(){y.prototype.onInit.apply(this);var t=this.getView().getBindingContext("internal");t.setProperty("hasPendingFilters",true);t.setProperty("appliedFilters","");t.setProperty("hideDraftInfo",false);t.setProperty("uom",{});t.setProperty("scalefactor",{});t.setProperty("scalefactorNumber",{});t.setProperty("currency",{});if(this._hasMultiVisualizations()){var r=this._getDefaultPath();if(!he.desktop&&r===Ve.Hybrid){r=Ve.Chart}t.setProperty("alpContentView",r)}this.filterBarConditions={};this.getAppComponent().getRouterProxy().waitForRouteMatchBeforeNavigation();this._setInitLoad()};o.onExit=function e(){delete this.filterBarConditions;if(this.extensionAPI){this.extensionAPI.destroy()}delete this.extensionAPI};o._onAfterBinding=function e(){var t=this;var r=this._getControls("table");if(h.isEditStateDirty()){var n,a;(n=this._getMultiModeControl())===null||n===void 0?void 0:n.invalidateContent();var o=(a=this._getTable())===null||a===void 0?void 0:a.getRowBinding();if(o){if(i.getAppComponent(this.getView())._isFclEnabled()){o.refresh()}else{if(!this.sUpdateTimer){this.sUpdateTimer=setTimeout(function(){o.refresh();delete t.sUpdateTimer},0)}var s=function(){t._updateTableActions(r);o.detachDataReceived(s)};o.attachDataReceived(s)}}h.setEditStateProcessed()}if(!this.sUpdateTimer){this._updateTableActions(r)}this.pageReady.waitFor(this.getAppComponent().getAppStateHandler().applyAppState())};o.onBeforeRendering=function e(){y.prototype.onBeforeRendering.apply(this)};o.onAfterRendering=function t(){var r=this;this.getView().getModel("sap.fe.i18n").getResourceBundle().then(function(e){r.oResourceBundle=e;var t=r._getControls();var n=r.getView().getViewData().entitySet;var a=i.getTranslatedText("T_TABLE_AND_CHART_NO_DATA_TEXT",r.oResourceBundle,undefined,n);t.forEach(function(e){e.setNoData(a)})}).catch(function(t){e.error("Error while retrieving the resource bundle",t)})};o.onPageReady=function e(t){if(t.forceFocus){this._setInitialFocus()}this.getAppComponent().getShellServices().setBackNavigation(undefined)};o.onViewNeedsRefresh=function e(t){};o.onPendingFilters=function e(){};o.getCurrentEntitySet=function e(){var t;return(t=this._getTable())===null||t===void 0?void 0:t.data("targetCollectionPath").slice(1)};o._updateTableActions=function e(t){var n=[];t.forEach(function(e){n=i.getIBNActions(e,n);var t=e.getBindingContext("internal"),a=JSON.parse(P.parseCustomData(w.getCustomData(e,"operationAvailableMap"))),o=e.getSelectedContexts();t.setProperty("selectedContexts",o);t.setProperty("numberOfSelectedContexts",o.length);A.handleTableDeleteEnablementForSideEffects(e,t);r.setActionEnablement(t,a,o,"table")});i.updateDataFieldForIBNButtonsVisibility(n,this.getView())};o._scrollTablesToRow=function e(t){this._getControls("table").forEach(function(e){V.scrollTableToRow(e,t)})};o._setInitialFocus=function e(){var t=this._getDynamicListReportControl(),r=t.getHeaderExpanded(),i=this._getFilterBarControl();if(i){if(r){if(!i.getShowMessages()){i.setShowMessages(true)}var n=i.getFilterItems().find(function(e){return e.getRequired()&&e.getConditions().length===0});if(n){n.focus()}else if(this._isInitLoadEnabled()){i.getFilterItems()[0].focus()}else{this.getView().byId("".concat(this._getFilterBarControlId(),"-btnSearch")).focus()}}else if(this._isInitLoadEnabled()){var a;(a=this._getTable())===null||a===void 0?void 0:a.focusRow(0)}}else{var o;(o=this._getTable())===null||o===void 0?void 0:o.focusRow(0)}};o._getPageTitleInformation=function e(){var t=this.getAppComponent().getManifestEntry("sap.app");return{title:t.title,subtitle:t.appSubTitle||"",intent:"",icon:""}};o._getFilterBarControl=function e(){return this.getView().byId(this._getFilterBarControlId())};o._getDynamicListReportControl=function e(){return this.getView().byId(this._getDynamicListReportControlId())};o._getAdaptationFilterBarControl=function e(){var t=this._getFilterBarControl().getInbuiltFilter();return t!==null&&t!==void 0&&t.getParent()?t:undefined};o._getSegmentedButton=function e(t){var r;var i=(r=t==="Chart"?this.getChartControl():this._getTable())===null||r===void 0?void 0:r.data("segmentedButtonId");return this.getView().byId(i)};o._getControlFromPageModelProperty=function e(t){var r;var i=(r=this._getPageModel())===null||r===void 0?void 0:r.getProperty(t);return i&&this.getView().byId(i)};o._getPageModel=function e(){var t=F.getOwnerComponentFor(this.getView());return t.getModel("_pageModel")};o._getDynamicListReportControlId=function e(){var t;return((t=this._getPageModel())===null||t===void 0?void 0:t.getProperty("/dynamicListReportId"))||""};o._getFilterBarControlId=function e(){var t;return((t=this._getPageModel())===null||t===void 0?void 0:t.getProperty("/filterBarId"))||""};o.getChartControl=function e(){return this._getControlFromPageModelProperty("/singleChartId")};o._getVisualFilterBarControl=function e(){var t=b.generate(["visualFilter",this._getFilterBarControlId()]);return t&&this.getView().byId(t)};o._getFilterBarVariantControl=function e(){return this._getControlFromPageModelProperty("/variantManagement/id")};o._getMultiModeControl=function e(){return this.getView().byId("fe::TabMultipleMode::Control")};o._getTable=function e(){if(this._isMultiMode()){var t,r;var i=(t=this._getMultiModeControl())===null||t===void 0?void 0:(r=t.getSelectedInnerControl())===null||r===void 0?void 0:r.content;return i!==null&&i!==void 0&&i.isA("sap.ui.mdc.Table")?i:undefined}else{return this._getControlFromPageModelProperty("/singleTableId")}};o._getControls=function e(t){var r=this;if(this._isMultiMode()){var i=[];var n=this._getMultiModeControl().content;n.getItems().forEach(function(e){var n=r.getView().byId(e.getKey());if(n&&t){if(e.getKey().indexOf("fe::".concat(t))>-1){i.push(n)}}else if(n!==undefined&&n!==null){i.push(n)}});return i}else if(t==="Chart"){var a=this.getChartControl();return a?[a]:[]}else{var o=this._getTable();return o?[o]:[]}};o._getDefaultPath=function e(){var t;var r=R.getDefaultPath(((t=this._getPageModel())===null||t===void 0?void 0:t.getProperty("/views"))||[]);switch(r){case"primary":return Ve.Chart;case"secondary":return Ve.Table;case"both":default:return Ve.Hybrid}};o._isMultiMode=function e(){var t;return!!((t=this._getPageModel())!==null&&t!==void 0&&t.getProperty("/multiViewsControl"))};o._isInitLoadEnabled=function e(){var t=this.getView().getViewData().initialLoad;return t===Fe.Enabled};o._hasMultiVisualizations=function e(){var t;return(t=this._getPageModel())===null||t===void 0?void 0:t.getProperty("/hasMultiVisualizations")};o._disableInitLoad=function e(){var t=this._getFilterBarControl();if(t){t.setSuspendSelection(true)}};o._applyAutomaticallyOnStandardVariant=function e(){return false};o._setInitLoad=function e(){if(!this._isInitLoadEnabled()){this._disableInitLoad()}var t=R.getVariantBackReference(this.getView().getViewData(),this._getPageModel());var r=t&&this.getView().byId(t);if(r){r.registerApplyAutomaticallyOnStandardVariant(this._applyAutomaticallyOnStandardVariant.bind(this))}};o._setShareModel=function e(){var r=t.get("sap.ushell.Container.getUser");var i={bookmarkTitle:document.title,bookmarkCustomUrl:function(){var e=M.getHash();return e?"#".concat(e):window.location.href},isShareInJamActive:!!r&&r().isJamActive()};var n=this.getOwnerComponent().getModel("_templPriv");n.setProperty("/listReport/share",i)};o._updateALPNotApplicableFields=function e(t,r){var i={};var n={},a=this._getControls("table"),o=this._getControls("Chart");if(!a.length||!o.length){return}o.forEach(function(e){var t=e.data("targetCollectionPath"),a=t.slice(1),o="".concat(a,"Chart");if(!i[o]){i[o]=S.getNotApplicableFilters(r,e)}n[o]=i[o]});t.setProperty("controls/ignoredFields",n)};o._isFilterBarHidden=function e(){return this.getView().getViewData().hideFilterBar};o._getApplyAutomaticallyOnVariant=function e(t,r){if(!t||!r){return false}var i=t.getVariants();var n=i.find(function(e){return e&&e.key===r});return n&&n.executeOnSelect||false};o._shouldAutoTriggerSearch=function e(t){if(this.getView().getViewData().initialLoad===Fe.Auto&&(!t||t.getStandardVariantKey()===t.getCurrentVariantKey())){var r=this._getFilterBarControl();if(r){var i=r.getConditions();for(var n in i){if(!n.startsWith("$")&&Array.isArray(i[n])&&i[n].length){var a=t.getVariants().find(function(e){return e.key===t.getCurrentVariantKey()});return a&&a.executeOnSelect}}}}return false};o._updateTable=function e(t){if(!t.isTableBound()||this.hasPendingChartChanges){t.rebind();this.hasPendingChartChanges=false}};o._updateChart=function e(t){var r=t.getControlDelegate()._getChart(t);if(!(r&&r.isBound("data"))||this.hasPendingTableChanges){t.getControlDelegate().rebind(t,r.getBindingInfo("data"));this.hasPendingTableChanges=false}};return a}(y),ae=Be(ne.prototype,"_routing",[z],{configurable:true,enumerable:true,writable:true,initializer:null}),oe=Be(ne.prototype,"_intentBasedNavigation",[k],{configurable:true,enumerable:true,writable:true,initializer:null}),se=Be(ne.prototype,"sideEffects",[H],{configurable:true,enumerable:true,writable:true,initializer:null}),le=Be(ne.prototype,"intentBasedNavigation",[U],{configurable:true,enumerable:true,writable:true,initializer:null}),ue=Be(ne.prototype,"share",[j],{configurable:true,enumerable:true,writable:true,initializer:null}),ge=Be(ne.prototype,"editFlow",[K],{configurable:true,enumerable:true,writable:true,initializer:null}),de=Be(ne.prototype,"viewState",[J],{configurable:true,enumerable:true,writable:true,initializer:null}),ce=Be(ne.prototype,"kpiManagement",[q],{configurable:true,enumerable:true,writable:true,initializer:null}),pe=Be(ne.prototype,"placeholder",[W],{configurable:true,enumerable:true,writable:true,initializer:null}),fe=Be(ne.prototype,"massEdit",[X],{configurable:true,enumerable:true,writable:true,initializer:null}),Be(ne.prototype,"getExtensionAPI",[$,G],Object.getOwnPropertyDescriptor(ne.prototype,"getExtensionAPI"),ne.prototype),Be(ne.prototype,"onPageReady",[Q,Y],Object.getOwnPropertyDescriptor(ne.prototype,"onPageReady"),ne.prototype),Be(ne.prototype,"onViewNeedsRefresh",[Z,ee],Object.getOwnPropertyDescriptor(ne.prototype,"onViewNeedsRefresh"),ne.prototype),Be(ne.prototype,"onPendingFilters",[te,re],Object.getOwnPropertyDescriptor(ne.prototype,"onPendingFilters"),ne.prototype),ne))||ie);return Te},false);
//# sourceMappingURL=ListReportController.controller.js.map