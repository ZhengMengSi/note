/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/CommonUtils", "sap/ui/mdc/field/MultiValueFieldDelegate"], function (CommonUtils, MdcMultiValueFieldDelegate) {
  "use strict";

  var MultiValueFieldDelegate = Object.assign({}, MdcMultiValueFieldDelegate);

  MultiValueFieldDelegate.updateItems = function (oPayload, aConditions, oControl) {
    var oListBinding = oControl.getBinding("items");

    if (oListBinding.isA("sap.ui.model.odata.v4.ODataListBinding")) {
      var oBindingInfo = oControl.getBindingInfo("items"); // check if conditions are added, removed or changed

      var oTemplate = oBindingInfo.template;
      var oKeyBindingInfo = oTemplate.getBindingInfo("key");
      var oDescriptionBindingInfo = oTemplate.getBindingInfo("description");
      var sKeyPath = oKeyBindingInfo && oKeyBindingInfo.parts[0].path;
      var sDescriptionPath = oDescriptionBindingInfo && oDescriptionBindingInfo.parts && oDescriptionBindingInfo.parts[0] && oDescriptionBindingInfo.parts[0].path;
      var aContexts = oListBinding.getCurrentContexts();
      var aDataToAdd = [];
      var oController = CommonUtils.getTargetView(oControl).getController(); // Contexts to delete

      var aNewKeys = aConditions.map(function (oCondition) {
        return oCondition.values[0];
      });
      var aOldKeys = aContexts.map(function (oContext) {
        return oContext.getProperty(sKeyPath);
      });
      var aModificationPromises = [];

      for (var i = 0; i < aContexts.length; i++) {
        var oDeleteContext = aContexts[i];

        if (!aNewKeys.includes(oDeleteContext.getProperty(sKeyPath))) {
          aModificationPromises.push(oController.editFlow.deleteMultipleDocuments([oDeleteContext], {
            controlId: oControl.getId(),
            noDialog: true
          }));
        }
      } // data to add


      aConditions.forEach(function (oCondition) {
        if (!aOldKeys.includes(oCondition.values[0])) {
          var oItem = {};

          if (sKeyPath && sKeyPath.indexOf("/") === -1) {
            // we do not manage to create on a sub entity of the 1:n navigation
            oItem[sKeyPath] = oCondition.values[0];

            if (sDescriptionPath && sDescriptionPath.indexOf("/") === -1 && sDescriptionPath !== sKeyPath) {
              oItem[sDescriptionPath] = oCondition.values[1];
            }

            aDataToAdd.push(oItem);
          }
        }
      });

      if (aDataToAdd.length) {
        aModificationPromises.push(oController._editFlow.createMultipleDocuments(oListBinding, aDataToAdd, true));
      }

      return Promise.all(aModificationPromises);
    }
  };

  return MultiValueFieldDelegate;
}, false);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNdWx0aVZhbHVlRmllbGREZWxlZ2F0ZSIsIk9iamVjdCIsImFzc2lnbiIsIk1kY011bHRpVmFsdWVGaWVsZERlbGVnYXRlIiwidXBkYXRlSXRlbXMiLCJvUGF5bG9hZCIsImFDb25kaXRpb25zIiwib0NvbnRyb2wiLCJvTGlzdEJpbmRpbmciLCJnZXRCaW5kaW5nIiwiaXNBIiwib0JpbmRpbmdJbmZvIiwiZ2V0QmluZGluZ0luZm8iLCJvVGVtcGxhdGUiLCJ0ZW1wbGF0ZSIsIm9LZXlCaW5kaW5nSW5mbyIsIm9EZXNjcmlwdGlvbkJpbmRpbmdJbmZvIiwic0tleVBhdGgiLCJwYXJ0cyIsInBhdGgiLCJzRGVzY3JpcHRpb25QYXRoIiwiYUNvbnRleHRzIiwiZ2V0Q3VycmVudENvbnRleHRzIiwiYURhdGFUb0FkZCIsIm9Db250cm9sbGVyIiwiQ29tbW9uVXRpbHMiLCJnZXRUYXJnZXRWaWV3IiwiZ2V0Q29udHJvbGxlciIsImFOZXdLZXlzIiwibWFwIiwib0NvbmRpdGlvbiIsInZhbHVlcyIsImFPbGRLZXlzIiwib0NvbnRleHQiLCJnZXRQcm9wZXJ0eSIsImFNb2RpZmljYXRpb25Qcm9taXNlcyIsImkiLCJsZW5ndGgiLCJvRGVsZXRlQ29udGV4dCIsImluY2x1ZGVzIiwicHVzaCIsImVkaXRGbG93IiwiZGVsZXRlTXVsdGlwbGVEb2N1bWVudHMiLCJjb250cm9sSWQiLCJnZXRJZCIsIm5vRGlhbG9nIiwiZm9yRWFjaCIsIm9JdGVtIiwiaW5kZXhPZiIsIl9lZGl0RmxvdyIsImNyZWF0ZU11bHRpcGxlRG9jdW1lbnRzIiwiUHJvbWlzZSIsImFsbCJdLCJzb3VyY2VSb290IjoiLiIsInNvdXJjZXMiOlsiTXVsdGlWYWx1ZUZpZWxkRGVsZWdhdGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IENvbW1vblV0aWxzIGZyb20gXCJzYXAvZmUvY29yZS9Db21tb25VdGlsc1wiO1xuaW1wb3J0IE1kY011bHRpVmFsdWVGaWVsZERlbGVnYXRlIGZyb20gXCJzYXAvdWkvbWRjL2ZpZWxkL011bHRpVmFsdWVGaWVsZERlbGVnYXRlXCI7XG5jb25zdCBNdWx0aVZhbHVlRmllbGREZWxlZ2F0ZSA9IE9iamVjdC5hc3NpZ24oe30sIE1kY011bHRpVmFsdWVGaWVsZERlbGVnYXRlKTtcbk11bHRpVmFsdWVGaWVsZERlbGVnYXRlLnVwZGF0ZUl0ZW1zID0gZnVuY3Rpb24gKG9QYXlsb2FkOiBhbnksIGFDb25kaXRpb25zOiBhbnksIG9Db250cm9sOiBhbnkpIHtcblx0Y29uc3Qgb0xpc3RCaW5kaW5nID0gb0NvbnRyb2wuZ2V0QmluZGluZyhcIml0ZW1zXCIpO1xuXHRpZiAob0xpc3RCaW5kaW5nLmlzQShcInNhcC51aS5tb2RlbC5vZGF0YS52NC5PRGF0YUxpc3RCaW5kaW5nXCIpKSB7XG5cdFx0Y29uc3Qgb0JpbmRpbmdJbmZvID0gb0NvbnRyb2wuZ2V0QmluZGluZ0luZm8oXCJpdGVtc1wiKTtcblx0XHQvLyBjaGVjayBpZiBjb25kaXRpb25zIGFyZSBhZGRlZCwgcmVtb3ZlZCBvciBjaGFuZ2VkXG5cdFx0Y29uc3Qgb1RlbXBsYXRlID0gb0JpbmRpbmdJbmZvLnRlbXBsYXRlO1xuXHRcdGNvbnN0IG9LZXlCaW5kaW5nSW5mbyA9IG9UZW1wbGF0ZS5nZXRCaW5kaW5nSW5mbyhcImtleVwiKTtcblx0XHRjb25zdCBvRGVzY3JpcHRpb25CaW5kaW5nSW5mbyA9IG9UZW1wbGF0ZS5nZXRCaW5kaW5nSW5mbyhcImRlc2NyaXB0aW9uXCIpO1xuXHRcdGNvbnN0IHNLZXlQYXRoID0gb0tleUJpbmRpbmdJbmZvICYmIG9LZXlCaW5kaW5nSW5mby5wYXJ0c1swXS5wYXRoO1xuXHRcdGNvbnN0IHNEZXNjcmlwdGlvblBhdGggPVxuXHRcdFx0b0Rlc2NyaXB0aW9uQmluZGluZ0luZm8gJiZcblx0XHRcdG9EZXNjcmlwdGlvbkJpbmRpbmdJbmZvLnBhcnRzICYmXG5cdFx0XHRvRGVzY3JpcHRpb25CaW5kaW5nSW5mby5wYXJ0c1swXSAmJlxuXHRcdFx0b0Rlc2NyaXB0aW9uQmluZGluZ0luZm8ucGFydHNbMF0ucGF0aDtcblx0XHRjb25zdCBhQ29udGV4dHMgPSBvTGlzdEJpbmRpbmcuZ2V0Q3VycmVudENvbnRleHRzKCk7XG5cdFx0Y29uc3QgYURhdGFUb0FkZDogYW55W10gPSBbXTtcblx0XHRjb25zdCBvQ29udHJvbGxlciA9IENvbW1vblV0aWxzLmdldFRhcmdldFZpZXcob0NvbnRyb2wpLmdldENvbnRyb2xsZXIoKTtcblxuXHRcdC8vIENvbnRleHRzIHRvIGRlbGV0ZVxuXHRcdGNvbnN0IGFOZXdLZXlzID0gYUNvbmRpdGlvbnMubWFwKGZ1bmN0aW9uIChvQ29uZGl0aW9uOiBhbnkpIHtcblx0XHRcdHJldHVybiBvQ29uZGl0aW9uLnZhbHVlc1swXTtcblx0XHR9KTtcblx0XHRjb25zdCBhT2xkS2V5cyA9IGFDb250ZXh0cy5tYXAoZnVuY3Rpb24gKG9Db250ZXh0OiBhbnkpIHtcblx0XHRcdHJldHVybiBvQ29udGV4dC5nZXRQcm9wZXJ0eShzS2V5UGF0aCk7XG5cdFx0fSk7XG5cdFx0Y29uc3QgYU1vZGlmaWNhdGlvblByb21pc2VzID0gW107XG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBhQ29udGV4dHMubGVuZ3RoOyBpKyspIHtcblx0XHRcdGNvbnN0IG9EZWxldGVDb250ZXh0ID0gYUNvbnRleHRzW2ldO1xuXHRcdFx0aWYgKCFhTmV3S2V5cy5pbmNsdWRlcyhvRGVsZXRlQ29udGV4dC5nZXRQcm9wZXJ0eShzS2V5UGF0aCkpKSB7XG5cdFx0XHRcdGFNb2RpZmljYXRpb25Qcm9taXNlcy5wdXNoKFxuXHRcdFx0XHRcdG9Db250cm9sbGVyLmVkaXRGbG93LmRlbGV0ZU11bHRpcGxlRG9jdW1lbnRzKFtvRGVsZXRlQ29udGV4dF0sIHsgY29udHJvbElkOiBvQ29udHJvbC5nZXRJZCgpLCBub0RpYWxvZzogdHJ1ZSB9KVxuXHRcdFx0XHQpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHQvLyBkYXRhIHRvIGFkZFxuXHRcdGFDb25kaXRpb25zLmZvckVhY2goKG9Db25kaXRpb246IGFueSkgPT4ge1xuXHRcdFx0aWYgKCFhT2xkS2V5cy5pbmNsdWRlcyhvQ29uZGl0aW9uLnZhbHVlc1swXSkpIHtcblx0XHRcdFx0Y29uc3Qgb0l0ZW06IGFueSA9IHt9O1xuXHRcdFx0XHRpZiAoc0tleVBhdGggJiYgc0tleVBhdGguaW5kZXhPZihcIi9cIikgPT09IC0xKSB7XG5cdFx0XHRcdFx0Ly8gd2UgZG8gbm90IG1hbmFnZSB0byBjcmVhdGUgb24gYSBzdWIgZW50aXR5IG9mIHRoZSAxOm4gbmF2aWdhdGlvblxuXHRcdFx0XHRcdG9JdGVtW3NLZXlQYXRoXSA9IG9Db25kaXRpb24udmFsdWVzWzBdO1xuXG5cdFx0XHRcdFx0aWYgKHNEZXNjcmlwdGlvblBhdGggJiYgc0Rlc2NyaXB0aW9uUGF0aC5pbmRleE9mKFwiL1wiKSA9PT0gLTEgJiYgc0Rlc2NyaXB0aW9uUGF0aCAhPT0gc0tleVBhdGgpIHtcblx0XHRcdFx0XHRcdG9JdGVtW3NEZXNjcmlwdGlvblBhdGhdID0gb0NvbmRpdGlvbi52YWx1ZXNbMV07XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGFEYXRhVG9BZGQucHVzaChvSXRlbSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblx0XHRpZiAoYURhdGFUb0FkZC5sZW5ndGgpIHtcblx0XHRcdGFNb2RpZmljYXRpb25Qcm9taXNlcy5wdXNoKG9Db250cm9sbGVyLl9lZGl0Rmxvdy5jcmVhdGVNdWx0aXBsZURvY3VtZW50cyhvTGlzdEJpbmRpbmcsIGFEYXRhVG9BZGQsIHRydWUpKTtcblx0XHR9XG5cdFx0cmV0dXJuIFByb21pc2UuYWxsKGFNb2RpZmljYXRpb25Qcm9taXNlcyk7XG5cdH1cbn07XG5cbmV4cG9ydCBkZWZhdWx0IE11bHRpVmFsdWVGaWVsZERlbGVnYXRlO1xuIl0sIm1hcHBpbmdzIjoiO0FBQUE7QUFBQTtBQUFBOzs7O0VBRUEsSUFBTUEsdUJBQXVCLEdBQUdDLE1BQU0sQ0FBQ0MsTUFBUCxDQUFjLEVBQWQsRUFBa0JDLDBCQUFsQixDQUFoQzs7RUFD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