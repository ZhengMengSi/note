/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/CommonUtils","sap/fe/core/converters/helpers/BindingHelper","sap/fe/core/converters/MetaModelConverter","sap/fe/core/formatters/CollaborationFormatter","sap/fe/core/formatters/ValueFormatter","sap/fe/core/helpers/BindingToolkit","sap/fe/core/helpers/ModelHelper","sap/fe/core/helpers/StableIdHelper","sap/fe/core/TemplateModel","sap/fe/core/templating/DataModelPathHelper","sap/fe/core/templating/UIFormatters","sap/fe/macros/field/FieldTemplating","sap/fe/macros/MacroMetadata","sap/fe/macros/situations/SituationsIndicator.fragment"],function(e,t,i,a,n,o,r,l,s,d,p,u,c,v){"use strict";var m=d.getTargetObjectPath;var f=d.getRelativePaths;var y=d.getContextRelativeTargetObjectPath;var g=d.enhanceDataModelPath;var b=l.generate;var h=o.pathInModel;var x=o.not;var O=o.ifElse;var I=o.getExpressionFromAnnotation;var T=o.formatResult;var S=o.constant;var F=o.compileExpression;var E=o.and;var U=t.Entity;var D=c.extend("sap.fe.macros.internal.Field",{name:"Field",namespace:"sap.fe.macros.internal",fragment:"sap.fe.macros.internal.Field",metadata:{stereotype:"xmlmacro",designtime:"sap/fe/macros/internal/Field.designtime",properties:{idPrefix:{type:"string"},_apiId:{type:"string"},noWrapperId:{type:"string"},vhIdPrefix:{type:"string",defaultValue:"FieldValueHelp"},_vhFlexId:{type:"string",computed:true},entitySet:{type:"sap.ui.model.Context",required:true,$kind:["EntitySet","NavigationProperty","EntityType","Singleton"]},entityType:{type:"sap.ui.model.Context",required:false,computed:true,$kind:["EntityType"]},parentEntitySet:{type:"sap.ui.model.Context",required:false,$kind:["EntitySet","NavigationProperty","EntityType","Singleton"]},navigateAfterAction:{type:"boolean",defaultValue:true},dataField:{type:"sap.ui.model.Context",required:true,$kind:["Property"],$Type:["com.sap.vocabularies.UI.v1.DataField","com.sap.vocabularies.UI.v1.DataFieldWithUrl","com.sap.vocabularies.UI.v1.DataFieldForAnnotation","com.sap.vocabularies.UI.v1.DataFieldForAction","com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation","com.sap.vocabularies.UI.v1.DataFieldWithAction","com.sap.vocabularies.UI.v1.DataFieldWithIntentBasedNavigation","com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath","com.sap.vocabularies.UI.v1.DataPointType"]},semanticObjects:{type:"sap.ui.model.Context",required:false,computed:true},editMode:{type:"sap.ui.mdc.enum.EditMode"},wrap:{type:"boolean"},class:{type:"string"},ariaLabelledBy:{type:"string"},textAlign:{type:"sap.ui.core.TextAlign"},editableExpression:{type:"string",computed:true},enabledExpression:{type:"string",computed:true},collaborationEnabled:{type:"boolean",computed:true},collaborationHasActivityExpression:{type:"string",computed:true},collaborationInitialsExpression:{type:"string",computed:true},collaborationColorExpression:{type:"string",computed:true},semanticObject:{type:"string",required:false},hasSemanticObjectOnNavigation:{type:"boolean",required:false},formatOptions:{type:"object",properties:{isCurrencyAligned:{type:"boolean",defaultValue:false},containsErrorVisibility:{type:"string"},textAlignMode:{type:"string",defaultValue:"Table",allowedValues:["Table","Form"]},displayMode:{type:"string",allowedValues:["Value","Description","ValueDescription","DescriptionValue"]},fieldMode:{type:"string",allowedValues:["nowrapper",""]},measureDisplayMode:{type:"string",allowedValues:["Hidden","ReadOnly"]},textLinesEdit:{type:"number",configurable:true},textMaxLines:{type:"number",configurable:true},textMaxCharactersDisplay:{type:"number",configurable:true},textExpandBehaviorDisplay:{type:"string",allowedValues:["InPlace","Popover"]},showEmptyIndicator:{type:"boolean",defaultValue:false},semanticKeyStyle:{type:"string",defaultValue:"",allowedValues:["ObjectIdentifier","Label",""]},hasDraftIndicator:{type:"boolean",defaultValue:false},showIconUrl:{type:"boolean",defaultValue:false},ignoreNavigationAvailable:{type:"boolean",defaultValue:false},isAnalytics:{type:"boolean",defaultValue:false},retrieveTextFromValueList:{type:"boolean",defaultValue:false},compactSemanticKey:{type:"boolean",defaultValue:false},fieldGroupDraftIndicatorPropertyPath:{type:"string"},fieldGroupName:{type:"string"}}}},events:{onChange:{type:"function"}}},getOverrides:function(e,t){var i={};if(e){var a=e[t];if(a){Object.keys(a).forEach(function(e){i[e]=a[e]})}}return i},setUpDataPointType:function(e){if((e===null||e===void 0?void 0:e.term)==="com.sap.vocabularies.UI.v1.DataPoint"){e.$Type=e.$Type||"com.sap.vocabularies.UI.v1.DataPointType"}},setUpVisibleProperties:function(e,t){e.visible=u.getVisibleExpression(t,e.formatOptions);e.displayVisible=e.formatOptions.fieldMode==="nowrapper"?e.visible:undefined},setUpParentEntitySet:function(e,t,i){var a;if(t!==null&&t!==void 0&&t.contextLocation&&i!==null&&i!==void 0&&(a=i.models)!==null&&a!==void 0&&a.metaModel){e.parentEntitySet=i.models.metaModel.createBindingContext("/".concat(t.contextLocation.startingEntitySet?t.contextLocation.startingEntitySet.name:t.startingEntitySet.name))}},create:function(e,t,a){var n;var o=i.convertMetaModelContext(e.dataField);var r=i.getInvolvedDataModelObjects(e.dataField,e.entitySet);this.setUpDataPointType(o);this.setUpVisibleProperties(e,r);this.setUpParentEntitySet(e,r,a);if(e._flexId){e._apiId=e._flexId;e._flexId=this.getContentId(e._flexId);e._vhFlexId="".concat(e._flexId,"_").concat(e.vhIdPrefix)}r=this._getTargetValueDataModelPath(o,r);this.setUpSemanticObjects(e,r);e.dataSourcePath=m(r);var l=a.models.metaModel||a.models.entitySet;e.entityType=l.createBindingContext("/".concat(r.targetEntityType.fullyQualifiedName));this.setUpEditableProperties(e,o,r,l);this.setUpFormatOptions(e,r,t,a);this.setUpDisplayStyle(e,o,r);this.setUpEditStyle(e,o,r);var d=["Avatar","AmountWithCurrency"];if(e.displayStyle&&d.indexOf(e.displayStyle)===-1&&r.targetObject){e.text=e.text||u.getTextBinding(r,e.formatOptions);this.setUpObjectIdentifierTitleAndText(e,r)}else{e.text=""}if(((n=e.dataField.getObject("@sapui.name"))===null||n===void 0?void 0:n.indexOf("com.sap.vocabularies.UI.v1.DataPoint"))>-1){var p=e.dataField.getObject();p.$Type=p.$Type||"com.sap.vocabularies.UI.v1.DataPointType";e.dataField=new s(p,e.dataField.getModel()).createBindingContext("/")}e.emptyIndicatorMode=e.formatOptions.showEmptyIndicator?"On":undefined;return e},getObjectIdentifierTitle:function(e,t){var i,a,o,r,l,s,d,u,c,v;var m=h(y(t));var g=e===null||e===void 0?void 0:e.displayMode;var b=t.targetObject.type==="PropertyPath"?t.targetObject.$target:t.targetObject;m=p.formatWithTypeInformation(b,m);var x=(i=b.annotations)===null||i===void 0?void 0:(a=i.Common)===null||a===void 0?void 0:a.Text;if(x===undefined){g="Value"}var O=f(t);var E=[];if(!!((o=t.targetEntitySet)!==null&&o!==void 0&&(r=o.annotations)!==null&&r!==void 0&&(l=r.Common)!==null&&l!==void 0&&l.DraftRoot)||!!((s=t.targetEntitySet)!==null&&s!==void 0&&(d=s.annotations)!==null&&d!==void 0&&(u=d.Common)!==null&&u!==void 0&&u.DraftNode)){E.push(U.HasDraft);E.push(U.IsActive)}else{E.push(S(null));E.push(S(null))}switch(g){case"Value":E.push(m);E.push(S(null));break;case"Description":E.push(I(x,O));E.push(S(null));break;case"ValueDescription":E.push(m);E.push(I(x,O));break;default:if(x!==null&&x!==void 0&&(c=x.annotations)!==null&&c!==void 0&&(v=c.UI)!==null&&v!==void 0&&v.TextArrangement){E.push(I(x,O));E.push(m)}else{var D,P,j;E.push(I(x,O));if((D=t.targetObject)!==null&&D!==void 0&&(P=D.annotations)!==null&&P!==void 0&&(j=P.Common)!==null&&j!==void 0&&j.SemanticObject){E.push(m)}else{E.push(S(null))}}break}return F(T(E,n.formatOPTitle))},getObjectIdentifierText:function(e,t){var i,a,n,o;var r=h(y(t));var l=e===null||e===void 0?void 0:e.displayMode;var s=t.targetObject.type==="PropertyPath"?t.targetObject.$target:t.targetObject;var d=(i=s.annotations)===null||i===void 0?void 0:(a=i.Common)===null||a===void 0?void 0:a.Text;if(d===undefined||d!==null&&d!==void 0&&(n=d.annotations)!==null&&n!==void 0&&(o=n.UI)!==null&&o!==void 0&&o.TextArrangement){return undefined}r=p.formatWithTypeInformation(s,r);switch(l){case"ValueDescription":var u=f(t);return F(I(d,u));case"DescriptionValue":return F(r);default:return undefined}},setUpObjectIdentifierTitleAndText:function(e,t){var i;if(((i=e.formatOptions)===null||i===void 0?void 0:i.semanticKeyStyle)==="ObjectIdentifier"){var a,n,o;e.identifierTitle=this.getObjectIdentifierTitle(e.formatOptions,t);if(!((a=t.targetObject)!==null&&a!==void 0&&(n=a.annotations)!==null&&n!==void 0&&(o=n.Common)!==null&&o!==void 0&&o.SemanticObject)){e.identifierText=this.getObjectIdentifierText(e.formatOptions,t)}else{e.identifierText=undefined}}else{e.identifierTitle=undefined;e.identifierText=undefined}},getTextWithWhiteSpace:function(e,t){var i=u.getTextBinding(t,e,true);return i._type==="PathInModel"||typeof i==="string"?F(T([i],"WSR")):F(i)},_getTargetValueDataModelPath:function(e,t){var i,a;if(!(e!==null&&e!==void 0&&e.$Type)){return t}var n="";var o=t;switch(e.$Type){case"com.sap.vocabularies.UI.v1.DataField":case"com.sap.vocabularies.UI.v1.DataPointType":case"com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath":case"com.sap.vocabularies.UI.v1.DataFieldWithUrl":case"com.sap.vocabularies.UI.v1.DataFieldWithIntentBasedNavigation":case"com.sap.vocabularies.UI.v1.DataFieldWithAction":n=(i=e.Value)===null||i===void 0?void 0:i.path;break;case"com.sap.vocabularies.UI.v1.DataFieldForAnnotation":if(e.Target.$target){if(e.Target.$target.$Type==="com.sap.vocabularies.UI.v1.DataField"||e.Target.$target.$Type==="com.sap.vocabularies.UI.v1.DataPointType"){var r;n=(r=e.Target.$target.Value)===null||r===void 0?void 0:r.path}else{var l;n=(l=e.Target)===null||l===void 0?void 0:l.path}}break}if(((a=n)===null||a===void 0?void 0:a.length)>0){o=g(t,n)}return o},setUpDisplayStyle:function(e,t,i){var a,n,o,r,l,s,d,c,m,f,y,g,b,h,x,O,I,T,S,E,U,D,P,j;var M=i.targetObject;if(!i.targetObject){e.displayStyle="Text";return}if(M.type==="Edm.Stream"){e.displayStyle="File";return}if((a=M.annotations)!==null&&a!==void 0&&(n=a.UI)!==null&&n!==void 0&&n.IsImageURL){e.displayStyle="Avatar";return}var V=M?u.isUsedInNavigationWithQuickViewFacets(i,M):false;switch(t.$Type){case"com.sap.vocabularies.UI.v1.DataPointType":e.displayStyle="DataPoint";return;case"com.sap.vocabularies.UI.v1.DataFieldForAnnotation":if(((o=t.Target)===null||o===void 0?void 0:(r=o.$target)===null||r===void 0?void 0:r.$Type)==="com.sap.vocabularies.UI.v1.DataPointType"){e.displayStyle="DataPoint";return}else if(((l=t.Target)===null||l===void 0?void 0:(s=l.$target)===null||s===void 0?void 0:s.$Type)==="com.sap.vocabularies.Communication.v1.ContactType"){e.displayStyle="Contact";return}break;case"com.sap.vocabularies.UI.v1.DataFieldForAction":e.displayStyle="Button";return;case"com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation":this.setUpNavigationAvailable(e,t);e.displayStyle="Button";return;case"com.sap.vocabularies.UI.v1.DataFieldWithIntentBasedNavigation":e.text=this.getTextWithWhiteSpace(e.formatOptions,i);case"com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath":case"com.sap.vocabularies.UI.v1.DataFieldWithAction":e.displayStyle="Link";return}if(i!==null&&i!==void 0&&(d=i.targetEntityType)!==null&&d!==void 0&&(c=d.annotations)!==null&&c!==void 0&&(m=c.Common)!==null&&m!==void 0&&m.SemanticKey){var C,A,W,L;var k=(C=i.contextLocation)===null||C===void 0?void 0:(A=C.targetEntityType)===null||A===void 0?void 0:(W=A.annotations)===null||W===void 0?void 0:(L=W.Common)===null||L===void 0?void 0:L.SemanticKey;var $=!(k!==null&&k!==void 0&&k.every(function(e){var t;return(e===null||e===void 0?void 0:(t=e.$target)===null||t===void 0?void 0:t.name)!==M.name}));if($&&e.formatOptions.semanticKeyStyle){var w,N,B;e.hasQuickViewFacets=V;e.hasSituationsIndicator=v.getSituationsNavigationProperty(i.targetEntityType)!==undefined;this.setUpObjectIdentifierTitleAndText(e,i);if((w=i.targetEntitySet)!==null&&w!==void 0&&(N=w.annotations)!==null&&N!==void 0&&(B=N.Common)!==null&&B!==void 0&&B.DraftRoot){e.displayStyle="SemanticKeyWithDraftIndicator";return}e.displayStyle=e.formatOptions.semanticKeyStyle==="ObjectIdentifier"?"ObjectIdentifier":"LabelSemanticKey";return}}if(t.Criticality){e.hasQuickViewFacets=V;e.displayStyle="ObjectStatus";return}if((f=M.annotations)!==null&&f!==void 0&&(y=f.Measures)!==null&&y!==void 0&&y.ISOCurrency&&String(e.formatOptions.isCurrencyAligned)==="true"){if(e.formatOptions.measureDisplayMode==="Hidden"){e.displayStyle="Text";return}e.valueAsStringBindingExpression=u.getValueBinding(i,e.formatOptions,true,true,undefined,true);e.unitBindingExpression=F(p.getBindingForUnitOrCurrency(i));e.displayStyle="AmountWithCurrency";return}if((g=M.annotations)!==null&&g!==void 0&&(b=g.Communication)!==null&&b!==void 0&&b.IsEmailAddress||(h=M.annotations)!==null&&h!==void 0&&(x=h.Communication)!==null&&x!==void 0&&x.IsPhoneNumber){e.text=this.getTextWithWhiteSpace(e.formatOptions,i);e.displayStyle="Link";return}if((O=M.annotations)!==null&&O!==void 0&&(I=O.UI)!==null&&I!==void 0&&I.MultiLineText){e.displayStyle="ExpandableText";return}if(V){e.text=this.getTextWithWhiteSpace(e.formatOptions,i);e.hasQuickViewFacets=true;e.displayStyle="LinkWithQuickViewForm";return}if(e.semanticObject&&!(M!==null&&M!==void 0&&(T=M.annotations)!==null&&T!==void 0&&(S=T.Communication)!==null&&S!==void 0&&S.IsEmailAddress||M!==null&&M!==void 0&&(E=M.annotations)!==null&&E!==void 0&&(U=E.Communication)!==null&&U!==void 0&&U.IsPhoneNumber)){e.hasQuickViewFacets=V;e.text=this.getTextWithWhiteSpace(e.formatOptions,i);e.displayStyle="LinkWithQuickViewForm";return}var R=(D=M.annotations)===null||D===void 0?void 0:D.Common;var _=i===null||i===void 0?void 0:(P=i.navigationProperties[0])===null||P===void 0?void 0:(j=P.annotations)===null||j===void 0?void 0:j.Common;for(var q in R){if(q.indexOf("SemanticObject")===0){e.hasQuickViewFacets=V;e.displayStyle="LinkWrapper";return}}for(var H in _){if(H.indexOf("SemanticObject")===0){e.hasQuickViewFacets=V;e.displayStyle="LinkWrapper";return}}if(t.$Type==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){e.text=this.getTextWithWhiteSpace(e.formatOptions,i);e.displayStyle="Link";return}e.displayStyle="Text"},setUpEditStyle:function(e,t,i){u.setEditStyleProperties(e,t,i)},setUpEditableProperties:function(t,i,n,o){var l,s,d;var u=n!==null&&n!==void 0&&(l=n.targetObject)!==null&&l!==void 0&&l.Value?n.targetObject.Value:n===null||n===void 0?void 0:n.targetObject;if(t.editMode!==undefined&&t.editMode!==null){t.editModeAsObject=t.editMode}else{var c=t.formatOptions.measureDisplayMode?t.formatOptions.measureDisplayMode==="ReadOnly":false;t.editModeAsObject=p.getEditMode(u,n,c,true,i);t.editMode=F(t.editModeAsObject)}var v=p.getEditableExpressionAsObject(u,i,n);var m=e.getRequiredPropertiesFromInsertRestrictions((s=t.entitySet)===null||s===void 0?void 0:s.getPath().replaceAll("/$NavigationPropertyBinding/","/"),o);var f=e.getRequiredPropertiesFromUpdateRestrictions((d=t.entitySet)===null||d===void 0?void 0:d.getPath().replaceAll("/$NavigationPropertyBinding/","/"),o);var y={requiredPropertiesFromInsertRestrictions:m,requiredPropertiesFromUpdateRestrictions:f};if(r.isCollaborationDraftSupported(o)){t.collaborationEnabled=true;var g=p.getCollaborationExpression(n,a.hasCollaborationActivity);t.collaborationHasActivityExpression=F(g);t.collaborationInitialsExpression=F(p.getCollaborationExpression(n,a.getCollaborationActivityInitials));t.collaborationColorExpression=F(p.getCollaborationExpression(n,a.getCollaborationActivityColor));t.editableExpression=F(E(v,x(g)));t.editMode=F(O(g,S("ReadOnly"),t.editModeAsObject))}else{t.editableExpression=F(v)}t.enabledExpression=p.getEnabledExpression(u,i,false,n);t.requiredExpression=p.getRequiredExpression(u,i,false,false,y,n)},setUpFormatOptions:function(e,t,i,a){var n;var o=this.getOverrides(i,e.dataField.getPath());if(!e.formatOptions.displayMode){e.formatOptions.displayMode=p.getDisplayMode(t)}e.formatOptions.textLinesEdit=o.textLinesEdit||o.formatOptions&&o.formatOptions.textLinesEdit||e.formatOptions.textLinesEdit||4;e.formatOptions.textMaxLines=o.textMaxLines||o.formatOptions&&o.formatOptions.textMaxLines||e.formatOptions.textMaxLines;if((n=a.models.viewData)!==null&&n!==void 0&&n.getProperty("/retrieveTextFromValueList")){e.formatOptions.retrieveTextFromValueList=u.isRetrieveTextFromValueListEnabled(t.targetObject,e.formatOptions);if(e.formatOptions.retrieveTextFromValueList){var r,l,s;var d=!!(t!==null&&t!==void 0&&(r=t.targetEntityType)!==null&&r!==void 0&&(l=r.annotations)!==null&&l!==void 0&&(s=l.UI)!==null&&s!==void 0&&s.TextArrangement);e.formatOptions.displayMode=d?e.formatOptions.displayMode:"DescriptionValue"}}if(e.formatOptions.fieldMode==="nowrapper"&&e.editMode==="Display"){if(e._flexId){e.noWrapperId=e._flexId}else{e.noWrapperId=e.idPrefix?b([e.idPrefix,"Field-content"]):undefined}}},setUpSemanticObjects:function(e,t){var i,a;var n=[];n=u.getSemanticObjectExpressionToResolve(t===null||t===void 0?void 0:(i=t.targetObject)===null||i===void 0?void 0:(a=i.annotations)===null||a===void 0?void 0:a.Common);if(!!e.semanticObject&&typeof e.semanticObject==="string"&&e.semanticObject[0]==="{"){n.push({key:e.semanticObject.substr(1,e.semanticObject.length-2),value:e.semanticObject})}e.semanticObjects=u.getSemanticObjects(n);if(!e.semanticObject&&t.navigationProperties.length>0){t.navigationProperties.forEach(function(t){var i,a;if(t!==null&&t!==void 0&&(i=t.annotations)!==null&&i!==void 0&&(a=i.Common)!==null&&a!==void 0&&a.SemanticObject){e.semanticObject=t.annotations.Common.SemanticObject;e.hasSemanticObjectOnNavigation=true}})}},setUpNavigationAvailable:function(e,t){e.navigationAvailable=true;if((t===null||t===void 0?void 0:t.$Type)==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"&&t.NavigationAvailable!==undefined&&String(e.formatOptions.ignoreNavigationAvailable)!=="true"){e.navigationAvailable=F(I(t.NavigationAvailable))}}});return D},false);
//# sourceMappingURL=Field.metadata.js.map