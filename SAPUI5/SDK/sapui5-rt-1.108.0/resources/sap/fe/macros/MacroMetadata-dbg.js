/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/util/deepClone", "sap/base/util/merge", "sap/base/util/uid", "sap/fe/core/converters/ConverterContext"], function (deepClone, merge, uid, ConverterContext) {
  "use strict";

  var fnGetOverrides = function (mControlConfiguration, sID) {
    var oProps = {};

    if (mControlConfiguration) {
      var oControlConfig = mControlConfiguration[sID];

      if (oControlConfig) {
        Object.keys(oControlConfig).forEach(function (sConfigKey) {
          oProps[sConfigKey] = oControlConfig[sConfigKey];
        });
      }
    }

    return oProps;
  };

  var fnSetDefaultValue = function (oProps, sPropName, oOverrideValue, bForceUpdate) {
    if (oProps[sPropName] === undefined || bForceUpdate) {
      oProps[sPropName] = oOverrideValue;
    }
  };

  var MacroMetadata = {
    metadata: {
      properties: {
        _flexId: {
          type: "string"
        }
      }
    },
    extend: function (fnName, oContent) {
      oContent.metadata.properties._flexId = MacroMetadata.metadata.properties._flexId;
      oContent.hasValidation = true;
      oContent.getOverrides = fnGetOverrides.bind(oContent);
      oContent.setDefaultValue = fnSetDefaultValue.bind(oContent);

      oContent.getConverterContext = function (oVisualizationObjectPath, contextPath, mSettings, mExtraParams) {
        var oAppComponent = mSettings.appComponent;
        var originalViewData = mSettings.models.viewData && mSettings.models.viewData.getData();
        var viewData = Object.assign({}, originalViewData);
        delete viewData.resourceBundle;
        viewData = deepClone(viewData);
        viewData.controlConfiguration = merge(viewData.controlConfiguration, mExtraParams);
        return ConverterContext.createConverterContextForMacro(oVisualizationObjectPath.startingEntitySet.name, mSettings.models.metaModel, oAppComponent && oAppComponent.getDiagnostics(), merge, oVisualizationObjectPath.contextLocation, viewData);
      };

      oContent.createBindingContext = function (oData, mSettings) {
        var sContextPath = "/".concat(uid());
        mSettings.models.converterContext.setProperty(sContextPath, oData);
        return mSettings.models.converterContext.createBindingContext(sContextPath);
      };

      oContent.parseAggregation = function (oAggregation, fnCallback) {
        var oOutObjects = {};

        if (oAggregation && oAggregation.children.length > 0) {
          var children = oAggregation.children;

          for (var childIdx = 0; childIdx < children.length; childIdx++) {
            var childObject = fnCallback(children[childIdx], childIdx);

            if (childObject) {
              oOutObjects[childObject.key] = childObject;
            }
          }
        }

        return oOutObjects;
      };

      oContent.getContentId = function (sMacroId) {
        return "".concat(sMacroId, "-content");
      };

      return oContent;
    }
  };
  return MacroMetadata;
}, false);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJmbkdldE92ZXJyaWRlcyIsIm1Db250cm9sQ29uZmlndXJhdGlvbiIsInNJRCIsIm9Qcm9wcyIsIm9Db250cm9sQ29uZmlnIiwiT2JqZWN0Iiwia2V5cyIsImZvckVhY2giLCJzQ29uZmlnS2V5IiwiZm5TZXREZWZhdWx0VmFsdWUiLCJzUHJvcE5hbWUiLCJvT3ZlcnJpZGVWYWx1ZSIsImJGb3JjZVVwZGF0ZSIsInVuZGVmaW5lZCIsIk1hY3JvTWV0YWRhdGEiLCJtZXRhZGF0YSIsInByb3BlcnRpZXMiLCJfZmxleElkIiwidHlwZSIsImV4dGVuZCIsImZuTmFtZSIsIm9Db250ZW50IiwiaGFzVmFsaWRhdGlvbiIsImdldE92ZXJyaWRlcyIsImJpbmQiLCJzZXREZWZhdWx0VmFsdWUiLCJnZXRDb252ZXJ0ZXJDb250ZXh0Iiwib1Zpc3VhbGl6YXRpb25PYmplY3RQYXRoIiwiY29udGV4dFBhdGgiLCJtU2V0dGluZ3MiLCJtRXh0cmFQYXJhbXMiLCJvQXBwQ29tcG9uZW50IiwiYXBwQ29tcG9uZW50Iiwib3JpZ2luYWxWaWV3RGF0YSIsIm1vZGVscyIsInZpZXdEYXRhIiwiZ2V0RGF0YSIsImFzc2lnbiIsInJlc291cmNlQnVuZGxlIiwiZGVlcENsb25lIiwiY29udHJvbENvbmZpZ3VyYXRpb24iLCJtZXJnZSIsIkNvbnZlcnRlckNvbnRleHQiLCJjcmVhdGVDb252ZXJ0ZXJDb250ZXh0Rm9yTWFjcm8iLCJzdGFydGluZ0VudGl0eVNldCIsIm5hbWUiLCJtZXRhTW9kZWwiLCJnZXREaWFnbm9zdGljcyIsImNvbnRleHRMb2NhdGlvbiIsImNyZWF0ZUJpbmRpbmdDb250ZXh0Iiwib0RhdGEiLCJzQ29udGV4dFBhdGgiLCJ1aWQiLCJjb252ZXJ0ZXJDb250ZXh0Iiwic2V0UHJvcGVydHkiLCJwYXJzZUFnZ3JlZ2F0aW9uIiwib0FnZ3JlZ2F0aW9uIiwiZm5DYWxsYmFjayIsIm9PdXRPYmplY3RzIiwiY2hpbGRyZW4iLCJsZW5ndGgiLCJjaGlsZElkeCIsImNoaWxkT2JqZWN0Iiwia2V5IiwiZ2V0Q29udGVudElkIiwic01hY3JvSWQiXSwic291cmNlUm9vdCI6Ii4iLCJzb3VyY2VzIjpbIk1hY3JvTWV0YWRhdGEudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGRlZXBDbG9uZSBmcm9tIFwic2FwL2Jhc2UvdXRpbC9kZWVwQ2xvbmVcIjtcbmltcG9ydCBtZXJnZSBmcm9tIFwic2FwL2Jhc2UvdXRpbC9tZXJnZVwiO1xuaW1wb3J0IHVpZCBmcm9tIFwic2FwL2Jhc2UvdXRpbC91aWRcIjtcbmltcG9ydCBDb252ZXJ0ZXJDb250ZXh0IGZyb20gXCJzYXAvZmUvY29yZS9jb252ZXJ0ZXJzL0NvbnZlcnRlckNvbnRleHRcIjtcbmNvbnN0IGZuR2V0T3ZlcnJpZGVzID0gZnVuY3Rpb24gKG1Db250cm9sQ29uZmlndXJhdGlvbjogYW55LCBzSUQ6IHN0cmluZykge1xuXHRjb25zdCBvUHJvcHM6IGFueSA9IHt9O1xuXHRpZiAobUNvbnRyb2xDb25maWd1cmF0aW9uKSB7XG5cdFx0Y29uc3Qgb0NvbnRyb2xDb25maWcgPSBtQ29udHJvbENvbmZpZ3VyYXRpb25bc0lEXTtcblx0XHRpZiAob0NvbnRyb2xDb25maWcpIHtcblx0XHRcdE9iamVjdC5rZXlzKG9Db250cm9sQ29uZmlnKS5mb3JFYWNoKGZ1bmN0aW9uIChzQ29uZmlnS2V5OiBzdHJpbmcpIHtcblx0XHRcdFx0b1Byb3BzW3NDb25maWdLZXldID0gb0NvbnRyb2xDb25maWdbc0NvbmZpZ0tleV07XG5cdFx0XHR9KTtcblx0XHR9XG5cdH1cblx0cmV0dXJuIG9Qcm9wcztcbn07XG5jb25zdCBmblNldERlZmF1bHRWYWx1ZSA9IGZ1bmN0aW9uIChvUHJvcHM6IGFueSwgc1Byb3BOYW1lOiBzdHJpbmcsIG9PdmVycmlkZVZhbHVlOiBhbnksIGJGb3JjZVVwZGF0ZTogYm9vbGVhbikge1xuXHRpZiAob1Byb3BzW3NQcm9wTmFtZV0gPT09IHVuZGVmaW5lZCB8fCBiRm9yY2VVcGRhdGUpIHtcblx0XHRvUHJvcHNbc1Byb3BOYW1lXSA9IG9PdmVycmlkZVZhbHVlO1xuXHR9XG59O1xuY29uc3QgTWFjcm9NZXRhZGF0YSA9IHtcblx0bWV0YWRhdGE6IHtcblx0XHRwcm9wZXJ0aWVzOiB7XG5cdFx0XHRfZmxleElkOiB7XG5cdFx0XHRcdHR5cGU6IFwic3RyaW5nXCJcblx0XHRcdH1cblx0XHR9XG5cdH0sXG5cdGV4dGVuZDogZnVuY3Rpb24gKGZuTmFtZTogYW55LCBvQ29udGVudDogYW55KSB7XG5cdFx0b0NvbnRlbnQubWV0YWRhdGEucHJvcGVydGllcy5fZmxleElkID0gTWFjcm9NZXRhZGF0YS5tZXRhZGF0YS5wcm9wZXJ0aWVzLl9mbGV4SWQ7XG5cdFx0b0NvbnRlbnQuaGFzVmFsaWRhdGlvbiA9IHRydWU7XG5cdFx0b0NvbnRlbnQuZ2V0T3ZlcnJpZGVzID0gZm5HZXRPdmVycmlkZXMuYmluZChvQ29udGVudCk7XG5cdFx0b0NvbnRlbnQuc2V0RGVmYXVsdFZhbHVlID0gZm5TZXREZWZhdWx0VmFsdWUuYmluZChvQ29udGVudCk7XG5cdFx0b0NvbnRlbnQuZ2V0Q29udmVydGVyQ29udGV4dCA9IGZ1bmN0aW9uIChvVmlzdWFsaXphdGlvbk9iamVjdFBhdGg6IGFueSwgY29udGV4dFBhdGg6IGFueSwgbVNldHRpbmdzOiBhbnksIG1FeHRyYVBhcmFtczogYW55KSB7XG5cdFx0XHRjb25zdCBvQXBwQ29tcG9uZW50ID0gbVNldHRpbmdzLmFwcENvbXBvbmVudDtcblx0XHRcdGNvbnN0IG9yaWdpbmFsVmlld0RhdGEgPSBtU2V0dGluZ3MubW9kZWxzLnZpZXdEYXRhICYmIG1TZXR0aW5ncy5tb2RlbHMudmlld0RhdGEuZ2V0RGF0YSgpO1xuXHRcdFx0bGV0IHZpZXdEYXRhID0gT2JqZWN0LmFzc2lnbih7fSwgb3JpZ2luYWxWaWV3RGF0YSk7XG5cdFx0XHRkZWxldGUgdmlld0RhdGEucmVzb3VyY2VCdW5kbGU7XG5cdFx0XHR2aWV3RGF0YSA9IGRlZXBDbG9uZSh2aWV3RGF0YSk7XG5cdFx0XHR2aWV3RGF0YS5jb250cm9sQ29uZmlndXJhdGlvbiA9IG1lcmdlKHZpZXdEYXRhLmNvbnRyb2xDb25maWd1cmF0aW9uLCBtRXh0cmFQYXJhbXMpO1xuXHRcdFx0cmV0dXJuIENvbnZlcnRlckNvbnRleHQuY3JlYXRlQ29udmVydGVyQ29udGV4dEZvck1hY3JvKFxuXHRcdFx0XHRvVmlzdWFsaXphdGlvbk9iamVjdFBhdGguc3RhcnRpbmdFbnRpdHlTZXQubmFtZSxcblx0XHRcdFx0bVNldHRpbmdzLm1vZGVscy5tZXRhTW9kZWwsXG5cdFx0XHRcdG9BcHBDb21wb25lbnQgJiYgb0FwcENvbXBvbmVudC5nZXREaWFnbm9zdGljcygpLFxuXHRcdFx0XHRtZXJnZSxcblx0XHRcdFx0b1Zpc3VhbGl6YXRpb25PYmplY3RQYXRoLmNvbnRleHRMb2NhdGlvbixcblx0XHRcdFx0dmlld0RhdGFcblx0XHRcdCk7XG5cdFx0fTtcblx0XHRvQ29udGVudC5jcmVhdGVCaW5kaW5nQ29udGV4dCA9IGZ1bmN0aW9uIChvRGF0YTogYW55LCBtU2V0dGluZ3M6IGFueSkge1xuXHRcdFx0Y29uc3Qgc0NvbnRleHRQYXRoID0gYC8ke3VpZCgpfWA7XG5cdFx0XHRtU2V0dGluZ3MubW9kZWxzLmNvbnZlcnRlckNvbnRleHQuc2V0UHJvcGVydHkoc0NvbnRleHRQYXRoLCBvRGF0YSk7XG5cdFx0XHRyZXR1cm4gbVNldHRpbmdzLm1vZGVscy5jb252ZXJ0ZXJDb250ZXh0LmNyZWF0ZUJpbmRpbmdDb250ZXh0KHNDb250ZXh0UGF0aCk7XG5cdFx0fTtcblx0XHRvQ29udGVudC5wYXJzZUFnZ3JlZ2F0aW9uID0gZnVuY3Rpb24gKG9BZ2dyZWdhdGlvbjogYW55LCBmbkNhbGxiYWNrOiBGdW5jdGlvbikge1xuXHRcdFx0Y29uc3Qgb091dE9iamVjdHM6IGFueSA9IHt9O1xuXHRcdFx0aWYgKG9BZ2dyZWdhdGlvbiAmJiBvQWdncmVnYXRpb24uY2hpbGRyZW4ubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRjb25zdCBjaGlsZHJlbiA9IG9BZ2dyZWdhdGlvbi5jaGlsZHJlbjtcblx0XHRcdFx0Zm9yIChsZXQgY2hpbGRJZHggPSAwOyBjaGlsZElkeCA8IGNoaWxkcmVuLmxlbmd0aDsgY2hpbGRJZHgrKykge1xuXHRcdFx0XHRcdGNvbnN0IGNoaWxkT2JqZWN0ID0gZm5DYWxsYmFjayhjaGlsZHJlbltjaGlsZElkeF0sIGNoaWxkSWR4KTtcblx0XHRcdFx0XHRpZiAoY2hpbGRPYmplY3QpIHtcblx0XHRcdFx0XHRcdG9PdXRPYmplY3RzW2NoaWxkT2JqZWN0LmtleV0gPSBjaGlsZE9iamVjdDtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdHJldHVybiBvT3V0T2JqZWN0cztcblx0XHR9O1xuXG5cdFx0b0NvbnRlbnQuZ2V0Q29udGVudElkID0gZnVuY3Rpb24gKHNNYWNyb0lkOiBzdHJpbmcpIHtcblx0XHRcdHJldHVybiBgJHtzTWFjcm9JZH0tY29udGVudGA7XG5cdFx0fTtcblxuXHRcdHJldHVybiBvQ29udGVudDtcblx0fVxufTtcblxuZXhwb3J0IGRlZmF1bHQgTWFjcm9NZXRhZGF0YTtcbiJdLCJtYXBwaW5ncyI6IjtBQUFBO0FBQUE7QUFBQTs7OztFQUlBLElBQU1BLGNBQWMsR0FBRyxVQUFVQyxxQkFBVixFQUFzQ0MsR0FBdEMsRUFBbUQ7SUFDekUsSUFBTUMsTUFBVyxHQUFHLEVBQXBCOztJQUNBLElBQUlGLHFCQUFKLEVBQTJCO01BQzFCLElBQU1HLGNBQWMsR0FBR0gscUJBQXFCLENBQUNDLEdBQUQsQ0FBNUM7O01BQ0EsSUFBSUUsY0FBSixFQUFvQjtRQUNuQkMsTUFBTSxDQUFDQyxJQUFQLENBQVlGLGNBQVosRUFBNEJHLE9BQTVCLENBQW9DLFVBQVVDLFVBQVYsRUFBOEI7VUFDakVMLE1BQU0sQ0FBQ0ssVUFBRCxDQUFOLEdBQXFCSixjQUFjLENBQUNJLFVBQUQsQ0FBbkM7UUFDQSxDQUZEO01BR0E7SUFDRDs7SUFDRCxPQUFPTCxNQUFQO0VBQ0EsQ0FYRDs7RUFZQSxJQUFNTSxpQkFBaUIsR0FBRyxVQUFVTixN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