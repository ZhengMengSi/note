/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/CommonUtils","sap/fe/core/helpers/BindingToolkit","sap/fe/macros/DelegateUtil","sap/fe/macros/field/FieldRuntime","sap/fe/macros/filter/FilterUtils","sap/ui/core/Component","sap/ui/core/format/NumberFormat","sap/ui/model/Filter"],function(e,t,n,a,r,i,o,c,s){"use strict";var l=n.pathInModel;var f=n.compileExpression;function u(e,n){var a=e.data("entityType"),r=t.getAppComponent(e).getMetaModel(),i=r.getObject("".concat(a).concat(n)),o={},c=[],l=[];var f="";if(i){f=i.Text;(i.SelectOptions||[]).filter(function(e){return e&&e.PropertyName&&e.PropertyName.$PropertyPath}).forEach(function(e){var t=e.PropertyName.$PropertyPath;if(!l.includes(t)){l.push(t)}for(var n in e.Ranges){var a=e.Ranges[n];o[t]=(o[t]||[]).concat(new s(t,a.Option.$EnumMember.split("/").pop(),a.Low,a.High))}});for(var u in o){c.push(new s({filters:o[u],and:false}))}}return{properties:l,filters:c,text:f}}function m(e){var t=[];var n=e.data("hiddenFilters");if(n&&Array.isArray(n.paths)){n.paths.forEach(function(n){var a=u(e,n.annotationPath);t=t.concat(a.filters)})}return t}function g(e){var t=[];var n=a.getCustomData(e,"quickFilterKey");if(n){t=t.concat(u(e,n).filters)}return t}function d(e){return g(e).concat(m(e))}function p(e,t,n){var a;var r=e.data("rowsBindingInfo"),i=e.getModel();var o=n.batchGroupId||"",c=b(e);var l=Array.isArray(n.additionalFilters)?n.additionalFilters:[];var f=c.bindingPath?c.bindingPath:r.path;l=l.concat(c.filters).concat(h(e));var u=new s({filters:l,and:true});var m=i.bindList((t?"".concat(t.getPath(),"/"):"")+f,e.getBindingContext(),[],u);return m.fetchFilter(m.getContext()).then(function(e){a=i.bindProperty("".concat(m.getPath(),"/$count"),m.getContext(),{$$groupId:o||"$auto",$filter:e[0],$search:c.search});return a.requestValue()}).then(function(e){a.destroy();m.destroy();return e})}function v(e){var t=c.getIntegerInstance({groupingEnabled:true});return t.format(e)}function b(e){var t=e.getParent().getTableDefinition();var n=[];function a(e){var t=e.getParent().getTableDefinition().aggregates;return Object.keys(t).map(function(e){return t[e].relativePath})}if(t.enableAnalytics){n=n.concat(a(e));if(!t.enableAnalyticsSearch){n=n.concat(["search"])}}return i.getFilterInfo(e.getFilter(),{ignoredProperties:n,targetControl:e})}function h(e){var t=e.getP13nMode();if(t&&t.indexOf("Filter")>-1){var n=(a.getCustomData(e,"sap_fe_TableDelegate_propertyInfoMap")||[]).filter(function(e){return e&&!(e.filterable===false)}),r=i.getFilterInfo(e,{propertiesMetadata:n});if(r&&r.filters){return r.filters}}return[]}function P(e){var t=b(e);return{filters:t.filters.concat(d(e),h(e)),search:t.search,bindingPath:t.bindingPath}}function O(e){return F(e).promise}function j(e){var t=F(e);if(t.resolve){t.resolve(e);e.data("boundPromiseResolve",null)}}function F(e){if(!e.data("boundPromise")){var t;e.data("boundPromise",new Promise(function(e){t=e}));if(e.isBound()){t(e)}else{e.data("boundPromiseResolve",t)}}return{promise:e.data("boundPromise"),resolve:e.data("boundPromiseResolve")}}function y(e,n,a){e.filters=a;if(n.search){e.parameters.$search=t.normalizeSearchTerm(n.search)}else{e.parameters.$search=undefined}}function C(n,i){var c=n.getView();var s=c.getBindingContext("internal");if(s){var u=a.getCustomData(i,"targetCollectionPath");if(u){var m=n.getOwnerComponent();var g=o.getOwnerComponentFor(m);var d=g.getMetaModel();var p=t.getShellServices(g);var v=r._fnFixHashQueryString(t.getHash());var b=i.getParent().getTableDefinition().columns;var h=[];var P=[];var O=[];var j="",F,y;var C;var x=[];var S,T;for(var $=0;$<b.length;$++){F=b[$].annotationPath;if(F){y=d.getObject(F);if(y&&y.$kind==="Property"){j=b[$].annotationPath}else if(y&&y.$Type==="com.sap.vocabularies.UI.v1.DataField"){j="".concat(u,"/").concat(d.getObject("".concat(F,"/Value/$Path")))}}if(j!==""){var I=Object.keys(d.getObject(j+"@"));for(var A=0;A<I.length;A++){if(!O.includes(j)&&I[A].indexOf("@".concat("com.sap.vocabularies.Common.v1.SemanticObject"))===0&&I[A].indexOf("@".concat("com.sap.vocabularies.Common.v1.SemanticObjectMapping"))===-1&&I[A].indexOf("@".concat("com.sap.vocabularies.Common.v1.SemanticObjectUnavailableActions"))===-1){T=/#(.*)/.exec(I[A]);S=T?T[1]:"";x.push(t.getSemanticObjectPromise(g,c,d,j,S));O.push(j)}}}j=""}if(x.length===0){return Promise.resolve()}else{Promise.all(x).then(function(e){var n=[];var a;var r=e.filter(function(e){if(e.semanticObject&&typeof e.semanticObject.semanticObject==="object"){a=f(l(e.semanticObject.semanticObject.$Path));e.semanticObject.semanticObject=a;e.semanticObjectForGetLinks[0].semanticObject=a;return true}else if(e){return e.semanticObject!==undefined}else{return false}});for(var i=0;i<r.length;i++){C=r[i];if(C&&C.semanticObject&&!(C.semanticObject.semanticObject.indexOf("{")===0)){h.push(C.semanticObjectForGetLinks);P.push({semanticObject:C.semanticObject&&C.semanticObject.semanticObject,unavailableActions:C.unavailableActions,path:r[i].semanticObjectPath});n.push(p.getLinksWithCache([C.semanticObjectForGetLinks]))}}return t.updateSemanticTargets(n,P,s,v)}).catch(function(t){e.error("fnGetSemanticTargetsFromTable: Cannot get Semantic Objects",t)})}}}}function x(e){e.clearSelection();var t=e.getBindingContext("internal");if(t){t.setProperty("deleteEnabled",false);t.setProperty("numberOfSelectedContexts",0);t.setProperty("selectedContexts",[]);t.setProperty("deletableContexts",[])}}var S={getCountFormatted:v,getHiddenFilters:m,getFiltersInfoForSV:u,getTableFilters:d,getListBindingForCount:p,getFilterInfo:b,getP13nFilters:h,getAllFilterInfo:P,whenBound:O,onTableBound:j,getSemanticTargetsFromTable:C,updateBindingInfo:y,clearSelection:x};return S},false);
//# sourceMappingURL=Utils.js.map