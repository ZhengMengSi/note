/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/converters/controls/Common/Action","sap/fe/core/converters/objectPage/HeaderAndFooterAction","sap/fe/core/helpers/BindingToolkit","sap/fe/templates/ObjectPage/ObjectPageTemplating","../controls/ObjectPage/Avatar","../controls/ObjectPage/HeaderFacet","../controls/ObjectPage/SubSection","../helpers/BindingHelper","../helpers/ConfigurableObject","../helpers/ID","../ManifestSettings"],function(e,t,n,i,r,o,a,l,s,c,v){"use strict";var u={};var d=v.TemplateType;var f=c.getSectionID;var b=c.getEditableHeaderSectionID;var g=c.getCustomSectionID;var p=s.Placement;var m=s.insertCustomElements;var y=l.UI;var h=a.SubSectionType;var A=a.createSubSections;var O=a.createCustomSubSections;var S=a.createCustomHeaderFacetSubSections;var E=o.getHeaderFacetsFromManifest;var w=o.getHeaderFacetsFromAnnotations;var C=r.getAvatar;var P=i.getPressExpressionForPrimaryAction;var j=i.getEditCommandExecutionVisible;var H=i.getEditCommandExecutionEnabled;var I=n.not;var F=n.ifElse;var T=n.getExpressionFromAnnotation;var k=n.equal;var M=n.constant;var x=n.compileExpression;var D=t.getHiddenHeaderActions;var U=t.getHeaderDefaultActions;var B=t.getFooterDefaultActions;var V=e.removeDuplicateActions;var z=e.getActionsFromManifest;function W(e){return G(e)||N(e)||_(e)||L()}function L(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _(e,t){if(!e)return;if(typeof e==="string")return q(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor)n=e.constructor.name;if(n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return q(e,t)}function N(e){if(typeof Symbol!=="undefined"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function G(e){if(Array.isArray(e))return q(e)}function q(e,t){if(t==null||t>e.length)t=e.length;for(var n=0,i=new Array(t);n<t;n++){i[n]=e[n]}return i}function J(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?J(Object(n),!0).forEach(function(t){$(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):J(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function $(e,t,n){if(t in e){Object.defineProperty(e,t,{value:n,enumerable:true,configurable:true,writable:true})}else{e[t]=n}return e}var K=function(e,t){var n,i;return((n=e.ID)===null||n===void 0?void 0:n.toString())||((i=e.Label)===null||i===void 0?void 0:i.toString())||t};function Q(e,t){var n,i;var r=b();var o=(n=e.getEntityType().annotations)===null||n===void 0?void 0:(i=n.UI)===null||i===void 0?void 0:i.HeaderFacets;var a=o?A(o,e,true):[];var l=S(e);var s=[];if(l.length>0){var c=0;t.forEach(function(e){while(a.length>c&&a[c].visible==="false"){s.push(a[c]);c++}if(a.length>c&&(e.key===a[c].key||e.key.slice(e.key.lastIndexOf("::")+2)===a[c].key.slice(a[c].key.lastIndexOf("::")+2))){s.push(a[c]);c++}else{l.forEach(function(t){if(e.key===t.key){s.push(t)}})}})}else{s=a}var v={id:r,key:"EditableHeaderContent",title:"{sap.fe.i18n>T_COMMON_OBJECT_PAGE_HEADER_SECTION}",visible:x(y.IsEditable),subSections:s};return v}u.createEditableHeaderSection=Q;function X(e){var t,n,i;var r=e.getEntityType();var o=((t=r.annotations)===null||t===void 0?void 0:(n=t.UI)===null||n===void 0?void 0:(i=n.Facets)===null||i===void 0?void 0:i.map(function(t){return Y(t,e)}))||[];return o}function Y(e,t){var n,i,r;var o=f({Facet:e});var a={id:o,key:K(e,o),title:x(T(e.Label)),showTitle:!!e.Label,visible:x(I(k(T((n=e.annotations)===null||n===void 0?void 0:(i=n.UI)===null||i===void 0?void 0:(r=i.Hidden)===null||r===void 0?void 0:r.valueOf()),true))),subSections:A([e],t)};return a}function Z(e,t){var n={};Object.keys(e).forEach(function(i){n[i]=ee(e[i],i,t)});return n}function ee(e,t,n){var i=e.id||g(t);var r=e.position;if(!r){r={placement:p.After}}var o;if(!e.subSections){o=$({},t,R(R({},e),{},{position:undefined,visible:"true"}))}else{o=e.subSections}var a=O(o,n);var l={id:i,key:t,title:e.title,showTitle:!!e.title,visible:e.visible!==undefined?e.visible:"true",position:r,subSections:a};return l}var te=function(e){var t=U(e);var n=e.getManifestWrapper();var i=z(n.getHeaderActions(),e,t,undefined,undefined,D(e));var r=m(t,i.actions,{isNavigable:"overwrite",enabled:"overwrite",visible:"overwrite",defaultValuesExtensionFunction:"overwrite",command:"overwrite"});return{actions:V(r),commandActions:i.commandActions}};u.getHeaderActions=te;var ne=function(e){var t=e.getManifestWrapper();var n=B(t.getViewLevel(),e);var i=z(t.getFooterActions(),e,n);var r=m(n,i.actions,{isNavigable:"overwrite",enabled:"overwrite",visible:"overwrite",defaultValuesExtensionFunction:"overwrite",command:"overwrite"});return{actions:r,commandActions:i.commandActions}};u.getFooterActions=ne;var ie=function(e,t,n){var i="";var r=[].concat(W(t),W(n));var o=function(e){if(e&&e.indexOf("{=")>-1){return e.replace("{=","(").slice(0,-1)+")"}return e};var a=r.filter(function(t){if(t!==null&&t!==void 0&&t.annotationPath){var n=e.getConverterContextFor(t===null||t===void 0?void 0:t.annotationPath).getDataModelObjectPath().targetObject;if(n!==null&&n!==void 0&&n.Criticality&&(n===null||n===void 0?void 0:n.Criticality)==="UI.CriticalityType/Positive"){return true}}});var l=e.getEntitySet();if(a.length>0){var s,c;i=P(a[0].annotationPath&&e.getConverterContextFor(a[0].annotationPath).getDataModelObjectPath().targetObject,l===null||l===void 0?void 0:l.name,a[0],o((s=a[0].visible)!==null&&s!==void 0?s:"true"),o((c=a[0].enabled)!==null&&c!==void 0?c:"true"),o(j(t)),o(H(t)))}else{i=P(null,l===null||l===void 0?void 0:l.name,null,"false","false",o(j(t)),o(H(t)))}return i};u.getPrimaryAction=ie;function re(e){var t;return e!==null&&e!==void 0&&(t=e.presentation)!==null&&t!==void 0&&t.visualizations[0]?e.presentation.visualizations[0]:undefined}function oe(e,t){var n,i;return e.visible==="true"&&(e===null||e===void 0?void 0:(n=e.presentation)===null||n===void 0?void 0:n.visualizations)&&(t===null||t===void 0?void 0:t.type)==="Table"&&(t===null||t===void 0?void 0:(i=t.control)===null||i===void 0?void 0:i.type)==="GridTable"}function ae(e,t,n,i){if(oe(t,n)){var r=n.control;if(!(i==="Page"&&e.length>1)){r.rowCountMode="Auto"}}}function le(e){if(e!==null&&e!==void 0&&e.content){if(e.content.length===1){var t;if(((t=e.content[0].presentation)===null||t===void 0?void 0:t.visualizations[0]).control.type==="GridTable"){var n;((n=e.content[0].presentation)===null||n===void 0?void 0:n.visualizations[0]).control.rowCountMode="Auto"}}}}function se(e,t,n){var i;var r;var o=t.subSections;if(o.length===1){i=o[0];switch(o[0].type){case"DataVisualization":r=re(i);ae(e,i,r,n);break;case"Mixed":le(i);break;default:break}}}var ce=function(e){var t=e.getManifestWrapper();var n=m(X(e),Z(t.getSections(),e),{title:"overwrite",visible:"overwrite",subSections:{actions:"merge",title:"overwrite",sideContent:"overwrite"}});n.forEach(function(e){var i;se(n,e,t.getSectionLayout());(i=e.subSections)===null||i===void 0?void 0:i.forEach(function(e){var t;e.title=e.title==="undefined"?undefined:e.title;if(e.type==="Mixed"&&(t=e.content)!==null&&t!==void 0&&t.length){var n;var i=e.content.find(function(e){return e.type===h.Form});if(e.sideContent){if(i){i.sideContent=e.sideContent}else{e.content[0].sideContent=e.sideContent}e.sideContent=undefined}if(i&&(n=e.actions)!==null&&n!==void 0&&n.length){i.actions=e.actions;e.actions=[]}}})});return n};u.getSections=ce;function ve(e){var t,n;var i=e.getManifestWrapper();return(((t=e.getEntityType().annotations)===null||t===void 0?void 0:(n=t.UI)===null||n===void 0?void 0:n.HeaderFacets)||[]).length>0||Object.keys(i.getHeaderFacets()).length>0}function ue(e){var t=e.getManifestWrapper();return F(!ve(e),M(false),F(k(t.isHeaderEditable(),false),M(true),I(y.IsEditable)))}var de=function(e){return x(ue(e))};u.getShowHeaderContent=de;var fe=function(e){return x(I(ue(e)))};u.getExpandedImageVisible=fe;var be=function(e){var t,n;var i=e.getManifestWrapper();var r;var o=e.getEntityType();var a=m(w(e),E(i.getHeaderFacets()));var l=te(e);var s=ne(e);if(i.isHeaderEditable()&&((t=o.annotations.UI)!==null&&t!==void 0&&t.HeaderFacets||(n=o.annotations.UI)!==null&&n!==void 0&&n.HeaderInfo)){r=Q(e,a)}var c=ce(e);var v=ie(e,l.actions,s.actions);return{template:d.ObjectPage,header:{visible:i.getShowObjectPageHeader(),section:r,facets:a,actions:l.actions,showContent:de(e),hasContent:ve(e),avatar:C(e),title:{expandedImageVisible:fe(e)}},sections:c,footerActions:s.actions,headerCommandActions:l.commandActions,footerCommandActions:s.commandActions,showAnchorBar:i.getShowAnchorBar(),useIconTabBar:i.useIconTabBar(),primaryAction:v}};u.convertPage=be;return u},false);
//# sourceMappingURL=ObjectPageConverter.js.map