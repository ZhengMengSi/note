/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/base/Log","sap/fe/core/converters/controls/Common/Action","sap/fe/core/converters/controls/ObjectPage/HeaderFacet","sap/fe/core/converters/helpers/IssueManager","sap/fe/core/converters/helpers/Key","sap/fe/core/helpers/BindingToolkit","../../helpers/ConfigurableObject","../../helpers/ID","../../ManifestSettings","../../objectPage/FormMenuActions","../Common/DataVisualization","../Common/Form"],function(e,t,n,a,i,r,o,l,u,c,s,v){"use strict";var d={};var f=v.isReferenceFacet;var p=v.createFormDefinition;var m=s.getDataVisualizationConfiguration;var b=c.getVisibilityEnablementFormMenuActions;var g=c.getFormHiddenActions;var y=c.getFormActions;var I=u.ActionType;var h=l.getSubSectionID;var F=l.getSideContentID;var S=l.getFormID;var A=l.getCustomSubSectionID;var U=o.Placement;var D=o.insertCustomElements;var O=r.ref;var T=r.pathInModel;var C=r.not;var w=r.ifElse;var k=r.getExpressionFromAnnotation;var M=r.fn;var E=r.equal;var P=r.compileExpression;var j=i.KeyHelper;var L=a.IssueType;var x=a.IssueSeverity;var N=a.IssueCategory;var R=n.getStashedSettingsForHeaderFacet;var $=n.getHeaderFacetsFromManifest;var V=n.getDesignTimeMetadataSettingsForHeaderFacet;var H=t.removeDuplicateActions;var B=t.isActionNavigable;var _=t.getSemanticObjectMapping;var z=t.getEnabledForAnnotationAction;var G=t.getActionsFromManifest;var q=t.ButtonType;function X(e,t){return W(e)||Q(e,t)||ae(e,t)||K()}function K(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Q(e,t){var n=e==null?null:typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(n==null)return;var a=[];var i=true;var r=false;var o,l;try{for(n=n.call(e);!(i=(o=n.next()).done);i=true){a.push(o.value);if(t&&a.length===t)break}}catch(e){r=true;l=e}finally{try{if(!i&&n["return"]!=null)n["return"]()}finally{if(r)throw l}}return a}function W(e){if(Array.isArray(e))return e}function J(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function Y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?J(Object(n),!0).forEach(function(t){Z(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):J(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Z(e,t,n){if(t in e){Object.defineProperty(e,t,{value:n,enumerable:true,configurable:true,writable:true})}else{e[t]=n}return e}function ee(e,t){var n=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=ae(e))||t&&e&&typeof e.length==="number"){if(n)e=n;var a=0;var i=function(){};return{s:i,n:function(){if(a>=e.length)return{done:true};return{done:false,value:e[a++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r=true,o=false,l;return{s:function(){n=n.call(e)},n:function(){var e=n.next();r=e.done;return e},e:function(e){o=true;l=e},f:function(){try{if(!r&&n.return!=null)n.return()}finally{if(o)throw l}}}}function te(e){return re(e)||ie(e)||ae(e)||ne()}function ne(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ae(e,t){if(!e)return;if(typeof e==="string")return oe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor)n=e.constructor.name;if(n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return oe(e,t)}function ie(e){if(typeof Symbol!=="undefined"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function re(e){if(Array.isArray(e))return oe(e)}function oe(e,t){if(t==null||t>e.length)t=e.length;for(var n=0,a=new Array(t);n<t;n++){a[n]=e[n]}return a}var le;(function(e){e["Unknown"]="Unknown";e["Form"]="Form";e["DataVisualization"]="DataVisualization";e["XMLFragment"]="XMLFragment";e["Placeholder"]="Placeholder";e["Mixed"]="Mixed"})(le||(le={}));d.SubSectionType=le;var ue=["com.sap.vocabularies.UI.v1.LineItem","com.sap.vocabularies.UI.v1.Chart","com.sap.vocabularies.UI.v1.PresentationVariant","com.sap.vocabularies.UI.v1.SelectionPresentationVariant"];function ce(e,t,n){var a=e.reduce(function(e,t){switch(t.$Type){case"com.sap.vocabularies.UI.v1.ReferenceFacet":e.push(t);break;case"com.sap.vocabularies.UI.v1.CollectionFacet":if(t.Facets.find(function(e){return e.$Type==="com.sap.vocabularies.UI.v1.CollectionFacet"})){e.splice.apply(e,[e.length,0].concat(te(t.Facets)))}else{e.push(t)}break;case"com.sap.vocabularies.UI.v1.ReferenceURLFacet":break}return e},[]);return a.map(function(e){var i;return be(e,a,t,0,!(e!==null&&e!==void 0&&(i=e.Facets)!==null&&i!==void 0&&i.length),n)})}d.createSubSections=ce;function se(e){var t=$(e.getManifestWrapper().getHeaderFacets());var n=[];Object.keys(t).forEach(function(e){n.push(t[e]);return n});var a=n.reduce(function(e,t){if(t.templateEdit){e.push(t)}return e},[]);return a.map(function(e){return ve(e)})}d.createCustomHeaderFacetSubSections=se;function ve(e){var t=A(e.key);var n={id:t,key:e.key,title:e.title,type:le.XMLFragment,template:e.templateEdit||"",visible:e.visible,level:1,sideContent:undefined,stashed:e.stashed,flexSettings:e.flexSettings,actions:{}};return n}var de=function(e,t){var n,a;return((n=e.ID)===null||n===void 0?void 0:n.toString())||((a=e.Label)===null||a===void 0?void 0:a.toString())||t};function fe(e,t,n){var a=g(t,n)||[],i=y(t,n),r=G(i,n,e,undefined,undefined,a),o=D(e,r.actions,{command:"overwrite"});return{actions:o?b(H(o)):e,commandActions:r.commandActions}}function pe(e,t){var n=new Array;switch(e.$Type){case"com.sap.vocabularies.UI.v1.CollectionFacet":n=e.Facets.filter(function(e){return f(e)}).reduce(function(e,n){return ye(e,n,t)},[]);break;case"com.sap.vocabularies.UI.v1.ReferenceFacet":n=ye([],e,t);break;default:break}return fe(n,e,t)}function me(e){var t=E(k(e),true);return P(w(t,q.Ghost,q.Transparent))}function be(t,n,a,i,r,o){var l,u,c,s,v;var d=h({Facet:t});var f=(l=t.annotations)===null||l===void 0?void 0:(u=l.UI)===null||u===void 0?void 0:u.Hidden;var b=P(C(E(true,k(f))));var g=b&&typeof b==="string"&&b.indexOf("{=")===0&&(f===null||f===void 0?void 0:f.type)!=="Path";var y=b&&g?b.substring(b.indexOf("{=")+2,b.lastIndexOf("}")):false;var I=P(k(t.Label));var F={id:d,key:de(t,d),title:I,type:le.Unknown,annotationPath:a.getEntitySetBasedAnnotationPath(t.fullyQualifiedName),visible:b,isVisibilityDynamic:g,level:i,sideContent:undefined};if(o){F.stashed=R(t,t,a);F.flexSettings={designtime:V(t,t,a)}}var S="";i++;switch(t.$Type){case"com.sap.vocabularies.UI.v1.CollectionFacet":var A=t.Facets;var U=A.map(function(e,t){return{index:t,facet:e}}).filter(function(e){var t,n;var a=e.facet;return ue.includes((t=a.Target)===null||t===void 0?void 0:(n=t.$target)===null||n===void 0?void 0:n.term)});var D=A.filter(function(e){return!U.find(function(t){return t.facet===e})});if(U.length>0){var O=[];var T=[];var w=[];var M=ee(U),j;try{for(M.s();!(j=M.n()).done;){var L=j.value.facet;O.push(be(L,[],a,i,A.length===1,o))}}catch(e){M.e(e)}finally{M.f()}if(D.length>0){e.warning("Warning: CollectionFacet '".concat(t.ID,"' includes a combination of either a chart or a table and other content. This can lead to rendering issues. Consider moving the chart or table into a separate CollectionFacet."));t.Facets=D;T.push(be(t,[],a,i,r,o))}if(U.find(function(e){var t=e.index;return t===0})){w.push.apply(w,O);w.push.apply(w,T)}else{w.push.apply(w,T);w.push.apply(w,O)}var x=Y(Y({},F),{},{type:le.Mixed,level:i,content:w});return x}else{var N=pe(t,a),$=Y(Y({},F),{},{type:le.Form,formDefinition:p(t,b,a,N.actions),level:i,actions:N.actions.filter(function(e){return e.facetName===undefined}),commandActions:N.commandActions});return $}case"com.sap.vocabularies.UI.v1.ReferenceFacet":if(!t.Target.$target){S="Unable to find annotationPath ".concat(t.Target.value)}else{switch(t.Target.$target.term){case"com.sap.vocabularies.UI.v1.LineItem":case"com.sap.vocabularies.UI.v1.Chart":case"com.sap.vocabularies.UI.v1.PresentationVariant":case"com.sap.vocabularies.UI.v1.SelectionPresentationVariant":var H=m(t.Target.value,Se(t,n,a),a,undefined,o);var B=((c=H.visualizations[0])===null||c===void 0?void 0:(s=c.annotation)===null||s===void 0?void 0:s.title)||((v=H.visualizations[0])===null||v===void 0?void 0:v.title);var _=ge(r,F.title,B);var z=b&&I!=="undefined"&&(I?b:false);var G=Y(Y({},F),{},{type:le.DataVisualization,level:i,presentation:H,showTitle:_,titleVisible:g?"{= (".concat(y,") && ('").concat(I,"' !=='undefined') && (").concat(_," ? true : false) }"):z});return G;case"com.sap.vocabularies.UI.v1.FieldGroup":case"com.sap.vocabularies.UI.v1.Identification":case"com.sap.vocabularies.UI.v1.DataPoint":case"com.sap.vocabularies.UI.v1.StatusInfo":case"com.sap.vocabularies.Communication.v1.Contact":var q=pe(t,a),X=Y(Y({},F),{},{type:le.Form,level:i,formDefinition:p(t,b,a,q.actions),actions:q.actions.filter(function(e){return e.facetName===undefined}),commandActions:q.commandActions});return X;default:S="For ".concat(t.Target.$target.term," Fragment");break}}break;case"com.sap.vocabularies.UI.v1.ReferenceURLFacet":S="For Reference URL Facet";break;default:break}var K=Y(Y({},F),{},{text:S});return K}d.createSubSection=be;function ge(e,t,n){if(e&&n===t){return false}return true}function ye(e,t,n){var a=t.Target.$target;var i=t.Target.value;var r={};var o=[];var l=i.split("@"),u=X(l,1),c=u[0];if(c.length>0){if(c.lastIndexOf("/")===c.length-1){c=c.substr(0,c.length-1)}}else{c=undefined}if(a){switch(a.term){case"com.sap.vocabularies.UI.v1.FieldGroup":o=a.Data;r=G(n.getManifestControlConfiguration(a).actions,n,undefined,undefined,undefined,undefined,t.fullyQualifiedName).actions;break;case"com.sap.vocabularies.UI.v1.Identification":case"com.sap.vocabularies.UI.v1.StatusInfo":if(a.qualifier){o=a}break;default:break}}e=o.reduce(function(e,i){var r,o,l,u,s,v,d,f,p,m,b,g,y,h,F,A;switch(i.$Type){case"com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation":if(((r=i.RequiresContext)===null||r===void 0?void 0:r.valueOf())===true){n.getDiagnostics().addIssue(N.Annotation,x.Low,L.MALFORMED_DATAFIELD_FOR_IBN.REQUIRESCONTEXT)}if(((o=i.Inline)===null||o===void 0?void 0:o.valueOf())===true){n.getDiagnostics().addIssue(N.Annotation,x.Low,L.MALFORMED_DATAFIELD_FOR_IBN.INLINE)}if(((l=i.Determining)===null||l===void 0?void 0:l.valueOf())===true){n.getDiagnostics().addIssue(N.Annotation,x.Low,L.MALFORMED_DATAFIELD_FOR_IBN.DETERMINING)}var U={};if(i.Mapping){U.semanticObjectMapping=_(i.Mapping)}e.push({type:I.DataFieldForIntentBasedNavigation,id:S({Facet:t},i),key:j.generateKeyFromDataField(i),text:(u=i.Label)===null||u===void 0?void 0:u.toString(),annotationPath:"",enabled:i.NavigationAvailable!==undefined?P(E(k((s=i.NavigationAvailable)===null||s===void 0?void 0:s.valueOf()),true)):"true",visible:P(C(E(k((v=i.annotations)===null||v===void 0?void 0:(d=v.UI)===null||d===void 0?void 0:(f=d.Hidden)===null||f===void 0?void 0:f.valueOf()),true))),buttonType:me((p=i.annotations)===null||p===void 0?void 0:(m=p.UI)===null||m===void 0?void 0:m.Emphasized),press:P(M("._intentBasedNavigation.navigate",[k(i.SemanticObject),k(i.Action),U])),customData:P({semanticObject:k(i.SemanticObject),action:k(i.Action)})});break;case"com.sap.vocabularies.UI.v1.DataFieldForAction":var D=n.getManifestControlConfiguration(a).actions;var w=j.generateKeyFromDataField(i);e.push({type:I.DataFieldForAction,id:S({Facet:t},i),key:w,text:(b=i.Label)===null||b===void 0?void 0:b.toString(),annotationPath:"",enabled:z(n,i.ActionTarget),binding:c?"{ 'path' : '".concat(c,"'}"):undefined,visible:P(C(E(k((g=i.annotations)===null||g===void 0?void 0:(y=g.UI)===null||y===void 0?void 0:(h=y.Hidden)===null||h===void 0?void 0:h.valueOf()),true))),requiresDialog:Ie(i.ActionTarget),buttonType:me((F=i.annotations)===null||F===void 0?void 0:(A=F.UI)===null||A===void 0?void 0:A.Emphasized),press:P(M("invokeAction",[i.Action,{contexts:M("getBindingContext",[],T("","$source")),invocationGrouping:i.InvocationGrouping==="UI.OperationGroupingType/ChangeSet"?"ChangeSet":"Isolated",label:k(i.Label),model:M("getModel",[],T("/","$source")),isNavigable:B(D&&D[w])}],O(".editFlow"))),facetName:i.Inline?t.fullyQualifiedName:undefined});break;default:break}return e},e);return D(e,r)}function Ie(e){if(e){var t,n;var a=(t=e.annotations)===null||t===void 0?void 0:(n=t.Common)===null||n===void 0?void 0:n.IsActionCritical;if(e.parameters.length>1||a){return"Dialog"}else{return"None"}}else{return"None"}}d.isDialog=Ie;function he(e,t){var n={};Object.keys(e).forEach(function(a){return n[a]=Fe(e[a],a,t)});return n}d.createCustomSubSections=he;function Fe(e,t,n){var a=e.sideContent?{template:e.sideContent.template,id:F(t),visible:false,equalSplit:e.sideContent.equalSplit}:undefined;var i=e.position;if(!i){i={placement:U.After}}var r=e.visible!==undefined?e.visible:true;var o=r&&typeof r==="string"&&r.indexOf("{=")===0;var l=G(e.actions,n);var u={type:le.Unknown,id:e.id||A(t),actions:l.actions,key:t,title:e.title,level:1,position:i,visible:e.visible!==undefined?e.visible:true,sideContent:a,isVisibilityDynamic:o};if(e.template||e.name){u.type=le.XMLFragment;u.template=e.template||e.name||""}else{u.type=le.Placeholder}return u}d.createCustomSubSection=Fe;function Se(e,t,n){var a=n.getManifestWrapper();if(a.useIconTabBar()){return Ae(e,t)}else{var i,r,o,l,u,c;var s=n.getEntityType();if((i=s.annotations)!==null&&i!==void 0&&(r=i.UI)!==null&&r!==void 0&&(o=r.Facets)!==null&&o!==void 0&&o.length&&((l=s.annotations)===null||l===void 0?void 0:(u=l.UI)===null||u===void 0?void 0:(c=u.Facets)===null||c===void 0?void 0:c.length)>1){return Ae(e,t)}else{return true}}}function Ae(e,t){return t.every(function(t){if(t!==e){if(t.$Type==="com.sap.vocabularies.UI.v1.ReferenceFacet"){var n,a,i,r,o;var l=t;if(((n=l.Target)===null||n===void 0?void 0:(a=n.$target)===null||a===void 0?void 0:a.term)==="com.sap.vocabularies.UI.v1.LineItem"||((i=l.Target)===null||i===void 0?void 0:(r=i.$target)===null||r===void 0?void 0:r.term)==="com.sap.vocabularies.UI.v1.PresentationVariant"||((o=l.Target.$target)===null||o===void 0?void 0:o.term)==="com.sap.vocabularies.UI.v1.SelectionPresentationVariant"){var u,c,s,v;return((u=l.annotations)===null||u===void 0?void 0:(c=u.UI)===null||c===void 0?void 0:c.Hidden)!==undefined?(s=l.annotations)===null||s===void 0?void 0:(v=s.UI)===null||v===void 0?void 0:v.Hidden:false}return true}else{var d=t;return d.Facets.every(function(e){var t,n,a,i,r,o;var l=e;if(((t=l.Target)===null||t===void 0?void 0:(n=t.$target)===null||n===void 0?void 0:n.term)==="com.sap.vocabularies.UI.v1.LineItem"||((a=l.Target)===null||a===void 0?void 0:(i=a.$target)===null||i===void 0?void 0:i.term)==="com.sap.vocabularies.UI.v1.PresentationVariant"||((r=l.Target)===null||r===void 0?void 0:(o=r.$target)===null||o===void 0?void 0:o.term)==="com.sap.vocabularies.UI.v1.SelectionPresentationVariant"){var u,c,s,v;return((u=l.annotations)===null||u===void 0?void 0:(c=u.UI)===null||c===void 0?void 0:c.Hidden)!==undefined?(s=l.annotations)===null||s===void 0?void 0:(v=s.UI)===null||v===void 0?void 0:v.Hidden:false}return true})}}return true})}return d},false);
//# sourceMappingURL=SubSection.js.map