/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["../utils/SelectionVariantHelper","sap/fe/navigation/SelectionVariant","sap/m/DynamicDateUtil","sap/ui/comp/util/DateTimeUtil","sap/ui/core/format/DateFormat","../utils/AppConstants","sap/ui/model/odata/v2/ODataModel"],function(e,a,t,r,i,n,o){function u(t,r){var i=t.descriptorContent["sap.card"].configuration.parameters;var n=t.descriptorContent["sap.card"]["data"]["request"];var u=false;if(n&&n["batch"]){u=true}var l=new a;var p=i._relevantODataFilters.value;var v=i._relevantODataParameters.value;var d=i._semanticDateRangeSetting,m=[];if(d){d=JSON.parse(d.value);m=Object.keys(d)||[]}p.forEach(function(e){var t=new a(i[e].value);var r=t.getSelectOption(e);var n=[];if(r&&r.length){if(m.includes(e)){n=f(r[0],"Filter");if(n.length){r[0].Low=n[0];r[0].High=n[1]?n[1]:null;if(r[0].Low&&r[0].High&&r[0].Option!=="BT"){r[0].Option="BT"}l.massAddSelectOption(e,r)}else if(o&&o.prototype.formatValue&&r[0]){r[0].Low=o.prototype.formatValue(r[0].Low,"Edm.DateTime");if(r[0].High){r[0].High=o.prototype.formatValue(r[0].High,"Edm.DateTime")}l.massAddSelectOption(e,r)}}else{l.massAddSelectOption(e,r)}}});v.forEach(function(e){var a="";if(i[e].value&&typeof i[e].value==="string"){a=i[e].value.toString()}else if(i[e].value.value){a=i[e].value.value.toString()}if(i[e].type==="datetime"&&!m.includes(e)&&!a.includes("datetime")){if(o&&o.oData){a=o.oData.formatValue(a,"Edm.DateTime");l.addParameter(e,a)}}else if(i[e].type==="datetime"&&m.includes(e)){a=f(a,"Parameter");l.addParameter(e,a[0])}else{l.addParameter(e,a)}});var h=i._entitySet.value;var g=h;if(v.length){var S={};v.forEach(function(e){S[e]=i[e].type});g+=e.getParameterQueryFromSV(l,S);var T=g;if(T&&Array.isArray(T.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm))&&T.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm).length){g=c(T)}}if(i._urlSuffix.value){g+=i._urlSuffix.value}var y={};p.forEach(function(e){y[e]=i[e].type});var D=e.getFilterQueryFromSV(l,y);var E=D;if(E&&Array.isArray(E.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm))&&E.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm).length){D=c(E)}var O="",A="",_="",H="",Q={header:"",content:""};if(i._headerDataUrl&&i._headerDataUrl.value){O=s(i,"_header",D,t.descriptorContent["sap.card"].type);A=O?g+"?"+O:g;i._headerDataUrl.value=r._headerDataUrl=A}else if(u&&i._headerDataUrl){O=s(i,"_header",D,t.descriptorContent["sap.card"].type);A=O?g+"?"+O:g;Q.header=A}if(i._contentDataUrl&&i._contentDataUrl.value){_=s(i,"_content",D,t.descriptorContent["sap.card"].type);H=_?g+"?"+_:g;i._contentDataUrl.value=r._contentDataUrl=H}else if(i._contentDataUrl){_=s(i,"_content",D,t.descriptorContent["sap.card"].type);H=_?g+"?"+_:g;Q.content=H;return Q}}function l(e,a){var t=u(e);if(a==="header"&&t.header){return t.header}else if(a==="content"&&t.content){return t.content}}function s(e,a,t,r){var i=[];if(t){i.push(t)}if(e[a+"SelectQuery"]&&e[a+"SelectQuery"].value){i.push(e[a+"SelectQuery"].value)}if(e[a+"ExpandQuery"]&&e[a+"ExpandQuery"].value){i.push(e[a+"ExpandQuery"].value)}if(e[a+"SortQuery"]&&e[a+"SortQuery"].value){var n=e[a+"SortQuery"].value;i.push(decodeURI(n)===n?encodeURI(n):n)}if(r==="Table"||r==="List"){i.push("$inlinecount=allpages");i.push("$skip=0&$top=13")}else{if(e[a+"TopQuery"]&&e[a+"TopQuery"].value){i.push(e[a+"TopQuery"].value)}if(e[a+"SkipQuery"]&&e[a+"SkipQuery"].value){i.push(e[a+"SkipQuery"].value)}}return i.length?i.join("&"):null}function c(e){var a=e.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm).length;var t=function(){var a=e.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm)[0];var t=a;t=t.replace("%27","");var r=t.lastIndexOf("%27");var i=t.substr(0,r)+t.substr(r+3,t.length-1);return i};for(var r=0;r<a;r++){e=e.replace(e.match(/%27datetime[a-zA-Z0-9%-:]*[,)%2c]/gm)[0],t)}return e}function f(e,a){var r,i=[],o=[];if(a==="Parameter"){r=e}else if(a==="Filter"){e=typeof e==="string"?JSON.parse(e):e;r=e.Low;if(n.DATE_OPTIONS.SPECIAL_RANGE.includes(r)){i=e.High.split(",")}}var u;if(n.DATE_OPTIONS.RANGE_OPTIONS.includes(r)||n.DATE_OPTIONS.SINGLE_OPTIONS.includes(r)){if(a==="Filter"){u=t.toDates({values:i,operator:r});o.push(u[0].oDate);o.push(u[1].oDate)}else{u=t.toDates({values:i,operator:r});o.push(u[0].oDate)}}if(o.length){o=p(o,true);return o}return[]}function p(e,a){var t;e.forEach(function(n,o){n=r.localToUtc(n);n=r.normalizeDate(n,true);if(a){t=i.getDateInstance({pattern:"'datetime'''yyyy-MM-dd'T'HH:mm:ss''",calendarType:"Gregorian"});e[o]=t.format(n,true)}else{var u=i.getDateInstance({pattern:"''yyyy-MM-dd'T'HH:mm:ss.SSS''",calendarType:"Gregorian"});var l=n instanceof Date?n:new Date(n);var s=u.format(l);e[o]=String(s).replace(/'/g,"")}});return e}function v(e,a,r){var i=r;if(e&&a){var n=e.operator;if(n!=="DATE"){return n}else{return n.values[0]}}if(!a){var o=e.operator;var u=e.values;var l="";if(o){switch(o){case"DATE":case"DATERANGE":case"SPECIFICMONTH":l="";if(typeof i==="string"){l=i}var s=t.toDates(e);u=s;var c=p(u,false);if(!c[1]){c[1]=""}var f={Low:c[0],High:c[1],Option:"BT",Text:l};if(f){f.Text=l;return f}break;case"FROM":case"TO":l="";if(typeof i==="string"){l=i}var v=p(u,false),d;d=o==="FROM"?"GE":"LE";var m={Low:v[0],High:"",Option:d,Text:l};if(m){m.Text=l;return m}break;case"LASTDAYS":case"LASTWEEKS":case"LASTMONTHS":case"LASTQUARTERS":case"LASTYEARS":case"NEXTDAYS":case"NEXTWEEKS":case"NEXTMONTHS":case"NEXTQUARTERS":case"NEXTYEARS":l="";if(typeof i==="string"){l=i}return{Low:o,High:u[0].toString(),Option:"BT",Text:l};case"TODAYFROMTO":l="";if(typeof i==="string"){l=i}var h=u&&u[0];var g=u&&u[1];return{Low:o,High:h.toString()+","+g.toString(),Option:"BT",Text:l};default:l="";if(typeof i==="string"){l=i.substring(0,i.indexOf("(")-1)}return{Low:o,High:null,Option:"EQ",Text:l}}}}}return{processPrivateParams:u,formatSemanticDateTime:f,semanticHeaderContentUrl:l,getDateRangeValue:v}});
//# sourceMappingURL=UrlGenerateHelper.js.map