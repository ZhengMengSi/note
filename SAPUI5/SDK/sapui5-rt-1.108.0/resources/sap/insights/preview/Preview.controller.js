/*!
 * 
		SAP UI development toolkit for HTML5 (SAPUI5)
		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ui/model/resource/ResourceModel","sap/m/MessageToast","../CardHelper"],function(e,t,i,s,r){return e.extend("sap.insights.preview.Preview",{onInit:function(){this.getView().setModel(new t({descriptor:{},isMessageVisible:false,message:"",messageType:"Information"}),"cardPreviewModel");this.I18_BUNDLE=sap.ui.getCore().getLibraryResourceBundle("sap.insights");this.getView().setModel(new i({bundle:this.I18_BUNDLE}),"i18n")},save:function(){var e=this.getView().getModel("cardPreviewModel").getProperty("/descriptor");if(e["sap.card"].header.title){e["sap.insights"].visible=e["sap.insights"].visible||false;this._getPreviewDialog().setBusy(true);r.getServiceAsync().then(function(e){var t=this.getView().getModel("cardPreviewModel").getProperty("/descriptor");t["sap.insights"].visible=t["sap.insights"].visible||false;e.createCard(t).then(function(e){s.show("Card created Successfully.");this._getPreviewDialog().setBusy(false);this._getPreviewDialog().close()}.bind(this)).catch(function(e){var t=this.getView().getModel("cardPreviewModel");t.setProperty("/message",e.message);t.setProperty("/isMessageVisible",true);t.setProperty("/messageType","Error");this._getPreviewDialog().setBusy(false)}.bind(this))}.bind(this))}},cancel:function(){this._getPreviewDialog().close()},handleTitleChange:function(e){var t=e.getSource();var i=t.getValue();var s=this.getView().byId("insightsCard");if(i){t.setValueState("None");t.setValueStateText("");s.getCardHeader().setTitle(i)}else{t.setValueState("Error");t.setValueStateText(this.I18_BUNDLE.getText("INT_Preview_Title_ValueStateText"))}},handleSubTitleChange:function(e){var t=e.getSource();var i=t.getValue();var s=this.getView().byId("insightsCard");s.getCardHeader().setSubtitle(i)},handleVisibilityChange:function(e){var t=this.getView().getModel("cardPreviewModel");var i=e.getParameter("state");var s=t.getProperty("/descriptor");s["sap.insights"].visible=i;t.setProperty("/descriptor",s)},showCardSelectionDialog:function(){this._getPreviewDialog().close();var e=this.getView().getModel("cardPreviewModel");var t=e.getProperty("/descriptor");r.getServiceAsync("UIService").then(function(e){e._showCardSelectionDialog(t)})},_getPreviewDialog:function(){return this.getView().byId("previewDialog")},showPreview:function(e){var t=this.getView().getModel("cardPreviewModel");t.setProperty("/message","");t.setProperty("/isMessageVisible",false);t.setProperty("/messageType","Information");return r.getServiceAsync().then(function(i){return i.getUserCards().then(function(i){var s=i.filter(function(e){return e.visibility});if(s.length>9){e["sap.insights"].visible=false;t.setProperty("/message",this.I18_BUNDLE.getText("insightMaxCardText"));t.setProperty("/isMessageVisible",true);t.setProperty("/messageType","Warning")}t.setProperty("/descriptor",e);this._getPreviewDialog().open();return Promise.resolve()}.bind(this))}.bind(this))}})});
//# sourceMappingURL=Preview.controller.js.map