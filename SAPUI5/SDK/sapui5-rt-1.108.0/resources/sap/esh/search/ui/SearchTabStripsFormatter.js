/*! 
 * SAPUI5

		(c) Copyright 2009-2021 SAP SE. All rights reserved
	 
 */
(function(){sap.ui.define(["./sinaNexTS/sina/DataSourceResultSet","./sinaNexTS/sina/UserCategoryDataSource"],function(e,t){function r(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function a(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}function i(e,t,r){if(t)a(e.prototype,t);if(r)a(e,r);Object.defineProperty(e,"prototype",{writable:false});return e}var n=e["DataSourceResultSet"];var o=t["UserCategoryDataSource"];var u=function(){function e(t,a){r(this,e);this.dataSource=t;this.count=a;this.children=[];this.parent=null}i(e,[{key:"equals",value:function e(t){return this===t}},{key:"setCount",value:function e(t){this.count=t}},{key:"getAncestors",value:function e(){var t=[];var r=this;while(r.parent){t.push(r.parent);r=r.parent}return t}},{key:"getChildren",value:function e(){var t=[];for(var r=0;r<this.children.length;++r){var a=this.children[r];if(a.unsureWhetherNodeisBelowRoot){continue}t.push(a)}return t}},{key:"getChildrenSortedByCount",value:function e(){var t=this.getChildren();t.sort(function(e,t){return t.count-e.count});return t}},{key:"clearChildren",value:function e(){for(var t=0;t<this.children.length;++t){var r=this.children[t];r.parent=null}this.children=[]}},{key:"appendNode",value:function e(t){t.parent=this;this.children.push(t)}},{key:"appendNodeAtIndex",value:function e(t,r){t.parent=this;this.children.splice(r,0,t)}},{key:"removeChildNode",value:function e(t){var r=this.children.indexOf(t);if(r<0){return}this.children.splice(r,1);t.parent=null}},{key:"hasChild",value:function e(t){return this.children.indexOf(t)>-1}},{key:"hasSibling",value:function e(t){if(this.equals(t)){return false}var r=this.parent;if(!r){return false}if(r.hasChild(t)){return true}return false}},{key:"_findNode",value:function e(t,r){if(this.dataSource===t){r.push(this);return}for(var a=0;a<this.children.length;++a){var i=this.children[a];i._findNode(t,r);if(r.length>0){return}}}}]);return e}();var s=function(){function e(t){r(this,e);this.rootNode=new u(t,null)}i(e,[{key:"reset",value:function e(){this.rootNode=null}},{key:"invalidate",value:function e(t){var r=this.findNode(t);if(!r){this.rootNode.children=[];this.rootNode.count=0;return}var a=null;while(r){r.children=a?[a]:[];r.count=null;if(a){a.count=null}a=r;r=r.parent}}},{key:"findNode",value:function e(t){if(!this.rootNode){return null}var r=[];this.rootNode._findNode(t,r);return r.length>0?r[0]:null}},{key:"hasChild",value:function e(t,r){if(r===this.rootNode.dataSource){return false}var a=this.findNode(t);if(!a){return false}var i=this.findNode(r);if(!i){return false}return a.hasChild(i)}},{key:"hasSibling",value:function e(t,r){if(r===this.rootNode.dataSource){return false}var a=this.findNode(t);if(!a){return false}var i=this.findNode(r);if(!i){return false}return a.hasSibling(i)}},{key:"updateFromPerspective",value:function e(t,r,a){var i;if(r){i=r.totalCount}var n=this.findNode(t);if(!n){n=new u(t,i);n.unsureWhetherNodeisBelowRoot=true;this.rootNode.appendNode(n)}n.setCount(i);if(t===a.allDataSource||a.isUserCategory()){n.setCount(n.count+a.getProperty("/appCount"))}this.updateFromPerspectiveChildDataSources(n,r,a);this.updateAppTreeNode(t,a)}},{key:"updateAppTreeNode",value:function e(t,r){if(r.isBusinessObject()||r.isOtherCategory()&&!r.isAppCategory()&&!r.isUserCategory()||r.isUserCategory()&&!t.isIncludeApps()){return}var a=this.findNode(r.appDataSource);if(a){this.rootNode.removeChildNode(a)}var i=r.getProperty("/appCount");if(i===0&&t!==r.appDataSource){return}a=new u(r.appDataSource,i);this.rootNode.appendNodeAtIndex(a,0)}},{key:"updateFromPerspectiveChildDataSources",value:function e(t,r,a){function i(e){return e instanceof n}if(!r||t.dataSource===a.appDataSource){return}var s=r.facets;if(s.length===0){t.clearChildren();return}if(!i(s[0])){return}var l=s[0];if(l.type!==a.sinaNext.FacetType.DataSource){return}var d=l.items;t.clearChildren();if(a.favDataSource&&t.dataSource===a.allDataSource){var h={dataSource:a.favDataSource,dimensionValueFormatted:a.favDataSource.labelPlural,measureValue:0,measureValueFormatted:""};d.splice(0,0,h)}var c=a.getProperty("/appCount");if(a.isUserCategory()&&t.dataSource instanceof o&&t.dataSource.isIncludeApps()&&c>0){var f=this.findNode(a.appDataSource);if(!f){f=new u(a.appDataSource,c)}f.setCount(c);t.appendNode(f)}for(var p=0;p<d.length;++p){var v=d[p];var S=v.dataSource;var N=this.findNode(S);if(!N){N=new u(S,v.measureValue)}if(N.unsureWhetherNodeisBelowRoot){N.unsureWhetherNodeisBelowRoot=false;this.rootNode.removeChildNode(N)}if(N.parent){N.parent.removeChildNode(N)}N.setCount(v.measureValue);t.appendNode(N)}}}]);return e}();var l=function(){function e(t){r(this,e);this.tree=new s(t)}i(e,[{key:"format",value:function e(t,r,a){this.tree.updateFromPerspective(t,r,a);var i=this.generateTabStrips(t,a);return i}},{key:"invalidate",value:function e(t){if(this.tree){this.tree.invalidate(t)}}},{key:"generateTabStrips",value:function e(t,r){var a=this.doGenerateTabStrips(t,r);var i=r.config.tabStripsFormatter(a.strips);if(i.indexOf(a.selected)<0){i.splice(0,0,a.selected)}a.strips=i;return a}},{key:"doGenerateTabStrips",value:function e(t,r){var a=9999;var i,n,o;var u={strips:[],selected:null};var s=this.tree.findNode(t);if(!s){if(t!==r.allDataSource){u.strips.push(r.allDataSource)}u.strips.push(t);u.selected=t;return u}if(s.dataSource===r.allDataSource){u.strips.push(r.allDataSource);o=s.getChildrenSortedByCount();for(i=0;i<o.length&&u.strips.length<a;++i){n=o[i];u.strips.push(n.dataSource)}u.selected=r.allDataSource;return u}if(s.parent===this.tree.rootNode&&!s.unsureWhetherNodeisBelowRoot){u.strips.push(r.allDataSource);var l=false;o=this.tree.rootNode.getChildrenSortedByCount();for(i=0;i<o.length;++i){n=o[i];if(l){if(u.strips.length>=a){break}u.strips.push(n.dataSource)}else{if(u.strips.length<a-1||s===n){u.strips.push(n.dataSource);if(s===n){l=true}}}}if(o.length===0){u.strips.push(s.dataSource)}u.selected=s.dataSource;return u}u.strips.push(r.allDataSource);u.strips.push(s.dataSource);u.selected=s.dataSource;return u}}]);return e}();var d={__esModule:true};d.Tree=s;d.Formatter=l;return d})})();
//# sourceMappingURL=SearchTabStripsFormatter.js.map