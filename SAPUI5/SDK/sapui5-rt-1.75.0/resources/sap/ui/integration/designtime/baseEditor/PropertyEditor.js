/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Control","sap/ui/integration/designtime/baseEditor/util/findClosestInstance","sap/ui/integration/designtime/baseEditor/util/createPromise","sap/ui/integration/designtime/baseEditor/util/escapeParameter","sap/base/util/isPlainObject","sap/ui/integration/designtime/baseEditor/propertyEditor/PropertyEditorFactory","sap/base/util/restricted/_merge"],function(C,f,c,e,i,P,_){"use strict";var a="config";var b="propertyName";var d=C.extend("sap.ui.integration.designtime.baseEditor.PropertyEditor",{metadata:{properties:{propertyName:{type:"string"},renderLabel:{type:"boolean"},config:{type:"object"}},aggregations:{propertyEditor:{type:"sap.ui.integration.designtime.baseEditor.propertyEditor.BasePropertyEditor",multiple:false,visibility:"hidden"}},associations:{editor:{type:"sap.ui.integration.designtime.baseEditor.BaseEditor",multiple:false}},events:{editorChange:{parameters:{previousEditor:{type:"sap.ui.integration.designtime.baseEditor.BaseEditor"},editor:{type:"sap.ui.integration.designtime.baseEditor.BaseEditor"}}},propertyEditorChange:{parameters:{previousPropertyEditor:{type:"sap.ui.integration.designtime.baseEditor.propertyEditor.BasePropertyEditor"},propertyEditor:{type:"sap.ui.integration.designtime.baseEditor.propertyEditor.BasePropertyEditor"}}},configChange:{parameters:{previousConfig:{type:"object"},config:{type:"object"}}},propertyNameChange:{parameters:{previousPropertyName:{type:"string"},propertyName:{type:"string"}}},ready:{},valueChange:{path:{type:"string"},value:{type:"any"}}}},_bEditorAutoDetect:false,_sCreatedBy:null,constructor:function(){C.prototype.constructor.apply(this,e(arguments,"config"));if(!this.getEditor()){this._bEditorAutoDetect=true;}this._propagationListener=this._propagationListener.bind(this);this.attachEditorChange(function(){if(this._sCreatedBy){this._removePropertyEditor();}this._initPropertyEditor();});this.attachConfigChange(function(){if(this._sCreatedBy){this._removePropertyEditor();}this._initPropertyEditor();});this.attachPropertyNameChange(function(){if(this._sCreatedBy===b){this._removePropertyEditor();}if(this._sCreatedBy!==a){this._initPropertyEditor();}});this._initPropertyEditor();},renderer:function(r,o){r.openStart("div",o);r.openEnd();r.renderControl(o.getAggregation("propertyEditor"));r.close("div");}});d.prototype.getEditor=function(){return sap.ui.getCore().byId(this.getAssociation("editor"));};d.prototype.setConfig=function(m){var p=this.getConfig();if(p!==m&&(!i(p)||!i(m)||JSON.stringify(p)!==JSON.stringify(m))){this.setProperty("config",m);this.fireConfigChange({previousConfig:p,config:m});}};d.prototype.setPropertyName=function(p){var s=this.getPropertyName();if(s!==p){this.setProperty("propertyName",p);this.firePropertyNameChange({previousPropertyName:s,propertyName:p});}};d.prototype.setEditor=function(E){var p=this.getEditor();var o=typeof E==="string"?sap.ui.getCore().byId(E):E;if(p!==o){this.setAssociation("editor",E);var o=this.getEditor();this.fireEditorChange({previousEditor:p,editor:o});}};d.prototype.destroy=function(){if(this._fnCancelInit){this._fnCancelInit();}this._removePropertyEditor();C.prototype.destroy.apply(this,arguments);};d.prototype._removePropertyEditor=function(){var p=this.getAggregation("propertyEditor");if(p){this.setAggregation("propertyEditor",null);p.detachReady(this._onPropertyEditorReady,this);switch(this._sCreatedBy){case a:p.destroy();break;case b:p.setParent(null);break;}this._sCreatedBy=null;this.firePropertyEditorChange({propertyEditor:null});}};d.prototype.isReady=function(){var n=this.getAggregation("propertyEditor");return n&&n.isReady()||false;};d.prototype.ready=function(){return new Promise(function(r){var g=function(n){n.ready().then(r);};var n=this.getAggregation("propertyEditor");if(n){g(n);}else{var w=function(E){var n=E.getParameter("propertyEditor");if(n){this.detachPropertyEditorChange(w,this);g(n);}};this.attachPropertyEditorChange(w,this);}}.bind(this));};d.prototype._onPropertyEditorReady=function(){this.fireReady();};d.prototype._initPropertyEditor=function(){if(!this.getEditor()){return;}if(this.getConfig()||(!this.getBindingInfo("config")&&this.getPropertyName()&&this.getEditor())){if(this._fnCancelInit){this._fnCancelInit();delete this._fnCancelInit;}var p=c(function(r,R){var m=this.getConfig()||this.getEditor().getPropertyConfig(this.getPropertyName());var s=this.getConfig()?a:b;P.create(m.type).then(function(o){o.setModel(this.getEditor()._oContextModel,"_context");o.setModel(this.getEditor().getModel("i18n"),"i18n");o.setConfig(_({},m));o.addStyleClass("sapUiTinyMargin");o.attachValueChange(function(E){this.fireValueChange(E.getParameters());},this);this._sCreatedBy=s;delete this._fnCancelInit;return o;}.bind(this)).then(r).catch(R);}.bind(this));this._fnCancelInit=p.cancel;p.promise.then(function(o){this.setAggregation("propertyEditor",o);var r=this.getRenderLabel();if(r!==undefined){o.setRenderLabel(r);}o.attachReady(this._onPropertyEditorReady,this);if(o.isReady()){this.fireReady();}this.firePropertyEditorChange({propertyEditor:o});}.bind(this));}};d.prototype._propagationListener=function(){var E=f(this.getParent(),"sap.ui.integration.designtime.baseEditor.BaseEditor");if(E){this.setEditor(E);this.removePropagationListener(this._propagationListener);}};d.prototype.setParent=function(p){C.prototype.setParent.apply(this,arguments);if(this._bEditorAutoDetect){var E=f(p,"sap.ui.integration.designtime.baseEditor.BaseEditor");if(E){this.setEditor(E);}else{this.addPropagationListener(this._propagationListener);}}};d.prototype.setRenderLabel=function(r){this.setProperty("renderLabel",r);var n=this.getAggregation("propertyEditor");if(n){n.setRenderLabel(r);}};d.prototype.getContent=function(){var n=this.getAggregation("propertyEditor");return n&&n.getContent();};d.prototype.getValue=function(){var n=this.getAggregation("propertyEditor");return n&&n.getValue();};return d;});
