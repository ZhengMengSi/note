/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Control","sap/ui/integration/designtime/baseEditor/util/findClosestInstance","sap/ui/integration/designtime/baseEditor/util/createPromise"],function(C,f,c){"use strict";var a="config";var b="tags";var S="created";var d="syncing";var e="ready";var P=C.extend("sap.ui.integration.designtime.baseEditor.PropertyEditors",{metadata:{properties:{tags:{type:"any"},renderLabels:{type:"boolean"},config:{type:"array"}},aggregations:{propertyEditors:{type:"sap.ui.integration.designtime.baseEditor.PropertyEditor",visibility:"hidden"}},associations:{editor:{type:"sap.ui.integration.designtime.baseEditor.BaseEditor",multiple:false}},events:{editorChange:{parameters:{previousEditor:{type:"sap.ui.integration.designtime.baseEditor.BaseEditor"},editor:{type:"sap.ui.integration.designtime.baseEditor.BaseEditor"}}},propertyEditorsChange:{parameters:{previousPropertyEditors:{type:"sap.ui.integration.designtime.baseEditor.PropertyEditor"},propertyEditors:{type:"sap.ui.integration.designtime.baseEditor.PropertyEditor"}}},init:{},configChange:{parameters:{previousConfig:{type:"array"},config:{type:"array"}}},tagsChange:{parameters:{previousTags:{type:"string"},tags:{type:"string"}}},ready:{}}},_bEditorAutoDetect:false,_sCreatedBy:null,_sState:S,constructor:function(){C.prototype.constructor.apply(this,arguments);if(!this.getEditor()){this._bEditorAutoDetect=true;}this._propagationListener=this._propagationListener.bind(this);this.attachEditorChange(function(){if(this._sCreatedBy){this._removePropertyEditors();}this._initPropertyEditors();});this.attachConfigChange(function(E){var p=E.getParameter("previousConfig");var g=E.getParameter("config");if(this._fnCancelInit||this._sCreatedBy===b||!Array.isArray(p)||!Array.isArray(g)||p.length!==g.length||p.some(function(o,i){return o.type!==g[i].type;})){this._removePropertyEditors();this._initPropertyEditors();}else if(this._sCreatedBy){var h=this.getAggregation("propertyEditors");g.forEach(function(m,i){h[i].getAggregation("propertyEditor").setConfig(m);});}});this.attachTagsChange(function(){if(this._sCreatedBy===b){this._removePropertyEditors();}if(this._sCreatedBy!==a){this._initPropertyEditors();}});this._initPropertyEditors();},init:function(){Promise.resolve().then(function(){this.fireInit();}.bind(this));},renderer:function(r,o){var p=o.getAggregation("propertyEditors");r.openStart("div",o);r.openEnd();if(Array.isArray(p)){p.forEach(function(g){r.renderControl(g);});}r.close("div");}});P.prototype.getEditor=function(){return sap.ui.getCore().byId(this.getAssociation("editor"));};P.prototype.setConfig=function(m){var p=this.getConfig();if(p!==m&&(!Array.isArray(p)||!Array.isArray(m)||JSON.stringify(p)!==JSON.stringify(m))){this.setProperty("config",m);this.fireConfigChange({previousConfig:p,config:m});}};P.prototype.setTags=function(t){var p=this.getTags();var r=t;if(typeof t==="string"){r=t.split(",").sort().join(",");}if(p!==r){this.setProperty("tags",r);this.fireTagsChange({previousTags:p,tags:r});}};P.prototype.setEditor=function(E){var p=this.getEditor();var o=typeof E==="string"?sap.ui.getCore().byId(E):E;if(p!==o){this.setAssociation("editor",E);var o=this.getEditor();this.fireEditorChange({previousEditor:p,editor:o});}};P.prototype.destroy=function(){this._removePropertyEditors();C.prototype.destroy.apply(this,arguments);};P.prototype._removePropertyEditors=function(){var p=this.removeAllAggregation("propertyEditors");if(p.length){p.forEach(function(o){o.detachReady(this._onPropertyEditorReady,this);switch(this._sCreatedBy){case a:o.destroy();break;case b:o.setParent(null);break;}},this);this._sCreatedBy=null;this.firePropertyEditorsChange({previousPropertyEditors:p,propertyEditors:[]});}};P.prototype.isReady=function(){return this._sState===e&&this.getAggregation("propertyEditors").every(function(n){return n.isReady();});};P.prototype._onPropertyEditorReady=function(){if(this.isReady()){this.fireReady();}};P.prototype.ready=function(){return new Promise(function(r){var g=function(){Promise.all((this.getAggregation("propertyEditors")||[]).map(function(p){return p.ready();})).then(function(){r();});}.bind(this);if(this._sState!==e){this.attachEventOnce("propertyEditorsChange",function(){g();});}else{g();}}.bind(this));};P.prototype._initPropertyEditors=function(){if(this.getEditor()&&(this.getConfig()||(!this.getBindingInfo("config")&&this.getTags()))){this._sState=d;var E=this.getEditor();if(this._fnCancelInit){this._fnCancelInit();delete this._fnCancelInit;}var p=c(function(r,R){var o;var s;if(this.getConfig()){o=Promise.all(this.getConfig().map(function(i){return E._createPropertyEditor(i);}));s=a;}else{var t=this.getTags().split(",");o=E.getPropertyEditors(t);s=b;}o.then(function(g){var h=this.getRenderLabels();if(h!==undefined){g.forEach(function(i){i.setRenderLabel(h);});}this._sCreatedBy=s;delete this._fnCancelInit;r(g);}.bind(this)).catch(R);}.bind(this));this._fnCancelInit=p.cancel;p.promise.then(function(g){var h=(this.getAggregation("propertyEditors")||[]).slice();g.forEach(function(o){this.addAggregation("propertyEditors",o);o.attachReady(this._onPropertyEditorReady,this);},this);this._sState=e;if(this.isReady()){this.fireReady();}this.firePropertyEditorsChange({previousPropertyEditors:h,propertyEditors:(this.getAggregation("propertyEditors")||[]).slice()});}.bind(this));}};P.prototype._propagationListener=function(){var E=f(this.getParent(),"sap.ui.integration.designtime.baseEditor.BaseEditor");if(E){this.setEditor(E);this.removePropagationListener(this._propagationListener);}};P.prototype.setParent=function(p){C.prototype.setParent.apply(this,arguments);if(this._bEditorAutoDetect){var E=f(p,"sap.ui.integration.designtime.baseEditor.BaseEditor");if(E){this.setEditor(E);}else{this.addPropagationListener(this._propagationListener);}}};return P;});
