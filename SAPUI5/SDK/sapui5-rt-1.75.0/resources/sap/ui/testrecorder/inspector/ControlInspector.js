/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/Object","sap/ui/testrecorder/CommunicationBus","sap/ui/testrecorder/CommunicationChannels","sap/ui/testrecorder/inspector/DOMMutation","sap/ui/support/supportRules/ui/external/Highlighter","sap/ui/test/_ControlFinder","sap/ui/testrecorder/inspector/ControlAPI","sap/ui/testrecorder/Constants","sap/ui/testrecorder/DialectRegistry","sap/ui/testrecorder/controlSelectors/ControlSelectorGenerator","sap/ui/testrecorder/codeSnippets/CodeSnippetProvider"],function(B,C,a,D,H,_,b,c,d,e,f){"use strict";var o=null;var h=new H(c.HIGHLIGHTER_ID);var p;var s={preferViewId:false,formatAsPOMethod:true};var g=B.extend("sap.ui.testrecorder.inspector.ControlInspector",{constructor:function(){if(!o){Object.apply(this,arguments);this._mutation=new D(this.getAllControlData);}else{return o;}}});g.prototype.init=function(){this._mutation.start();C.subscribe(a.REQUEST_ALL_CONTROLS_DATA,this.getAllControlData.bind(this));C.subscribe(a.REQUEST_CONTROL_DATA,this.getControlData.bind(this));C.subscribe(a.REQUEST_CODE_SNIPPET,this.getCodeSnippet.bind(this));C.subscribe(a.HIGHLIGHT_CONTROL,this.highlightControl.bind(this));C.subscribe(a.SET_DIALECT,this.setDialect.bind(this));C.subscribe(a.UPDATE_SELECTOR_SETTINGS,this.updateSelectorSettings.bind(this));};g.prototype.getAllControlData=function(){C.publish(a.RECEIVE_ALL_CONTROLS_DATA,{renderedControls:b.getAllControlData().renderedControls,framework:b.getFrameworkData().framework});e.emptyCache();};g.prototype.getControlData=function(m){var i=b.getControlData(m);C.publish(a.RECEIVE_CONTROL_DATA,i);};g.prototype.getCodeSnippet=function(m){var i=Object.assign({},m,{settings:s});p=i;return e.getSelector(i).then(function(S){return f.getSnippet({controlSelector:S,action:i.action,settings:s});}).then(function(S){C.publish(a.RECEIVE_CODE_SNIPPET,{codeSnippet:S});}).catch(function(E){C.publish(a.RECEIVE_CODE_SNIPPET,{error:"Could not generate code snippet for "+JSON.stringify(m)+". Details: "+E,domElement:i.domElement});});};g.prototype.highlightControl=function(m){if(m.domElement){h.highlight(m.domElement);}else if(m.controlId){var i=_._findElements({id:m.controlId})[0];if(i){h.highlight(i.id);}}};g.prototype.setDialect=function(i){d.setActiveDialect(i);C.publish(a.DIALECT_CHANGED);if(p){this.getCodeSnippet(p);}};g.prototype.updateSelectorSettings=function(S){Object.assign(s,S);var E=S.preferViewId!==null&&S.preferViewId!==undefined;var u=E||S.formatAsPOMethod!==null&&S.formatAsPOMethod!==undefined;if(E){e.emptyCache();}if(u&&p){this.getCodeSnippet(p);}};g.prototype.stop=function(){this._mutation.stop();};o=new g();return o;},true);
