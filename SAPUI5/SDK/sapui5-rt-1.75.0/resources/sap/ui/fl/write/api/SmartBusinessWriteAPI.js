/*
 * ! OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/descriptorRelated/api/DescriptorVariantFactory","sap/ui/fl/write/api/PersistenceWriteAPI","sap/ui/fl/write/api/ChangesWriteAPI","sap/ui/fl/apply/_internal/ChangesController","sap/ui/fl/write/_internal/SaveAs","sap/ui/fl/write/_internal/connectors/LrepConnector","sap/ui/fl/registry/Settings"],function(D,P,C,a,S,L,b){"use strict";function _(A,p){return b.getInstance().then(function(s){if(s.isAtoEnabled()){p.skipIam=true;p.transport="ATO_NOTIFICATION";}return S[A](p);});}function c(p){if(!p.appId){return Promise.reject("App Variant ID must be provided");}p.selector={appId:p.appId};var o=a.getDescriptorFlexControllerInstance(p.selector);p.referenceAppId=o.getComponentName();p.isForSmartBusiness=true;}var d={create:function(p){if(!p.layer){return Promise.reject("Layer must be provided");}if(!p.selector||!p.selector.appId){return Promise.reject("selector.appId must be provided");}if(!p.id){return Promise.reject("App variant ID must be provided");}var f=a.getDescriptorFlexControllerInstance(p.selector);p.reference=f.getComponentName();p.isForSmartBusiness=true;return _("saveAs",p);},update:function(p){c(p);return _("updateAppVariant",p);},remove:function(p){c(p);return _("deleteAppVariant",p);},getDesignTimeVariant:function(p){if(!p.appId){return Promise.reject("App Variant ID must be provided");}return D.loadAppVariant(p.appId);},getRunTimeVariant:function(p){if(!p.appId){return Promise.reject("Reference App ID must be provided");}if(!p.id){return Promise.reject("App Variant ID must be provided");}var A="/sap/bc/lrep/content/apps/"+p.appId+"/appVariants/"+p.id+"/manifest.appdescr_variant";return L.appVariant.getManifest({appVarUrl:A});},createDescriptorInlineChanges:function(p){if(!p.appId){return Promise.reject("appId must be provided");}if(!p.changeSpecificData){return Promise.reject("changeSpecificData must be provided");}p.selector={appId:p.appId};return C.create(p);},add:function(p){if(!p.appId){return Promise.reject("appId must be provided");}if(!p.change){return Promise.reject("Change instance must be provided");}p.selector={appId:p.appId};return P.add(p);}};return d;});
