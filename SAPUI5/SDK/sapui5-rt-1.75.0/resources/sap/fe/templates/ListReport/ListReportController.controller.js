/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2017 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/fe/core/controllerextensions/Routing","sap/fe/core/controllerextensions/EditFlow","sap/fe/macros/field/FieldRuntime","sap/fe/macros/CommonHelper","sap/fe/core/AnnotationHelper","sap/fe/core/actions/messageHandling","sap/base/Log","sap/base/util/ObjectPath","sap/fe/navigation/SelectionVariant","sap/m/MessageBox","sap/fe/core/CommonUtils","sap/fe/navigation/NavigationHelper","sap/fe/core/FEHelper"],function(C,J,R,E,F,a,A,m,L,O,S,M,b,N,c){"use strict";return C.extend("sap.fe.templates.ListReport.ListReportController",{routing:R,editFlow:E,messageHandling:m,onInit:function(){this.getView().setModel(new J(),"sap.fe.templates.ListReport");this.getView().setModel(this.editFlow.getUIStateModel(),"ui");this.getView().setModel(new J({sessionOn:false,appliedFilters:""}),"localUI");this.filterBarConditions={};},onExit:function(){var v=this.getView();v.getModel("sap.fe.templates.ListReport").destroy();v.getModel("ui").destroy();v.getModel("localUI").destroy();delete this.filterBarConditions;delete this._oListReportControl;},onAfterBinding:function(B,p){if(this.routing.isUIStateDirty()){var t=this.getTableBinding();if(t){t.refresh();}this.routing.setUIStateProcessed();}},onPageReady:function(p){var l=p.lastFocusedControl;var v=this.getView();if(l&&l.controlId&&l.focusInfo){var f=v.byId(l.controlId);if(f){f.applyFocusInfo(l.focusInfo);}}},getPageTitleInformation:function(){var t=this;return new Promise(function(r,d){var T={title:"",subtitle:"",intent:"",icon:""};T.title=t.getView().getContent()[0].data().ListReportTitle;T.subtitle=t.getView().getContent()[0].data().ListReportSubtitle;r(T);});},_getTableControlId:function(){return this.getView().getContent()[0].data("reportTableId");},_getTableControl:function(){if(!this._oListReportControl){this._oListReportControl=this.getView().byId(this._getTableControlId());}return this._oListReportControl;},getTableBinding:function(){var t=this._getTableControl(),B=t&&t._getRowBinding();return B;},_getMergedContext:function(o,f){var d,s;d=N.addConditionsToSelectionVariant(new S(),f);s=N.mixAttributesAndSelectionVariant(o.getObject(),d);return N.removeSensitiveData(o,s);},setShareModel:function(){var g=O.get("sap.ushell.Container.getUser");var s={bookmarkTitle:document.title,bookmarkCustomUrl:function(){var h=hasher.getHash();return h?"#"+h:window.location.href;},isShareInJamActive:!!g&&g().isJamActive()};var t=this.getOwnerComponent().getModel("_templPriv");t.setProperty("/listReport/share",s);},handlers:{onShareListReportActionButtonPress:function(e){var g=this.getView().getModel("sap.fe.i18n").getResourceBundle();if(!this._oShareActionButton){this._oShareActionButton=sap.ui.xmlfragment("sap.fe.templates.ListReport.ShareSheet",{shareEmailPressed:function(){g.then(function(B){sap.m.URLHelper.triggerEmail(null,B.getText("SAPFE_EMAIL_SUBJECT",[document.title]),document.URL);});},shareJamPressed:function(){}});this.getView().addDependent(this._oShareActionButton);}this._oShareActionButton.openBy(e.getSource());},onFiltersChanged:function(e){var f=e.getSource(),o=this.getView().getModel("localUI");o.setProperty("/appliedFilters",f.getAssignedFiltersText());},onSearch:function(e){this.filterBarConditions=e.getParameter("conditions");},onFieldValueChange:function(e){this.editFlow.syncTask(e.getParameter("promise"));F.handleChange(e);},onDataFieldForIntentBasedNavigation:function(o,s,d,e,v){var f;if(v){f=o._getMergedContext(v[0],o.filterBarConditions);}if(e!="undefined"){f=c.setSemanticObjectMappings(f,e);}b.navigateToExternalApp(o.getView(),f,s,d);},onChevronPressNavigateOutBound:function(o,s,d){var e=o.routing.getOutbounds(),f,D=e[s];if(D){if(d){f=o._getMergedContext(d,o.filterBarConditions);}b.navigateToExternalApp(o.getView(),f,D.semanticObject,D.action,a.showNavigateErrorMessage);return Promise.resolve();}else{throw new Error("outbound target "+s+" not found in cross navigation definition of manifest");}},fetchDefaultDisplayCurrency:function(){var v=this.getView();var o=b.getAppComponent(v);var t=this;o.getService("navigation").then(function(n){var p=n.parseNavigation();p.done(function(d,s,e){var f=t.routing.getEntitySet(o);var g=o.getMetaModel().getObject("/"+f+"@Org.OData.Capabilities.V1.FilterRestrictions/RequiredProperties");for(var i=0;i<g.length;i++){if(g[i].$PropertyPath==="DisplayCurrency"){if(!d.oSelectionVariant.getSelectOption("DisplayCurrency").length){if(d.oDefaultedSelectionVariant.getSelectOption("DisplayCurrency").length){var h=d.oDefaultedSelectionVariant.getSelectOption("DisplayCurrency")[0];var j=h["Sign"];var k=h["Option"];var l=h["Low"];var H=h["High"];d.oSelectionVariant.addSelectOption("DisplayCurrency",j,k,l,H);}}}}});});}}});});
