sap.ui.define(["sap/ui/base/Object","sap/f/FlexibleColumnLayoutSemanticHelper","sap/f/library","sap/base/util/extend"],function(B,F,f,e){"use strict";var L=f.LayoutType;var r=Promise.resolve();var d=2;var c=["begin","mid","end"];var m=["messagePageBeginColumn","messagePageMidColumn","messagePageEndColumn"];function t(i){return c[i]?i:d;}function g(i){return c[t(i)]+"ColumnPages";}function a(C){for(var i=0;i<c.length;i++){C(m[i],g(i));}}function b(v){return m[t(v)];}function h(i){return c[t(i)];}function j(T){var i;if(T instanceof sap.ui.table.Table){i=T.getRows();}else if(T instanceof sap.m.Table){i=T.getItems();}return i;}function k(T){var i=j(T);var R=i?i[0]:false;return R;}function l(s){return(s&&(Array.isArray(s.FCLLayout)?s.FCLLayout.sort()[0]:s.FCLLayout))||"";}function n(o,N){var T=N.oTemplateContract;var p=T.oAppComponent.getFlexibleColumnLayout();var q=F.getInstanceFor(o,p);var u;var C;var s;var M=sap.ui.Device.system.phone?1:(p.maxColumnsCount||3);var v=M>1&&p.initialColumnsCount===2;var D=(function(){var i=q.getDefaultLayouts();return[v?i.defaultTwoColumnLayoutType:i.defaultLayoutType,i.defaultTwoColumnLayoutType,i.defaultThreeColumnLayoutType];})();var w=p.displayNextObjectAfterDelete===true;function x(i){return i.fCLLevel===1||i.fCLLevel===2||(i.level===0&&v);}function y(i){if(i.fCLLevel===3||(i.fCLLevel===0&&i.level>0)){return 1;}var r1=p.initialColumnsCount||1;var s1=Math.max(i.fCLLevel+1,r1);return sap.ui.Device.system.tablet&&s1>2?2:s1;}function A(i,r1,s1,t1){var u1=y(t1);i.showBeginColumn=t1.fCLLevel===0||u1>1;i.showMidColumn=t1.fCLLevel===1||u1>1;i.showEndColumn=t1.fCLLevel>1;if(u1===1){i.target=r1;}else if(t1.level===0){i.target=[r1,i.pages[0].entitySet];}else{i.target=s1.concat([r1]);}return g(t1.fCLLevel);}function z(i,r1){if(i===L.OneColumn&&v){return false;}var s1=r1&&T.mRoutingTree[r1];var t1=s1&&s1.defaultLayoutType;if(t1){return i===t1;}return i===D[0]||i===D[1]||i===D[2];}function E(i,r1,s1){var t1=T.mRouteToTemplateComponentPromise[s1];if(t1){return t1.then(function(u1){return N.activateOneComponent(r1,i,u1);});}return r;}function G(){var i=N.getCurrentIdentity();if(!i){return null;}var r1={};var s1=true;for(var t1=i.treeNode;s1;t1=T.mRoutingTree[t1.parentRoute]){var u1=t1.fCLLevel;var v1=h(u1);r1[v1]={route:t1.sRouteName,path:t1.getPath(2,i.keys),isVisible:u1>2||u.columnsVisibility[v1+"Column"]};s1=u1===1||u1===2;}return r1;}function H(i,r1){var s1=G();if(!s1){return Promise.resolve();}var t1=[];r1=r1||s1;for(var u1 in r1){var v1=s1[u1];if(v1.isVisible){t1.push(E(i,v1.path,v1.route));}else{var w1=T.oTemplatePrivateGlobalModel.getProperty("/generic/routeLevel");var x1=T.mRoutingTree[v1.route];var y1=(w1===x1.level)?2:(3+U(C));N.setVisibilityOfRoute(v1.route,y1);}}return Promise.all(t1).then(N.afterActivation);}function I(i){var r1=N.getActivationInfo();H(r1,i);}function J(){return!(u.columnsVisibility.beginColumn?u.columnsVisibility.midColumn:u.columnsVisibility.midColumn&&u.columnsVisibility.endColumn);}function K(i){if(!u&&!i){return;}var r1=q.getCurrentUIState();var s1={};s1.end=u&&(u.columnsVisibility.endColumn!==r1.columnsVisibility.endColumn);s1.mid=u&&(u.columnsVisibility.midColumn!==r1.columnsVisibility.midColumn);s1.begin=u&&(u.columnsVisibility.beginColumn!==r1.columnsVisibility.beginColumn);u=r1;T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/midActionButtons",{fullScreen:u.actionButtonsInfo.midColumn.fullScreen!==null,exitFullScreen:u.actionButtonsInfo.midColumn.exitFullScreen!==null,closeColumn:u.actionButtonsInfo.midColumn.closeColumn!==null});T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/endActionButtons",{fullScreen:u.actionButtonsInfo.endColumn.fullScreen!==null,exitFullScreen:u.actionButtonsInfo.endColumn.exitFullScreen!==null,closeColumn:u.actionButtonsInfo.endColumn.closeColumn!==null});var t1=N.getCurrentIdentity();var u1=t1&&t1.treeNode;if(t1){var v1=J();var w1=u1.level-(u1.fCLLevel===2&&!u.columnsVisibility.endColumn);var x1=w1-(w1>1&&!v1)-(u.columnsVisibility.endColumn&&u.columnsVisibility.beginColumn&&w1>2);T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/isVisuallyFullScreen",v1);T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/highestViewLevel",w1);T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/lowestDetailViewLevel",x1);}if(t1&&C!==u.layout){var y1=z(u.layout,u1.sRouteName)?null:u.layout;N.navigateByExchangingQueryParam("FCLLayout",y1);}else if((s1.begin||s1.mid||s1.end)&&!i){I(s1);}}var S=false;function O(i){var r1=function(){if(x(i.treeNode)){C=Q(i);if(!C){switch(i.treeNode.fCLLevel){case 0:var s1=q.getNextUIState(0).columnsVisibility;if(s1.midColumn){C=D[1];}else{C=D[0];N.navigateByExchangingQueryParam("FCLLayout",C);}break;case 1:C=D[1];break;case 2:C=D[2];}}}else{C=i.treeNode.fCLLevel===0?D[0]:L.EndColumnFullScreen;}o.setLayout(C);if(i.treeNode.fCLLevel===1||i.treeNode.fCLLevel===2){var t1=q.getCurrentUIState();if(t1.columnsVisibility.midColumn){var u1=1-t1.columnsVisibility.beginColumn;for(var v1=i.treeNode;v1.fCLLevel>u1;){v1=T.mRoutingTree[v1.parentRoute];i.componentsDisplayed[v1.sRouteName]=1;}}}};if(S){r1();return Promise.resolve();}return q.whenReady().then(function(){S=true;r1();});}function P(i){K(true);return H(i);}function Q(i){return l(i.appStates)||i.treeNode.defaultLayoutType||D[t(i.treeNode.fCLLevel)];}function R(i,r1,s1){if(!z(r1,s1)){i.FCLLayout=r1;}}function U(i){return i===L.EndColumnFullScreen||i===L.MidColumnFullScreen;}function V(i){return i===L.ThreeColumnsBeginExpandedEndHidden||i===L.ThreeColumnsMidExpandedEndHidden;}function W(i,r1,s1,t1){var u1={treeNode:i,keys:r1,appStates:t1};var v1=N.getApplicableStateForIdentityAddedPromise(u1);s1.push(v1);}function X(i,r1,s1,t1){R(i,s1,r1.sRouteName);var u1=[];if(!V(s1)){W(r1,t1,u1,i);}if(!U(s1)){for(var v1=r1;v1.fCLLevel>0;){v1=T.mRoutingTree[v1.parentRoute];W(v1,t1,u1,i);}}return Promise.all(u1);}function Y(i){return U(C)?_(i.fCLLevel):(i.defaultLayoutType||q.getNextUIState(i.fCLLevel).layout);}function Z(i,r1){var s1=(r1.treeNode.fCLLevel===1&&i.treeNode.parentRoute===r1.treeNode.sRouteName)?u.actionButtonsInfo.endColumn.closeColumn:Y(r1.treeNode);return X(r1.appStates,r1.treeNode,s1,r1.keys);}function $(i,r1,s1){var t1;if(i.treeNode.fCLLevel===r1.treeNode.fCLLevel){t1=C;}else if(i.treeNode.fCLLevel===2){t1=u.actionButtonsInfo.endColumn.closeColumn;}else{t1=Y(r1.treeNode);}return X(s1,r1.treeNode,t1,r1.keys);}function _(i){if(i===0){return L.OneColumn;}else if(i===1){return L.MidColumnFullScreen;}else if(i===2){return L.EndColumnFullScreen;}else{return"";}}function a1(r1,s1){var t1=T.mRoutingTree[r1];if(!x(t1)){return null;}var u1=s||t1.defaultLayoutType||q.getNextUIState(t1.fCLLevel).layout;R(s1,u1,r1);s=null;if(U(u1)){return null;}var v1=[];for(var i=t1.fCLLevel;i>0;i--){var w1=t1.parentRoute;v1.push(N.addUrlParameterInfoForRoute(w1,s1));t1=T.mRoutingTree[w1];}return Promise.all(v1);}function b1(i,r1){if(i.treeNode.fCLLevel===0||i.treeNode.fCLLevel===3){return true;}var s1=Q(i);var t1=Q(r1);return U(s1)===U(t1);}function c1(i,r1,s1){T.oApplicationProxy.performAfterSideEffectExecution(function(){var t1=h(i.fCLLevel);var u1=u.actionButtonsInfo[t1+"Column"][r1];var v1=s1?T.mRoutingTree[i.parentRoute]:i;var w1=N.getCurrentIdentity();var x1=Object.create(null);T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/FCLActionButton",0);if(r1==="fullScreen"||r1==="exitFullScreen"){T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/FCLActionButton",1);}else{T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/FCLActionButton",0);}var y1=X(x1,v1,u1,w1.keys);var z1=y1.then(function(){N.navigateToIdentity({treeNode:v1,keys:(v1===w1.treeNode)?w1.keys:w1.keys.slice(0,v1.level+1),appStates:x1});});T.oBusyHelper.setBusy(z1);},true);}function d1(i){return{onCloseColumnPressed:c1.bind(null,i,"closeColumn",true),onFullscreenColumnPressed:c1.bind(null,i,"fullScreen",false),onExitFullscreenColumnPressed:c1.bind(null,i,"exitFullScreen",false)};}T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL",{});function e1(i){var r1=T.oNavigationControllerProxy.getCurrentIdentity();var s1=r1.treeNode;return i===s1;}function f1(i){C=q.getNextUIState(i).layout;o.setLayout(C);}function g1(){return!J();}function h1(i,r1){var s1=0;for(var t1 in r1){var u1=T.mRoutingTree[t1];if(u1.level>=i.viewLevel&&r1[t1]===1){if(u1.level===i.viewLevel){s1=u1.fCLLevel;}r1[t1]=5+(u1.level>i.viewLevel);}}f1(s1);var v1=N.oRouter.getTargets();var w1=b(s1);v1.display(w1);}function i1(i,r1){if(!x(r1)){return;}var s1=_(r1.fCLLevel);if(z(s1,r1.sRouteName)){return;}i.FCLLayout=s1;}function j1(i){return i.treeNode.fCLLevel!==0&&i.treeNode.fCLLevel!==3&&!U(Q(i));}function k1(){return M;}function l1(i,r1){if(!v){return;}var s1=false;var t1=q.getNextUIState(0).columnsVisibility;if(t1.midColumn){var u1=N.getCurrentIdentity();var v1=u1&&u1.treeNode;s1=v1&&v1.level===0&&l(u1.appStates)!==L.OneColumn;}if(s1){if(i){r1(i);}else{N.navigateByExchangingQueryParam("FCLLayout",L.OneColumn);}}}function m1(){return w;}function n1(){return v;}function o1(i,r1){var s1=k(i);l1(s1,r1);}function p1(i){if(i>2){s="";}else{s=_(i);}}function q1(i){var r1={};if(i.fCLLevel===1||i.fCLLevel===2){r1.oActionButtonHandlers=d1(i);}if(i.level===0){r1.handleDataReceived=(n1&&n1())?o1:Function.prototype;r1.isListAndFirstEntryLoadedOnStartup=n1;}return r1;}o.attachStateChange(K.bind(null,false));return{adaptRoutingInfo:A,createMessagePageTargets:a,displayMessagePage:h1,handleBeforeRouteMatched:O,handleRouteMatched:P,areIdentitiesLayoutEquivalent:b1,getAppStatesPromiseForNavigation:Z,getSpecialDraftCancelPromise:$,getFCLAppStatesPromise:a1,isNewHistoryEntryRequired:e1,adaptBreadCrumbUrlParameters:i1,isAppTitlePrefered:g1,hasNavigationMenuSelfLink:j1,getMaxColumnCountInFCL:k1,isNextObjectLoadedAfterDelete:m1,getFclProxy:q1,isListAndFirstEntryLoadedOnStartup:n1,setStoredTargetLayoutToFullscreen:p1};}return B.extend("sap.suite.ui.generic.template.lib.FlexibleColumnLayoutHandler",{constructor:function(o,N){e(this,n(o,N));}});});
