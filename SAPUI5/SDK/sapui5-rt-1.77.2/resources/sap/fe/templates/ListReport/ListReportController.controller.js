/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2017 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/fe/core/controllerextensions/Routing","sap/fe/core/controllerextensions/FlexibleColumnLayout","sap/fe/core/controllerextensions/EditFlow","sap/fe/macros/field/FieldRuntime","sap/fe/macros/CommonHelper","sap/fe/core/AnnotationHelper","sap/fe/core/actions/messageHandling","sap/base/Log","sap/base/util/ObjectPath","sap/fe/navigation/SelectionVariant","sap/m/MessageBox","sap/fe/core/CommonUtils","sap/fe/navigation/NavigationHelper","sap/fe/navigation/navigationLibrary","sap/fe/core/FEHelper","sap/fe/core/AppStateHandler","sap/ui/mdc/p13n/StateUtil","sap/fe/macros/ResourceModel","sap/fe/core/controllerextensions/RoutingListener"],function(C,J,R,F,E,a,b,A,m,L,O,S,M,c,N,d,e,f,g,h,i){"use strict";return C.extend("sap.fe.templates.ListReport.ListReportController",{routing:R,routingListener:i,editFlow:E,fcl:F,messageHandling:m,onInit:function(){this.getView().setModel(this.editFlow.getTransactionHelper().getUIStateModel(),"ui");this.getView().setModel(this.editFlow.getUIStateModel({sessionOn:false,appliedFilters:""}),"localUI");this.filterBarConditions={};f.init();f.applyAppState(this);},onExit:function(){delete this.filterBarConditions;delete this._oListReportControl;},onAfterBinding:function(B,p){if(this.routing.isUIStateDirty()){var t=this.getTableBinding();var l=this.getView().getModel("localUI");if(t){t.refresh();if(l){l.setProperty("/$contexts",{});}}this.routing.setUIStateProcessed();}},onAfterRendering:function(o){var t=this;this.getView().getModel("sap.fe.i18n").getResourceBundle().then(function(r){t.oResourceBundle=r;});},onPageReady:function(p){var l=p.lastFocusedControl;var v=this.getView();if(l&&l.controlId&&l.focusInfo){var o=v.byId(l.controlId);if(o){o.applyFocusInfo(l.focusInfo);}}},getPageTitleInformation:function(){var t=this;return new Promise(function(r,j){var T={title:"",subtitle:"",intent:"",icon:""};T.title=t.getView().getContent()[0].data().ListReportTitle;T.subtitle=t.getView().getContent()[0].data().ListReportSubtitle;r(T);});},_getTableControlId:function(){return this.getView().getContent()[0].data("reportTableId");},_getTableControl:function(){if(!this._oListReportControl){this._oListReportControl=this.getView().byId(this._getTableControlId());}return this._oListReportControl;},getTableBinding:function(){var t=this._getTableControl(),B=t&&t._getRowBinding();return B;},_getMergedContext:function(o,j){var k,s;k=N.addExternalStateFiltersToSelectionVariant(new S(),j);if(Array.isArray(o)){var s=b.getMergedLineContexts(o,k,undefined);return s;}else{s=N.mixAttributesAndSelectionVariant(o.getObject(),k.toJSONString());return N.removeSensitiveData(o,s);}},setShareModel:function(){var G=O.get("sap.ushell.Container.getUser");var s={bookmarkTitle:document.title,bookmarkCustomUrl:function(){var H=hasher.getHash();return H?"#"+H:window.location.href;},isShareInJamActive:!!G&&G().isJamActive()};var t=this.getOwnerComponent().getModel("_templPriv");t.setProperty("/listReport/share",s);},handlers:{onShareListReportActionButtonPress:function(o){var G=this.getView().getModel("sap.fe.i18n").getResourceBundle();if(!this._oShareActionButton){this._oShareActionButton=sap.ui.xmlfragment("sap.fe.templates.ListReport.ShareSheet",{shareEmailPressed:function(){G.then(function(B){sap.m.URLHelper.triggerEmail(null,B.getText("SAPFE_EMAIL_SUBJECT",[document.title]),document.URL);});},shareJamPressed:function(){}});this.getView().addDependent(this._oShareActionButton);}this._oShareActionButton.openBy(o.getSource());},onFiltersChanged:function(o){var j=o.getSource(),k=this.getView().getModel("localUI");k.setProperty("/appliedFilters",j.getAssignedFiltersText());f.createAppState(this);},onVariantSelected:function(o){f.createAppState(this);},onVariantSaved:function(o){f.createAppState(this);},onSearch:function(o){var t=this;var j=o.getSource();g.retrieveExternalState(j).then(function(k){t.filterBarConditions=k.filter;});},onFieldValueChange:function(o){this.editFlow.syncTask(o.getParameter("promise"));a.handleChange(o);},onDataFieldForIntentBasedNavigation:function(o,s,j,k,v,r,I){var l;if(I==="true"&&(r==="false"||r==="undefined")){sap.m.MessageBox.show(h.getText("navigation.CONTEXT_MESSAGE"),{title:h.getText("navigation.ERROR_TITLE")});}else{if(v){l=o._getMergedContext(v,o.filterBarConditions);if(k!="undefined"){l=e.setSemanticObjectMappings(l,k);}}c.navigateToExternalApp(o.getView(),l,s,j);}},onChevronPressNavigateOutBound:function(o,s,j){var k=o.routing.getOutbounds(),l,D=k[s];if(D){if(j){l=o._getMergedContext(j,o.filterBarConditions);}c.navigateToExternalApp(o.getView(),l,D.semanticObject,D.action,b.showNavigateErrorMessage);return Promise.resolve();}else{throw new Error("outbound target "+s+" not found in cross navigation definition of manifest");}}}});});
