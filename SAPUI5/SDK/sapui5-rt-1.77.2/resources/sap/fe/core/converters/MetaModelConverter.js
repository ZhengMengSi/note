sap.ui.define(["./ObjectPageConverter","sap/fe/core/converters/common/AnnotationConverter"],function(O,A){"use strict";function _(o,k,v){if(k in o){Object.defineProperty(o,k,{value:v,enumerable:true,configurable:true,writable:true});}else{o[k]=v;}return o;}function a(g,i){return f(g)||e(g,i)||c(g,i)||b();}function b(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function c(o,m){if(!o)return;if(typeof o==="string")return d(o,m);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return d(o,m);}function d(g,l){if(l==null||l>g.length)l=g.length;for(var i=0,h=new Array(l);i<l;i++){h[i]=g[i];}return h;}function e(g,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(g)))return;var h=[];var j=true;var k=false;var l=undefined;try{for(var m=g[Symbol.iterator](),n;!(j=(n=m.next()).done);j=true){h.push(n.value);if(i&&h.length===i)break;}}catch(o){k=true;l=o;}finally{try{if(!j&&m["return"]!=null)m["return"]();}finally{if(k)throw l;}}return h;}function f(g){if(Array.isArray(g))return g;}var V={"Org.OData.Capabilities.V1":"Capabilities","Org.OData.Core.V1":"Core","Org.OData.Measures.V1":"Measures","com.sap.vocabularies.Common.v1":"Common","com.sap.vocabularies.UI.v1":"UI","com.sap.vocabularies.Analytics.v1":"Analytics","com.sap.vocabularies.PersonalData.v1":"PersonalData","com.sap.vocabularies.Communication.v1":"Communication"};var M={parsePropertyValue:function(g,p,h,i){var j=this;var v;var k=h+"/"+p;if(typeof g==="string"){v={type:"String",String:g};}else if(typeof g==="boolean"){v={type:"Bool",Bool:g};}else if(typeof g==="number"){v={type:"Int",Int:g};}else if(Array.isArray(g)){v={type:"Collection",Collection:g.map(function(s,l){return j.parseAnnotationObject(s,k+"/"+l,i);})};if(g[0].$PropertyPath){v.Collection.type="PropertyPath";}else if(g[0].$NavigationPropertyPath){v.Collection.type="NavigationPropertyPath";}else if(g[0].$AnnotationPath){v.Collection.type="AnnotationPath";}else if(g[0].$Type){v.Collection.type="Record";}else{v.Collection.type="String";}}else if(g.$Path!==undefined){v={type:"Path",Path:g.$Path};}else if(g.$Decimal!==undefined){v={type:"Decimal",Decimal:parseFloat(g.$Decimal)};}else if(g.$PropertyPath!==undefined){v={type:"PropertyPath",PropertyPath:g.$PropertyPath};}else if(g.$NavigationPropertyPath!==undefined){v={type:"NavigationPropertyPath",NavigationPropertyPath:g.$NavigationPropertyPath};}else if(g.$AnnotationPath!==undefined){v={type:"AnnotationPath",AnnotationPath:g.$AnnotationPath};}else if(g.$EnumMember!==undefined){v={type:"EnumMember",EnumMember:this.mapNameToAlias(g.$EnumMember.split("/")[0])+"/"+g.$EnumMember.split("/")[1]};}else if(g.$Type){v={type:"Record",Record:this.parseAnnotationObject(g,h,i)};}return{name:p,value:v};},mapNameToAlias:function(g){var h=g.split("@"),i=a(h,2),p=i[0],j=i[1];if(!j){j=p;p="";}else{p+="@";}var l=j.lastIndexOf(".");return p+V[j.substr(0,l)]+"."+j.substr(l+1);},parseAnnotationObject:function(g,h,i){var j=this;var p={};var k=false;if(typeof g==="string"){p={type:"String",String:g};}else if(typeof g==="boolean"){p={type:"Bool",Bool:g};}else if(typeof g==="number"){p={type:"Int",Int:g};}else if(g.$AnnotationPath!==undefined){p={type:"AnnotationPath",AnnotationPath:g.$AnnotationPath};}else if(g.$Path!==undefined){p={type:"Path",Path:g.$Path};}else if(g.$Decimal!==undefined){p={type:"Decimal",Decimal:parseFloat(g.$Decimal)};}else if(g.$PropertyPath!==undefined){p={type:"PropertyPath",PropertyPath:g.$PropertyPath};}else if(g.$NavigationPropertyPath!==undefined){p={type:"NavigationPropertyPath",NavigationPropertyPath:g.$NavigationPropertyPath};}else if(g.$EnumMember!==undefined){p={type:"EnumMember",EnumMember:this.mapNameToAlias(g.$EnumMember.split("/")[0])+"/"+g.$EnumMember.split("/")[1]};}else if(Array.isArray(g)){k=true;var l=p;l.collection=g.map(function(s,q){return j.parseAnnotationObject(s,h+"/"+q,i);});if(g[0].$PropertyPath){l.collection.type="PropertyPath";}else if(g[0].$NavigationPropertyPath){l.collection.type="NavigationPropertyPath";}else if(g[0].$AnnotationPath){l.collection.type="AnnotationPath";}else if(g[0].$Type){l.collection.type="Record";}else{l.collection.type="String";}}else{if(g.$Type){var t=g.$Type;var m=V[t.substr(0,t.lastIndexOf("."))];var n=t.substr(t.lastIndexOf(".")+1);p.type="".concat(m,".").concat(n);}var o=[];Object.keys(g).forEach(function(q){if(q!=="$Type"&&!q.startsWith("@")){o.push(j.parsePropertyValue(g[q],q,h,i));}else if(q.startsWith("@")){var r=q.split("#");var s=r[1];var u=r[0];var v=j.getOrCreateAnnotationList(h,i);v.annotations.push({term:j.mapNameToAlias(u.substr(1)),qualifier:s,value:j.parseAnnotationObject(g[q],h,i),isCollection:false});}});p.propertyValues=o;}return p;},getOrCreateAnnotationList:function(t,g){var p=g.find(function(h){return h.target===t;});if(!p){p={target:t,annotations:[]};g.push(p);}return p;},createAnnotationLists:function(m,g,h,i){var j=this;var o={target:h,annotations:[]};Object.keys(g).forEach(function(k){var l=o;var n=g[k];var p=k.split("#");var q=p[1];k=p[0];var r=k.split("@");if(r.length>2){l=j.getOrCreateAnnotationList(h+"@"+j.mapNameToAlias(r[1]),i);k=r[2];}else{k=r[1];}var s=V[k.substr(0,k.lastIndexOf("."))];var t=k.substr(k.lastIndexOf(".")+1);var u={term:"".concat(s,".").concat(t),qualifier:q};var v=h+"@"+u.term;if(q){v+="#"+q;}var w=false;if(typeof n==="string"){u.value={type:"String",String:n};}else if(typeof n==="boolean"){u.value={type:"Bool",Bool:n};}else if(typeof n==="number"){u.value={type:"Int",Int:n};}else if(n.$Path!==undefined){u.value={type:"Path",Path:n.$Path};}else if(n.$AnnotationPath!==undefined){u.value={type:"AnnotationPath",AnnotationPath:n.$AnnotationPath};}else if(n.$Decimal!==undefined){u.value={type:"Decimal",Decimal:parseFloat(n.$Decimal)};}else if(n.$EnumMember!==undefined){u.value={type:"EnumMember",EnumMember:j.mapNameToAlias(n.$EnumMember.split("/")[0])+"/"+n.$EnumMember.split("/")[1]};}else if(Array.isArray(n)){w=true;u.collection=n.map(function(D,E){return j.parseAnnotationObject(D,v+"/"+E,i);});if(n[0].$PropertyPath){u.collection.type="PropertyPath";}else if(n[0].$NavigationPropertyPath){u.collection.type="NavigationPropertyPath";}else if(n[0].$AnnotationPath){u.collection.type="AnnotationPath";}else if(n[0].$Type){u.collection.type="Record";}else{u.collection.type="String";}}else{var x={propertyValues:[]};if(n.$Type){var y=n.$Type;var z=V[y.substr(0,y.lastIndexOf("."))];var B=y.substr(y.lastIndexOf(".")+1);x.type="".concat(z,".").concat(B);}var C=[];Object.keys(n).forEach(function(D){if(D!=="$Type"&&!D.startsWith("@")){C.push(j.parsePropertyValue(n[D],D,v,i));}else if(D.startsWith("@")){i.push({target:v,annotations:[{value:j.parseAnnotationObject(n[D],v,i)}]});}});x.propertyValues=C;u.record=x;}u.isCollection=w;l.annotations.push(u);});if(o.annotations.length>0){i.push(o);}},parseProperty:function(m,g,p,h){var i=m.getObject("/".concat(g.name,"/").concat(p,"@"));var j=m.getObject("/".concat(g.name,"/").concat(p));var k={_type:"Property",name:p,fullyQualifiedName:"".concat(g.fullyQualifiedName,"/").concat(p),type:j.$Type,maxLength:j.$MaxLength,precision:j.$Precision,scale:j.$Scale,nullable:j.$Nullable,annotations:{}};this.createAnnotationLists(m,i,k.fullyQualifiedName,h);return k;},parseNavigationProperty:function(m,g,n,h){var i=m.getObject("/".concat(g.name,"/").concat(n,"@"));var j=m.getObject("/".concat(g.name,"/").concat(n));var r=[];if(j.$ReferentialConstraint){r=Object.keys(j.$ReferentialConstraint).map(function(s){return{sourceTypeName:g.name,sourceProperty:s,targetTypeName:j.$Type,targetProperty:j.$ReferentialConstraint[s]};});}var k={_type:"NavigationProperty",name:n,fullyQualifiedName:"".concat(g.fullyQualifiedName,"/").concat(n),partner:j.$Partner,isCollection:j.$isCollection?j.$isCollection:false,targetTypeName:j.$Type,referentialConstraint:r,annotations:{}};this.createAnnotationLists(m,i,k.fullyQualifiedName,h);return k;},parseEntityType:function(m,g,h){var i=this;var j=m.getObject("/".concat(g));var k=m.getObject("/".concat(g,"@"));var l=m.getObject("/".concat(g,"/@"));var n=m.getObject("/".concat(g,"/"));var o=n.$Key;var p={_type:"EntityType",name:g,fullyQualifiedName:j.$Type,keys:[],entityProperties:[],navigationProperties:[],annotations:{getAnnotation:function(s){return p.annotations[s];}}};this.createAnnotationLists(m,l,p.fullyQualifiedName,h);this.createAnnotationLists(m,k,"EntityContainer/".concat(g),h);var q=Object.keys(n).filter(function(s){if(s!="$Key"&&s!="$kind"){return n[s].$kind==="Property";}}).map(function(s){return i.parseProperty(m,p,s,h);});var r=Object.keys(n).filter(function(s){if(s!="$Key"&&s!="$kind"){return n[s].$kind==="NavigationProperty";}}).map(function(s){return i.parseNavigationProperty(m,p,s,h);});p.keys=o.map(function(s){return q.find(function(t){return t.name===s;});});p.entityProperties=q;p.navigationProperties=r;return p;},parseEntityTypes:function(m){var g=this;var E=m.getObject("/");var h=[];var i=Object.keys(E).filter(function(j){return j!=="$kind"&&E[j].$kind==="EntitySet";}).map(function(j){return g.parseEntityType(m,j,h);});var u=function(j){if(!j){return j;}var k=j.split("."),l=a(k,2),n=l[0],v=l[1];var o=Object.keys(V).find(function(t){return V[t]===n;});if(o){return"".concat(o,".").concat(v);}else{if(j.indexOf("@")!==-1){var p=j.split("@"),q=a(p,2),r=q[0],s=q[1];return"".concat(r,"@").concat(u(s));}else{return j;}}};return{identification:"metamodelResult",version:"4.0",schema:{entityContainer:{},entitySets:[],entityTypes:i,associations:[],actions:[],namespace:"",annotations:{"metamodelResult":h}},references:[],unalias:u};},convertTypes:function(m){var p=this.parseEntityTypes(m);return A.convertTypes(p);},convertPage:function(m,o){var s=this.convertTypes(m);var E=o.entitySet;var t=s.schema.entityTypes.find(function(g){return g.name===E;});if(t){var C=m.createBindingContext("/"+E);return _({},E,O.convertPage(t,C,o,s.unalias));}}};return M;});
