sap.ui.define(["sap/ui/test/OpaBuilder","sap/ui/test/Opa5","sap/ui/core/util/ShortcutHelper","sap/fe/test/Utils","sap/fe/test/builder/FEBuilder","sap/fe/test/builder/FieldBuilder","sap/fe/test/builder/TableBuilder","sap/fe/test/api/TableAssertions","sap/fe/test/api/TableActions","sap/fe/test/builder/FilterBarBuilder","sap/fe/test/api/FilterBarAssertions","sap/fe/test/api/FilterBarActions","sap/base/util/deepEqual"],function(O,a,S,U,F,b,T,c,d,e,f,g,h){"use strict";function _(s,G){return O.Matchers.aggregationMatcher("cells",function(C){var i=false;if(C.getItems){var l=C.getItems();if(l&&l.length===2){i=l[0].getProperty("text")===s;if(G!==undefined){if(!Array.isArray(G)){G=[G];}G=G.join(" > ");i=i&&l[1].getProperty("text")===G;}}}return i;});}function j(o,t){var i=T.create(o);if(U.isOfType(t,String)){i.hasProperties({header:t});}else{i.hasId(t.id);}return i;}function k(o,v){return e.create(o).hasId(v.id);}return{create:function(v,E){var r=sap.ui.getCore().getLibraryResourceBundle("sap.fe.templates"),R=sap.ui.getCore().getLibraryResourceBundle("sap.fe.core");return{viewId:v,actions:{_onTable:function(t){return new d(j(this,t),t);},_onFilterBar:function(i){return new g(k(this,i),i);},iCloseMessageErrorDialog:function(){return O.create(this).isDialogElement().hasType("sap.m.Bar").hasAggregation("contentMiddle",O.Matchers.properties({text:"Error"})).do(O.create(this).isDialogElement().hasType("sap.m.Dialog").doOnAggregation("beginButton",O.Matchers.resourceBundle("text","sap.fe.core","SAPFE_CLOSE"),O.Actions.press())).description("Closing message error dialog").execute();},iOpenVHOnActionDialog:function(s){var i="APD_::"+s+"-inner-vhi";return O.create(this).hasId(i).isDialogElement().doPress().description("Opening value help for '"+s+"'").execute();},_iSwitchItem:function(n){var i=n?{icon:"sap-icon://navigation-down-arrow"}:{icon:"sap-icon://navigation-up-arrow"};return O.create(this).hasType("sap.fe.templates.controls.Paginator").doOnChildren(O.create(this).hasType("sap.uxap.ObjectPageHeaderActionButton").hasProperties(i).doPress()).description("Paginator button "+(n?"Up":"Down")+" pressed").execute();},_iPressKeyboardShortcut:function(i,s,p,t){return O.create(this).hasId(i).hasProperties(p?p:{}).hasType(t).do(function(o){var n=S.parseShortcut(s);n.type="keydown";o.$().trigger(n);}).description("Execute keyboard shortcut "+s).execute();},iCancelActionDialog:function(){return O.create(this).hasType("sap.m.Button").isDialogElement().hasProperties({text:R.getText("SAPFE_ACTION_PARAMETER_DIALOG_CANCEL")}).doPress().description("Cancelling Action dialog").execute();},iConfirmCustomAction:function(t){return O.create(this).hasType("sap.m.Button").hasProperties({text:t}).doPress().description("Custom Action in Table ToolBar").execute();},iConfirmDialog:function(){return O.create(this).hasType("sap.m.Button").isDialogElement().hasProperties({text:R.getText("SAPFE_OK")}).doPress().description("Confirming Action dialog via Ok button").execute();},iConfirmDelete:function(){return O.create(this).hasType("sap.m.Button").isDialogElement().hasProperties({text:r.getText("OBJECT_PAGE_DELETE")}).doPress().description("Delete dialog confirmed").execute();},iConfirmActionVHDialog:function(s,A,i){return O.create(this).hasId(s+"."+A+"::"+i+"-ok").isDialogElement().doPress().description("Confirming value help dialog for action "+A).execute();},iCancelActionVHDialog:function(s,A,i){return O.create(this).hasId(s+"."+A+"::"+i+"-cancel").isDialogElement().doPress().description("Cancelling value help dialog for action "+A).execute();},iCollapseExpandPageHeader:function(C){var o=O.Matchers.resourceBundle("tooltip","sap.f","COLLAPSE_HEADER_BUTTON_TOOLTIP"),i=O.Matchers.resourceBundle("tooltip","sap.f","EXPAND_HEADER_BUTTON_TOOLTIP");return O.create(this).hasType("sap.m.Button").has(O.Matchers.some(o,i)).doConditional(C?o:i,O.Actions.press()).description("Resizing of the Page Header").execute();},_iOpenTableSortSettings:function(t){return T.create(this).hasId(t).doPress("sort").description("Opening sort settings for table "+t).execute();},_iAddColumnInTableSettings:function(s,G){return this._iModifyFilterInTableSettings(s,G,false,"Adding column");},_iSortTableByColumn:function(t,C){return this._iOpenTableSortSettings(t).and._iAddColumnInTableSettings(C);},_iModifyFilterInTableSettings:function(s,G,i,D){return O.create(this).hasType("sap.m.ColumnListItem").isDialogElement().hasProperties({selected:i}).has(_(s,G)).doOnChildren(O.create(this).hasType("sap.m.CheckBox").doPress()).description(D+" '"+s+"'").execute();}},assertions:{_onTable:function(t){return new c(j(this,t),t);},_onFilterBar:function(i){return new f(k(this,i),i);},iSeeThisPage:function(){return O.create(this).hasId(v).viewId(null).viewName(null).description(U.formatMessage("Seeing the page '{0}'",v)).execute();},iSeeFilterDefinedOnActionDialogValueHelp:function(A,V,s,i){return O.create(this).hasId(A+"::"+V+"::FilterBar::FF::"+s+"-inner").isDialogElement().hasAggregationProperties("tokens",{text:i}).description("Seeing filter for '"+s+"' set to '"+i+"'").execute();},_iSeeTheMessageToast:function(t){return O.create(this).has(function(){return!!a.getJQuery()(".sapMMessageToast").length;}).check(function(){return a.getJQuery()(".sapMMessageToast").getEncodedText()===t;}).description("Toast message '"+t+"' is displayed").execute();},iSeeMessageErrorDialog:function(){return O.create(this).isDialogElement().hasType("sap.m.Bar").hasAggregation("contentMiddle",O.Matchers.properties({"text":"Error"})).description("Seeing message error dialog").execute();},_iSeeButtonWithText:function(t,B){return F.create(this).hasType("sap.m.Button").hasProperties({text:t}).hasState(B).checkNumberOfMatches(1).description(U.formatMessage("Seeing Button with text '{0}'"+(B?" with state: '{1}'":""),t,B)).execute();},_iSeeBreadCrumb:function(I,l,s){var B,L,o=F.create(this).hasId(I);if(l){if(typeof l==="string"){B=l;L=s;var m=B.split("/");o.hasAggregationLength("links",m.length-1).has(function(n){var i=0;while(i<n.getLinks().length){if(n.getLinks()[i].mProperties.text===m[i]){i++;}else{return false;}}return true;});}else if(typeof l==="object"){L=l;o.hasSome(O.Matchers.properties({visible:false}),O.Matchers.aggregationLength("links",0));}}o.hasState(L||{visible:true});o.description(U.formatMessage("Seeing BreadCrumb '{0}'"+(B?" with link '{1}'":"")+(L?" with state: '{2}'":""),I,B,L));return o.execute();},_iSeeElement:function(i,o){return F.create(this).hasId(i).hasState(o).description(U.formatMessage("Seeing Element '{0}'"+(o?" with state: '{1}'":""),i,o)).execute();},_checkPaginatorButtonEnablement:function(n,i){var m=n?{icon:"sap-icon://navigation-down-arrow"}:{icon:"sap-icon://navigation-up-arrow"};m.enabled=i;return O.create(this).hasType("sap.fe.templates.controls.Paginator").doOnChildren(O.create(this).hasType("sap.uxap.ObjectPageHeaderActionButton").hasProperties(m).mustBeEnabled(false)).description("Paginator button "+(n?"Up":"Down")+" is "+(i?"enabled":"disabled")).execute();},iSeeActionParameterDialog:function(D){return O.create(this).hasType("sap.m.Dialog").hasProperties({title:D}).isDialogElement().description("Seeing Action Parameter Dialog with title '"+D+"'").execute();},iSeeActionCustomDialog:function(D){return O.create(this).hasType("sap.m.Text").hasProperties({text:D}).isDialogElement().description("Seeing Action Custom Dialog '"+D+"'").execute();},iSeeActionDefaultDialog:function(){return(O.create(this).hasType("sap.m.Text").has(O.Matchers.resourceBundle("text","sap.fe.core","SAPFE_ACTION_CONFIRM")).isDialogElement().description("Seeing Action Default Dialog ").execute());},iSeeActionParameterContent:function(s,C){var i="APD_::"+s+"-inner";return O.create(this).hasId(i).isDialogElement().hasProperties({value:C}).description("Seeing Action parameter '"+s+"' with content '"+C+"'").execute();},iSeeActionVHDialog:function(s,A,i){return O.create(this).hasId(s+"."+A+"::"+i+"-dialog").isDialogElement().description("Seeing Action Value Help dialog for field "+i).execute();},iSeeActionVHDialogFilterBar:function(s,A,i){return O.create(this).hasId(s+"."+A+"::"+i+"::FilterBar").isDialogElement().description("Seeing Action Value Help FilterBar for field "+i).execute();},iSeeActionVHDialogTable:function(s,A,i){return O.create(this).hasId(s+"."+A+"::"+i+"::Table").isDialogElement().description("Seeing Action Value Help Table for field "+i).execute();},iSeePageHeaderButton:function(C){return O.create(this).hasType("sap.m.Button").has(O.Matchers.resourceBundle("tooltip","sap.f",C?"COLLAPSE_HEADER_BUTTON_TOOLTIP":"EXPAND_HEADER_BUTTON_TOOLTIP")).description("Seeing the "+(C?"Collapse":"Expand")+" Page Header Button").execute();},_iSeeSortedColumn:function(t,C,p,D){var i={};i[p]=D?"Descending":"Ascending";return O.create(this).hasId(t+"::C::"+C+"-innerColumn").hasProperties(i).description(U.formatMessage("Seeing column '{0}' sorted by '{1}' {2}",C,p,i[p])).execute();},_iSeeControlsP13nMode:function(C,m){if(!Array.isArray(m)){m=[];}m.sort();return O.create(this).hasId(C).check(function(o){var p=o.getP13nMode();if(!Array.isArray(p)){p=[];}p.sort();return h(m,p);}).description(U.formatMessage("Seeing p13n modes {0} for Control {1}",m,C)).execute();},_iSeeExportExcelOptions:function(t){return O.create(this).hasId(t+"-export").description("Seeing excel export options").execute();},_iDoNotSeeExportExcelOptions:function(t){return O.create(this).hasType("sap.ui.mdc.ActionToolbar").check(function(A){var i=A.some(function(A){return A.getId()===v+"--"+t+"-export";});return i===false;},true).description("Do not see excel export options").execute();},_iSeeTableRowWithCellProperty:function(t,C,o){return T.create(this).hasId(t).hasRows([T.Row.Matchers.cellProperties(C)]).description(U.formatMessage("Seeing table '{0}' having properties '{1}'",t,JSON.stringify(C))).execute(this);}}};}};});
