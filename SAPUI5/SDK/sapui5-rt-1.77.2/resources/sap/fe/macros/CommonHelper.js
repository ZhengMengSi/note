/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2017 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/fe/macros/ResourceModel","sap/ui/model/odata/v4/AnnotationHelper","sap/base/Log","./StableIdHelper","sap/ui/mdc/condition/ConditionModel","sap/fe/core/CommonUtils","sap/ui/mdc/odata/v4/FieldBaseDelegate","sap/ui/mdc/condition/FilterOperatorUtil","sap/fe/navigation/NavigationHelper","sap/fe/navigation/SelectionVariant"],function(R,O,L,S,C,a,F,b,N,c){"use strict";var H={isVisible:function(t,i){var m=i.context.getModel(),p=i.context.getPath(),A=m.getObject(p+"@"),h=A["@com.sap.vocabularies.UI.v1.Hidden"];return typeof h==="object"?"{= !${"+h.$Path+"} }":!h;},fireButtonPress:function(B){return a.fireButtonPress(B);},getParameterEditMode:function(t,i){var m=i.context.getModel(),p=i.context.getPath(),A=m.getObject(p+"@"),f=A["@com.sap.vocabularies.Common.v1.FieldControl"],d=A["@Org.OData.Core.V1.Immutable"],e=A["@Org.OData.Core.V1.Computed"];if(f&&f.$Path){if(f.$Path==="ReadOnly"){return sap.ui.mdc.EditMode.ReadOnly;}else{return("{= %{"+f.$Path+"} ? "+"'"+sap.ui.mdc.EditMode.ReadOnly+"'"+" : "+"'"+sap.ui.mdc.EditMode.Editable+"'"+" }");}}if(f&&f.$EnumMember){if(f.$EnumMember==="com.sap.vocabularies.Common.v1.FieldControlType/ReadOnly"){return sap.ui.mdc.EditMode.ReadOnly;}}if(d||e){return sap.ui.mdc.EditMode.ReadOnly;}return sap.ui.mdc.EditMode.Editable;},getMetaPath:function(t,i){return(i&&i.context&&i.context.getPath())||undefined;},getStableId:S.generate,getTargetCollection:function(o,n){var p=o.getPath(),P,e,d;if(o.getMetadata().getName()==="sap.ui.model.Context"&&o.getObject("$kind")==="EntitySet"){return p;}if(o.getModel){p=(o.getModel().getMetaPath&&o.getModel().getMetaPath(p))||o.getModel().getMetaModel().getMetaPath(p);}P=p.split("/").filter(Boolean);e="/"+P[0];if(P.length===1){return e;}d=typeof n==="undefined"?P[P.length-1]:n;return e+"/$NavigationPropertyBinding/"+d;},isPropertyFilterable:function(p,i){var e,P,I=false,m=i.context.getModel(),s=i.context.getPath();if(m.getObject(s+"@com.sap.vocabularies.UI.v1.Hidden")){return false;}if(m.getObject(s+"@com.sap.vocabularies.UI.v1.HiddenFilter")){return false;}e=H._getEntitySetPath(m,s);if(typeof p==="string"){P=p;}else{P=m.getObject(s+"@sapui.name");}if(P.indexOf("/")<0){I=H._isInNonFilterableProperties(m,e,P);}else{I=H._isContextPathFilterable(m,e,P);}return!I;},_isInNonFilterableProperties:function(m,e,s){var i=false;var A=m.getObject(e+"@Org.OData.Capabilities.V1.FilterRestrictions");if(A&&A.NonFilterableProperties){i=A.NonFilterableProperties.some(function(p){return p.$NavigationPropertyPath===s||p.$PropertyPath===s;});}return i;},_isContextPathFilterable:function(m,e,s){var d=s.split("/"),i=false,f="";d.some(function(g,h,j){if(f.length>0){f+="/"+g;}else{f=g;}if(h===j.length-1){i=H._isInNonFilterableProperties(m,e,f);}else if(m.getObject(e+"/$NavigationPropertyBinding/"+g)){i=H._isInNonFilterableProperties(m,e,f);f="";e="/"+m.getObject(e+"/$NavigationPropertyBinding/"+g);}return i===true;});return i;},replaceSpecialCharsInId:function(i){if(i.indexOf(" ")>=0){L.error("Annotation Helper: Spaces are not allowed in ID parts. Please check the annotations, probably something is wrong there.");}return i.replace(/@/g,"").replace(/\//g,"::").replace(/#/g,"::");},formatDraftLockText:function(I,d,e){if(!I){return R.getText("draft.DRAFT_OBJECT");}else if(d){if(e){return R.getText("draft.LOCKED_OBJECT");}else{return R.getText("draft.UNSAVED_CHANGES");}}else{return"";}},_getEntitySetPath:function(m,p){var l;var e=p.slice(0,p.indexOf("/",1));if(m.getObject(e+"/$kind")==="EntityContainer"){l=e.length+1;e=p.slice(l,p.indexOf("/",l));}return e;},getMergedLineContexts:function(l,f,p){var s;s=f?N.mixAttributesAndSelectionVariant({},f.toJSONString()):N.mixAttributesAndSelectionVariant(p,new c());for(var i=0;i<l.length;i++){if(f){s=N.mixAttributesAndSelectionVariant(l[i].getObject(),s.toJSONString());s=N.removeSensitiveData(l[i],s);}else if(p){s=N.mixAttributesAndSelectionVariant(l[i],s.toJSONString());}}return s;},_resolveValueHelpField:function(o){var v=o.getModel();var V=v.getObject("/");return V.$model.getMetaModel().createBindingContext("/"+V.CollectionPath+"/"+o.getObject());},getBoolAnnotationValue:function(A){var v=A||false;v=v===true||(v&&v["Bool"]!=="false");return v;},gotoTargetEntitySet:function(o){var p=H.getTargetCollection.call(H,o);return p+"/$";},gotoActionParameter:function(o){var p=o.getPath(),P=o.getObject(p+"/$Name");var s;if(p.indexOf("@$ui5.overload")>-1){s=p.split("@$ui5.overload")[0];}else{var A=p.split("/0/")[0].split(".");s="/"+A[A.length-1]+"/";}return s+P;},showNavigateErrorMessage:function(e){sap.m.MessageBox.show(R.getText("navigation.ERROR_MESSAGE"),{title:R.getText("navigation.ERROR_TITLE")});},getLabel:function(m,p){p=p||"";return(m.getProperty(p+"@@sap.ui.model.odata.v4.AnnotationHelper.label")||m.getProperty(p+"@com.sap.vocabularies.Common.v1.Label")||m.getProperty(p+"/@com.sap.vocabularies.Common.v1.Label")||m.getProperty(p+"@sapui.name"));},getIdentifyingName:function(m,i){return((i?this._getEntitySetPath(m.getModel(),m.getPath())+"/":"")+(m.getProperty("Value/$Path")||m.getProperty("Target/$AnnotationPath")||m.getProperty("@sapui.name")));},getEntitySetName:function(m,e){var E=m.getObject("/");for(var k in E){if(typeof E[k]==="object"&&E[k].$Type===e){return k;}}},getActionPath:function(A,r,s,d){s=!s?A.getObject(A.getPath()):s;var e=A.getPath().split("/@")[0];e=A.getObject(e).$Type;e=this.getEntitySetName(A.getModel(),e);if(d){return A.getObject("/"+e+"/"+s+"@Org.OData.Core.V1.OperationAvailable");}if(r){return"/"+e+"/"+s;}else{return{sEntityName:e,sProperty:A.getObject("/"+e+"/"+s+"@Org.OData.Core.V1.OperationAvailable/$Path"),sBindingParameter:A.getObject("/"+e+"/"+s+"/@$ui5.overload/0/$Parameter/0/$Name")};}},getEditMode:function(A,d,f,D,e,s,p,r,g,u){if(g){return false;}if(e==="Display"||e==="ReadOnly"||e==="Disabled"){return e;}var h,i,j,E,k,l,m,n,o,I,q;if(d==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"||(A&&A["@com.sap.vocabularies.Common.v1.SemanticObject"]&&!(A["@com.sap.vocabularies.Common.v1.ValueListReferences"]||A["@com.sap.vocabularies.Common.v1.ValueListMapping"]||A["@com.sap.vocabularies.Common.v1.ValueList"]||A["@com.sap.vocabularies.Common.v1.ValueListWithFixedValues"]))){return"Display";}if(A&&A["@Org.OData.Core.V1.Computed"]){h=A["@Org.OData.Core.V1.Computed"].Bool?A["@Org.OData.Core.V1.Computed"].Bool=="true":true;}if(A&&A["@Org.OData.Core.V1.Immutable"]){i=A["@Org.OData.Core.V1.Immutable"].Bool?A["@Org.OData.Core.V1.Immutable"].Bool=="true":true;}k=h||i;if(s&&s.indexOf("{")===0){s="$"+s;}o=typeof h==="undefined"?typeof i==="undefined"||i:!h;if(f){if(f.indexOf("{")===0){I="$"+f+" === '1'";q="$"+f+" === '0'";}else{k=k||f=="com.sap.vocabularies.Common.v1.FieldControlType/ReadOnly";}}var t;var v;var w;var x;if(I){x=e==="Editable"?"'ReadOnly'":"$"+e+" === 'Editable' ? 'ReadOnly'  : 'Display'";if(o){v=e==="Editable"?s+" ? 'Editable' : 'ReadOnly'":"$"+e+" === 'Editable' ? "+s+"? 'Editable' : 'ReadOnly'  : 'Display'";w=e==="Editable"?"'Disabled'":"$"+e+" === 'Editable' ? 'Disabled' : 'Display'";}else{v=e==="Editable"?"'ReadOnly'":"$"+e+" === 'Editable' ? 'ReadOnly' : 'Display'";w=e==="Editable"?"'Disabled'":"$"+e+" === 'Editable' ? 'Disabled' : 'Display'";}}else{v="'Display'";w="'Display'";x="'Display'";}l=e&&e.indexOf("{")===0?"$"+e:"'"+e+"'";if(k){if(!o){if(e&&e.indexOf("{")===0){return r?false:"{= "+v+"}";}v=v.split("'")&&v.split("'")[1];return r?false:v;}else{if(I){if(s&&s.indexOf("$")===0){return("{= "+s+" ? ("+q+"? "+(r?false:"'Disabled'")+" : "+I+"? "+(r?false:"'ReadOnly'")+" : "+(r?"${ui>/editable} === 'Editable'":l)+") : "+(r?false:v)+"}");}else if(s=="true"){return("{= "+q+"? "+(r?false:"'Disabled'")+" : "+I+"? "+(r?false:"'ReadOnly'")+" : "+(r?"${ui>/editable} === 'Editable'":l)+"}");}else{return r?false:"{= "+v+"}";}}else if(f=="com.sap.vocabularies.Common.v1.FieldControlType/ReadOnly"){l="'ReadOnly'";}if(s&&s.indexOf("$")===0){return("{= "+s+" ?"+(r?"${ui>/editable} === 'Editable'":l)+" : "+(r?false:v)+"}");}else if(s=="true"){return"{= "+(r?"${ui>/editable} === 'Editable'":l)+"}";}else{return r?false:"{= "+v+"}";}}}if(I){if(u){l="$"+u+" === '1' ? 'EditableReadOnly' : "+l;}j=q+" ? "+(r?false:w)+" :"+I+" ? "+(r?false:x)+" :"+(r?"${ui>/editable} === 'Editable'":l);t="{= "+j+"}";}else if(u){m="$"+u+" === '1'";n=e==="Editable"?"'EditableReadOnly'":"$"+e+" === 'Editable' ? 'EditableReadOnly' : 'Display'";j=m+" ? "+n+" :"+l;t="{= "+j+"}";}else{j=l;t=r?"{= ${ui>/editable} === 'Editable'}":e;}var y;if(s&&s.indexOf("$")===0){y="{= "+s+" ? "+(r?false:v)+" : "+j+"}";}else if(s=="true"){y=r?false:"{= "+v+"}";}else{y="{= "+j+"}";}E=o?t:y;return E;},getNavigationContext:function(o){return O.getNavigationPath(o.getPath());},getHiddenPathExpression:function(d,D){var o=D.context,h,p=o.getPath(),e=O.getNavigationPath(p),s,P;if(o.getObject(p+"@com.sap.vocabularies.UI.v1.Hidden")){s=o.getObject(p+"@com.sap.vocabularies.UI.v1.Hidden");}else{if(p.lastIndexOf("/")===p.length-1){P="Value/$Path@com.sap.vocabularies.UI.v1.Hidden";}else{P="/Value/$Path@com.sap.vocabularies.UI.v1.Hidden";}s=o.getObject(p+P);}if(s){if(s.$Path){if(s.$Path.indexOf("/")>0){var n=s.$Path.split("/")[0];if(o.getObject(e+"/"+n)&&!o.getObject(e+"/"+n).$isCollection){h="%{"+s.$Path+"}";}else{return true;}}else{h="%{"+s.$Path+"}";}return"{= "+h+"=== true ? false : true }";}else{return"{= "+s+"=== true ? false : true }";}}return true;},operators:function(p,i){var e=["EQ"];var s=["EQ","BT","BTEX","LT","NOTLT","GT","NOTGT","LE","NOTLE","GE","NOTGE"];var m=["EQ","BT","BTEX","NOTBT","NOTBTEX","LT","NOTLT","GT","NOTGT","LE","NOTLE","GE","NOTGE","NE"];var d=["StartsWith","NotStartsWith","EndsWith","NotEndsWith","Contains","NotContains"];var o=i.context,M=o.getModel(),P=o.getPath(),E=H._getEntitySetPath(M,P),f=M.getObject(E+"@Org.OData.Capabilities.V1.FilterRestrictions");if(f&&f.FilterExpressionRestrictions&&f.FilterExpressionRestrictions.some(function(h){return h.Property.$PropertyPath===p;})){var r=M.getObject(P+"/$Type");var D=H._getDefaultOperators(r);var g=f.FilterExpressionRestrictions.filter(function(h){return h.Property.$PropertyPath===p;});if(g.some(function(h){return h.AllowedExpressions==="SingleValue"||h.AllowedExpressions==="MultiValue";})){return H._getRestrictions(D,e);}if(g.some(function(h){return h.AllowedExpressions==="SingleRange";})){return H._getRestrictions(D,s);}if(g.some(function(h){return h.AllowedExpressions==="MultiRange";})){return H._getRestrictions(D,m);}if(g.some(function(h){return h.AllowedExpressions==="SearchExpression";})){return H._getRestrictions(D,d);}if(g.some(function(h){return h.AllowedExpressions==="MultiRangeOrSearchExpression";})){return H._getRestrictions(D,d.concat(m));}return undefined;}},_getDefaultOperators:function(r){var d=F.getDataTypeClass(null,r);var B=F.getBaseType(null,d);return b.getOperatorsForType(B);},_getRestrictions:function(d,e){var o=d.filter(function(E){return e.indexOf(E)>-1;});return o.toString()||undefined;}};H.isPropertyFilterable.requiresIContext=true;return H;},true);
