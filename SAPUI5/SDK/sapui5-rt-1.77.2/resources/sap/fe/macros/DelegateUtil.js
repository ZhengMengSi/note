/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2017 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/mdc/TableDelegate","sap/ui/mdc/FilterBarDelegate","sap/ui/core/XMLTemplateProcessor","sap/ui/core/util/XMLPreprocessor","sap/ui/core/Fragment","sap/ui/model/json/JSONModel","sap/fe/macros/CommonHelper","sap/fe/macros/StableIdHelper","sap/fe/macros/field/FieldHelper","sap/base/util/ObjectPath","sap/ui/mdc/odata/v4/FieldBaseDelegate","sap/ui/model/odata/type/String","sap/fe/macros/ResourceModel","sap/base/util/merge"],function(T,F,X,a,b,J,C,S,c,O,d,e,R,m){"use strict";var D={},N="http://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1";function _(){this.control.detachModelContextChange(_,this);var M=this.modelName,o=this.control.getModel(M);if(o){this.resolve(o);}else{this.control.attachModelContextChange(_,this);}}D.getCustomDataProperty=function(p,o,M){if(M&&M.targets==="xmlTree"){return o.getAttributeNS(N,p);}return(o.data&&o.data(p))||undefined;};D.fetchPropertiesForEntity=function(E,M){return M.requestObject(E+"/");};D.fetchAnnotationsForEntity=function(E,M){return M.requestObject(E+"@");};D.fetchModel=function(o){return new Promise(function(r,f){var M=o.getDelegate().payload&&o.getDelegate().payload.modelName,g={modelName:M,control:o,resolve:r};_.call(g);});};D.templateControlFragment=function(f,p,o,i){return a.process(X.loadTemplate(f,"fragment"),{name:f},p).then(function(g){var h=g.firstElementChild;if(i&&h){return h;}return b.load({definition:g,controller:o});});};D.checkValueHelp=function(p){var v=false,P=p.sPropertyName||"",V=p.sVHIdPrefix||"",M=p.oMetaModel,o=p.oModifier,s=p.sBindingPath+"/"+P,f=M.createBindingContext(s);return Promise.all([M.requestObject(s+"@com.sap.vocabularies.Common.v1.ValueListReferences"),M.requestObject(s+"@com.sap.vocabularies.Common.v1.ValueListMapping"),M.requestObject(s+"@com.sap.vocabularies.Common.v1.ValueList")]).then(function(r){var g=r[0]||r[1]||r[2];if(g){var h=c.valueHelpProperty(f),G=S.generate([S.generate([o.getId(p.oControl),V]),P]);if(h.indexOf("$Path")>-1){h=M.getObject(h);}if(s!==h){G=S.generate([G,h]);}v=o.getAggregation(p.oControl,"dependents").some(function(i){return o.getId(i)===G;});}return g&&!v;});};return D;});
