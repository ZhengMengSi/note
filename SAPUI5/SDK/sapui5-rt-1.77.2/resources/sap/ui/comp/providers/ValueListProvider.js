/*
 * ! SAPUI5

		(c) Copyright 2009-2020 SAP SE. All rights reserved
	
 */
sap.ui.define(['sap/ui/core/library','sap/ui/comp/library','sap/m/library','sap/ui/comp/odata/MetadataAnalyser','sap/ui/core/SeparatorItem','sap/m/GroupHeaderListItem','sap/m/Column','sap/m/ColumnListItem','sap/m/Text','sap/m/Token','./BaseValueListProvider','sap/ui/core/ListItem','sap/ui/model/Filter','sap/ui/model/Sorter','sap/ui/model/json/JSONModel','sap/ui/model/FilterOperator','sap/ui/comp/util/FormatUtil','sap/ui/comp/smartfilterbar/FilterProvider','sap/ui/comp/providers/HistoryValuesProvider','sap/ui/Device','sap/base/Log'],function(c,l,L,M,S,G,C,d,T,e,B,f,F,g,J,h,j,k,H,D,m){"use strict";var n=l.smartfilterbar.DisplayBehaviour;var P=L.PopinDisplay;var W=L.WrappingType;var V=c.ValueState;var o={Recommendations:10,RecentlyUsed:20,Others:30};var p="order";var q="list";var r=B.extend("sap.ui.comp.providers.ValueListProvider",{constructor:function(a){if(!k){k=sap.ui.require("sap/ui/comp/smartfilterbar/FilterProvider");}if(a){this.sAggregationName=a.aggregation;this.bTypeAheadEnabled=!!a.typeAheadEnabled;this.bEnableShowTableSuggestionValueHelp=a.enableShowTableSuggestionValueHelp===undefined?true:a.enableShowTableSuggestionValueHelp;this.dropdownItemKeyType=a.dropdownItemKeyType;this.sDeferredGroupId=a.deferredGroupId;this.sContext=a.context;}this._aRecommendations=[];this._oRecommendationListPromise=Promise.resolve();this._oHistoryDataPromise=Promise.resolve();this._oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");this._groupHeaderFactory=this._groupHeaderFactory.bind(this);B.apply(this,arguments);this._onInitialise();}});r.prototype._onInitialise=function(){if(!this.bTypeAheadEnabled){this.oAfterRenderingEventDelegate={onAfterRendering:this._onMetadataInitialised};this.oControl.addEventDelegate(this.oAfterRenderingEventDelegate,this);}else if(this.oControl.attachSuggest){this._fSuggest=function(E){this.oControl=E.getSource();if(!this.bInitialised){return;}if(!this.oTemplate||!this.oControl.data("_hassuggestionTemplate")){this._createSuggestionTemplate();}var a=E.getParameter("suggestValue");this._fetchData(a);}.bind(this);this.oControl.attachSuggest(this._fSuggest);if(!this.oFilterModel){var t=this;var s=this.oControl.setParent;this.oControl.setParent=function(N,a,b){var O=this.getParent();var R=s.apply(this,arguments);N=this.getParent();var A=!(N&&(O===null));if((N!==O)&&A){t.unbindAggregation();}return R;};}this._handleSelect();}this.oControl.setModel(new J(),q);this._setupHistoryValues();this._setupRecommendations();};r.prototype._onMetadataInitialised=function(){if(this.bInitialised){if(this.oAfterRenderingEventDelegate){this.oControl.removeEventDelegate(this.oAfterRenderingEventDelegate);}if(this.oPrimaryValueListAnnotation){if(this.sAggregationName&&this.sAggregationName=="suggestionRows"){this._createSuggestionTemplate();}else{this._createDropDownTemplate();}this._fetchData();}else{m.error("ValueListProvider","Missing primary ValueListAnnotation for "+(this._sFullyQualifiedFieldName||this.sFieldName));}if(this.oAfterRenderingEventDelegate){delete this.oAfterRenderingEventDelegate;}}};r.prototype._onAnnotationLoad=function(v){B.prototype._onAnnotationLoad.call(this,v);if(this._shouldHaveRecommendations()||this._shouldHaveHistory()){this._bindInnerControlSuggestions();this._setupSuggestionInteractions();}};r.prototype._isSortable=function(N){if(this.oPrimaryValueListAnnotation){for(var i=0;i<this.oPrimaryValueListAnnotation.valueListFields.length;i++){if(this.oPrimaryValueListAnnotation.valueListFields[i].name===N){return this.oPrimaryValueListAnnotation.valueListFields[i].sortable!==false;}}return false;}return false;};r.prototype._createDropDownTemplate=function(){this._oTemplate=new f({key:{path:this._resolveSuggestionBindingPath(this.sKey),type:this.dropdownItemKeyType},text:{parts:[{path:this._resolveSuggestionBindingPath(this.sKey),type:this.dropdownItemKeyType},{path:this._resolveSuggestionBindingPath(this.sDescription)}],formatter:j.getFormatterFunctionFromDisplayBehaviour(this.sDDLBDisplayBehaviour)}});if(this._oRecommendationListAnnotation){this._oTemplate.bindProperty("additionalText",{path:this._resolveSuggestionBindingPath(this._oRecommendationListAnnotation.rankProperty)});}this._oSorter=null;if(this.sDDLBDisplayBehaviour===n.idOnly||this.sDDLBDisplayBehaviour===n.idAndDescription){if(this._isSortable(this.sKey)){this._oSorter=new g(this.sKey);}}else{if(this._isSortable(this.sDescription)){this._oSorter=new g(this.sDescription);}else if((this.sDescription!==this.sKey)&&this._isSortable(this.sKey)){this._oSorter=new g(this.sKey);}}};r.prototype._createSuggestionTemplate=function(){var i=0,a=0,s=0,b=this._aHighImportanceCols||this._aRecommendationCols||this._aCols;this._oTemplate=new d();if(b){this.oControl.removeAllSuggestionColumns();a=b.length;for(i=0;i<a;i++){var t=false,u="1px",w=b[i].width;if(D.system.phone){w=undefined;if(i>=2){t=true;u=(i+1)*10+"rem";}}this.oControl.addSuggestionColumn(new C({header:new T({wrapping:true,wrappingType:W.Hyphenated,text:b[i].label}),demandPopin:t,popinDisplay:P.Inline,minScreenWidth:u,width:w}));this._oTemplate.addCell(new T({wrapping:true,text:{path:this._resolveSuggestionBindingPath(b[i].template),type:b[i].oType}}));if(w){s+=parseFloat(w.substring(0,w.length-2));}}if(s>0){this.oControl.setProperty('maxSuggestionWidth',s+a+"em",true);}}this.oControl.data("_hassuggestionTemplate",true);};r.prototype._handleRowSelect=function(a,b){var K,t,i;if(a){K=a[this.sKey];t=a[this.sDescription];}if(K||(K==="")){if(this.oControl.addToken){t=j.getFormattedExpressionFromDisplayBehaviour(this.sTokenDisplayBehaviour,K,t);i=new e();i.setKey(K);i.setText(t);i.setTooltip(t);i.data("row",a);if(b){b(i);}if(this.oControl.getValue()===""){this.oControl.setValue("");}delete this.oControl.__sValidationText;}else{this.oControl.setValue(K);this.oControl.fireChange({value:K,validated:true});}}this._calculateAndSetFilterOutputData([a]);};r.prototype._multiInputValidator=function(a){if(!this.bInitialised){return;}if(this._aValidators){var t;this._aValidators.some(function(v){t=v(a);return t;},this);if(t){return t;}}var R=a.suggestionObject,b,i=a.text;if(R){var s=this._getSuggestionsModelName(),u=R.getBindingContext(s);b=u.getObject();this._handleRowSelect(b,a.asyncCallback);}else if(i){this._validateInput(i,a.asyncCallback);}};r.prototype._validateInput=function(i,a){var b=[],s=this.oControl,t;if(this.sDisplayFormat==="UpperCase"){i=i.toUpperCase();}if(s.__sValidationText!==i){s.__sValidationText=i;if(i===this._truncateSearchText(i)){s.__bValidatingToken=true;this._calculateFilterInputData();if(this.mFilterInputData&&this.aFilterField){b=k.generateFilters(this.aFilterField,this.mFilterInputData);}b.push(new F(this.sKey,h.EQ,i));if(this.bSupportBasicSearch){t={"search-focus":this.sKey};}this.oODataModel.read("/"+this.sValueListEntitySetName,{filters:b,urlParameters:t,success:function(R){if(!this.oControl||!this.oControl.hasOwnProperty("__bValidatingToken")){return;}var u=R;delete this.oControl.__bValidatingToken;if(R){if(R.results&&R.results.length>=1){if(R.results.length===1){u=R.results[0];}if(this.oControl.data("__validationError")){this.oControl.data("__validationError",null);this.oControl.setValueState("None");}}else{this.oControl.setValueState("Error");this.oControl.data("__validationError",true);}if(u&&u[this.sKey]){this._handleRowSelect(u,a);}}this._afterTokenValidate();}.bind(this),error:function(){if(this.oControl.data("__validationError")){this.oControl.setValueState("None");}delete this.oControl.__bValidatingToken;this._afterTokenValidate();}.bind(this)});}}else{if(s.data("__validationError")){s.setValueState(V.Error);}}};r.prototype._validateStringSingleWithValueList=function(E){var v;if(E.getParameter("validated")){return;}v=E.getParameter("value");if(v===""||v===undefined){return;}this._validateInput(v);};r.prototype._afterTokenValidate=function(){if(this.oFilterProvider&&this.oFilterProvider._oSmartFilter&&this.oFilterProvider._oSmartFilter.bIsSearchPending&&this.oFilterProvider._oSmartFilter.search){if(this.oFilterProvider._oSmartFilter.getLiveMode&&this.oFilterProvider._oSmartFilter.getLiveMode()){return;}this.oFilterProvider._oSmartFilter.search();}};r.prototype._onSuggestionItemSelected=function(E){var R=E.getParameter("selectedRow");if(R){var s=this._getSuggestionsModelName();this._handleRowSelect(R.getBindingContext(s).getObject());}};r.prototype._handleSelect=function(){if(this.oControl.addValidator){this._aValidators=this.oControl._tokenizer?this.oControl._tokenizer._aTokenValidators.slice():[];this.oControl.removeAllValidators();this._fValidator=this._multiInputValidator.bind(this);this.oControl.addValidator(this._fValidator);}else if(this.oControl.attachSuggestionItemSelected){this.oControl.attachSuggestionItemSelected(this._onSuggestionItemSelected,this);if(this.sContext==="SmartFilterBar"&&this._fieldViewMetadata&&this._fieldViewMetadata.hasValueListAnnotation){this.oControl.attachChange(this._validateStringSingleWithValueList,this);}}this.oControl.setRowResultFunction(function(s){var a,R="",b=this._getSuggestionsModelName();if(s){a=s.getBindingContext(b);}if(a&&this.sKey){R=a.getProperty(this.sKey);}return R;}.bind(this));};r.prototype._fetchData=function(s){var a={},b=[],i=this._getBindingLength(),t="",v;s=s||"";if(this.bTypeAheadEnabled){if(s&&this.sDisplayFormat==="UpperCase"){s=s.toUpperCase();}if(this.bSupportBasicSearch){if(this._shouldHaveRecommendations()||this._shouldHaveHistory()){a={"search-focus":this.sKey,"search":s};}else{a.custom={"search-focus":this.sKey,"search":s};}}this._calculateFilterInputData();if(this.mFilterInputData&&this.aFilterField){b=k.generateFilters(this.aFilterField,this.mFilterInputData,{dateSettings:this._oDateFormatSettings});}if(!this.bSupportBasicSearch){if(this._fieldViewMetadata&&this._fieldViewMetadata.filterType==="numc"){b.push(new F(this.sKey,h.Contains,s));}else{t=this._truncateSearchText(s);if(t===s){b.push(new F(this.sKey,h.StartsWith,t));}else{this.oControl.closeSuggestions();return;}}}i=10;}a["$top"]=i;a["$skip"]=0;if(!this.sValueListEntitySetName){m.error("ValueListProvider","Empty sValueListEntitySetName for "+this.sAggregationName+" binding! (missing primaryValueListAnnotation)");}if(this.sDeferredGroupId){a["batchGroupId"]=this.sDeferredGroupId;}if(this.aSelect&&this.aSelect.length){a["$select"]=this.aSelect.toString();}if(!(this._shouldHaveRecommendations()||this._shouldHaveHistory())){if(this.bTypeAheadEnabled&&this.bEnableShowTableSuggestionValueHelp){var E={dataReceived:function(w){var x=w.getSource(),y;if(x){y=x.getLength();if(y&&y<=i){this.oControl.setShowTableSuggestionValueHelp(false);}else{this.oControl.setShowTableSuggestionValueHelp(true);}}}.bind(this)};}else if(this.bTypeAheadEnabled){this.oControl.setShowTableSuggestionValueHelp(false);}this.oControl.bindAggregation(this.sAggregationName,{path:"/"+this.sValueListEntitySetName,length:i,parameters:a,filters:b,sorter:this._oSorter,events:E,template:this._oTemplate,templateShareable:false});return;}var u=this;v=new Promise(function(w,x){if(!u.sValueListEntitySetName){w({results:[]});}u.oODataModel.read("/"+u.sValueListEntitySetName,{urlParameters:a,filters:b,sorters:u._oSorter&&[u._oSorter],success:function(y){w(y);},error:function(y){x(y);}});});Promise.all([v,this._oRecommendationListPromise,this._oHistoryDataPromise]).then(function(R){var w=[],x=[],y=[],z=[],A=u._getSuggestionsModelName(),I=u.oControl,K=I.getModel(A),N=[];if(Array.isArray(R[0]&&R[0].results)){x=u._addSuggestionsToGroup(R[0].results,o.Others);}if(Array.isArray(R[1]&&R[1].results)){y=u._addSuggestionsToGroup(R[1].results,o.Recommendations);}if(u._shouldHaveHistory()){z=u._getHistoryProvider().getFieldData(u._fieldViewMetadata.fullName);z=u._addSuggestionsToGroup(z,o.RecentlyUsed);}w=w.concat(y).concat(x);w=u._getDistinctSuggestions(w);w=w.concat(z);u._showSuggestionsMoreButton(x.length>=i);if(I.getSelectedKeys){N=I.getSelectedKeys();}u._bindInnerControlSuggestions();K.setData(w);if(I.setSelectedKeys){I.setSelectedKeys(N);}});};r.prototype._sortRecommendations=function(a,b){var R=this._oRecommendationListAnnotation.rankProperty,i=parseFloat(a[R]),s=parseFloat(b[R]);return s-i;};r.prototype._showSuggestionsMoreButton=function(s){if(!this.bTypeAheadEnabled){return;}if(this.bEnableShowTableSuggestionValueHelp){this.oControl.setShowTableSuggestionValueHelp(s);}else{this.oControl.setShowTableSuggestionValueHelp(false);}};r.prototype._addSuggestionsToGroup=function(s,i){if(!s){return[];}return s.map(function(a){var b={};b[p]=i;return Object.assign({},a,b);});};r.prototype._groupHeaderFactory=function(a){var t=this._getGroupHeaderTitle(a.key);if(this._isValueListWithFixedValues(this._fieldViewMetadata)){return new S({text:t});}return new G({title:t});};r.prototype._getGroupHeaderTitle=function(s){switch(s){case o.Recommendations:return this._oResourceBundle.getText("VALUELIST_RECOMMENDATIONS_TITLE");case o.RecentlyUsed:return this._oResourceBundle.getText("VALUELIST_RECENTLY_USED_TITLE");default:return this._oResourceBundle.getText("VALUELIST_OTHERS_TITLE");}};r.prototype._getGroupHeaderSorter=function(){if(this._groupHeaderSorter){return this._groupHeaderSorter;}this._groupHeaderSorter=new g({path:p,descending:false,group:function(a){return a.getProperty(p);}});return this._groupHeaderSorter;};r.prototype._getDistinctSuggestions=function(a){var u={},b=[];a.forEach(function(x){var s=x[this.sKey];if(!u[s]){b.push(x);u[s]=true;}},this);return b;};r.prototype._resolveRecommendationListAnnotationData=function(R){var a=R.fieldsToDisplay,b,s,t;this._aRecommendationCols=[];this.aRecommendationSelect=[];for(var i=0;i<a.length;i++){b=a[i];s=this._getColumnConfigFromField(b);if(b.visible){this._aRecommendationCols.push(s);this.aRecommendationSelect.push(b.name);}}if(this._aHighImportanceCols&&this._oRecommendationListAnnotation){t=this._oRecommendationListAnnotation.rankField[0];t=this._getColumnConfigFromField(t);this._aHighImportanceCols.push(t);}};r.prototype._setupRecommendations=function(){if(!this._shouldHaveRecommendations()){return;}this._resolveRecommendationListAnnotationData(this._getRecommendationListAnnotation());this._fetchRecommendations();};r.prototype._shouldHaveRecommendations=function(){return M.isRecommendationList(this._fieldViewMetadata);};r.prototype._getRecommendationListAnnotation=function(){if(!this._oRecommendationListAnnotation){var R=this._oMetadataAnalyser._getRecommendationListAnnotation(this._sFullyQualifiedFieldName);this._oRecommendationListAnnotation=this._oMetadataAnalyser._enrichRecommendationListAnnotation(R);}return this._oRecommendationListAnnotation;};r.prototype._isValueListWithFixedValues=function(){var a=this._fieldViewMetadata;return M.isValueListWithFixedValues(a)||a["sap:value-list"]==="fixed-values";};r.prototype._fetchRecommendations=function(){var t=this;this._oRecommendationListPromise=new Promise(function(a,b){t.oODataModel.read("/"+t._oRecommendationListAnnotation.path,{urlParameters:{$skip:0,$top:5,$select:t.aRecommendationSelect.toString()},sorter:t._oSorter,success:function(i){var R=t._addSuggestionsToGroup(i.results,o.Recommendations),s=t._getSuggestionsModelName(),u=t.oControl.getModel(s),v=u.getData(),w=R.sort(t._sortRecommendations.bind(t));t._aRecommendations=w;if(Array.isArray(v)){w=[].concat(v).concat(w);}u.setData(w);t._showSuggestionsMoreButton(false);a(i);},error:function(i){b(i);}});});};r.prototype._getHistoryProvider=function(){return H.getInstance();};r.prototype._setupHistoryValues=function(){if(!this._shouldHaveHistory()){return;}var a=this._getHistoryProvider();a.registerControl(this.oControl,this._fieldViewMetadata.fullName);a.attachEvent("fieldUpdated",function(E){if(this._fieldViewMetadata.fullName!==E.getParameter("fieldName")){return;}var b=E.getParameter("fieldData")||[];this._updateModelHistoryData(b);if(this.oControl&&this.oControl._oSuggestionPopover&&this.oControl._oSuggestionPopover._oPopover&&this.oControl._oSuggestionPopover._oPopover.close){this.oControl._oSuggestionPopover._oPopover.close();}}.bind(this));this._oHistoryDataPromise=a.isDataReady().then(function(b){var i=b[this._fieldViewMetadata.fullName]||[];this._updateModelHistoryData(i);return i;}.bind(this));};r.prototype._updateModelHistoryData=function(a){var b=[],R=this._addSuggestionsToGroup(a,o.RecentlyUsed),s=this._getSuggestionsModelName(),i=this.oControl.getModel(s),O=i.getData();if(Array.isArray(O)){O=O.filter(function(t){return t[p]!==o.RecentlyUsed;});}else{O=[];}b=b.concat(O).concat(R);i.setData(b);this._showSuggestionsMoreButton(false);};r.prototype._shouldHaveHistory=function(){var s=window["sap-ushell-config"],a,i,E;if(s){a=s.apps;}if(a){i=a.inputFieldHistory;}if(i){E=i.enabled;}return sap.ushell&&sap.ushell.Container&&E&&!M.isPotentiallySensitive(this._fieldViewMetadata);};r.prototype._bindInnerControlSuggestions=function(){if(this.sAggregationName&&this.sAggregationName==="suggestionRows"){this._createSuggestionTemplate();}else{this._createDropDownTemplate();}var b={path:this._getSuggestionsModelName()+">/",template:this._oTemplate,templateShareable:false,length:this._getBindingLength()};if(this._shouldHaveRecommendations()||this._shouldHaveHistory()){b.groupHeaderFactory=this._groupHeaderFactory;b.sorter=this._getGroupHeaderSorter();}if(this.sAggregationName){this.oControl.bindAggregation(this.sAggregationName,b);}};r.prototype._setupSuggestionInteractions=function(){if(this.sAggregationName==="suggestionRows"){this._setupInputSuggestionInteractions();return;}this._setupComboBoxSuggestionInteractions();};r.prototype._setupInputSuggestionInteractions=function(){var i=this.oControl;i.setFilterSuggests(true);i.setFilterFunction(function(v,I){var s=this._getSuggestionsModelName(),O=I.getBindingContext(s).getObject()[this.sKey];return O.toLowerCase().indexOf(v.toLowerCase())!==-1;}.bind(this));i.attachLiveChange(function(E){var v=E.getParameter("value"),a=[o.RecentlyUsed,o.Recommendations];if(v===""){this.oControl._oSuggPopover._oPopover.close();this._showInitialSuggestions(a);}},this);i.addEventDelegate({onfocusin:function(){var a=[o.RecentlyUsed,o.Recommendations],A=[o.RecentlyUsed];if(this._isNotRecommendationItemSelected("suggestionRows",i.getValue())){this._showInitialSuggestions(a);}else if(this._shouldHaveHistory()){this._showInitialSuggestions(A);}}},this);if(i.isA("sap.m.MultiInput")||!this._shouldHaveRecommendations()){return;}i.attachSuggestionItemSelected(function(E){var s=this._getSuggestionsModelName(),a=E.getParameter("selectedRow"),I;if(a){var b=a.getBindingContext(s).getObject();I=b&&b[this.sKey];}if(this._isNotRecommendationItemSelected("suggestionRows",I)){this._setControlValueState(V.Warning);}else{this._setControlValueState(V.None);}},this);};r.prototype._setupComboBoxSuggestionInteractions=function(){var a=this.oControl;a.setShowSecondaryValues(true);a.addEventDelegate({onmousedown:function(E){var t=E.srcControl;a._isTargetControlInputField=!(t.isA("sap.m.ComboBox")||t.isA("sap.m.MultiComboBox"));a._isTargetControlIcon=t.isA("sap.ui.core.Icon");a._isMouseDown=true;},onmouseup:function(){setTimeout(function(){a._isMouseDown=false;});},onfocusin:function(){if(a._isTargetControlInputField&&(a._isMouseDown||a._isTargetControlIcon)){return;}var A=[o.RecentlyUsed,o.Recommendations],b=[o.RecentlyUsed];if(this._isNotRecommendationItemSelected("items",a.getValue())){this._showInitialSuggestions(A);}else if(this._shouldHaveHistory()){this._showInitialSuggestions(b);}}},this);if(a.isA("sap.m.MultiComboBox")||!this._shouldHaveRecommendations()){return;}a.attachChange(function(E){if(this._isNotRecommendationItemSelected("items",E.getParameter("value"))){this._setControlValueState(V.Warning);}else{this._setControlValueState(V.None);}},this);};r.prototype._isNotRecommendationItemSelected=function(a,v){return this._findSuggestionItemGroup(a,v)!==o.Recommendations;};r.prototype._findSuggestionItemGroup=function(a,v){var I=this.oControl.getBinding(a).getCurrentContexts(),s;for(var i=0;i<I.length;i++){var b=I[i].getObject(),K=b[this.sKey],t=b[this.sDescription];if(K===v||t===v){s=b;break;}}return s?s[p]:null;};r.prototype._setControlValueState=function(s){this.oControl.setValueState(s?s:V.None);this.oControl.setValueStateText(" ");};r.prototype._showInitialSuggestions=function(a){var t=this;this.oControl.showItems(function(v,i){var s=t._getSuggestionsModelName(),O=i.getBindingContext(s).getObject()[p];return a.indexOf(O)!==-1;});};r.prototype._getSuggestionsModelName=function(){var s;if(this._shouldHaveRecommendations()||this._shouldHaveHistory()){s=q;}return s;};r.prototype._resolveSuggestionBindingPath=function(s){var a=this._getSuggestionsModelName();if(a){s=a+">"+s;}return s;};r.prototype._getBindingLength=function(){var i=300;if(this.oODataModel&&this.oODataModel.iSizeLimit&&this.oODataModel.iSizeLimit>i){i=this.oODataModel.iSizeLimit;}return i;};r.prototype._truncateSearchText=function(s){var i=-1;if(this._sMaxLength){i=parseInt(this._sMaxLength);}else if(this._fieldViewMetadata&&this._fieldViewMetadata.maxLength){i=parseInt(this._fieldViewMetadata.maxLength);}if(i>-1&&s.length>i){s=s.substr(0,i);}return s;};r.prototype.unbindAggregation=function(){if(this.oControl){this.oControl.unbindAggregation(this.sAggregationName);}return this;};r.prototype.destroy=function(){if(this.oControl){if(this.oControl.detachSuggest&&this._fSuggest){this.oControl.detachSuggest(this._fSuggest);this._fSuggest=null;}if(this.oControl.removeValidator&&this._fValidator){this.oControl.removeValidator(this._fValidator);this._fValidator=null;}else if(this.oControl.detachSuggestionItemSelected){this.oControl.detachSuggestionItemSelected(this._onSuggestionItemSelected,this);}if(this.oControl.detachChange){this.oControl.detachChange(this._validateStringSingleWithValueList,this);}this.oControl.unbindAggregation(this.sAggregationName);this.oControl.data("_hassuggestionTemplate",false);delete this.oControl.__sValidationText;delete this.oControl.__bValidatingToken;}B.prototype.destroy.apply(this,arguments);if(this.oJsonModel){this.oJsonModel.destroy();this.oJsonModel=null;}if(this._oTemplate){this._oTemplate.destroy();}this._oTemplate=null;this.sAggregationName=null;this.bTypeAheadEnabled=null;this._oSorter=null;};return r;});
