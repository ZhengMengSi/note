/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./ODataAnnotations","./ODataContextBinding","./ODataListBinding","./ODataTreeBinding","sap/base/assert","sap/base/Log","sap/base/security/encodeURL","sap/base/util/deepEqual","sap/base/util/each","sap/base/util/isEmptyObject","sap/base/util/isPlainObject","sap/base/util/merge","sap/base/util/uid","sap/base/util/UriParameters","sap/ui/core/library","sap/ui/core/message/Message","sap/ui/core/message/MessageParser","sap/ui/model/BindingMode","sap/ui/model/Context","sap/ui/model/FilterProcessor","sap/ui/model/Model","sap/ui/model/odata/CountMode","sap/ui/model/odata/MessageScope","sap/ui/model/odata/ODataMetadata","sap/ui/model/odata/ODataMetaModel","sap/ui/model/odata/ODataMessageParser","sap/ui/model/odata/ODataPropertyBinding","sap/ui/model/odata/ODataUtils","sap/ui/model/odata/OperationMode","sap/ui/model/odata/UpdateMethod","sap/ui/thirdparty/datajs","sap/ui/thirdparty/jquery","sap/ui/thirdparty/URI"],function(O,a,b,c,d,L,e,f,g,h,l,m,u,U,o,M,p,B,C,F,q,r,s,t,v,w,x,y,z,A,D,Q,E){"use strict";var G=o.MessageType,H={};H[G.Error]=0;H[G.Warning]=1;H[G.Success]=2;H[G.Information]=3;H[G.None]=4;var I=q.extend("sap.ui.model.odata.v2.ODataModel",{constructor:function(S,P){q.apply(this,arguments);var i,j,k,T,W,n,K,R,N,V,X,Y,Z,$,_,a1,b1,c1,d1,e1,f1,g1,h1,i1,j1,k1,l1,m1,n1=this;if(typeof(S)==="object"){P=S;S=P.serviceUrl;}if(P){i=P.user;j=P.password;k=P.headers;T=P.tokenHandling;W=P.withCredentials;n=P.maxDataServiceVersion;K=P.useBatch;R=P.refreshAfterChange;N=P.annotationURI;V=P.loadAnnotationsJoined;Z=P.defaultBindingMode;X=P.defaultCountMode;Y=P.preliminaryContext;$=P.defaultOperationMode;_=P.metadataNamespaces;a1=P.serviceUrlParams;b1=P.metadataUrlParams;c1=P.json;d1=P.messageParser;e1=P.skipMetadataAnnotationParsing;f1=P.defaultUpdateMethod;g1=P.disableHeadRequestForToken;h1=P.sequentializeRequests;i1=P.disableSoftStateHeader;j1=P.bindableResponseHeaders;k1=P.warmupUrl;l1=P.canonicalRequests;m1=P.tokenHandlingForGet;}this.mPathCache={};this.mInvalidatedPaths={};this.bCanonicalRequests=!!l1;this.bTokenHandlingForGet=!!m1;this.sMessageScope=s.RequestedObjects;this.sWarmupUrl=k1;this.bWarmup=!!k1;this.mSupportedBindingModes={"OneWay":true,"OneTime":true,"TwoWay":true};this.mUnsupportedFilterOperators={"Any":true,"All":true};this.sDefaultBindingMode=Z||B.OneWay;this.bIsMessageScopeSupported=false;this.iPendingDeferredRequests=0;this.bJSON=c1!==false;this.aPendingRequestHandles=[];this.aCallAfterUpdate=[];this.mRequests={};this.mDeferredRequests={};this.mChangedEntities={};this.mChangeHandles={};this.mDeferredGroups={};this.mLaunderingState={};this.sDefaultUpdateMethod=f1||A.Merge;this.bTokenHandling=T!==false;this.bWithCredentials=W===true;this.bUseBatch=K!==false;this.bRefreshAfterChange=R!==false;this.sMaxDataServiceVersion=n;this.bLoadAnnotationsJoined=V!==false;this.sAnnotationURI=N;this.sDefaultCountMode=X||r.Request;this.sDefaultOperationMode=$||z.Default;this.sMetadataLoadEvent=null;this.oMetadataFailedEvent=null;this.sRefreshGroupId=undefined;this.bIncludeInCurrentBatch=false;this.bSkipMetadataAnnotationParsing=!!e1;this.bDisableHeadRequestForToken=!!g1;this.bSequentializeRequests=!!h1;this.bDisableSoftStateHeader=!!i1;this.aBindableResponseHeaders=j1?j1:null;this.bPreliminaryContext=Y||false;this.mMetadataUrlParams=b1||{};this.mChangedEntities4checkUpdate={};if(d1){d1.setProcessor(this);}this.oMessageParser=d1;this.sDefaultChangeGroup="changes";this.setDeferredGroups([this.sDefaultChangeGroup]);this.setChangeGroups({"*":{groupId:this.sDefaultChangeGroup}});this.oData={};this.oMetadata=null;this.oAnnotations=null;this.aUrlParams=[];this.pSequentialRequestCompleted=Promise.resolve();this.pReadyForRequest=Promise.resolve();this.sServiceUrl=S;var o1=S.split("?");if(o1.length>1){this.sServiceUrl=o1[0];if(o1[1]){this.aUrlParams.push(o1[1]);}}this.sServiceUrl=this.sServiceUrl.replace(/\/$/,"");this.sUser=i;this.sPassword=j;if(sap.ui.getCore().getConfiguration().getStatistics()){this.aUrlParams.push("sap-statistics=true");}this.oHeaders={};this.setHeaders(k);if(!this.bDisableSoftStateHeader){this.oHeaders["sap-contextid-accept"]="header";this.mCustomHeaders["sap-contextid-accept"]="header";}var p1=this._getServerUrl();var q1=this.sWarmupUrl||this._createMetadataUrl("/$metadata");this.oSharedServerData=I._getSharedData("server",p1);this.oSharedServiceData=I._getSharedData("service",this.sServiceUrl);this.oSharedMetaData=I._getSharedData("meta",q1);this.bUseCache=this._cacheSupported(q1);if(!this.oSharedMetaData.oMetadata||this.oSharedMetaData.oMetadata.bFailed){this.oMetadata=new t(q1,{async:true,cacheKey:this.bUseCache?q1:undefined,user:this.sUser,password:this.sPassword,headers:this.mCustomHeaders,namespaces:_,withCredentials:this.bWithCredentials});if(!this.bWarmup){this.oSharedMetaData.oMetadata=this.oMetadata;}}else{this.oMetadata=this.oSharedMetaData.oMetadata;}this.oAnnotations=new O(this.oMetadata,{source:this.sAnnotationURI,skipMetadata:this.bSkipMetadataAnnotationParsing,headers:this.mCustomHeaders,combineEvents:true,cacheKey:this._getAnnotationCacheKey(q1),useCache:this.bUseCache});if(!this.bDisableSoftStateHeader){delete this.mCustomHeaders["sap-contextid-accept"];}this.oAnnotations.attachAllFailed(this.onAnnotationsFailed,this);this.oAnnotations.attachSomeLoaded(this.onAnnotationsLoaded,this);this.pAnnotationsLoaded=this.oAnnotations.loaded();if(a1){this.aUrlParams=this.aUrlParams.concat(y._createUrlParamsArray(a1));}this.onMetadataFailed=function(r1){n1.fireMetadataFailed(r1.getParameters());};if(!this.oMetadata.isLoaded()){this.oMetadata.attachFailed(this.onMetadataFailed);}this.oMetadata.loaded().then(function(){n1._initializeMetadata();});if(this.bJSON){if(this.sMaxDataServiceVersion==="3.0"){this.oHeaders["Accept"]="application/json;odata=fullmetadata";}else{this.oHeaders["Accept"]="application/json";}}else{this.oHeaders["Accept"]="application/atom+xml,application/atomsvc+xml,application/xml";}if(this.bTokenHandling){if(this.oSharedServiceData.securityToken){this.oHeaders["x-csrf-token"]=this.oSharedServiceData.securityToken;}else if(this.oSharedServerData.securityToken){this.oSharedServiceData.securityToken=this.oSharedServerData.securityToken;this.oHeaders["x-csrf-token"]=this.oSharedServiceData.securityToken;}}this.oHeaders["Accept-Language"]=sap.ui.getCore().getConfiguration().getLanguageTag();this.oHeaders["DataServiceVersion"]="2.0";this.oHeaders["MaxDataServiceVersion"]="2.0";if(this.sMaxDataServiceVersion){this.oHeaders["MaxDataServiceVersion"]=this.sMaxDataServiceVersion;}},metadata:{publicMethods:["read","create","update","remove","submitChanges","getServiceMetadata","metadataLoaded","hasPendingChanges","getPendingChanges","refresh","refreshMetadata","resetChanges","setDefaultCountMode","setDefaultBindingMode","getDefaultBindingMode","getDefaultCountMode","setProperty","getSecurityToken","refreshSecurityToken","setHeaders","getHeaders","setUseBatch","setDeferredBatchGroups","getDeferredBatchGroups","setChangeBatchGroups","getChangeBatchGroups"]}});I.M_EVENTS={MetadataLoaded:"metadataLoaded",MetadataFailed:"metadataFailed",AnnotationsLoaded:"annotationsLoaded",AnnotationsFailed:"annotationsFailed",BatchRequestFailed:"batchRequestFailed",BatchRequestSent:"batchRequestSent",BatchRequestCompleted:"batchRequestCompleted"};I.prototype.attachBatchRequestFailed=function(i,j,k){this.attachEvent("batchRequestFailed",i,j,k);return this;};I.prototype.detachBatchRequestFailed=function(i,j){this.detachEvent("batchRequestFailed",i,j);return this;};I.prototype.fireBatchRequestFailed=function(P){this.fireEvent("batchRequestFailed",P);return this;};I.prototype.attachBatchRequestSent=function(i,j,k){this.attachEvent("batchRequestSent",i,j,k);return this;};I.prototype.detachBatchRequestSent=function(i,j){this.detachEvent("batchRequestSent",i,j);return this;};I.prototype.fireBatchRequestSent=function(P){this.fireEvent("batchRequestSent",P);return this;};I.prototype.attachBatchRequestCompleted=function(i,j,k){this.attachEvent("batchRequestCompleted",i,j,k);return this;};I.prototype.detachBatchRequestCompleted=function(i,j){this.detachEvent("batchRequestCompleted",i,j);return this;};I.prototype.fireBatchRequestCompleted=function(P){this.fireEvent("batchRequestCompleted",P);return this;};I.mSharedData={server:{},service:{},meta:{}};I._getSharedData=function(S,k){var i=this.mSharedData[S][k];if(!i){i={};this.mSharedData[S][k]=i;}return i;};I.prototype._initializeMetadata=function(){if(this.bDestroyed){return;}this.bIsMessageScopeSupported=this.oMetadata._isMessageScopeSupported();var i=function(){this.fireMetadataLoaded({metadata:this.oMetadata});L.debug(this+" - metadataloaded fired");}.bind(this);this.initialize();if(this.bLoadAnnotationsJoined){this.oAnnotations.loaded().then(i,this.fireMetadataFailed.bind(this));}else{i();}};I.prototype.refreshMetadata=function(){if(this.oMetadata&&this.oMetadata.refresh){return this.oMetadata.refresh();}};I.prototype.fireAnnotationsLoaded=function(P){this.fireEvent("annotationsLoaded",P);return this;};I.prototype.attachAnnotationsLoaded=function(i,j,k){this.attachEvent("annotationsLoaded",i,j,k);return this;};I.prototype.detachAnnotationsLoaded=function(i,j){this.detachEvent("annotationsLoaded",i,j);return this;};I.prototype.fireAnnotationsFailed=function(P){this.fireEvent("annotationsFailed",P);L.debug(this+" - annotationsfailed fired");return this;};I.prototype.attachAnnotationsFailed=function(i,j,k){this.attachEvent("annotationsFailed",i,j,k);return this;};I.prototype.detachAnnotationsFailed=function(i,j){this.detachEvent("annotationsFailed",i,j);return this;};I.prototype.fireMetadataLoaded=function(P){this.fireEvent("metadataLoaded",P);return this;};I.prototype.attachMetadataLoaded=function(i,j,k){this.attachEvent("metadataLoaded",i,j,k);return this;};I.prototype.detachMetadataLoaded=function(i,j){this.detachEvent("metadataLoaded",i,j);return this;};I.prototype.fireMetadataFailed=function(P){this.fireEvent("metadataFailed",P);return this;};I.prototype.attachMetadataFailed=function(i,j,k){this.attachEvent("metadataFailed",i,j,k);return this;};I.prototype.detachMetadataFailed=function(i,j){this.detachEvent("metadataFailed",i,j);return this;};I.prototype._createEventInfo=function(R,k,n){var K={};K.url=R.requestUri;K.method=R.method;K.async=R.async;K.headers=R.headers;if(n){K.requests=[];for(var i=0;i<n.length;i++){var N={};if(Array.isArray(n[i])){var P=n[i];for(var j=0;j<P.length;j++){var R=P[j].request;var S=n[i][j].response;N={};N.url=R.requestUri;N.method=R.method;N.headers=R.headers;if(S){N.response={};if(R._aborted){N.success=false;N.response.statusCode=0;N.response.statusText="abort";}else{N.success=true;if(S.message){N.response.message=S.message;S=S.response;N.response.responseText=S.body;N.success=false;}N.response.headers=S.headers;N.response.statusCode=S.statusCode;N.response.statusText=S.statusText;}}K.requests.push(N);}}else{var R=n[i].request;var S=n[i].response;N.url=R.requestUri;N.method=R.method;N.headers=R.headers;if(S){N.response={};if(R._aborted){N.success=false;N.response.statusCode=0;N.response.statusText="abort";}else{N.success=true;if(S.message){N.response.message=S.message;S=S.response;N.response.responseText=S.body;N.success=false;}N.response.headers=S.headers;N.response.statusCode=S.statusCode;N.response.statusText=S.statusText;}}K.requests.push(N);}}}if(k){K.response={};K.success=true;if(k.message){K.response.message=k.message;K.success=false;}if(k.response){k=k.response;}if(k&&k.statusCode!=undefined){K.response.headers=k.headers;K.response.statusCode=k.statusCode;K.response.statusText=k.statusText;K.response.responseText=k.body!==undefined?k.body:k.responseText;}}K.ID=R.requestID;return K;};I.prototype._createRequestID=function(){var R;R=u();return R;};I.prototype._getServerUrl=function(){var S,i;S=new E(this.sServiceUrl).absoluteTo(document.baseURI);i=new E("/").absoluteTo(S).toString();return i;};I.prototype._createMetadataUrl=function(i){if(i.indexOf(this.sServiceUrl)==-1){if(!i.startsWith("/")){i="/"+i;}i=this.sServiceUrl+i;}var j=U.fromURL(i||window.location.href);var k=Object.assign({},this.mMetadataUrlParams);Array.from(j.keys()).forEach(function(N){k[N]=j.get(N);});var n=y._createUrlParamsArray(k);var K=i.split("?");if(K.length>1){i=K[0];}return this._addUrlParams(i,n);};I.prototype._addUrlParams=function(i,j){var k=[];if(this.aUrlParams){k=k.concat(this.aUrlParams);}if(j){k=k.concat(j);}if(k&&k.length>0){i+="?"+k.join("&");}return i;};I.prototype._createRequestUrl=function(P,i,j,k){return this._createRequestUrlWithNormalizedPath(this._normalizePath(P,i),j,k);};I.prototype._createRequestUrlWithNormalizedPath=function(n,i,j){var k="";if(!j){k=this.sServiceUrl+n;}else{k=n.substr(n.indexOf('/')+1);}return this._addUrlParams(k,i);};I.prototype._importData=function(j,k,R,P,n,K,N){var S=this,T,V,W,X;P=P||"";K=K||"";if(j.results&&Array.isArray(j.results)){T=[];g(j.results,function(i,c1){var K=S._getKey(c1);K=S._importData(c1,k,R,P.substr(0,P.lastIndexOf("/")),n,K);if(K){T.push(K);}});return T;}else{if(K){P="/"+K;n+=K.substr(K.indexOf("("));}else{K=this._getKey(j);}if(!K){return K;}W=this._getEntity(K);X=W;if(!W||(W.__metadata&&W.__metadata.invalid)){if(!X){X=j;}W=j;K=this._addEntity(W);}if(this.aBindableResponseHeaders){var Y={};for(var Z in R.headers){var $=Z.toLowerCase();if(this.aBindableResponseHeaders.indexOf($)>-1){Y[$]=R.headers[Z];}}if(!h(Y)){if(!j.__metadata){j.__metadata={};}j.__metadata.headers=Y;}}g(j,function(i,c1){if(c1&&(c1.__metadata&&c1.__metadata.uri||c1.results)&&!c1.__deferred){var d1=P+"/"+i;var e1=n+"/"+i;V=S._importData(c1,k,R,d1,e1);if(Array.isArray(V)){W[i]={__list:V};}else{if(X[i]&&X[i].__ref){if(X[i].__ref!==V){S.mInvalidatedPaths[P.substr(P.lastIndexOf("("))+"/"+i]="/"+V;}}W[i]={__ref:V};}}else if(!c1||!c1.__deferred){if(X[i]&&c1===null){S.mInvalidatedPaths[P.substr(P.lastIndexOf("("))+"/"+i]=null;}W[i]=c1;}});var _={};_[K]=W;if(this.hasContext("/"+K)&&this.getContext("/"+K).isPreliminary()){var a1=this.getContext("/"+K);a1.setUpdated(true);a1.setPreliminary(false);}this._updateChangedEntities(_);k[K]=true;P=P||'/'+K;n=n||P;var b1=this.resolveFromCache(n);if(b1==="/"+K||(b1&&b1.split("/").length>2)){this._writePathCache(b1,"/"+K,N);}this._writePathCache(P,"/"+K,N);this._writePathCache(n,"/"+K,N,true);return K;}};I.prototype._writePathCache=function(P,i,j,k){var n,K,N,R,S,T;if(P&&i){if(!this.mPathCache[P]){this.mPathCache[P]={};}if(!j&&P.lastIndexOf("/")===0){i=P;}this.mPathCache[P].canonicalPath=i;if(k){S=P.split("/");for(T=3;T<S.length;T+=1){N=S.slice(0,T).join("/");R=this.mPathCache[N];if(R){n=R.canonicalPath+P.slice(N.length);K=this.mPathCache[n];if(K){K.canonicalPath=i;}}}}}};I.prototype._removeReferences=function(j){var k=this,n;if(!j){return j;}if(j.results){n=[];g(j.results,function(i,K){n.push(k._removeReferences(K));});return n;}else{g(j,function(P,i){if(i){if(i["__ref"]||i["__list"]){delete j[P];}}});return j;}};I.prototype._restoreReferences=function(j,V){var k=this,K,n,R;function N(K){var n=V[K];if(!n){n=k._getObject("/"+K);d(n,"ODataModel inconsistent: "+K+" not found!");if(n){n=m({},n);V[K]=n;k._restoreReferences(n,V);}}return n;}if(!V){V={};}g(j,function(P,S){if(S){if(S.__ref){K=S.__ref;n=N(K);if(n){j[P]=n;}delete S.__ref;}else if(S.__list){R=[];g(S.__list,function(i,K){n=N(K);if(n){R.push(n);}});delete S.__list;S.results=R;}}});return j;};I.prototype.removeData=function(){this.oData={};};I.prototype.initialize=function(){var i=this.getBindings();i.forEach(function(j){j.initialize();});};I.prototype.invalidate=function(i){var j;for(var k in this.oData){j=this.oData[k];if(!i||i(k,j)){j.__metadata.invalid=true;}}};I.prototype.invalidateEntry=function(i){var j;if(typeof i==="string"){if(i.indexOf("/")===0){j=this._getObject(i);}else{j=this.oData[i];}}else if(i instanceof C){j=this._getObject(i.getPath());}if(j&&j.__metadata){j.__metadata.invalid=true;}};I.prototype.invalidateEntityType=function(i){var j;for(var k in this.oData){j=this.oData[k];if(j.__metadata.type===i){j.__metadata.invalid=true;}}};I.prototype.refresh=function(i,R,j){if(typeof i==="string"){j=i;i=false;R=false;}if(R){this.removeData();}this._refresh(i,j);};I.prototype._refresh=function(i,j,k,n){var K=this.getBindings();this.sRefreshGroupId=j;K.forEach(function(N){N._refresh(i,k,n);});this.sRefreshGroupId=undefined;};I.prototype.checkUpdate=function(i,j,k,n){if(j){this.bForceUpdate=this.bForceUpdate||i;Object.assign(this.mChangedEntities4checkUpdate,k);if(!this.sUpdateTimer){this.sUpdateTimer=setTimeout(function(){this.checkUpdate(this.bForceUpdate,false,this.mChangedEntities4checkUpdate);}.bind(this),0);}return;}if(this.sUpdateTimer){clearTimeout(this.sUpdateTimer);this.sUpdateTimer=null;this.bForceUpdate=undefined;this.mChangedEntities4checkUpdate={};}var K=this.getBindings();K.forEach(function(N){if(!n||this.isMetaModelPath(N.getPath())){N.checkUpdate(i,k);}}.bind(this));this._processAfterUpdate();};I.prototype.checkDataState=function(i){var j=this.getBindings();j.forEach(function(k){if(k.checkDataState){k.checkDataState(i);}});};I.prototype.bindProperty=function(P,i,j){var k=new x(this,P,i,j);return k;};I.prototype.bindList=function(P,i,S,j,k){var n=new b(this,P,i,S,j,k);return n;};I.prototype.bindTree=function(P,i,j,k,S){var n=new c(this,P,i,j,k,S);return n;};I.prototype.createBindingContext=function(P,i,j,k,R){var n,K,N,S,T,V=this,W;if(i!==null&&typeof i==="object"&&!(i instanceof sap.ui.model.Context)){R=k;k=j;j=i;i=undefined;}if(typeof i=="function"){R=j;k=i;j=undefined;i=undefined;}if(typeof i=="boolean"){R=i;k=undefined;j=undefined;i=undefined;}if(typeof j=="function"){R=k;k=j;j=undefined;}if(typeof j=="boolean"){R=j;k=undefined;j=undefined;}if(typeof k=="boolean"){R=k;k=undefined;}if(j){W=j.canonicalRequest;}W=this._isCanonicalRequestNeeded(W);n=this.resolve(P,i,W);if(!n&&W){n=this.resolve(P,i);}T=this.resolveDeep(P,i);if(!n){if(k){k(null);}return null;}if(R===undefined){R=this._isReloadNeeded(n,j);}if(!R){K=this.resolve(P,i,true);if(K){N=this.getContext(K,T);}else{N=null;}if(k){k(N);}return N;}function X(a1){var b1=a1?V._getKey(a1):null,c1=!(P===""||P.indexOf("/")>0),d1=null,e1,f1;N=null;if(b1){N=V.getContext('/'+b1,T);d1={__ref:b1};}if(i&&Z&&c1){e1=i.getPath();e1=e1.substr(1);f1=V._getEntity(e1);if(f1){f1[P]=d1;}}k(N);}function Y(a1){var b1;if(a1.statusCode=='404'&&i&&Z){var c1=i.getPath();c1=c1.substr(1);b1=V._getEntity(c1);if(b1){b1[P]={__ref:null};}}k(null);}if(k){var Z=!P.startsWith("/");if(n){var $=[],_=this.createCustomParams(j);if(_){$.push(_);}if(j&&(j.batchGroupId||j.groupId)){S=j.groupId||j.batchGroupId;}this.read(P,{canonicalRequest:W,context:i,error:Y,groupId:S,success:X,updateAggregatedMessages:true,urlParameters:$});}else{k(null);}}if(j&&j.createPreliminaryContext){n=this.resolve(P,i,W);if(!n&&W){n=this.resolve(P,i);}N=this.getContext(n,T);return N;}};I.prototype._updateContext=function(i,P){if(!P.startsWith("/")){throw new Error("Path "+P+" must start with a / ");}i.sPath=P;this.mContexts[P]=i;};I.prototype._splitEntries=function(i){return i.replace(/\s/g,"").split(',').map(function(j){return j.split("/");});};I.prototype._filterOwnSelect=function(S,i){var j,k;if(!i){return[];}k=i.map(function(P){return P.name;});j=S.filter(function(n){return n.length===1;}).map(function(n){return n[0];});if(S.length===0||j.indexOf("*")!==-1||j.indexOf("**")!==-1){return k;}else{return j.filter(function(n){return k.indexOf(n)!==-1;});}};I.prototype._filterOwnExpand=function(i,S){return i.map(function(j){return j[0];}).filter(function(V,j,k){return k.indexOf(V)===j;}).filter(function(V){return S.length===0||S.some(function(j){return j.indexOf(V)===0||j.indexOf("**")===0;});});};I.prototype._filterSelectByNavProp=function(i,n){return i.filter(function(S){return S[0]===n;}).map(function(S){return S.length>1?S.slice(1):["**"];});};I.prototype._filterExpandByNavProp=function(i,n){return i.filter(function(S){return S.length>1&&S[0]===n;}).map(function(S){return S.slice(1);});};I.prototype._isReloadNeeded=function(P,k){var n=this,K=this.oMetadata,N,R=this._getObject(P),S=[],T=[];if(!this.oMetadata.isLoaded()){return true;}N=this.oMetadata._getEntityTypeByPath(P);if(this._isCreatedEntity(R)){return false;}function V(N,R,T,S){var W,X,Y,Z,$,_,a1,b1,c1;if(!N){return false;}if(R===null){return false;}if(!R){return true;}if(R.__metadata&&R.__metadata.invalid){return true;}W=n._filterOwnSelect(T,N.property);for(var i=0;i<W.length;i++){c1=W[i];if(R[c1]===undefined){return true;}}X=n._filterOwnExpand(S,T);for(var i=0;i<X.length;i++){b1=X[i];Y=R[b1];if(Y===null){continue;}if(Y===undefined||Y.__deferred){return true;}Z=K._getEntityTypeByNavProperty(N,b1);_=n._filterSelectByNavProp(T,b1);a1=n._filterExpandByNavProp(S,b1);if(Y.__ref){$=n._getEntity(Y.__ref);if(V(Z,$,_,a1)){return true;}}if(Y.__list){for(var j=0;j<Y.__list.length;j++){$=n._getEntity(Y.__list[j]);if(V(Z,$,_,a1)){return true;}}}}return false;}if(k){if(k.select){T=this._splitEntries(k.select);}if(k.expand){S=this._splitEntries(k.expand);}}return V(N,R,T,S);};I.prototype.createCustomParams=function(P){var i=[],j,S={expand:true,select:true};for(var n in P){if(n in S){i.push("$"+n+"="+e(P[n]));}if(n==="custom"){j=P[n];for(n in j){if(n.indexOf("$")===0){L.warning(this+" - Trying to set OData parameter '"+n+"' as custom query option!");}else if(typeof j[n]==='string'){i.push(n+"="+e(j[n]));}else{i.push(n);}}}}return i.join("&");};I.prototype.bindContext=function(P,i,j){var k=new a(this,P,i,j);return k;};I.prototype.setDefaultCountMode=function(i){this.sDefaultCountMode=i;};I.prototype.getDefaultCountMode=function(){return this.sDefaultCountMode;};I.prototype._addEntity=function(i){var k=this._getKey(i);this.oData[k]=i;return k;};I.prototype._removeEntity=function(k){k=k&&y._normalizeKey(k);delete this.oData[k];delete this.mChangedEntities[k];delete this.mContexts["/"+k];};I.prototype._getEntity=function(k){var i=this.oData[k];if(!i){k=k&&y._normalizeKey(k);i=this.oData[k];}return i;};I.prototype._getKey=function(V){var k,i;if(V instanceof C){k=V.getPath().substr(1);}else if(V&&V.__metadata&&V.__metadata.uri){i=V.__metadata.uri;k=i.substr(i.lastIndexOf("/")+1);}else if(typeof V==='string'){k=V.substr(V.lastIndexOf("/")+1);}if(!this.oData[k]){k=k&&y._normalizeKey(k);}return k;};I.prototype.getKey=function(V){return this._getKey(V);};I.prototype.createKey=function(j,k){var n=this.oMetadata._getEntityTypeByPath(j),K=j,N=this,P,R;d(n,"Could not find entity type of collection \""+j+"\" in service metadata!");K+="(";if(n.key.propertyRef.length===1){P=n.key.propertyRef[0].name;d(P in k,"Key property \""+P+"\" is missing in object!");R=this.oMetadata._getPropertyMetadata(n,P);K+=encodeURIComponent(y.formatValue(k[P],R.type));}else{g(n.key.propertyRef,function(i,S){if(i>0){K+=",";}P=S.name;d(P in k,"Key property \""+P+"\" is missing in object!");R=N.oMetadata._getPropertyMetadata(n,P);K+=P;K+="=";K+=encodeURIComponent(y.formatValue(k[P],R.type));});}K+=")";return K;};I.prototype.getProperty=function(P,i,j){var V=this._getObject(P,i);if(!j){return V;}if(!l(V)){return V;}V=m({},V);if(j===true){return this._restoreReferences(V);}else{return this._removeReferences(V);}};I.prototype.getObject=function(P,n,K){if(l(n)){K=n;n=undefined;}var N=this,R=this.resolve(P,n),V=this._getObject(R),S=this.oMetadata._getEntityTypeByPath(R),T=[],W=[];if(!S||!l(V)||!V.__metadata||!V.__metadata.uri){return V;}if(!K||!(K.select||K.expand)){return m({},V);}function X(S,V,W,T){var Y,Z,$,_,a1,b1,c1,d1,e1,f1,g1,h1,i1;if(!V){return undefined;}if(!S){return undefined;}$=N._filterOwnSelect(W,S.property);Z={};for(var i=0;i<$.length;i++){h1=$[i];if(V[h1]!==undefined){Z[h1]=V[h1];}else{L.fatal("No data loaded for select property: "+h1+" of entry: "+N.getKey(V));return undefined;}}if(V.__metadata){Z.__metadata=V.__metadata;}Y=N._filterOwnExpand(T,W);for(var i=0;i<Y.length;i++){g1=Y[i];a1=V[g1];b1=N.oMetadata._getEntityTypeByNavProperty(S,g1);e1=N._filterSelectByNavProp(W,g1);f1=N._filterExpandByNavProp(T,g1);if(a1&&a1.__ref){d1=N._getObject("/"+a1.__ref);c1=X(b1,d1,e1,f1);if(c1!==undefined){Z[g1]=c1;}else{L.fatal("No data loaded for expand property: "+g1+" of entry: "+N.getKey(c1));return undefined;}}if(a1&&a1.__list){i1=[];for(var j=0;j<a1.__list.length;j++){d1=N._getObject("/"+a1.__list[j]);c1=X(b1,d1,e1,f1);if(c1!==undefined){i1.push(c1);}else{L.fatal("No data loaded for expand property: "+g1+" of entry: "+N.getKey(c1));return undefined;}}Z[g1]=i1;}}_=N._filterOwnSelect(W,S.navigationProperty);for(var k=0;k<_.length;k++){g1=_[k];if(Y.indexOf(g1)===-1){var j1=Z.__metadata.uri+"/"+g1;Z[g1]={__deferred:{uri:j1}};}}return Z;}if(K.select){W=this._splitEntries(K.select);}if(K.expand){T=this._splitEntries(K.expand);}V=X(S,V,W,T);return V;};I.prototype._getObject=function(P,i,j){var n=this.isLegacySyntax()?this.oData:null,k,K,R,S,N,T,V,W,X;R=this.resolve(P,i,this.bCanonicalRequests);if(!R&&this.bCanonicalRequests){R=this.resolve(P,i);}if(!R){return n;}if(this._isMetadataPath(R)){if(this.oMetadata&&this.oMetadata.isLoaded()){if(this.isMetaModelPath(R)){S=R.indexOf('/##');X=this.getMetaModel();if(!this.bMetaModelLoaded){return null;}N=R.substr(0,S);T=R.substr(S+3);V=X.getMetaContext(N);n=X.getProperty(T,V);}else{n=this.oMetadata._getAnnotation(R);}}}else{if(R==="/"){return this.oData;}var Y=R.split("/"),Z=0;W=Y[1];Y.splice(0,2);k=this.mChangedEntities[W];K=this._getEntity(W);n=j?K:k||K;while(n&&Y[Z]){var $=k&&k.hasOwnProperty(Y[Z]);k=k&&k[Y[Z]];K=K&&K[Y[Z]];n=j||!$?K:k;if(n){if(n.__ref){k=this.mChangedEntities[n.__ref];K=this._getEntity(n.__ref);n=j?K:k||K;}else if(n.__list){n=n.__list;}else if(n.__deferred){n=undefined;}}Z++;}}if(l(k)){n=j?K:m({},K,k);}return n;};I.prototype.updateSecurityToken=function(){if(this.bTokenHandling){if(!this.oSharedServiceData.securityToken){this.refreshSecurityToken();}if(this.bTokenHandling){this.oHeaders["x-csrf-token"]=this.oSharedServiceData.securityToken;}}};I.prototype.resetSecurityToken=function(){delete this.oSharedServiceData.securityToken;delete this.oHeaders["x-csrf-token"];delete this.pSecurityToken;};I.prototype.getSecurityToken=function(){var T=this.oSharedServiceData.securityToken;if(!T){this.refreshSecurityToken();T=this.oSharedServiceData.securityToken;}return T;};I.prototype.securityTokenAvailable=function(){if(!this.pSecurityToken){if(this.oSharedServiceData.securityToken){this.pSecurityToken=Promise.resolve(this.oSharedServiceData.securityToken);}else{this.pSecurityToken=new Promise(function(i,j){this.refreshSecurityToken(function(){i(this.oSharedServiceData.securityToken);}.bind(this),function(){j();},true);}.bind(this));}}return this.pSecurityToken;};I.prototype.refreshSecurityToken=function(S,i,j){var T;var k=this;var n=this._createRequestUrlWithNormalizedPath("/");var K={abort:function(){this.request.abort();}};function N(W,X){if(X){T=k._getHeader("x-csrf-token",X.headers);k._setSessionContextIdHeader(k._getHeader("sap-contextid",X.headers));if(T){k.oSharedServerData.securityToken=T;k.oSharedServiceData.securityToken=T;k.pSecurityToken=Promise.resolve(T);k.oHeaders["x-csrf-token"]=T;}else{k.resetSecurityToken();k.bTokenHandling=false;}}if(S){S(W,X);}}function P(W){k.resetSecurityToken();k.bTokenHandling=false;k._handleError(W);if(i){i(W);}}function R(W){K.request=V("GET",P);}function V(W,i){var X=k._createRequest(n,"",W,k._getHeaders(undefined,true),null,null,!!j);X.headers["x-csrf-token"]="Fetch";return k._request(X,N,i,undefined,undefined,k.getServiceMetadata());}if(this.bDisableHeadRequestForToken){K.request=V("GET",P);}else{K.request=V("HEAD",R);}return K;};I.prototype._submitRequest=function(R,S,j){var k=this,n,K,N,P,T;P=new Promise(function(i,_){T=i;});function V(i,_){if(S){S(i,_);}T();}function W(i){if(k.bTokenHandling&&i.response){var _=k._getHeader("x-csrf-token",i.response.headers);if(!R.bTokenReset&&i.response.statusCode=='403'&&_&&_.toLowerCase()==="required"){k.resetSecurityToken();R.bTokenReset=true;Y();return;}}if(j){j(i);}T();}function X(R){if(k.bTokenHandling&&(R.method!=="GET"||k.bTokenHandlingForGet)){k.pReadyForRequest=k.securityTokenAvailable();}return k.pReadyForRequest;}function Y(){if(k.bTokenHandling){delete R.headers["x-csrf-token"];}X(R).then(function(i){if(k.bTokenHandling&&(R.method!=="GET"||k.bTokenHandlingForGet)){R.headers["x-csrf-token"]=i;}$();},function(){$();});}function Z(_,R,a1){var b1,c1=R.eventInfo.requests;if(c1){g(c1,function(i,R){if(Array.isArray(R)){R.forEach(function(R){g(R.parts,function(i,d1){b1=k._createEventInfo(R.request,d1.fnError);k["fireRequest"+_](b1);});});}else{if(R.parts){g(R.parts,function(i,d1){b1=k._createEventInfo(R.request,d1.fnError);k["fireRequest"+_](b1);});}else{b1=k._createEventInfo(R.request,R.fnError);k["fireRequest"+_](b1);}}});if(R.eventInfo.batch){b1=k._createEventInfo(R,a1,c1);k["fireBatchRequest"+_](b1);}}}function $(){if(k.sSessionContextId){R.headers["sap-contextid"]=k.sSessionContextId;}K=k._request(R,V,W,n,undefined,k.getServiceMetadata());if(R.eventInfo){Z("Sent",R,null);delete R.eventInfo;}if(N){K.abort();}}n=k._getODataHandler(R.requestUri);if(this.bSequentializeRequests){this.pSequentialRequestCompleted.then(function(){Y();});this.pSequentialRequestCompleted=P;}else{Y();}return{abort:function(){if(K){K.abort();}N=true;}};};I.prototype._setSessionContextIdHeader=function(S){if(S){this.sSessionContextId=S;}};I.prototype._submitSingleRequest=function(R){var j=this,k,n={},K={},N={};function P(T,V){if(T===undefined&&V.statusCode===200){S({message:"Response did not contain a valid OData result",response:V});return;}function W(T,V){for(var i=0;i<R.parts.length;i++){if(R.parts[i].request._aborted){j._processAborted(R.parts[i].request,V);}else if(R.parts[i].fnSuccess){R.parts[i].fnSuccess(T,V);}}if(R.request.requestUri.indexOf("$count")===-1){j.checkUpdate(false,false,K);if(R.bRefreshAfterChange){j._refresh(false,undefined,n,N);}}}j._processSuccess(R.request,V,W,K,n,N);j._invalidatePathCache();j._setSessionContextIdHeader(j._getHeader("sap-contextid",V.headers));}function S(T){if(T.message=="Request aborted"){for(var i=0;i<R.parts.length;i++){j._processAborted(R.parts[i].request,T);}}else{for(var i=0;i<R.parts.length;i++){j._processError(R.parts[i].request,T,R.parts[i].fnError);}}j._processAfterUpdate();}R.request.eventInfo={requests:R.parts,batch:false};k=this._submitRequest(R.request,P,S);return k;};I.prototype._submitBatchRequest=function(k,R,S,n){var K=this,N={},P={},T={};function V(j,_,a1){for(var i=0;i<j.parts.length;i++){if(a1||j.parts[i].request._aborted){K._processAborted(j.parts[i].request,_);}else if(_.message){K._processError(j.parts[i].request,_,j.parts[i].fnError);}else{K._processSuccess(j.parts[i].request,_,j.parts[i].fnSuccess,P,N,T);}}}function W(_,a1){if(_===undefined&&a1.statusCode===200){X({message:"Response did not contain a valid OData batch result",response:a1});return;}var b1,c1,d1,e1=_.__batchResponses;if(e1){var i,j;for(i=0;i<e1.length;i++){b1=e1[i];if(Array.isArray(R[i])){if(b1.message){for(j=0;j<R[i].length;j++){c1=R[i][j];V(c1,b1);c1.response=b1;}}else{d1=b1.__changeResponses;for(j=0;j<d1.length;j++){var f1=d1[j];c1=R[i][j];V(c1,f1);c1.response=f1;}}}else{c1=R[i];V(c1,b1);c1.response=b1;}}K._invalidatePathCache();K.checkUpdate(false,false,P);}K._processSuccess(k,a1,S,P,N,T,true,R);K._setSessionContextIdHeader(K._getHeader("sap-contextid",a1.headers));}function X(j){var _=j.message=="Request aborted";g(R,function(i,a1){if(Array.isArray(a1)){a1.forEach(function(a1){V(a1,j,_);});}else{V(a1,j,_);}});K._processAfterUpdate();if(_){K._processAborted(k,j,true);}else{K._processError(k,j,n,true,R);}}k.eventInfo={requests:R,batch:true};var Y=this._submitRequest(k,W,X);function Z(j){var n;for(var i=0;i<j.parts.length;i++){n=j.parts[i].fnError;if(!j.parts[i].request._aborted&&n){n(J);}}}var $={abort:function(j){g(R,function(i,_){if(Array.isArray(_)){_.forEach(function(_){Z(_);});}else{Z(_);}});if(n&&!j){n(J);}Y.abort();}};return $;};I.prototype._invalidatePathCache=function(){var i=this,j;if(Object.keys(this.mInvalidatedPaths).length>0){Object.keys(this.mPathCache).forEach(function(k){for(var n in i.mInvalidatedPaths){j=k.indexOf(n);if(j>-1){if(j+n.length!==k.length){var K=k.substr(j+n.length);i.mPathCache[k].canonicalPath=i.mInvalidatedPaths[n]===null?null:i.mInvalidatedPaths[n]+K;}else{i.mPathCache[k].canonicalPath=i.mInvalidatedPaths[n];}}}});}this.mInvalidatedPaths={};};I.prototype._createBatchRequest=function(i){var j,R,k={},P={},n=true;P.__batchRequests=i;for(var K in i){if(i[K]&&i[K].__changeRequests||i[K]&&i[K].headers&&!i[K].headers['sap-cancel-on-close']){n=false;break;}}j=this.sServiceUrl+"/$batch";if(this.aUrlParams.length>0){j+="?"+this.aUrlParams.join("&");}Q.extend(k,this.mCustomHeaders,this.oHeaders);k["Accept"]="multipart/mixed";delete k["Content-Type"];k['sap-cancel-on-close']=n;R={headers:k,requestUri:j,method:"POST",data:P,user:this.sUser,password:this.sPassword,async:true};R.withCredentials=this.bWithCredentials;return R;};I.prototype.abortInternalRequest=function(j,P){var R=this.mRequests;var k,n;if(P){k=P.requestKey;n=P.path;}if(j in this.mDeferredGroups){R=this.mDeferredRequests;}var K=function(S){for(var i=0;i<S.parts.length;i++){S.parts[i].requestHandle.abort();}};var N=R[j];if(N){if(k in N.map){K(N.map[k]);}else if(n){g(N.map,function(k,i){if(k.indexOf(n)>=0){K(i);}});}else if(j&&!P){g(N.map,function(i,S){K(S);});}}};I.prototype._pushToRequestQueue=function(R,i,j,k,S,n,K,N){var P=R[i],T=k.key?k.key:k.method+":"+k.requestUri;if(this.bWarmup){return;}if(!P){P={};P.map={};P.requests=[];R[i]=P;}if(T in P.map&&(k.key||k.method==='GET')){var V=P.map[T];var W=V.request;k.deepPath=W.deepPath;if(this.sMessageScope===s.BusinessObject){k.headers["sap-message-scope"]=W.headers["sap-message-scope"];}if(V.bRefreshAfterChange===undefined){V.bRefreshAfterChange=N;}if(!k.key){V.parts.push({request:k,fnSuccess:S,fnError:n,requestHandle:K});}if(k.method==="GET"){delete W.data;}else{W.method=k.method;W.headers=k.headers;W.data=k.data;W.requestUri=k.requestUri;if(k.method==="PUT"){delete W.headers["x-http-method"];}if(W._aborted){delete W._aborted;}}}else{var V={request:k,bRefreshAfterChange:N,parts:[{request:k,fnSuccess:S,fnError:n,requestHandle:K}]};if(k.method==="GET"){P.requests.push(V);}else{if(!P.changes){P.changes={};}var X=P.changes[j];if(!X){X=[];P.changes[j]=X;}V.changeSetId=j;X.push(V);}P.map[T]=V;}};I.prototype._collectChangedEntities=function(j,k,n){var K=this;if(j.changes){g(j.changes,function(N,P){for(var i=0;i<P.length;i++){if(P[i].bRefreshAfterChange){var R=P[i].request,S="/"+R.requestUri.split("?")[0],T,V;if(R.method==="POST"||R.method==="DELETE"){var W=K.oMetadata._getEntityTypeByPath(S);if(W){n[W.entityType]=true;}}else{T=K._getObject(S);if(T){V=K._getKey(T);}else if(S.lastIndexOf("/")===0){V=K._getKey(S);}if(V){k[V]=true;}}}}});}};I.prototype._processRequestQueue=function(R,j,S,k){var n=this,P,K=[];function N(V,W){for(var i=0;i<V.parts.length;i++){var X=V.parts[i];if(X.request._aborted){n._processAborted(V.request,null);V.parts.splice(i,1);i--;}else if(W){X.request._handle=W;W.iRelevantRequests++;}}}function T(){return{iRelevantRequests:0,oRequestHandle:{},abort:function(){this.iRelevantRequests--;if(this.iRelevantRequests===0&&this.oRequestHandle){this.oRequestHandle.abort(true);if(S){S({},undefined);}}}};}if(this.bUseBatch){g(R,function(i,V){if(i===j||!j){var W={},X={};n._collectChangedEntities(V,W,X);if(Object.keys(W).length||Object.keys(X).length){n.bIncludeInCurrentBatch=true;n._refresh(false,i,W,X);n.bIncludeInCurrentBatch=false;}}});g(R,function(V,W){if(V===j||!j){var X=[],Y=[],Z,$;var _=T();if(W.changes){g(W.changes,function(c1,d1){Z={__changeRequests:[]};$=[];for(var i=0;i<d1.length;i++){P='/'+n.getKey(d1[i].request.data);n.increaseLaundering(P,d1[i].request.data);N(d1[i],_);if(d1[i].parts.length>0){n.removeInternalMetadata(d1[i].request.data);Z.__changeRequests.push(d1[i].request);$.push(d1[i]);}}if(Z.__changeRequests&&Z.__changeRequests.length>0){X.push(Z);Y.push($);}});}if(W.requests){var a1=W.requests;for(var i=0;i<a1.length;i++){N(a1[i],_);if(a1[i].parts.length>0){X.push(a1[i].request);Y.push(a1[i]);}}}if(X.length>0){var b1=n._createBatchRequest(X);_.oRequestHandle=n._submitBatchRequest(b1,Y,S,k);K.push(_.oRequestHandle);}delete R[V];}});}else{g(R,function(V,W){if(V===j||!j){if(W.changes){g(W.changes,function(Z,$){for(var i=0;i<$.length;i++){var Y=T();P='/'+n.getKey($[i].request.data);n.increaseLaundering(P,$[i].request.data);N($[i],Y);if($[i].parts.length>0){n.removeInternalMetadata($[i].request.data);Y.oRequestHandle=n._submitSingleRequest($[i]);K.push(Y.oRequestHandle);}}});}if(W.requests){var X=W.requests;for(var i=0;i<X.length;i++){var Y=T();N(X[i],Y);if(X[i].parts.length>0){Y.oRequestHandle=n._submitSingleRequest(X[i]);K.push(Y.oRequestHandle);}}}delete R[V];}});}this.checkDataState(this.mLaunderingState);return K.length==1?K[0]:K;};I.prototype._processRequestQueueAsync=function(R){var i=this;if(!this.pCallAsync){this.pCallAsync=this.oMetadata.loaded().then(function(){return Promise.resolve().then(function(){i._processRequestQueue(R);i.pCallAsync=undefined;});});}};I.prototype._processSuccess=function(R,i,S,j,k,n,K,N){var P=i.data,T,V,W,X,Y,Z,$,_={},a1={},b1=this;if(!K){V=!(i.statusCode===204||i.statusCode==='204');W=R.requestUri;X=W.replace(this.sServiceUrl,"");if(!X.startsWith('/')){X='/'+X;}var c1=this._normalizePath(X);var d1=this.oMetadata._getEntityTypeByPath(c1);var e1=d1?!d1.isFunction:true;X=this._normalizePath(X,undefined,e1);this.decreaseLaundering(X,R.data);this._decreaseDeferredRequestCount(R);if(V&&P===undefined&&i){this._parseResponse(i,R);L.fatal(this+" - No data was retrieved by service: '"+i.requestUri+"'");b1.fireRequestCompleted({url:i.requestUri,type:"GET",async:i.async,info:"Accept headers:"+this.oHeaders["Accept"],infoObject:{acceptHeaders:this.oHeaders["Accept"]},success:false});return false;}if(P&&!P.__metadata&&P.results&&!Array.isArray(P.results)){P=P.results;}if(!i._imported&&P&&(Array.isArray(P)||typeof P=='object')){T=m({},P);if(R.key||R.created){b1._importData(T,_,i,undefined,undefined,undefined,d1&&d1.isFunction);}else{b1._importData(T,_,i,X,R.deepPath,undefined,d1&&d1.isFunction);}i._imported=true;}Z=this._getEntity(R.key);if(_&&Z&&Z.__metadata.created&&Z.__metadata.created.functionImport){var f1=[];var g1=Z["$result"];if(g1&&g1.__list){g(_,function(i1){f1.push(i1);});g1.__list=f1;}else if(g1&&g1.__ref){g(_,function(i1){g1.__ref=i1;});}}if(!V){Y=X.split("/");if(Y[1]){a1[Y[1]]=R;var h1={};h1[Y[1]]=R.data;this._updateChangedEntities(h1);}if(R.method==="DELETE"&&Y[2]!=="$links"){this._removeEntity(Y[1]);}}if(V&&R.method==="POST"){$=this.oMetadata._getEntityTypeByPath(X);if($){n[$.entityType]=true;}if(R.key){if(R.created){var i1=this._getKey(P);var j1=this.getContext("/"+R.key);j1.bCreated=false;this._updateContext(j1,'/'+i1);j1.setUpdated(true);this.callAfterUpdate(function(){j1.setUpdated(false);});Z=this._getEntity(i1);if(Z){delete Z.__metadata.created;}}this._removeEntity(R.key);}}this._parseResponse(i,R,_,a1);Q.extend(j,_);Q.extend(k,a1);this._updateETag(R,i);}if(S){S(P,i);}var k1=this._createEventInfo(R,i,N);if(K){this.fireBatchRequestCompleted(k1);}else{this.fireRequestCompleted(k1);}return true;};I.prototype._processError=function(R,i,j,k,n){var P,K=this._handleError(i,R);if(!k){P='/'+this.getKey(R.data);this.decreaseLaundering(P,R.data);this._decreaseDeferredRequestCount(R);}if(j){j(K);}var N=this._createEventInfo(R,K,n);if(k){this.fireBatchRequestCompleted(N);this.fireBatchRequestFailed(N);}else{this.fireRequestCompleted(N);this.fireRequestFailed(N);}};var J={message:"Request aborted",statusCode:0,statusText:"abort",headers:{},responseText:""};I.prototype._processAborted=function(R,i,j){var P;if(!j){P='/'+this.getKey(R.data);this.decreaseLaundering(P,R.data);this._decreaseDeferredRequestCount(R);}if(i){var k=this._createEventInfo(R,J);k.success=false;if(j){this.fireBatchRequestCompleted(k);}else{this.fireRequestCompleted(k);}}};I.prototype._processAfterUpdate=function(){var j=this.aCallAfterUpdate;this.aCallAfterUpdate=[];for(var i=0;i<j.length;i++){j[i]();}};I.prototype._processChange=function(k,i,j,K){var P,N,R,S,T,V,W,X,Y,Z,$,_=this;if(K&&this.mChangedEntities[k]&&this.mChangedEntities[k].__metadata){this.mChangedEntities[k].__metadata.deepPath=K;}else if(!K&&this.mChangedEntities[k]&&this.mChangedEntities[k].__metadata&&this.mChangedEntities[k].__metadata.deepPath){K=this.mChangedEntities[k].__metadata.deepPath;}N=this.oMetadata._getEntityTypeByPath(k);if(!j){j="MERGE";}P=m({},this._getObject('/'+k,true),i);if(i.__metadata&&i.__metadata.created){S=i.__metadata.created.method?i.__metadata.created.method:"POST";k=i.__metadata.created.key;W=true;R=i.__metadata.created;if(i.__metadata.created.functionImport){R.urlParameters=this._createFunctionImportParameters(i.__metadata.created.key,S,P);P=undefined;}else{delete P.__metadata['uri'];}}else if(j==="MERGE"){S="MERGE";$=this._getEntity(k);}else{S="PUT";}if(P&&P.__metadata){for(var n in P.__metadata){if(n!=='type'&&n!=='uri'&&n!=='etag'&&n!=='content_type'&&n!=='media_src'){delete P.__metadata[n];}}}if(P&&N){var a1=this.oMetadata._getNavigationPropertyNames(N);a1.forEach(function(d1){delete P[d1];});}if(S==="MERGE"&&N&&$){g(P,function(d1,e1){if(d1!=='__metadata'){if(f($[d1],e1)&&!_.isLaundering('/'+k+'/'+d1)){delete P[d1];}}});var b1="/"+k,c1;g(P,function(d1,e1){if(d1!=='__metadata'){c1=_.getProperty(b1+"/"+d1+"/#@sap:unit");if(c1){if(P[c1]===undefined){P[c1]=$[c1];}}}});}P=this._removeReferences(P);Y=R&&R.urlParameters?y._createUrlParamsArray(R.urlParameters):undefined;X=R?this._getHeaders(R.headers):this._getHeaders();T=R&&R.eTag?R.eTag:this.getETag(P);V=this._createRequestUrl('/'+k,null,Y,this.bUseBatch);Z=this._createRequest(V,K,S,X,P,T,undefined,true);if(W){Z.created=true;}if(this.bUseBatch){Z.requestUri=Z.requestUri.replace(this.sServiceUrl+'/','');}return Z;};I.prototype._resolveGroup=function(k){var i,j,P,n,K,N;j=this.oMetadata._getEntityTypeByPath(k);N=this._getObject('/'+k);if(N){P=N.__metadata.created;if(P){return{groupId:P.groupId,changeSetId:P.changeSetId};}}if(this.mChangeGroups[j.name]){i=this.mChangeGroups[j.name];n=i.groupId;K=i.single?u():i.changeSetId;}else if(this.mChangeGroups['*']){i=this.mChangeGroups['*'];n=i.groupId;K=i.single?u():i.changeSetId;}return{groupId:n,changeSetId:K};};I.prototype._updateETag=function(R,i){var j,k,n;j=R.requestUri.replace(this.sServiceUrl+'/','');if(!j.startsWith("/")){j="/"+j;}k=this._getObject(j.split("?")[0]);n=this._getHeader("etag",i.headers);if(k&&k.__metadata&&n){k.__metadata.etag=n;}};I.prototype._handleError=function(i,R){var P={},T;var j="The following problem occurred: "+i.message;P.message=i.message;if(i.response){this._parseResponse(i.response,R);if(this.bTokenHandling){T=this._getHeader("x-csrf-token",i.response.headers);if(i.response.statusCode=='403'&&T&&T.toLowerCase()==="required"){this.resetSecurityToken();}}j+=i.response.statusCode+","+i.response.statusText+","+i.response.body;P.statusCode=i.response.statusCode;P.statusText=i.response.statusText;P.headers=i.response.headers;P.responseText=i.response.body;}L.fatal(j);return P;};I.prototype.getData=function(P,i,j){return this.getProperty(P,i,j);};I.prototype._getODataHandler=function(i){if(i.indexOf("$batch")>-1){return D.batchHandler;}else if(i.indexOf("$count")>-1){return undefined;}else if(this.bJSON){return D.jsonHandler;}else{return D.atomHandler;}};I.prototype.getETag=function(P,i,j){if(typeof P=="object"){j=P;P="";}return this._getETag(P,i,j);};I.prototype._getETag=function(P,i,j){if(!j||!j.__metadata){j=this._getObject(P,i);}if(j&&j.__metadata){return j.__metadata.etag;}return null;};I.prototype.forceEntityUpdate=function(k){var i=this.mChangedEntities[k];if(i&&i.__metadata){i.__metadata.etag='*';}else{L.error(this+" - Entity with key "+k+" does not exist or has no change");}};I.prototype._createRequest=function(i,j,k,n,K,N,P,R){P=P!==false;if(N&&k!=="GET"){n["If-Match"]=N;}if(!n["Content-Type"]&&k!=="DELETE"&&k!=="GET"){if(this.bJSON){n["Content-Type"]="application/json";}else{n["Content-Type"]="application/atom+xml";}}if(i.indexOf("$count")>-1){n["Accept"]="text/plain, */*;q=0.5";}if(k==="MERGE"&&!this.bUseBatch){n["x-http-method"]="MERGE";k="POST";}if(this.sMessageScope===s.BusinessObject){if(this.bIsMessageScopeSupported){n["sap-message-scope"]=this.sMessageScope;}else{L.error("Message scope 'sap.ui.model.odata.MessageScope.BusinessObject' is not"+" supported by the service: "+this.sServiceUrl,undefined,"sap.ui.model.odata.v2.ODataModel");}}R=R&&this.sMessageScope===s.BusinessObject&&this.bIsMessageScopeSupported;var S={headers:n,requestUri:i,method:k,user:this.sUser,password:this.sPassword,async:P,deepPath:j,updateAggregatedMessages:R};if(K){S.data=K;}if(this.bWithCredentials){S.withCredentials=this.bWithCredentials;}S.requestID=this._createRequestID();return S;};I.prototype._processRequest=function(P,i,j){var R,k,n=false,K=this;if(this.bWarmup){return{abort:function(){}};}if(j){this.iPendingDeferredRequests++;}R={abort:function(){if(j&&!n){K.iPendingDeferredRequests--;}if(!n&&i){i(J);}if(k){k._aborted=true;if(k._handle){k._handle.abort();}}n=true;}};this.oMetadata.loaded().then(function(){k=P(R);if(k){k.deferred=!!j;}K._processRequestQueueAsync(K.mRequests);if(n){R.abort();}});return R;};I.prototype.update=function(P,i,j){var S,k,R,n,K,N,T,V,W,X,Y,Z,$,_,a1,b1=this,c1,d1,e1;if(j){V=j.groupId||j.batchGroupId;W=j.changeSetId;K=j.context;S=j.success;k=j.error;N=j.eTag;Y=j.headers;X=j.urlParameters;_=j.refreshAfterChange;e1=j.canonicalRequest;if(j.merge!==undefined){Z=j.merge?"MERGE":"PUT";}}e1=this._isCanonicalRequestNeeded(e1);a1=V in b1.mDeferredGroups;_=this._getRefreshAfterChange(_,V);T=y._createUrlParamsArray(X);Y=this._getHeaders(Y);Z=Z?Z:this.sDefaultUpdateMethod;N=N||this._getETag(P,K,i);c1=this._normalizePath(P,K,e1);d1=this.resolveDeep(P,K);return this._processRequest(function(f1){n=b1._createRequestUrlWithNormalizedPath(c1,T,b1.bUseBatch);R=b1._createRequest(n,d1,Z,Y,i,N);$=b1.mRequests;if(a1){$=b1.mDeferredRequests;}b1._pushToRequestQueue($,V,W,R,S,k,f1,_);return R;},k,a1);};I.prototype.create=function(P,i,j){var R,k,n,K,S,N,T,V,W,X,Y,Z,$,_,a1,b1,c1=this,d1,e1,f1;if(j){K=j.context;T=j.urlParameters;S=j.success;N=j.error;Z=j.groupId||j.batchGroupId;_=j.changeSetId;Y=j.eTag;W=j.headers;a1=j.refreshAfterChange;f1=j.canonicalRequest;}f1=this._isCanonicalRequestNeeded(f1);a1=this._getRefreshAfterChange(a1,Z);X=y._createUrlParamsArray(T);W=this._getHeaders(W);$="POST";b1=Z in c1.mDeferredGroups;d1=c1._normalizePath(P,K,f1);e1=this.resolveDeep(P,K);return this._processRequest(function(g1){k=c1._createRequestUrlWithNormalizedPath(d1,X,c1.bUseBatch);R=c1._createRequest(k,e1,$,W,i,Y);R.created=true;n=c1.oMetadata._getEntityTypeByPath(d1);R.entityTypes={};if(n){R.entityTypes[n.entityType]=true;}V=c1.mRequests;if(b1){V=c1.mDeferredRequests;}c1._pushToRequestQueue(V,Z,_,R,S,N,g1,a1);return R;},N,b1);};I.prototype.remove=function(P,i){var j,k,S,n,R,K,N,T,V,W,X,Y,Z,$,_,a1,b1=this,c1,d1,e1=this.bCanonicalRequests;if(i){N=i.groupId||i.batchGroupId;T=i.changeSetId;j=i.context;S=i.success;n=i.error;V=i.eTag;Y=i.headers;X=i.urlParameters;W=i.refreshAfterChange;e1=i.canonicalRequest;}e1=this._isCanonicalRequestNeeded(e1);W=this._getRefreshAfterChange(W,N);Z=y._createUrlParamsArray(X);Y=this._getHeaders(Y);$="DELETE";V=V||this._getETag(P,j);a1=N in b1.mDeferredGroups;c1=this._normalizePath(P,j,e1);d1=this.resolveDeep(P,j);function f1(g1,h1){k=K.substr(K.lastIndexOf('/')+1);if(k.indexOf('?')!==-1){k=k.substr(0,k.indexOf('?'));}b1._removeEntity(k);if(S){S(g1,h1);}}return this._processRequest(function(g1){K=b1._createRequestUrlWithNormalizedPath(c1,Z,b1.bUseBatch);R=b1._createRequest(K,d1,$,Y,undefined,V);_=b1.mRequests;if(a1){_=b1.mDeferredRequests;}b1._pushToRequestQueue(_,N,T,R,f1,n,g1,W);return R;},n,a1);};I.prototype.callFunction=function(i,P){var R,j,k,n,K,N,S,T,V="GET",W,X,Y,Z,$=this,_,a1,b1,c1,d1,e1,f1,g1={};if(P){W=P.groupId||P.batchGroupId;X=P.changeSetId;V=P.method?P.method:V;K=Object.assign({},P.urlParameters);Z=P.eTag;S=P.success;T=P.error;Y=P.headers;f1=P.refreshAfterChange;}f1=this._getRefreshAfterChange(f1,W);if(!i.startsWith("/")){L.fatal(this+" callFunction: path '"+i+"' must be absolute!");return;}Y=this._getHeaders(Y);d1=new Promise(function(h1,i1){b1=h1;c1=i1;});e1=this._processRequest(function(h1){k=$.oMetadata._getFunctionImportMetadata(i,V);d(k,$+": Function "+i+" not found in the metadata !");if(!k){c1();return;}var i1=k.entitySet||k.entitySetPath;if(i1){g1.$result={__list:[]};if(k.returnType&&k.returnType.indexOf("Collection")==-1){g1.$result={__ref:{}};}}if(k.parameter!=null){g(k.parameter,function(j1,k1){g1[k1.name]=$._createPropertyValue(k1.type);if(K&&K[k1.name]!==undefined){g1[k1.name]=K[k1.name];K[k1.name]=y.formatValue(K[k1.name],k1.type);}else{L.warning($+" - No value for parameter '"+k1.name+"' found!'");}});}_=i.substring(1)+"('"+u()+"')";g1.__metadata={uri:$.sServiceUrl+'/'+_,created:{key:i.substring(1),success:S,error:T,headers:Y,method:V,groupId:W,changeSetId:X,eTag:Z,functionImport:true}};_=$._addEntity(g1);a1=$.getContext("/"+_);$._writePathCache("/"+_,"/"+_);b1(a1);N=y._createUrlParamsArray(K);j=$._createRequestUrlWithNormalizedPath(i,N,$.bUseBatch);R=$._createRequest(j,$.resolveDeep(i,a1),V,Y,undefined,Z);R.key=_;n=$.mRequests;if(W in $.mDeferredGroups){n=$.mDeferredRequests;}$._pushToRequestQueue(n,W,X,R,S,T,h1,f1);return R;},T);e1.contextCreated=function(){return d1;};return e1;};I.prototype._createFunctionImportParameters=function(i,j,P){var k=Q.extend(true,{},P);delete k.__metadata;delete k["$result"];var n=this.oMetadata._getFunctionImportMetadata(i,j);d(n,this+": Function "+i+" not found in the metadata !");if(!n){return;}if(n.parameter!=null){g(n.parameter,function(K,N){if(k&&k[N.name]!==undefined){k[N.name]=y.formatValue(k[N.name],N.type);}});}return k;};I.prototype.read=function(P,i){var j,k,n,K,N,R,S,T,V,W,X,Y,Z,$,_,a1,b1,c1,d1,e1,f1,g1,h1,i1=this;if(i){$=i.canonicalRequest;_=i.context;a1=i.error;b1=i.filters;c1=i.groupId||i.batchGroupId;d1=i.headers;e1=i.sorters;f1=i.success;g1=i.updateAggregatedMessages;h1=i.urlParameters;}$=this._isCanonicalRequestNeeded($);if(this.sRefreshGroupId){c1=this.sRefreshGroupId;}Z=y._createUrlParamsArray(h1);d1=this._getHeaders(d1,true);R="GET";n=this._getETag(P,_);var j1={abort:function(){if(V){V._aborted=true;}}};var k1=P;var l1=P.indexOf("$count");if(l1!==-1){k1=P.substring(0,l1-1);}T=this._normalizePath(k1,_,$);S=this._normalizePath(P,_,$);j=this.resolveDeep(P,_);function m1(n1){X=y.createSortParams(e1);if(X){Z.push(X);}k=i1.oMetadata._getEntityTypeByPath(T);K=F.groupFilters(b1);N=y.createFilterParams(K,i1.oMetadata,k);if(N){Z.push(N);}Y=i1._createRequestUrlWithNormalizedPath(S,Z,i1.bUseBatch);V=i1._createRequest(Y,j,R,d1,null,n,undefined,g1);W=i1.mRequests;if(c1 in i1.mDeferredGroups){W=i1.mDeferredRequests;}i1._pushToRequestQueue(W,c1,null,V,f1,a1,n1,false);return V;}if(this.bUseBatch&&this.bIncludeInCurrentBatch){V=m1(j1);return j1;}else{return this._processRequest(m1,a1);}};I.prototype.getServiceMetadata=function(){if(this.oMetadata&&this.oMetadata.isLoaded()){return this.oMetadata.getServiceMetadata();}};I.prototype.metadataLoaded=function(){var i=this.oMetadata.loaded();if(this.bLoadAnnotationsJoined){var j=function(){return i;};return this.pAnnotationsLoaded.then(j,j);}else{return i;}};I.prototype.annotationsLoaded=function(){return this.pAnnotationsLoaded;};I.prototype.isMetadataLoadingFailed=function(){return this.oMetadata.isFailed();};I.prototype.getServiceAnnotations=function(){var i=this.oAnnotations.getData();return h(i)?null:i;};I.prototype.onAnnotationsFailed=function(i){this.fireAnnotationsFailed(i.getParameters());};I.prototype.onAnnotationsLoaded=function(i){this.fireAnnotationsLoaded(i.getParameters());};I.prototype.addAnnotationUrl=function(i){var j=[].concat(i),k=[],n=[],K=[],N=this;j.forEach(function(P){var R=P.indexOf("$metadata");if(R>=0){P=N._createMetadataUrl(P);k.push(P);}else{n.push(P);}});return this.oMetadata._addUrl(k).then(function(P){return Promise.all(P.map(function(R){K=K.concat(R.entitySets);return N.oAnnotations.addSource({type:"xml",data:R["metadataString"]});}));}).then(function(){return N.oAnnotations.addSource(n);}).then(function(P){return{annotations:N.oAnnotations.getData(),entitySets:K};});};I.prototype.addAnnotationXML=function(X,S){return this.oAnnotations.addSource({type:"xml",data:X});};I.prototype.submitChanges=function(P){var R,j,k,S,n,K,N,T=false,V,W,X=this.bRefreshAfterChange,Y,Z=this;if(P){j=P.groupId||P.batchGroupId;S=P.success;n=P.error;if(P.merge!==undefined){V=P.merge?"MERGE":"PUT";}}if(j&&!this.mDeferredGroups[j]){L.fatal(this+" submitChanges: \""+j+"\" is not a deferred group!");}W=m({},Z.mChangedEntities);this.oMetadata.loaded().then(function(){g(W,function(d1,e1){k=Z._resolveGroup(d1);if(k.groupId===j||!j){R=Z._processChange(d1,e1,V||Z.sDefaultUpdateMethod);R.key=d1;Y=e1.__metadata&&e1.__metadata.created?e1.__metadata.created:{};var K={abort:function(){R._aborted=true;}};if(k.groupId in Z.mDeferredGroups){Z._pushToRequestQueue(Z.mDeferredRequests,k.groupId,k.changeSetId,R,Y.success,Y.error,K,X);}}});var $,_,a1,b1,c1,i;for($ in Z.mDeferredRequests){a1=Z.mDeferredRequests[$];for(_ in a1.changes){b1=a1.changes[_];for(i=b1.length-1;i>=0;i--){c1=b1[i];if(c1.bRefreshAfterChange===undefined){c1.bRefreshAfterChange=X;}}}}N=Z._processRequestQueue(Z.mDeferredRequests,j,S,n);if(T){K.abort();}if(Array.isArray(N)&&N.length==0&&S){S({},undefined);}});K={abort:function(){if(N){if(Array.isArray(N)){N.forEach(function(K){K.abort();});}else{N.abort();}}else{T=true;}}};return K;};I.prototype._updateChangedEntities=function(i){var j=this,R,k,n;function K(N,P,S){g(P,function(T){var V=S+'/'+T;if(l(P[T])&&l(N[T])){K(N[T],P[T],V);if(h(P[T])){delete P[T];}}else if(f(P[T],N[T])&&!j.isLaundering(V)){delete P[T];if(S===R){k=j.oMetadata._getEntityTypeByPath(R);n=k&&j.oMetadata._getNavPropertyRefInfo(k,T);if(n&&P[n.name]){N[n.name]=P[n.name];delete P[n.name];}}}});}g(i,function(N,P){if(N in j.mChangedEntities){var S=j._getObject('/'+N,null,true);var T=j._getObject('/'+N);m(S,P);R='/'+N;var V=j.removeInternalMetadata(T).deepPath;K(S,T,R);if(h(T)){delete j.mChangedEntities[N];j.abortInternalRequest(j._resolveGroup(N).groupId,{requestKey:N});}else{j.mChangedEntities[N]=T;T.__metadata={deepPath:V};Q.extend(T.__metadata,S.__metadata);}}});};I.prototype.resetChanges=function(P,j){var k=this,n,K={},N,R;if(j){if(P){P.forEach(function(i){k.oMetadata.loaded().then(function(){g(k.mDeferredGroups,function(S){k.abortInternalRequest(S,{path:i.substring(1)});});});});}else{this.oMetadata.loaded().then(function(){g(k.mDeferredGroups,function(i){k.abortInternalRequest(i);});});}}if(P){g(P,function(S,T){k.getEntityByPath(T,null,K);if(K&&K.propertyPath!==undefined){n=K.propertyPath.split("/");var V=K.key;N=k.mChangedEntities[V];for(var i=0;i<n.length-1;i++){if(N.hasOwnProperty(n[i])){N=N[n[i]];}else{N=undefined;}}if(N){delete N[n[n.length-1]];}if(k.mChangedEntities[V]){R=k.mChangedEntities[V].__metadata;delete k.mChangedEntities[V].__metadata;if(h(k.mChangedEntities[V])||!K.propertyPath){k.oMetadata.loaded().then(function(){k.abortInternalRequest(k._resolveGroup(V).groupId,{requestKey:V});});delete k.mChangedEntities[V];sap.ui.getCore().getMessageManager().removeMessages(k.getMessagesByEntity(V,true));}else{k.mChangedEntities[V].__metadata=R;}}else{L.warning(k+" - resetChanges: "+T+" is not changed");}}});}else{g(this.mChangedEntities,function(i,S){k.oMetadata.loaded().then(function(){k.abortInternalRequest(k._resolveGroup(i).groupId,{requestKey:i});});delete k.mChangedEntities[i];sap.ui.getCore().getMessageManager().removeMessages(k.getMessagesByEntity(i,true));});}this.checkUpdate(true);return this.oMetadata.loaded();};I.prototype.setProperty=function(P,V,j,k){var n,K,R,N,S,T,W,X,Y,Z,$,_,a1={},b1={},c1,d1,e1,f1=false,g1=this,h1,i1,j1,k1,l1,m1,n1;function o1(q1,r1){g(r1,function(Y){if(l(r1[Y])&&l(q1[Y])){o1(q1[Y],r1[Y]);if(h(r1[Y])){delete r1[Y];}}else if(f(r1[Y],q1[Y])){delete r1[Y];}});}W=this.resolve(P,j);n1=this.resolveDeep(P,j);T=this.getEntityByPath(W,null,b1);if(!T){return false;}K=W.substring(W.lastIndexOf("/")+1);Y=b1.key;S=this._getObject('/'+Y,null,true);n=this._getObject(P,j,true);if(!this.mChangedEntities[Y]){_=T.__metadata;T={};T.__metadata=Object.assign({},_);if(b1.propertyPath.length>0){var p1=n1.lastIndexOf(b1.propertyPath);T.__metadata.deepPath=n1.substring(0,p1-1);}this.mChangedEntities[Y]=T;}d1=this.mChangedEntities[Y];X=b1.propertyPath.split("/");for(var i=0;i<X.length-1;i++){if(!d1.hasOwnProperty(X[i])){d1[X[i]]={};}d1=d1[X[i]];}f1=S.__metadata.created&&S.__metadata.created.functionImport;d1[K]=V;i1=this.oMetadata._getEntityTypeByPath(b1.key);j1=i1&&this.oMetadata._getNavPropertyRefInfo(i1,K);k1=j1&&S[j1.name]&&S[j1.name].__ref;if(k1&&j1.keys.length===1){if(V===null){m1=null;}else{l1={};j1.keys.forEach(function(q1){l1[q1]=T[q1]!==undefined?T[q1]:S[q1];});l1[j1.keys[0]]=V;m1=this.createKey(j1.entitySet,l1);}d1[j1.name]={__ref:m1};}if(f(V,n)&&!this.isLaundering('/'+Y)&&!f1){_=this.mChangedEntities[Y].__metadata;h1=_&&_.created;delete this.mChangedEntities[Y].__metadata;if(!h1){o1(S,this.mChangedEntities[Y]);}if(h(this.mChangedEntities[Y])){delete this.mChangedEntities[Y];a1[Y]=true;this.checkUpdate(false,k,a1);g1.oMetadata.loaded().then(function(){g1.abortInternalRequest(g1._resolveGroup(Y).groupId,{requestKey:Y});});return true;}this.mChangedEntities[Y].__metadata=_;}Z=this._resolveGroup(Y);R=this.mRequests;if(Z.groupId in this.mDeferredGroups){R=this.mDeferredRequests;N=this._processChange(Y,{__metadata:T.__metadata},this.sDefaultUpdateMethod);}else{N=this._processChange(Y,this._getObject('/'+Y),this.sDefaultUpdateMethod);}N.key=Y;c1=d1.__metadata&&d1.__metadata.created?d1.__metadata.created:{};e1=this._getRefreshAfterChange(undefined,Z.groupId);this.oMetadata.loaded().then(function(){$={abort:function(){N._aborted=true;}};g1._pushToRequestQueue(R,Z.groupId,Z.changeSetId,N,c1.success,c1.error,$,e1);g1._processRequestQueueAsync(g1.mRequests);});a1[Y]=true;this.checkUpdate(false,k,a1);return true;};I.prototype._isHeaderPrivate=function(i){switch(i.toLowerCase()){case"accept":case"accept-language":case"maxdataserviceversion":case"dataserviceversion":return true;case"x-csrf-token":return this.bTokenHandling;case"sap-contextid-accept":case"sap-contextid":return!this.bDisableSoftStateHeader;default:return false;}};I.prototype.setHeaders=function(i){var j={},k=this;this.mCustomHeaders={};if(i){g(i,function(n,K){if(k._isHeaderPrivate(n)){L.warning(this+" - modifying private header: '"+n+"' not allowed!");}else{j[n]=K;}});this.mCustomHeaders=j;}if(this.oAnnotations){this.oAnnotations.setHeaders(this.mCustomHeaders);}};I.prototype._getHeaders=function(i,j){var k={},n=this;if(i){g(i,function(K,N){if(n._isHeaderPrivate(K)){L.warning(this+" - modifying private header: '"+K+"' not allowed!");}else{k[K]=N;}});}return Q.extend({'sap-cancel-on-close':!!j},this.mCustomHeaders,k,this.oHeaders);};I.prototype.getHeaders=function(){return Q.extend({},this.mCustomHeaders,this.oHeaders);};I.prototype._getHeader=function(i,j){var k;for(k in j){if(k.toLowerCase()===i.toLowerCase()){return j[k];}}return null;};I.prototype.hasPendingChanges=function(i){var j=!h(this.mChangedEntities);if(i){j=j||this.iPendingDeferredRequests>0;}return j;};I.prototype.hasPendingRequests=function(){return this.aPendingRequestHandles.length>0;};I.prototype.getPendingChanges=function(){return m({},this.mChangedEntities);};I.prototype.updateBindings=function(i){this.checkUpdate(i);};I.prototype.setTokenHandlingEnabled=function(T){this.bTokenHandling=T;};I.prototype.setUseBatch=function(i){this.bUseBatch=i;};I.prototype.formatValue=function(V,T){return y.formatValue(V,T);};I.prototype.deleteCreatedEntry=function(i){var j=this,k,n;if(i){var k=i.getPath().substr(1);n=this._resolveGroup(k).groupId;j.oMetadata.loaded().then(function(){j.abortInternalRequest(n,{requestKey:k});});j._removeEntity(k);sap.ui.getCore().getMessageManager().removeMessages(this.getMessagesByEntity(i.getPath(),true));}};I.prototype.createEntry=function(P,j){var S,k,R,n,K,N,T,V,W,X,Y,Z,$,_,a1,b1={},c1,d1="POST",e1=this,f1,g1,h1;if(j){a1=j.properties;W=j.groupId||j.batchGroupId;X=j.changeSetId;N=j.context;S=j.success;k=j.error;c1=j.created;K=j.eTag;$=j.headers;Z=j.urlParameters;Y=j.refreshAfterChange;h1=j.canonicalRequest;}h1=this._isCanonicalRequestNeeded(h1);$=$||{};Y=this._getRefreshAfterChange(Y,W);W=W?W:this.sDefaultChangeGroup;V=y._createUrlParamsArray(Z);var i1={abort:function(){if(R){R._aborted=true;}}};if(!P.startsWith("/")&&!N){P="/"+P;}g1=e1._normalizePath(P,N,h1);f1=e1.resolveDeep(P,N);function j1(){var k1;var l1=e1.oMetadata._getEntityTypeByPath(g1);if(!l1){d(l1,"No Metadata for collection "+g1+" found");return undefined;}if(typeof a1==="object"&&!Array.isArray(a1)){b1=m({},a1);}else{for(var i=0;i<l1.property.length;i++){var m1=l1.property[i];var n1=(a1?a1.indexOf(m1.name):-1)>-1;if(!a1||n1){b1[m1.name]=e1._createPropertyValue(m1.type);if(n1){a1.splice(a1.indexOf(m1.name),1);}}}if(a1){d(a1.length===0,"No metadata for the following properties found: "+a1.join(","));}}var o1=e1.oMetadata._getEntitySetByType(l1);var p1="('"+u()+"')";T=o1.name+p1;if(f1&&e1.oMetadata._isCollection(f1)){f1=f1+p1;}b1.__metadata={type:""+l1.entityType,uri:e1.sServiceUrl+'/'+T,created:{key:g1.substring(1),success:S,error:k,headers:$,urlParameters:Z,groupId:W,changeSetId:X,eTag:K},deepPath:f1};T=e1._addEntity(m({},b1));e1.mChangedEntities[T]=b1;n=e1._createRequestUrlWithNormalizedPath(g1,V,e1.bUseBatch);R=e1._createRequest(n,f1,d1,$,b1,K);k1=e1.getContext("/"+T,f1);k1.bCreated=true;R.key=T;R.created=true;_=e1.mRequests;if(W in e1.mDeferredGroups){_=e1.mDeferredRequests;}e1.oMetadata.loaded().then(function(){e1._pushToRequestQueue(_,W,X,R,S,k,i1,Y);e1._processRequestQueueAsync(e1.mRequests);});return k1;}if(c1){this.oMetadata.loaded().then(function(){c1(j1());});}else if(this.oMetadata.isLoaded()){return j1();}else{L.error("Tried to use createEntry without created-callback, before metadata is available!");}};I.prototype._isCreatedEntity=function(i){return!!(i&&i.__metadata&&i.__metadata.created);};I.prototype._createPropertyValue=function(T){var j=this.oMetadata._splitName(T);var n=j.namespace;var k=j.name;if(n.toUpperCase()!=='EDM'){var K={};var N=this.oMetadata._getObjectMetadata("complexType",k,n);d(N,"Complex type "+T+" not found in the metadata !");for(var i=0;i<N.property.length;i++){var P=N.property[i];K[P.name]=this._createPropertyValue(P.type);}return K;}else{return this._getDefaultPropertyValue(k,n);}};I.prototype._getDefaultPropertyValue=function(T,n){return undefined;};I.prototype._normalizePath=function(P,i,j){if(P&&P.indexOf('?')!==-1){P=P.substr(0,P.indexOf('?'));}if(!i&&!P.startsWith("/")){L.fatal(this+" path "+P+" must be absolute if no Context is set");}return this.resolve(P,i,j)||this.resolve(P,i);};I.prototype.getRefreshAfterChange=function(){return this.bRefreshAfterChange;};I.prototype.setRefreshAfterChange=function(R){this.bRefreshAfterChange=R;};I.prototype.isList=function(P,i){P=this.resolve(P,i);return P&&P.substr(P.lastIndexOf("/")).indexOf("(")===-1;};I.prototype._isMetadataPath=function(P){var i=false;if(P&&P.indexOf('/#')>-1){i=true;}return i;};I.prototype.isMetaModelPath=function(P){return P.indexOf("##")==0||P.indexOf("/##")>-1;};I.prototype._request=function(R,S,i,j,k,n){var K;if(this.bDestroyed){return{abort:function(){}};}var N=this;function P(T){return function(){if(N.aPendingRequestHandles){var V=N.aPendingRequestHandles.indexOf(K);if(V>-1){N.aPendingRequestHandles.splice(V,1);}}if(!(K&&K.bSuppressErrorHandlerCall)){T.apply(this,arguments);}};}K=D.request(R,P(S||D.defaultSuccess),P(i||D.defaultError),j,k,n);if(R.async!==false){this.aPendingRequestHandles.push(K);}return K;};I.prototype.destroy=function(){this.bDestroyed=true;q.prototype.destroy.apply(this,arguments);if(this.aPendingRequestHandles){for(var i=this.aPendingRequestHandles.length-1;i>=0;i--){var R=this.aPendingRequestHandles[i];if(R&&R.abort){R.bSuppressErrorHandlerCall=true;R.abort();}}delete this.aPendingRequestHandles;}if(this.sMetadataLoadEvent){clearTimeout(this.sMetadataLoadEvent);}if(this.oMetadataFailedEvent){clearTimeout(this.oMetadataFailedEvent);}if(this.oMetadata){this.oMetadata.detachFailed(this.onMetadataFailed);if(!this.oMetadata.isLoaded()&&!this.oMetadata.hasListeners("loaded")){this.oMetadata.destroy();delete this.oSharedMetaData.oMetadata;}delete this.oMetadata;delete this.pMetadataLoaded;}if(this.oMetaModel){this.oMetaModel.destroy();delete this.oMetaModel;}if(this.oAnnotations){this.oAnnotations.detachSomeLoaded(this.onAnnotationsLoaded);this.oAnnotations.detachAllFailed(this.onAnnotationsFailed);this.oAnnotations.destroy();delete this.oAnnotations;delete this.pAnnotationsLoaded;}};I.prototype.setDeferredBatchGroups=function(i){this.setDeferredGroups(i);};I.prototype.setDeferredGroups=function(i){var j=this;this.mDeferredGroups={};g(i,function(k,n){j.mDeferredGroups[n]=n;});};I.prototype.getDeferredBatchGroups=function(){return this.getDeferredGroups();};I.prototype.getDeferredGroups=function(){return Object.keys(this.mDeferredGroups);};I.prototype.setChangeBatchGroups=function(i){g(i,function(j,k){k.groupId=k.batchGroupId;});this.setChangeGroups(i);};I.prototype.setChangeGroups=function(i){this.mChangeGroups=i;};I.prototype.getChangeBatchGroups=function(){return this.getChangeGroups();};I.prototype.getChangeGroups=function(){return this.mChangeGroups;};I.prototype.setMessageParser=function(P){if(!(P instanceof p)){L.error("Given MessageParser is not of type sap.ui.core.message.MessageParser");return this;}P.setProcessor(this);this.oMessageParser=P;return this;};I.prototype._parseResponse=function(R,i,j,k){try{if(!this.oMessageParser){this.oMessageParser=new w(this.sServiceUrl,this.oMetadata);this.oMessageParser.setProcessor(this);}this.oMessageParser.parse(R,i,j,k,this.bIsMessageScopeSupported);}catch(n){L.error("Error parsing OData messages: "+n);}};I.prototype.callAfterUpdate=function(i){this.aCallAfterUpdate.push(i);};I.prototype.getMetaModel=function(){var i=this;if(!this.oMetaModel){this.oMetaModel=new v(this.oMetadata,this.oAnnotations,{addAnnotationUrl:this.addAnnotationUrl.bind(this),annotationsLoadedPromise:this.pAnnotationsLoaded});this.oMetaModel.loaded().then(function(){i.bMetaModelLoaded=true;i.checkUpdate(false,false,null,true);},function(j){var k=j.message,n;if(!k&&j.xmlDoc&&j.xmlDoc.parseError){k=j.xmlDoc.parseError.reason;n=j.xmlDoc.parseError.srcText;}L.error("error in ODataMetaModel.loaded(): "+k,n,"sap.ui.model.odata.v2.ODataModel");});}return this.oMetaModel;};I.prototype.getOriginalProperty=function(P,i){return this._getObject(P,i,true);};I.prototype.getEntityByPath=function(P,i,j){var R=q.prototype.resolve.call(this,P,i);if(!R){return null;}var k=R.split("/"),n=null,K=[];while(k.length>0){var N=k.join("/"),S=this._getObject(N);if(l(S)){var T=this._getKey(S);if(T){n=S;break;}}K.unshift(k.pop());}if(n){j.propertyPath=K.join("/");j.key=T;return n;}return null;};I.prototype.resolveFromCache=function(P){if(!this.mPathCache){return undefined;}var S,i="",j,n,k;j=this.mPathCache[P]?this.mPathCache[P].canonicalPath:undefined;if(P&&j!==P){S=j||P;if(!j){k=S.lastIndexOf("/");i=S.substr(k);S=S.substr(0,k);}n=this.resolveFromCache(S);if(n&&n!==S){j=n+i;}}return j;};I.prototype.resolve=function(P,i,j){var R=q.prototype.resolve.call(this,P,i);if(R&&!this._isMetadataPath(R)&&j){var k=this.resolveFromCache(R);if(!k){k=this.oMetadata._calculateCanonicalPath(R);k=this.resolveFromCache(k)||k;}this._writePathCache(R,k);return k;}return R;};I.prototype.resolveDeep=function(P,i){var R=q.prototype.resolve.call(this,P,i);if(P&&!P.startsWith("/")){R=i?i.sDeepPath+'/'+P:R;}if(P===""){R=i?i.sDeepPath:R;}return R;};I.prototype.isLaundering=function(P,i){var R=this.resolve(P,i);return(R in this.mLaunderingState)&&this.mLaunderingState[R]>0;};I.prototype.increaseLaundering=function(P,i){if(!i){return;}for(var n in i){if(n==="__metadata"){continue;}var j=i[n];if(l(j)){this.increaseLaundering(P+"/"+n,j);}else{var T=P+"/"+n;if(!(T in this.mLaunderingState)){this.mLaunderingState[T]=0;}this.mLaunderingState[T]++;}}if(!(P in this.mLaunderingState)){this.mLaunderingState[P]=0;}this.mLaunderingState[P]++;};I.prototype.decreaseLaundering=function(P,i){if(!i){return;}for(var n in i){if(n==="__metadata"){continue;}var j=i[n],T=P+"/"+n;if(l(j)){this.decreaseLaundering(T,j);}else{if(T in this.mLaunderingState){this.mLaunderingState[T]--;if(this.mLaunderingState[T]===0){delete this.mLaunderingState[T];}}}}this.mLaunderingState[P]--;if(this.mLaunderingState[P]===0){delete this.mLaunderingState[P];}};I.prototype._getRefreshAfterChange=function(R,i){if(R===undefined&&!(i in this.mDeferredGroups)){return this.bRefreshAfterChange;}return R;};I.prototype.getMessagesByEntity=function(j,k){var n=j,K=[],P;function N(K){var R=[];for(var i=0;i<K.length;i++){if(!k||(k&&!K[i].persistent)){R.push(K[i]);}}return R;}if(!n.startsWith('/')){n='/'+n;}if(this.mMessages){for(P in this.mMessages){if(typeof n=="string"&&n.length>0&&P.startsWith(n)){K=K.concat(N(this.mMessages[P]));}}return K;}return null;};I.prototype._cacheSupported=function(i){var j=/\/~[\w\-]+~[A-Z0-9]?/;var k=[i];if(this.sAnnotationURI){if(!Array.isArray(this.sAnnotationURI)){this.sAnnotationURI=[this.sAnnotationURI];}k=k.concat(this.sAnnotationURI);}k=k.filter(function(n){return n.indexOf("sap-context-token")===-1;});k=k.filter(function(n){return!j.test(n);});return k.length===0?true:false;};I.prototype._getAnnotationCacheKey=function(i){var j;if(this.bUseCache){if(!this.bSkipMetadataAnnotationParsing){j=i+"#annotations";}if(this.sAnnotationURI){if(!Array.isArray(this.sAnnotationURI)){this.sAnnotationURI=[this.sAnnotationURI];}this.sAnnotationURI=this.sAnnotationURI.map(function(k){return k+"#annotations";});j=this.bSkipMetadataAnnotationParsing?this.sAnnotationURI.join("_"):j+"_"+this.sAnnotationURI.join("_");}}return j;};I.prototype.canonicalRequestsEnabled=function(){return this.bCanonicalRequests;};I.prototype._decreaseDeferredRequestCount=function(R){if(R.deferred){this.iPendingDeferredRequests--;}};I.prototype.enableCanonicalRequests=function(i){this.bCanonicalRequests=!!i;};I.prototype.getMessageScope=function(){return this.sMessageScope;};I.prototype.setMessageScope=function(i){if(i!==s.RequestedObjects&&i!==s.BusinessObject){throw new Error("Unsupported message scope: "+i);}this.sMessageScope=i;};I.prototype.messageScopeSupported=function(){var i=this;return this.metadataLoaded().then(function(){return i.bIsMessageScopeSupported;});};I.prototype.getContext=function(P,i){var j=q.prototype.getContext.apply(this,arguments);if(i){j.sDeepPath=i;}else if(!i&&!j.sDeepPath){j.sDeepPath=P;}return j;};I.prototype.hasContext=function(P){return this.mContexts[P];};I.prototype.removeInternalMetadata=function(i){var j,k,K,V;if(i&&i.__metadata){j=i.__metadata.created;k=i.__metadata.deepPath;delete i.__metadata.created;delete i.__metadata.deepPath;for(K in i){V=i[K];if(Array.isArray(V)){V.forEach(I.prototype.removeInternalMetadata);}else if(typeof V==="object"){I.prototype.removeInternalMetadata(V);}}}return{created:j,deepPath:k};};I.prototype._isCanonicalRequestNeeded=function(i){if(i!==undefined){return!!i;}else{return!!this.bCanonicalRequests;}};I.prototype.filterMatchingMessages=function(i,P){var j=this;return this.mMessages[i].filter(function(k){return j.isMessageMatching(k,P);});};I.prototype.isMessageMatching=function(i,P){var j=i.fullTarget,k=P.length;return j===P||j.startsWith(P)&&(P==="/"||j[k]==="/"||j[k]==="(");};I.prototype.getMessages=function(i){return this.getMessagesByPath(i.sDeepPath,true).sort(M.compare);};return I;});
