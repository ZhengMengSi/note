/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/base/ManagedObject","sap/base/util/uid","./AnimationSequence","./AnimationTrack","./ViewGroup","./View","./Highlight","./Annotation"],function(M,u,A,a,V,b,H,c){"use strict";var S=M.extend("sap.ui.vk.Scene",{metadata:{"abstract":true,properties:{doubleSided:{type:"boolean",defaultValue:false},autoPlayAnimation:{type:"boolean",defaultValue:true},autoAdvanceView:{type:"boolean",defaultValue:false},autoAdvanceViewTimeout:{type:"int",defaultValue:5000},enableDivAnnotations:{type:"boolean",defaultValue:false}},associations:{animationPlayer:{type:"sap.ui.vk.AnimationPlayer",multiple:false}},events:{annotationsLoaded:{},annotationAdded:{parameters:{nodeRef:{type:"object"},annotationId:{type:"string"}}},annotationUpdated:{parameters:{nodeRef:{type:"object"},annotationId:{type:"string"}}},annotationRemoved:{parameters:{nodeRef:{type:"object"},annotationId:{type:"string"}}},allAnnotationsRemoved:{}}}});S.prototype.getInitialView=function(){return null;};S.prototype.createSequence=function(i,p){var s=new A(i,p);this.addSequence(s);return s;};S.prototype.getSequences=function(){if(!this._sequences){this._sequences=[];}return this._sequences;};S.prototype.findSequence=function(s){if(!this._sequences){return undefined;}return this._sequences.find(function(d){return d.getId()===s;});};S.prototype.addSequence=function(s){if(!this._sequences){this._sequences=[];}this._sequences.push(s);return this;};S.prototype.insertSequence=function(s,i){if(!this._sequences){this._sequences=[];}if(i<0){i=0;}else if(i!==0&&i>=this._sequences.length){i=this._sequences.length;}this._sequences.splice(i,0,s);return this;};S.prototype.indexOfSequence=function(s){if(!this._sequences){return-1;}return this._sequences.find(function(i){return i==s;});};S.prototype.removeSequence=function(s){if(this._sequences){var i=this.indexOfSequence(s);if(i>=0){this._sequences.splice(i,1);}}return this;};S.prototype.removeSequences=function(){if(this._sequences){this._sequences.splice(0);}return this;};S.prototype.createTrack=function(i,p){var t=new a(i,p);this.addTrack(t);return t;};S.prototype.getTracks=function(){if(!this._tracks){this._tracks=[];}return this._tracks;};S.prototype.findTrack=function(t){if(!this._tracks){return undefined;}return this._tracks.find(function(d){return d.getId()===t;});};S.prototype.addTrack=function(t){if(!this._tracks){this._tracks=[];}this._tracks.push(t);return this;};S.prototype.insertTrack=function(t,i){if(!this._tracks){this._tracks=[];}if(i<0){i=0;}else if(i!==0&&i>=this._tracks.length){i=this._tracks.length;}this._tracks.splice(i,0,t);return this;};S.prototype.indexOfTrack=function(t){if(!this._tracks){return-1;}return this._tracks.findIndex(function(i){return i==t;});};S.prototype.removeTrack=function(t){if(this._tracks){var i=this.indexOfTrack(t);if(i>=0){this._tracks.splice(i,1);}}return this;};S.prototype.removeTracks=function(){if(this._tracks){this._tracks.splice(0);}return this;};S.prototype.getViewGroups=function(){if(!this._viewGroups){this._viewGroups=[];}return this._viewGroups;};S.prototype.createViewGroup=function(p){if(!this._viewGroups){this._viewGroups=[];}var v=new V(p);this._viewGroups.push(v);return v;};S.prototype.indexOfViewGroup=function(v){if(!this._viewGroups){return-1;}return this._viewGroups.find(function(i){return i==v;});};S.prototype.insertViewGroup=function(v,i){if(!this._viewGroups){this._viewGroups=[];}if(i<0){i=0;}else if(i!==0&&i>=this._viewGroups.length){i=this._viewGroups.length;}this._viewGroups.splice(i,0,v);return this;};S.prototype.removeViewGroup=function(v){var i=this.indexOfViewGroup(v);if(i>=0){this._viewGroups.splice(i,1);}return this;};S.prototype.removeViewGroups=function(){this._viewGroups.splice(0);return this;};S.prototype.findViewGroupByView=function(v){var r;if(this._viewGroups){for(var i=0;i<this._viewGroups.length;i++){if(this._viewGroups[i].indexOfView(v)>=0){r=this._viewGroups[i];break;}}}return r;};S.prototype.getViews=function(){if(!this._views){this._views=[];}return this._views;};S.prototype.createView=function(p){if(!this._views){this._views=[];}var v=new b(p);this._views.push(v);return v;};S.prototype.removeView=function(v){if(!this._views){return this;}var d=this.getViewGroups();if(Array.isArray(d)){d.forEach(function(e){e.removeView(v);});}var i=this._views.indexOf(v);if(i>=0){this._views.splice(i,1);}return this;};S.prototype.createHighlight=function(i,p){var h=new H(i,p);if(!this._highlights){this._highlights=new Map();}this._highlights.set(i,h);return h;};S.prototype.getHighlight=function(i){var h;if(this._highlights){h=this._highlights.get(i);}return h;};S.prototype.removeHighlight=function(i){if(this._highlights){this._highlights.delete(i);}return this;};S.prototype.setEnableDivAnnotations=function(e){this.setProperty("enableDivAnnotations",e);if(this.loaders){this.loaders.forEach(function(l){if(e){l.attachSceneCompleted(this.createAnnotations,this);}else{l.detachSceneCompleted(this.createAnnotations,this);}},this);}return this;};S.prototype.addAnnotation=function(d,v){if(!this._annotations){this._annotations=new Map();}this._annotations.forEach(function(d){d.setProperty("isStatic",true);});var e=d.getAnnotationId();if(!this._annotations.has(e)){this._annotations.set(e,d);}if(v){d.setSceneView(this,v);}if(!d._viewIds){d._viewIds=new Map([[null,true]]);}d._shouldRenderVp=true;return d;};S.prototype.getAnnotationStyles=function(){return c.getStyles();};S.prototype.createNewAnnotation=function(o){var d=new c({nodeRef:o.nodeRef,title:o.title,style:o.style,visible:o.visible?o.visible:true,annotationId:u(),annotationName:o.name,annotationType:o.type,xCoordinate:o.x,yCoordinate:o.y,isStatic:o.isStatic,positionType:o.nodeRef&&o.x!==undefined&&o.y!==undefined?sap.ui.vk.AnnotationPositionType.Fixed:sap.ui.vk.AnnotationPositionType.Relative});this.addAnnotation(d,o.viewid);d.sourceData={node:c.createAnnotationNode(d,this,o)};d._sceneRef=this;this.fireAnnotationAdded({nodeRef:d.sourceData.node,annotationId:d.getAnnotationId()});return d;};S.prototype._updateAnnotationId=function(o,n){var d=this.getAnnotation(o);if(d){d.setAnnotationId(n,this);this._annotations.delete(o);this._annotations.set(n,d);}return this;};S.prototype.updateAnnotation=function(o){var d=this.getAnnotation(o.annotationId);if(!o.annotationId||!d){return this;}if(o.newAnnotationId&&o.newAnnotationId!==o.annotationId){this._updateAnnotationId(o.annotationId,o.newAnnotationId);}if(o.name&&o.name!==d.getAnnotationName()){d.setProperty("annotationName",o.name);}if(o.type&&o.type!==d.getAnnotationType()){d.setProperty("annotationType",o.type);}if(o.title&&o.title!==d.getTitle()){d.setProperty("title",o.title);}if(o.style&&o.style!==d.getStyle()){d.setProperty("style",o.style);}if(o.nodeRef&&o.nodeRef!==d.getNodeRef()){d.setProperty("nodeRef",o.nodeRef);}d._shouldRenderVp=true;this.fireAnnotationUpdated({nodeRef:d.sourceData.node,annotationId:o.annotationId});return this;};S.prototype.createAnnotations=function(){this.annotations.forEach(function(d){d.viewIds=this.annotationViews.get(d.annotation.id)?this.annotationViews.get(d.annotation.id).viewIds:new Map([[null,true]]);var o=c.createAnnotation(d);o._sceneRef=this;this.addAnnotation(o);},this);this.fireAnnotationsLoaded();return this._annotations;};S.prototype.setAllAnnotationsEditable=function(e){if(e){this.getAnnotations().forEach(function(d){d.setEditable(false);});this.getSelectedAnnotations().forEach(function(d){d.setEditable(true);});}else{this.getAnnotations().forEach(function(d){d.setEditable(false);});}return this;};S.prototype.getAnnotations=function(){if(!this._annotations){this._annotations=new Map();}return this._annotations;};S.prototype.getNodeAnnotation=function(n){if(!n.userData.nodeId){return null;}return this.getAnnotations().get(n.userData.nodeId);};S.prototype.getSelectedAnnotations=function(){var s=new Map();if(this._annotations){this._annotations.forEach(function(d,i){if(d.getSelected()){s.set(i,d);}});}return s;};S.prototype.getEditableAnnotations=function(){var e=new Map();if(this._annotations){this._annotations.forEach(function(d,i){if(d.getEditable()){e.set(i,d);}});}return e;};S.prototype.getAnnotationsByViewId=function(v){var d=new Map();if(this._annotations){this._annotations.forEach(function(e,i){if(e._viewIds.get(v)){d.set(i,e);}});}return d;};S.prototype.getAnnotation=function(i){if(!this._annotations){this._annotations=new Map();}return this._annotations.get(i);};S.prototype.getAnnotationsByNodeId=function(t){var d=[];this.getAnnotations().forEach(function(e){if(e.getNodeRef()&&(e.getNodeRef().userData.nodeId===t||e.getNodeRef().parent.userData.nodeId===t)){d.push(e);}});return d;};S.prototype.removeAllAnnotations=function(){if(this._annotations){var d=this._annotations.keys();var e=d.next().value;while(e){this.removeAnnotation(e);e=d.next().value;}this._annotations.clear();}this.fireAllAnnotationsRemoved();return this;};S.prototype.removeAnnotation=function(d){var n=c.removeAnnotationNode(d,this);this.fireAnnotationRemoved({nodeRef:n,annotationId:d});return this;};S.prototype.updateNodeAnnotations=function(d,t,s,v,e){d.forEach(function(f,i){var g;if(f.children.length===0){g=f;}else{g=f.children.filter(function(n){return n.type==="Mesh";})[0];}var h=g.userData.nodeId||g.parent.userData.nodeId;var m=this.getAnnotationsByNodeId(h);if(m.length===0){var j=t&&t[i]?t[i]:"<cite style='color:red;'>"+f.name+"</cite>";this.createNewAnnotation({nodeRef:g,title:j,visible:true,viewid:v,style:s[i],viewport:e});}}.bind(this));};S.prototype.updateSceneAnnotation=function(d,e,f,g){var h=this.getAnnotation(d);if(h){if(g&&g!==h.getPositionType()){h.setProperty("positionType",g);}if(e===h.getTitle()&&(!f||f===h.getStyle())){return;}if(e&&e!==h.getTitle()){h.setProperty("title",e);}if(f&&f!==h.getStyle()){h.setProperty("style",e);}}};S.prototype.checkBlockedAnnotations=function(){if(!this._annotations){return this;}this._annotations.forEach(function(d){d.setBlocked(false);});return this;};S.prototype.hideAllAnnotations=function(){if(!this._annotations){return this;}this._annotations.forEach(function(d){d.setVisible(false);});return this;};S.prototype.hideAnnotation=function(d){if(this._annotations.has(d)){this._annotations.get(d).setVisible(false);}return this;};S.prototype.showAllAnnotations=function(){if(!this._annotations){return this;}this._annotations.forEach(function(d){d.setVisible(true);});return this;};return S;});
