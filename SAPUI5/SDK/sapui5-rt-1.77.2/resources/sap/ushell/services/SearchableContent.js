// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/Config","sap/ushell/adapters/cdm/v3/_LaunchPage/readApplications","sap/ushell/adapters/cdm/v3/_LaunchPage/readVisualizations","sap/ushell/adapters/cdm/v3/_LaunchPage/readPages","sap/base/util/values"],function(C,r,a,b,o){"use strict";var S=function(){};S.COMPONENT_NAME="sap/ushell/services/SearchableContent";S.prototype.getApps=function(){if(C.last("/core/spaces/enabled")){return this._getPagesAppData().then(this._filterGetApps);}return this._getLaunchPageAppData().then(this._filterGetApps);};S.prototype._filterGetApps=function(A){A.forEach(function(c){var v=c.visualizations;var u=[];c.visualizations=[];v.forEach(function(V){var U=JSON.stringify({title:V.title,subtitle:V.subtitle,icon:V.icon,vizTypeId:V.vizTypeId});if(u.indexOf(U)===-1){c.visualizations.push(V);u.push(U);}});});return A.filter(function(c){return c.visualizations.length>0;});};S.prototype._getLaunchPageAppData=function(){return sap.ushell.Container.getServiceAsync("LaunchPage").then(function(l){this._oLaunchPageService=l;return this._collectLaunchPageTiles();}.bind(this)).then(function(l){var A={};var v=l.map(this._buildVizDataFromLaunchPageTile.bind(this)).filter(function(V){return V;});v.forEach(function(V){var t=this._getTargetHash(undefined,V.target);if(A[t]){A[t].visualizations.push(V);}else{A[t]=this._buildAppDataFromViz(V);}}.bind(this));return o(A);}.bind(this));};S.prototype._collectLaunchPageTiles=function(){return new Promise(function(c,d){this._oLaunchPageService.getCatalogs().then(function(e){var D=[];e.forEach(function(f){D.push(this._oLaunchPageService.getCatalogTiles(f));}.bind(this));var g=this._oLaunchPageService.getGroups().then(function(G){var t=[];G.forEach(function(f){Array.prototype.push.apply(t,this._oLaunchPageService.getGroupTiles(f)||[]);}.bind(this));return t;}.bind(this));D.push(g);return jQuery.when.apply(jQuery,D).then(function(){var t=[];var f=Array.prototype.slice.call(arguments);f.forEach(function(h){Array.prototype.push.apply(t,h);});c(t);});}.bind(this));}.bind(this));};S.prototype._getPagesAppData=function(){return sap.ushell.Container.getServiceAsync("CommonDataModel").then(function(c){return Promise.all([c.getAllPages(),c.getApplications(),c.getVisualizations(),sap.ushell.Container.getServiceAsync("URLParsing")]);}).then(function(R){var p=R[0];var A=R[1];var v=R[2];this._oUrlParsingService=R[3];var s={applications:A,visualizations:v};var m={};this._applyCdmApplications(s,m);this._applyCdmPages(s,p,m);return o(m);}.bind(this));};S.prototype._applyCdmApplications=function(s,A){o(s.applications).forEach(function(c){var i=r.getInbounds(c)||{};o(i).forEach(function(I){var t=this._getTargetHash(s,I);A[t]=this._buildAppDataFromAppAndInbound(c,I);A[t].target=this._oUrlParsingService.parseShellHash(t);}.bind(this));}.bind(this));};S.prototype._applyCdmPages=function(s,p,A){p.forEach(function(P){var v=b.getVisualizationReferences(P);v.forEach(function(V){var c=a.getVizData(s,V);var t=this._getTargetHash(s,c.target);if(A[t]){A[t].visualizations.push(c);}else{A[t]=this._buildAppDataFromViz(c);}}.bind(this));}.bind(this));};S.prototype._getTargetHash=function(s,t){var T;var A=t.appId;var i=t.inboundId;if(t.url){T=t.url;if(T[0]==="#"){T=T.substring(1);}}else if(A&&i){var c=a.getAppDescriptor(s,A)||{};var I=r.getInbound(c,i)||{};T=this._oUrlParsingService.constructShellHash(I);}else{T=this._oUrlParsingService.constructShellHash(t);}return T;};S.prototype._buildAppDataFromAppAndInbound=function(A,i){return{id:r.getId(A),title:i.title||r.getTitle(A),subtitle:i.subTitle||r.getSubTitle(A),icon:i.icon||r.getIcon(A),info:i.info||r.getInfo(A),keywords:i.keywords||r.getKeywords(A),visualizations:[]};};S.prototype._buildAppDataFromViz=function(v){return{id:v.vizId,title:v.title,subtitle:v.subtitle,icon:v.icon,info:v.info,keywords:v.keywords,target:v.target,visualizations:[v]};};S.prototype._buildVizDataFromLaunchPageTile=function(l){var t;if(!this._oLaunchPageService.getCatalogTileTargetURL(l)){return;}if(this._oLaunchPageService.isTileIntentSupported&&!this._oLaunchPageService.isTileIntentSupported(l)){return;}if(!this._oLaunchPageService.getCatalogTilePreviewTitle(l)){t=this._oLaunchPageService.getCatalogTileView(l);}var v={id:this._oLaunchPageService.getTileId(l)||this._oLaunchPageService.getCatalogTileId(l),vizId:this._oLaunchPageService.getCatalogTileId(l)||this._oLaunchPageService.getTileId(l)||"",vizTypeId:"",title:this._oLaunchPageService.getCatalogTilePreviewTitle(l)||this._oLaunchPageService.getCatalogTileTitle(l)||this._oLaunchPageService.getTileTitle(l)||"",subtitle:this._oLaunchPageService.getCatalogTilePreviewSubtitle(l)||"",icon:this._oLaunchPageService.getCatalogTilePreviewIcon(l)||"sap-icon://business-objects-experience",info:this._oLaunchPageService.getCatalogTilePreviewInfo(l)||"",keywords:this._oLaunchPageService.getCatalogTileKeywords(l)||[],target:{type:"URL",url:this._oLaunchPageService.getCatalogTileTargetURL(l)}};if(t){if(!t.destroy){var e=new Error("The tileview \""+v.title+"\" with target url \""+v.target.url+"\" does not implement mandatory function destroy!");throw e;}t.destroy();}return v;};S.hasNoAdapter=true;return S;},true);
