// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/m/Button","sap/m/library","sap/m/List","sap/m/ResponsivePopover","sap/m/StandardListItem","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/json/JSONModel","sap/ui/model/Sorter","sap/ushell/services/Container"],function(B,m,L,R,S,F,a,J,b){"use strict";var c=m.ButtonType;var P=m.PlacementType;var d=m.ListMode;var e=m.ListSeparators;return function(){var p,f,t,l,A,M,r,g={},o,s,h,i;this.init=function(C){p=C.getView();f=p.byId("tileSelector");t=p.byId("tileSelectorToolbar");l=p.byId("tileSelectorList");A=p.byId("tileSelectorAddButton");g.i18n=C.getResourceBundle();l.setBusy(true);M=new J({searchText:"",descending:false,tileSelectorHierarchySet:undefined});M.setSizeLimit(Infinity);f.setModel(M);r=p.getModel("roles");s=new L({mode:d.MultiSelect,showSeparators:e.None,includeItemInSelection:true,selectionChange:function(){h.getBeginButton().setEnabled(!!s.getSelectedItem());},items:{path:"/page/sections",template:new S({title:"{title}"})},noDataText:g.i18n.getText("Message.NoSections")}).setModel(p.getModel());A.setEnabled(false);l.attachSelectionChange(this._onSelectionChange);};this.initTiles=function(T){var x={};A.setEnabled(false);if(typeof T!=="undefined"){M.setProperty("/tileSelectorHierarchySet",T);l.setModel(undefined);}else{M.setProperty("/tileSelectorHierarchySet",undefined);l.setModel(p.getModel("PageRepository"));x.parameters={expand:"vizDetails"};}x.path="/tileSelectorHierarchySet";x.sorter=j(M.getProperty("/descending"));x.factory=function(I,y){switch(y.getProperty("type")){default:case"catalog":return p.byId("tileSelectorGroupHeader").clone();case"visualization":return p.byId("tileSelectorCustomListItem").clone().bindObject(y.getPath()+"/vizDetails");}};l.bindItems(x);l.getBinding("items").filter(_());l.setBusy(false);};this.refreshRoleContext=function(){l.getBinding("items").filter(_());};this.onSearchTiles=function(){l.getBinding("items").filter(_());};this.onAddTiles=function(E){var x=s.getItems(),y=E.getSource().getBindingContext();if(y){var z=y.getPath();o=l.getItems().filter(function(C){return(C.getBindingContextPath()===z);})[0];}else{o=undefined;}if(x.length===1){x[0].setSelected(true);w();}else{q(E);}};this.onSortCatalogsToggle=function(){k();};this._onSelectionChange=function(){A.setEnabled(!!n().length);};this.setAddTileHandler=function(x){i=x;};this.onDragStart=function(E){var I=E.getParameter("target").getBindingContext().getProperty();if(!I.vizId){E.preventDefault();return;}E.getParameter("dragSession").setComplexData("callback",function callback(x,y){i(I,[y],x);});};function _(){var x=[];if(!M.getProperty("/tileSelectorHierarchySet")){var y=r.getProperty("/selected")||[];y.forEach(function(z){x.push(new F("roleIdFilter",a.EQ,z));});}return x;}function j(x){return[new b("title",x),new b("vizDetails/title",false)];}function k(x){var y=((typeof x!=="undefined")?x:!M.getProperty("/descending"));l.getBinding("items").sort(j(y));M.setProperty("/descending",y);}function n(){if(o){return[o.getBindingContext().getProperty()];}var x=l.getModel();return l.getSelectedContextPaths().map(function(y){return x.getContext(y).getProperty();});}function q(E){if(!h||h.bIsDestroyed){v();}s.removeSelections(true);h.getBeginButton().setEnabled(false);h.getEndButton().setEnabled(true);if(!o&&u(A)){h.openBy(t.getAggregation("_overflowButton"));}else{h.openBy(E.getSource());}}function u(C){return(C.hasStyleClass("sapMOTAPButtonNoIcon")||C.hasStyleClass("sapMOTAPButtonWithIcon"));}function v(){h=new R({placement:P.Auto,title:g.i18n.getText("Tooltip.AddToSections"),beginButton:new B({type:c.Emphasized,text:g.i18n.getText("Button.Add"),press:function(){this.setEnabled(false);h.close();w();}}),endButton:new B({text:g.i18n.getText("Button.Cancel"),press:function(){this.setEnabled(false);h.close();}}),content:s,initialFocus:s}).addStyleClass("sapContrastPlus");f.addDependent(h);}var w=function(){if(typeof i!=="function"){return;}var x=s.getSelectedItems().map(function(z){return s.indexOfItem(z);});var y=n();y.forEach(function(z){i(z,x);});if(!o){l.removeSelections(true);this._onSelectionChange();}else if(o.getSelected()){o.setSelected(false);this._onSelectionChange();}}.bind(this);};});
