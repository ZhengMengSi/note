sap.ui.define(["sap/ui/base/Object","sap/suite/ui/generic/template/js/StableIdHelper","sap/suite/ui/generic/template/lib/MessageUtils","sap/base/util/extend","sap/suite/ui/generic/template/lib/testableHelper"],function(B,S,M,e,t){"use strict";function g(s,c,T){function G(){var i=S.getStableId({type:"ListReportAction",subType:"CreateWithDialog"});return i;}function f(d){if(d&&d.getBindingContext&&c&&d.getBindingContext().getPath){return{"aFilters":[{sPath:"fullTarget",sOperator:"StartsWith",oValue1:d.getBindingContext().getPath()},{sPath:"target",sOperator:"EQ",oValue1:"/"+c.getOwnerComponent().getEntitySet()}]};}}function r(d){var o=f(d);var m=sap.ui.getCore().getMessageManager().getMessageModel();if(o){var h=m.bindList("/",null,null,[o]);var i=h.getContexts();if(i.length){var E=[];for(var j in i){E.push(i[j].getObject());}sap.ui.getCore().getMessageManager().removeMessages(E);}}}function C(){var d=c.byId(G());if(d&&c&&T){d.close();if(T.oComponentUtils.isDraftEnabled()){T.oServices.oCRUDManager.deleteEntities([d.getBindingContext().getPath()],true);}else{r(d);c.getView().getModel().deleteCreatedEntry(d.getBindingContext());}d.setBindingContext(null);}}function a(E){var m=false;var o=sap.ui.getCore().getMessageManager().getMessageModel().getData();for(var i=0;i<o.length;i++){if(o[i].type==="Error"&&o[i].validation){m=true;}}if(!m&&T.oComponentUtils.isDraftEnabled()){s.oSaveScenarioHandler=T.oServices.oApplication.getSaveScenarioHandler(c,T.oCommonUtils);T.oCommonUtils.executeIfControlReady(s.oSaveScenarioHandler.handleSaveScenario.bind(null,1,A()),E.getSource().getId());}else if(!m){var v=c.getView();var d=v.getModel();var p=d.getPendingChanges();var P=Object.create(null);if(p){for(var h in p){if(p.hasOwnProperty(h)){var j=d.getContext("/"+h);P[h]={context:j,change:p[h]};}}}T.oCommonEventHandlers.submitChangesForSmartMultiInput();var D=c.byId(G());var F=f(D);var k=T.oServices.oCRUDManager.saveEntity(F);k.then(function(){if(D&&s&&T){D.close();T.oCommonUtils.refreshModel(s.oSmartTable);T.oCommonUtils.refreshSmartTable(s.oSmartTable);r(D);D.setBindingContext(null);}});var l={saveEntityPromise:k};T.oComponentUtils.fire(c,"AfterSave",l);}}function A(){var d=c.byId(G());if(d&&s&&T){var o=T.oServices.oCRUDManager.activateDraftEntity(s.oSaveScenarioHandler,d.getBindingContext());o.then(function(R){if(R&&R.response&&R.response.statusCode==="200"){d.close();d.setBindingContext(null);M.showSuccessMessageIfRequired(T.oCommonUtils.getText("OBJECT_SAVED"),T.oServices);T.oCommonUtils.refreshSmartTable(s.oSmartTable);}},Function.prototype);var E={activationPromise:o};T.oComponentUtils.fire(c,"AfterActivate",E);}}function b(E){var o=s.oSmartFilterbar;var d=c.byId(G());var h=T.oCommonUtils.getOwnerControl(E);h=T.oCommonUtils.isSmartTable(h)?h:h.getParent();if(T.oComponentUtils.isDraftEnabled()){T.oCommonEventHandlers.addEntry(E,false,o,false,false,true).then(function(i){T.oServices.oApplication.registerContext(i);d.setBindingContext(i);d.open();});}else{var n=T.oServices.oApplication.createNonDraft(h.getEntitySet());d.setBindingContext(n);d.open();}}t.testableStatic(A,"CreateWithDialogHelper_fnActivateImpl");t.testableStatic(r,"CreateWithDialogHelper_fnRemoveOldMessageFromModel");t.testableStatic(f,"CreateWithDialogHelper_fnGetFilterForCurrentState");return{getStableIdForDialog:G,onCancelPopUpDialog:C,onSavePopUpDialog:a,createWithDialog:b};}return B.extend("sap.suite.ui.generic.template.ListReport.controller.CreateWithDialogHelper",{constructor:function(s,c,T){e(this,g(s,c,T));}});});
